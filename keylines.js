//
//     KeyLines v4.7.0-11899 professional eval
//     Licensed to Alpine consulting, inc. for OEM Law Enforcement expires on Wed Oct 31 2018
//
//     Copyright © 2011-2018 Cambridge Intelligence Limited.
//     All rights reserved.
//
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.KeyLines=t()}(this,function(){"use strict";var e,t=function(e,t){if(e&&"object"==typeof e)if(Array.isArray(e))e.forEach(t);else for(var n=Object.keys(e),r=n.length,i=0;i<r;i++){var a=n[i];t(e[a],a)}};function n(){if("undefined"!=typeof window)return window.devicePixelRatio||1}function r(e){return"rtl"===window.getComputedStyle(e).direction}function i(e){if(null===e)return null;switch(typeof e){case"object":if(Array.isArray(e))return e.slice();if(s(e))return l(e);if(e instanceof Date)return new Date(e.getTime());var n={};t(e,function(e,t){n[t]=e});return n;case"boolean":case"string":case"number":return e;default:return}}function a(e){return e*(Math.PI/180)}function o(e,n,r){var i,a=n,u=r;if(2===arguments.length&&"string"==typeof a){u=a;a=!0}if(null===e)return null;function c(e,t){a&&"_"===t.charAt(0)||(i[t]=o(e,a&&t!==u))}switch(typeof e){case"object":if(Array.isArray(e)){for(var f=[],d=0;d<e.length;d++)f.push(o(e[d],a,u));return f}if(s(e))return l(e,!0);if(e instanceof Date)return new Date(e.getTime());i={};t(e,c);return i;case"boolean":case"string":case"number":return e;default:return}}function l(e,t){var n,r=Object.getPrototypeOf(e).constructor;if(t){n=new r;o(Array.from(e)).forEach(function(e){n.add?n.add(e):n.set(e[0],e[1])})}else n=new r(e);return n}function u(){return Object.isPrototypeOf&&Array.from&&"undefined"!=typeof Set&&"undefined"!=typeof Map}function s(t){null==e&&u&&(e=u());return!!e&&(Object.prototype.isPrototypeOf.call(Map.prototype,t)||Object.prototype.isPrototypeOf.call(Set.prototype,t))}function c(e,t){if(m(e))return setTimeout(e,t)}function f(e,t){if(m(e))return setInterval(e,t)}function d(){if(!KeyLines._loggerDisabled&&"undefined"!=typeof console){var e=[].slice.call(arguments).join(" ");console.log(e)}}var g=Number.isNaN||function(e){return e!=e},h=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};function v(e){return e>>>0===parseFloat(e)}function m(e){return"function"==typeof e}function p(e,t){var n=t||"";return n.slice(Math.max(n.length-5,0))==="."+e}function b(e){return"data:image/"===(e||"").slice(0,11)}function y(e){return!("object"!=typeof e||e instanceof Date||Array.isArray(e)||M(e))}function I(e){return"[object Date]"===Object.prototype.toString.call(e)&&!g(e.getTime())}function x(e,t){e&&m(e)&&e(t)}var C=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function G(e,t){try{t(null,e())}catch(e){t(e)}}function w(e){return e&&!Array.isArray(e)&&e.items?e.items:e}function Z(e){return Array.isArray(e)?e:[e]}function A(e,n){var r=o(e)||{};if("string"==typeof e)return e;t(n,function(e,t){R(r,t)&&!M(r[t])||(r[t]=e)});return r}function B(e){return void 0!==e}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function M(e){return null==e}function W(){return"✄"}function V(e){return e.lastIndexOf(W())}function S(e){if(M(e))return null;var t=e+"",n=V(t);-1!==n&&(t=t.substring(0,n));return t}function k(e){if(M(e))return null;var t=e+"",n=V(t);return-1!==n?t.substring(n+1):null}function X(e,t){return e.indexOf(t)>-1}var E=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})};function F(e){return Object.keys(e).length>0}function Y(e){return Z(e).reduce(function(e,t){e[S(t)]=1;return e},{})}function H(e){return Z(e).reduce(function(e,t){e.set(S(t),1);return e},new Map)}function z(e){var t={};e.forEach(function(e){t[e.id]=e});return t}function T(e){var t={};e.forEach(function(e){t[e]=e});return t}function N(e){return e.map(function(e){return e.id})}function U(e,n){if(e){t(n,function(t,n){e[n]=t});return e}return n}var D=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n};function O(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))}function _(e,t){var n=e,r=t,i=O(n,r);return[n/=i,r/=i]}function K(e,t,n,r){var i=_(e,t),a=_(n,r);return i[0]*a[0]+i[1]*a[1]}function P(){}function J(e,t,n){var r=!e();function i(){r||(r=t())||(r=!e());return r?n():c(i,0)}i()}function j(e,t){var n,r,i,a;return function(){var o=Date.now();i=this;a=arguments;function l(){r=Date.now();e.apply(i,a)}if(!n)if(!r||o-r>=t)l();else{n=c(function(){n=null;l()},t-(o-r))}}}function Q(e){var t=e,n=48271,r=2147483647,i=r/n,a=r%n,o=1/r;return{setSeed:function(e){t=e},next:function(){if(t){var e=n*(t%i)-a*(t/i);return(t=e>0?e:e+r)*o}return Math.random()}}}function q(e,n){t(e,function(e){if(e&&e.im&&$(e.im)){e.im=n;e.missing=!0}})}function $(e){var t=void 0!==e.naturalWidth&&0===e.naturalWidth;if(!b(e.src)&&p("svg",e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}var ee={};function te(e){if(!ee[e]){var t=e;e.match(/'/)&&(t=e.replace(/'/g,"\\'"));t.match(/\s/)&&(t="'"+t+"'");ee[e]=t}return ee[e]}function ne(e){return re(e,e.target.id)}function re(e,t){var n=ie(t);return{x:Math.floor(e.pageX-n.left),y:Math.floor(e.pageY-n.top)}}function ie(e){var t=document.getElementById(e),n={top:0,left:0};t&&(n=t.getBoundingClientRect());return{top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft}}function oe(e){for(var t=0,n=e.length;t<n;t++){var r=e.charCodeAt(t);if(r>=1536&&(r<=1791||r>=64336&&r<=65023||r>=65136&&r<=65279||r>=1872&&r<=1919||r>=2208&&r<=2303))return!0}return!1}function le(e){return Math.floor(e*(11/14))}function ue(e){var t=e.charCodeAt(0);return t<=55295||t>=57344?t:1024*(t-55296)+(e.charCodeAt(1)-56320)+65536}function se(e){return[[169,169],[174,174],[8252,8252],[8265,8265],[8419,8419],[8482,8482],[8505,8505],[8596,8601],[8617,8618],[8986,8987],[9e3,9e3],[9096,9096],[9167,9167],[9193,9203],[9208,9210],[9410,9410],[9642,9643],[9654,9654],[9664,9664],[9723,9726],[9728,9733],[9735,9746],[9748,9861],[9872,9989],[9992,10002],[10004,10004],[10006,10006],[10013,10013],[10017,10017],[10024,10024],[10035,10036],[10052,10052],[10055,10055],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10083,10087],[10133,10135],[10145,10145],[10160,10160],[10175,10175],[10548,10549],[11013,11015],[11035,11036],[11088,11088],[11093,11093],[12336,12336],[12349,12349],[12951,12951],[12953,12953],[65039,65039],[126976,127231],[127245,127247],[127279,127279],[127340,127345],[127358,127359],[127374,127374],[127377,127386],[127405,127487],[127489,127503],[127514,127514],[127535,127535],[127538,127546],[127548,127551],[127561,128317],[128326,128591],[128640,128767],[128884,128895],[128981,129023],[129036,129039],[129096,129103],[129114,129119],[129160,129167],[129198,129279],[129292,129338],[129340,129349],[129351,131069],[917536,917631]].some(function(t){return e>=t[0]&&e<=t[1]})}function ce(e){return fe(e).some(function(e){return se(ue(e))})}function fe(e){for(var t,n=0,r=e.length,i=[];n<r;++n){t=!1;var a=e.charCodeAt(n);if(a>=55296&&a<=56319&&n+1<r&&(a=e.charCodeAt(n+1))>=56320&&a<=57343){i.push(e.slice(n,n+2));++n;t=!0}t||i.push(e.charAt(n))}return i}function de(e){var t,n,r,i=[],a=e.length;for(t=0;t<a;t++){r=ue(n=e[t]);if(0===t)i.push(n);else if(u(r))i[i.length-1]+=n;else if(65038===r||65039===r)i[i.length-1]+=n;else if(o(r))i[i.length-1]+=n;else if(l(r)&&2===i[i.length-1].length&&l(ue(i[i.length-1])))i[i.length-1]+=n;else if(8205===r&&ce(i[i.length-1])&&t<a-1&&se(ue(e[t+1]))){i[i.length-1]+=n;i[i.length-1]+=e[++t]}else r>=917536&&r<=917631?i[i.length-1]+=n:i.push(n)}function o(e){return e>=127995&&e<=127999}function l(e){return e>=127462&&e<=127487}function u(e){return e>=768&&e<=879||e>=8400&&e<=8447}return i}var ge={},he=0,ve=1,me=2,pe=3,be=4,ye=5,Ie=6,xe=7,Ce=8,Ge=9,we=10,Ze=11,Ae=12,Be=13,Re=14,Me=15,We=16,Ve=17,Se=18,ke=2,Xe=5,Ee=[9,Se,10,Ie,11,ye,12,Ie,13,Ce,14,ye,28,Se,31,ye,32,Ie,33,Ce,35,be,38,Ze,43,be,44,we,45,Ge,46,we,48,Ge,58,me,59,Ge,65,be,91,he,97,be,123,he,127,be,133,Se,134,ye,160,Se,161,Ge,162,be,166,Ze,170,be,171,he,173,be,174,Se,176,be,178,Ze,180,me,181,be,182,he,185,be,186,me,187,he,192,be,215,he,216,be,247,he,248,be,697,he,699,be,706,he,720,be,722,he,736,be,741,he,750,be,751,he,768,be,880,Ae,884,he,886,be,894,he,895,be,900,he,902,be,903,he,904,be,1014,he,1015,be,1155,he,1162,Ae,1418,he,1423,be,1425,Ze,1470,Ae,1471,ve,1472,Ae,1473,ve,1475,Ae,1476,ve,1478,Ae,1479,ve,1488,Ae,1536,ve,1542,pe,1544,be,1545,xe,1547,Ze,1548,xe,1549,Ge,1550,xe,1552,be,1563,Ae,1611,xe,1632,Ae,1642,pe,1643,Ze,1645,pe,1648,xe,1649,Ae,1750,xe,1757,Ae,1758,pe,1759,be,1765,Ae,1767,xe,1769,Ae,1770,be,1774,Ae,1776,xe,1786,me,1809,xe,1810,Ae,1840,xe,1869,Ae,1958,xe,1969,Ae,1984,xe,2027,ve,2036,Ae,2038,ve,2042,be,2070,ve,2074,Ae,2075,ve,2084,Ae,2085,ve,2088,Ae,2089,ve,2096,Ae,2137,ve,2142,Ae,2208,ve,2260,xe,2274,Ae,2275,pe,2307,Ae,2362,he,2363,Ae,2364,he,2365,Ae,2369,he,2377,Ae,2381,he,2382,Ae,2385,he,2392,Ae,2402,he,2404,Ae,2433,he,2434,Ae,2492,he,2493,Ae,2497,he,2503,Ae,2509,he,2510,Ae,2530,he,2534,Ae,2546,he,2548,Ze,2555,he,2561,Ze,2563,Ae,2620,he,2622,Ae,2625,he,2649,Ae,2672,he,2674,Ae,2677,he,2691,Ae,2748,he,2749,Ae,2753,he,2761,Ae,2765,he,2768,Ae,2786,he,2790,Ae,2801,he,2809,Ze,2817,he,2818,Ae,2876,he,2877,Ae,2879,he,2880,Ae,2881,he,2887,Ae,2893,he,2903,Ae,2914,he,2918,Ae,2946,he,2947,Ae,3008,he,3009,Ae,3021,he,3024,Ae,3059,he,3065,be,3066,Ze,3072,be,3073,Ae,3134,he,3137,Ae,3142,he,3160,Ae,3170,he,3174,Ae,3192,he,3199,be,3201,he,3202,Ae,3260,he,3261,Ae,3276,he,3285,Ae,3298,he,3302,Ae,3329,he,3330,Ae,3393,he,3398,Ae,3405,he,3406,Ae,3426,he,3430,Ae,3530,he,3535,Ae,3538,he,3544,Ae,3633,he,3634,Ae,3636,he,3647,Ae,3648,Ze,3655,he,3663,Ae,3761,he,3762,Ae,3764,he,3773,Ae,3784,he,3792,Ae,3864,he,3866,Ae,3893,he,3894,Ae,3895,he,3896,Ae,3897,he,3898,Ae,3902,be,3953,he,3967,Ae,3968,he,3973,Ae,3974,he,3976,Ae,3981,he,4030,Ae,4038,he,4039,Ae,4141,he,4145,Ae,4146,he,4152,Ae,4153,he,4155,Ae,4157,he,4159,Ae,4184,he,4186,Ae,4190,he,4193,Ae,4209,he,4213,Ae,4226,he,4227,Ae,4229,he,4231,Ae,4237,he,4238,Ae,4253,he,4254,Ae,4957,he,4960,Ae,5008,he,5024,be,5120,he,5121,be,5760,he,5761,Ce,5787,he,5792,be,5906,he,5920,Ae,5938,he,5941,Ae,5970,he,5984,Ae,6002,he,6016,Ae,6068,he,6070,Ae,6071,he,6078,Ae,6086,he,6087,Ae,6089,he,6100,Ae,6107,he,6108,Ze,6109,he,6112,Ae,6128,he,6155,be,6158,Ae,6160,Se,6277,he,6279,Ae,6313,he,6314,Ae,6432,he,6435,Ae,6439,he,6441,Ae,6450,he,6451,Ae,6457,he,6464,Ae,6470,be,6622,he,6656,be,6679,he,6681,Ae,6683,he,6686,Ae,6742,he,6743,Ae,6744,he,6753,Ae,6754,he,6755,Ae,6757,he,6765,Ae,6771,he,6784,Ae,6832,he,6916,Ae,6964,he,6965,Ae,6966,he,6971,Ae,6972,he,6973,Ae,6978,he,6979,Ae,7019,he,7028,Ae,7040,he,7042,Ae,7074,he,7078,Ae,7080,he,7082,Ae,7083,he,7086,Ae,7142,he,7143,Ae,7144,he,7146,Ae,7149,he,7150,Ae,7151,he,7154,Ae,7212,he,7220,Ae,7222,he,7227,Ae,7376,he,7379,Ae,7380,he,7393,Ae,7394,he,7401,Ae,7405,he,7406,Ae,7412,he,7413,Ae,7416,he,7424,Ae,7616,he,7680,Ae,8125,he,8126,be,8127,he,8130,be,8141,he,8144,be,8157,he,8160,be,8173,he,8178,be,8189,he,8192,be,8203,Ce,8206,Se,8207,he,8208,ve,8232,be,8233,Ce,8234,ye,8235,Be,8236,Re,8237,Me,8238,We,8239,Ve,8240,Ge,8245,Ze,8260,be,8261,Ge,8287,be,8288,Ce,8294,Se,8298,null,8304,Se,8305,me,8308,he,8314,me,8316,we,8319,be,8320,he,8330,me,8332,we,8336,be,8352,he,8400,Ze,8448,Ae,8450,be,8451,he,8455,be,8456,he,8458,be,8468,he,8469,be,8470,he,8473,be,8478,he,8484,be,8485,he,8486,be,8487,he,8488,be,8489,he,8490,be,8494,he,8495,Ze,8506,he,8508,be,8512,he,8517,be,8522,he,8526,be,8528,he,8544,be,8585,he,8722,be,8723,we,8724,Ze,9014,be,9083,he,9109,be,9110,he,9352,be,9372,me,9450,he,9900,be,9901,he,10240,be,10496,he,11264,be,11493,he,11499,be,11503,he,11506,Ae,11513,he,11520,be,11647,he,11648,Ae,11744,he,11776,Ae,12288,be,12289,Ce,12293,be,12296,he,12321,be,12330,he,12334,Ae,12336,he,12337,be,12342,he,12344,be,12349,he,12353,be,12441,he,12443,Ae,12445,be,12448,he,12449,be,12539,he,12540,be,12736,he,12784,be,12829,he,12832,be,12880,he,12896,be,12924,he,12927,be,12977,he,12992,be,13004,he,13008,be,13175,he,13179,be,13278,he,13280,be,13311,he,13312,be,19904,he,19968,be,42128,he,42192,be,42509,he,42512,be,42607,he,42611,Ae,42612,be,42622,Ae,42624,be,42654,he,42656,Ae,42736,he,42738,Ae,42752,he,42786,be,42888,he,42889,be,43010,he,43011,Ae,43014,he,43015,Ae,43019,he,43020,Ae,43045,he,43047,Ae,43048,he,43056,be,43064,he,43072,Ze,43124,he,43136,be,43204,he,43214,Ae,43232,he,43250,Ae,43302,he,43310,Ae,43335,he,43346,Ae,43392,he,43395,Ae,43443,he,43444,Ae,43446,he,43450,Ae,43452,he,43453,Ae,43493,he,43494,Ae,43561,he,43567,Ae,43569,he,43571,Ae,43573,he,43584,Ae,43587,he,43588,Ae,43596,he,43597,Ae,43644,he,43645,Ae,43696,he,43697,Ae,43698,he,43701,Ae,43703,he,43705,Ae,43710,he,43712,Ae,43713,he,43714,Ae,43756,he,43758,Ae,43766,he,43777,Ae,44005,he,44006,Ae,44008,he,44009,Ae,44013,he,44016,Ae,64285,he,64286,ve,64287,Ae,64297,ve,64298,we,64336,ve,64830,xe,64848,be,65021,xe,65024,be,65040,Ae,65056,be,65072,Ae,65104,be,65105,Ge,65106,be,65108,Ge,65109,be,65110,Ge,65119,be,65120,Ze,65122,be,65124,we,65129,be,65131,Ze,65136,be,65279,xe,65281,Se,65283,be,65286,Ze,65291,be,65292,we,65293,Ge,65294,we,65296,Ge,65306,me,65307,Ge,65313,be,65339,he,65345,be,65371,he,65382,be,65504,he,65506,Ze,65509,be,65512,Ze,1114109,be],Fe={1536:{t:4},1537:{t:4},1538:{t:4},1539:{t:4},1540:{t:4},1541:{t:4},1544:{t:4},1547:{t:4},1568:{t:2},1569:{t:4,isolated:65152},1570:{t:1,isolated:65153,initial:65154},1571:{t:1,isolated:65155,initial:65156},1572:{t:1,isolated:65157,initial:65158},1573:{t:1,isolated:65159,initial:65160},1574:{t:2,isolated:65161,final:65163,median:65164,initial:65162},1575:{t:1,isolated:65165,initial:65166},1576:{t:2,isolated:65167,final:65169,median:65170,initial:65168},1577:{t:1,isolated:65171,initial:65172},1578:{t:2,isolated:65173,final:65175,median:65176,initial:65174},1579:{t:2,isolated:65177,final:65179,median:65180,initial:65178},1580:{t:2,isolated:65181,final:65183,median:65184,initial:65182},1581:{t:2,isolated:65185,final:65187,median:65188,initial:65186},1582:{t:2,isolated:65189,final:65191,median:65192,initial:65190},1583:{t:1,isolated:65193,initial:65194},1584:{t:1,isolated:65195,initial:65196},1585:{t:1,isolated:65197,initial:65198},1586:{t:1,isolated:65199,initial:65200},1587:{t:2,isolated:65201,final:65203,median:65204,initial:65202},1588:{t:2,isolated:65205,final:65207,median:65208,initial:65206},1589:{t:2,isolated:65209,final:65211,median:65212,initial:65210},1590:{t:2,isolated:65213,final:65215,median:65216,initial:65214},1591:{t:2,isolated:65217,final:65219,median:65220,initial:65218},1592:{t:2,isolated:65221,final:65223,median:65224,initial:65222},1593:{t:2,isolated:65225,final:65227,median:65228,initial:65226},1594:{t:2,isolated:65229,final:65231,median:65232,initial:65230},1595:{t:2},1596:{t:2},1597:{t:2},1598:{t:2},1599:{t:2},1600:{t:3,isolated:1600,final:1600,median:1600,initial:1600},1601:{t:2,isolated:65233,final:65235,median:65236,initial:65234},1602:{t:2,isolated:65237,final:65239,median:65240,initial:65238},1603:{t:2,isolated:65241,final:65243,median:65244,initial:65242},1604:{t:2,isolated:65245,final:65247,median:65248,initial:65246},1605:{t:2,isolated:65249,final:65251,median:65252,initial:65250},1606:{t:2,isolated:65253,final:65255,median:65256,initial:65254},1607:{t:2,isolated:65257,final:65259,median:65260,initial:65258},1608:{t:1,isolated:65261,initial:65262},1609:{t:2,isolated:65263,initial:65264},1610:{t:2,isolated:65265,final:65267,median:65268,initial:65266},1646:{t:2},1647:{t:2},1649:{t:1},1650:{t:1},1651:{t:1},1652:{t:4},1653:{t:1},1654:{t:1},1655:{t:1},1656:{t:2},1657:{t:2},1658:{t:2},1659:{t:2},1660:{t:2},1661:{t:2},1662:{t:2,isolated:64342,final:64344,median:64345,initial:64343},1663:{t:2},1664:{t:2},1665:{t:2},1666:{t:2},1667:{t:2},1668:{t:2},1669:{t:2},1670:{t:2,isolated:64378,final:64380,median:64381,initial:64379},1671:{t:2},1672:{t:1},1673:{t:1},1674:{t:1},1675:{t:1},1676:{t:1},1677:{t:1},1678:{t:1},1679:{t:1},1680:{t:1},1681:{t:1},1682:{t:1},1683:{t:1},1684:{t:1},1685:{t:1},1686:{t:1},1687:{t:1},1688:{t:1,isolated:64394,initial:64395},1689:{t:1},1690:{t:2},1691:{t:2},1692:{t:2},1693:{t:2},1694:{t:2},1695:{t:2},1696:{t:2},1697:{t:2},1698:{t:2},1699:{t:2},1700:{t:2},1701:{t:2},1702:{t:2},1703:{t:2},1704:{t:2},1705:{t:2,isolated:64398,final:64400,median:64401,initial:64399},1706:{t:2},1707:{t:2},1708:{t:2},1709:{t:2},1710:{t:2},1711:{t:2,isolated:64402,final:64404,median:64405,initial:64403},1712:{t:2},1713:{t:2},1714:{t:2},1715:{t:2},1716:{t:2},1717:{t:2},1718:{t:2},1719:{t:2},1720:{t:2},1721:{t:2},1722:{t:2},1723:{t:2},1724:{t:2},1725:{t:2},1726:{t:2},1727:{t:2},1728:{t:1},1729:{t:2},1730:{t:2},1731:{t:1},1732:{t:1},1733:{t:1},1734:{t:1},1735:{t:1},1736:{t:1},1737:{t:1},1738:{t:1},1739:{t:1},1740:{t:2,isolated:64508,final:64510,median:64511,initial:64509},1741:{t:1},1742:{t:2},1743:{t:1},1744:{t:2},1745:{t:2},1746:{t:1},1747:{t:1},1749:{t:1},1757:{t:4},1774:{t:1},1775:{t:1},1786:{t:2},1787:{t:2},1788:{t:2},1791:{t:2},1808:{t:1},1810:{t:2},1811:{t:2},1812:{t:2},1813:{t:1},1814:{t:1},1815:{t:1},1816:{t:1},1817:{t:1},1818:{t:2},1819:{t:2},1820:{t:2},1821:{t:2},1822:{t:1},1823:{t:2},1824:{t:2},1825:{t:2},1826:{t:2},1827:{t:2},1828:{t:2},1829:{t:2},1830:{t:2},1831:{t:2},1832:{t:1},1833:{t:2},1834:{t:1},1835:{t:2},1836:{t:1},1837:{t:2},1838:{t:2},1839:{t:1},1869:{t:1},1870:{t:2},1871:{t:2},1872:{t:2},1873:{t:2},1874:{t:2},1875:{t:2},1876:{t:2},1877:{t:2},1878:{t:2},1879:{t:2},1880:{t:2},1881:{t:1},1882:{t:1},1883:{t:1},1884:{t:2},1885:{t:2},1886:{t:2},1887:{t:2},1888:{t:2},1889:{t:2},1890:{t:2},1891:{t:2},1892:{t:2},1893:{t:2},1894:{t:2},1895:{t:2},1896:{t:2},1897:{t:2},1898:{t:2},1899:{t:1},1900:{t:1},1901:{t:2},1902:{t:2},1903:{t:2},1904:{t:2},1905:{t:1},1906:{t:2},1907:{t:1},1908:{t:1},1909:{t:2},1910:{t:2},1911:{t:2},1912:{t:1},1913:{t:1},1914:{t:2},1915:{t:2},1916:{t:2},1917:{t:2},1918:{t:2},1919:{t:2},2208:{t:2},2209:{t:2},2210:{t:2},2211:{t:2},2212:{t:2},2213:{t:2},2214:{t:2},2215:{t:2},2216:{t:2},2217:{t:2},2218:{t:1},2219:{t:1},2220:{t:1},2221:{t:4},2222:{t:1},2223:{t:2},2224:{t:2},2225:{t:1},2226:{t:1},2227:{t:2},2228:{t:2},2230:{t:2},2231:{t:2},2232:{t:2},2233:{t:1},2234:{t:2},2235:{t:2},2236:{t:2},2237:{t:2},2274:{t:4},8204:{t:4},8205:{t:3},8239:{t:4},8294:{t:4},8295:{t:4},8296:{t:4},8297:{t:4},65269:{t:1,isolated:65269,initial:65270},65271:{t:1,isolated:65271,initial:65272},65273:{t:1,isolated:65273,initial:65274},65275:{t:1,isolated:65275,initial:65276}},Ye={1611:1,1612:1,1613:1,1614:1,1615:1,1616:1,1617:1,1618:1,1619:1,1620:1,1621:1,1648:1},He={1456:1,1457:1,1458:1,1459:1,1460:1,1461:1,1462:1,1463:1,1464:1,1465:1,1466:1,1467:1,1473:1,1474:1},Le={"ل":{"ا":"ﻻ","آ":"ﻵ","أ":"ﻷ","إ":"ﻹ"},"ا":{"ل":{"ل":{"ه":"ﷲ"}}}},ze={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{",">":"<","<":">"},Te=63;function Ne(e,t){if(ge[t])return ge[t];var n={characters:[],logicalOrder:e,result:[]},r=Ue(e),i=Ke(e,r),a=i.length;i.forEach(function(e,t){Pe(e);_e(e);if(0!==e.characters.length){De(e);Oe(e);it(e);at(e);st(e);ct(e);ot(e);dt(e,He,!1);ft(e);n.result=n.result.concat(e.reorderedCharacters);t<a-1&&n.result.push({text:"\n",level:0,type:ye});n.characters=n.characters.concat(e.characters)}});n.types=r;ge[t]=n;return n}function Ue(e){return e.map(function(e){return bt(e)||0})}function De(e){Je(e);je(e);Qe(e);qe(e);$e(e);et(e);tt(e)}function Oe(e){nt(e);rt(e)}function _e(e){var t=0,n=1,r=2,i=e.level,a=[];a.push({level:e.level,override:t});var o=0,l=a[0],u=l.level,s=[];function c(e,t){if(e<Te){a.push({level:e,override:t});return e}}e.characters.forEach(function(e){var f=e.type;if(f===Re){u+=It(u)?2:1;i=c(u,t)}else if(f===Be){u+=yt(u)?2:1;i=c(u,t)}else if(f===Ve){u+=It(u)?2:1;i=c(u,r)}else if(f===We){u+=yt(u)?2:1;i=c(u,n)}f===Me?a.length>1&&(l=a.pop()):l=a[a.length-1];i=l.level;u=i;if(-1===[Se,Re,Be,Ve,We,Me].indexOf(f)){l.override>t&&(e.type=l.override===r?ve:he);e.embeddingLevel=i;e.index=o++;s.push(e)}});e.characters=s}function Ke(e,t){var n=0,r=[],i=[];t.forEach(function(e){if(e!==ye)i.push(e);else if(i.length>0){a(i);n++;i.length=0}});i.length>0&&a(i);function a(t){var i=n,a=t.map(function(t){return{text:e[n++],level:0,embeddingLevel:null,type:t}}),o=e.slice(i,i+t.length);r.push({symbols:o,level:0,characters:a})}return r}function Pe(e){e.level=1}function Je(e){e.characters.filter(xt(Ae)).forEach(function(t){t.isNSM=!0;if(t.index>0){var n=e.characters[t.index-1].type;n===xe&&(t.type=xe);ve===n&&(t.type=ve)}})}function je(e){e.characters.filter(xt(me)).forEach(function(t){for(var n=t.index-1;n>=0;n--){var r=e.characters[n].type;if(r===xe){t.type=pe;break}if([ve,he].indexOf(r)>-1)break}})}function Qe(e){e.characters.filter(xt(xe)).forEach(function(e){e.type=ve;e.isAL=!0})}function qe(e){e.characters.filter(xt([we,Ge])).forEach(function(t){var n=t.index;if(n>0&&n<e.characters.length-1){var r=e.characters[n-1].type;r!==e.characters[n+1].type||r!==me&&r!==pe||(t.type=r)}})}function $e(e){e.characters.filter(xt(Ze)).forEach(function(t){var n=t.index,r=n;if(n>0){for(var i=e.characters[n-1].type;r-- >0&&i===Ze;)i=e.characters[r].type;if(i===me){t.type=me;return}}if(n<e.characters.length-1){var a=e.characters[n+1].type;r=n;for(;r++<e.characters.length-1&&a===Ze;)a=e.characters[r].type;a===me&&(t.type=me)}})}function et(e){e.characters.filter(xt([Ze,Ge,we,pe])).forEach(function(e){e.type=be})}function tt(e){e.characters.filter(xt(me)).forEach(function(t){for(var n=t.index-1;n>=0;n--){var r=e.characters[n].type;if(r===ve)return;if(r===he){t.type=he;return}}})}function nt(e){e.characters.filter(xt([ye,Ie,Ce,be])).forEach(function(t){var n=t.index;if(e.level<t.embeddingLevel)t.type=yt(t.embeddingLevel)?he:ve;else if(0!==n&&n!==e.characters.length-1&&n>0&&n<e.characters.length-1){for(var r=e.characters[n-1].type,i=e.characters[n+1].type,a=n;a-- >0&&-1===[ve,xe,me,pe,he].indexOf(r);)r=e.characters[a].type;a=n;for(;a++<e.characters.length-1&&-1===[ve,xe,me,pe,he].indexOf(i);)i=e.characters[a].type;[ve,xe,me,pe].indexOf(r)>-1&&[ve,xe,me,pe].indexOf(i)>-1?t.type=ve:t.type=r===he&&i===he?he:yt(t.embeddingLevel)?he:ve}})}function rt(e){e.characters.filter(xt([ye,Ie,Ce,be])).forEach(function(e){e.type=yt(e.embeddingLevel)?he:ve})}function it(e){var t;e.characters.forEach(function(e){var n=e.type;t=e.embeddingLevel;n===he?It(t)&&t++:n===ve||n===xe?yt(t)&&t++:n!==me&&n!==pe||(yt(t)?t+=2:t++);e.level=t})}function at(e){e.characters.filter(function(e){return ze[e.text]&&It(e.level)}).forEach(function(e){e.text=ze[e.text]})}function ot(e){var t=e.highestLevel;e.reorderedCharacters=o(e.characters);for(;t>0;){lt(e,t);t--}}function lt(e,t){var n,r=[];e.levelRuns.forEach(function(e){if(e.level>=t)if(n)n.endIndex+=e.length;else{n={startIndex:e.idx,endIndex:e.idx+e.length};r.push(n)}else n=null});r.forEach(function(t){ut(e,t)})}function ut(e,t){var n=t.startIndex,r=t.endIndex,i=e.reorderedCharacters.slice(n,r).reverse();e.reorderedCharacters=e.reorderedCharacters.slice(0,n).concat(i).concat(e.reorderedCharacters.slice(r))}function st(e){var t=0;e.characters.forEach(function(e){e.level>t&&(t=e.level)});e.highestLevel=t}function ct(e){var t=[],n=0,r=0,i={idx:0,length:0,level:e.characters[0].level};e.characters.forEach(function(e){if(e.level!==n&&0!==r){t.push(i);i={idx:r,length:0,level:e.level}}i.length++;r++;n=e.level});t.push(i);e.levelRuns=t}function ft(e){dt(e,Ye,!0);ht(e);mt(e);pt(e)}function dt(e,t,n){for(var r=e.reorderedCharacters.reverse(),i=[],a=0,o=r.length;a<o;a++){var l=r[a],u=gt(a,r,t);a+=u.length;n||(l.text+=u.join(""));i.push(l)}var s=0;e.reorderedCharacters=i.reverse();e.reorderedCharacters.forEach(function(e){e.index=s++})}function gt(e,t,n){for(var r=[],i=e+1;i<t.length;i++){if(!n[t[i].text.charCodeAt(0)])return r;r.push(t[i].text)}return r}function ht(e){for(var t=e.reorderedCharacters.reverse(),n=[],r=0,i=t.length;r<i;r++){var a=t[r],o=Le[a.text[0]];if(o){var l=vt(r,o,t);if(l){r+=l.length;a.text=l.text}}n.push(a)}var u=0;e.reorderedCharacters=n.reverse();e.reorderedCharacters.forEach(function(e){e.index=u++})}function vt(e,t,n){for(var r=0,i=t,a=e+1;a<n.length;a++){var o=i[n[a].text[0]];if(!o)return!1;if("string"==typeof o)return{text:o,length:++r};i=o}return!1}function mt(e){var t,n=function(){e.arabicTextRuns.push(t);t=null},r=e.reorderedCharacters;e.arabicTextRuns=[];for(var i=0,a=r.length;i<a;i++){var o=r[i].text.charCodeAt(0),l=Fe[o];if(l&&[ve,ke,he].indexOf(l.t)>-1){t||(t={startIndex:i});t.endIndex=i+1;if(i+1<a){var u=r[i+1].text.charCodeAt(0),s=Fe[u];s&&s.t===ve&&n()}else n();l.t===he&&n()}else l&&l.t===Xe||t&&n()}t&&n()}function pt(e){e.arabicTextRuns.forEach(function(t){for(var n,r=t.startIndex,i=t.endIndex,a=r;a<i;a++){var o=e.reorderedCharacters[a],l=Fe[o.text.charCodeAt(0)];n=null;i-r>1?a===r?n=l.initial:a===i-1?n=l.final:a>r&&a<i-1&&(n=l.median):n=l.isolated;n&&(o.text=String.fromCharCode(n)+o.text.substring(1))}})}function bt(e){for(var t=e.charCodeAt(0),n=0;n<Ee.length;n+=2)if(t<Ee[n])return Ee[n+1];return be}function yt(e){return e%2==0}function It(e){return e%2!=0}function xt(e){var t=Z(e);return function(e){return t.indexOf(e.type)>-1}}var Ct=Object.freeze({analyseText:Ne}),Gt={},wt={},Zt="rgb(128, 128, 128)",At={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:Zt,gray:Zt,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",orange:"rgb(255,165,0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"};function Bt(e,t,n){return"rgb("+e+","+t+","+n+")"}function Rt(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"}var Mt=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,Wt=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,Vt=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,St=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;function kt(e){return!!Xt(e).length}function Xt(e){var t,n=[];if("string"!=typeof e)return n;var r=At[e.toLowerCase()]||e,i=r.match(Mt);i||(i=r.match(Wt));if(i){for(t=1;t<4;t++)n.push(parseInt(i[t],10));void 0!==i[4]&&n.push(+i[4])}else{if(!(i=r.match(St))&&(i=r.match(Vt)))for(t=1;t<4;t++)i[t]=""+i[t]+i[t];if(i)for(t=1;t<4;t++)n.push(parseInt(i[t],16))}return n}function Et(e){if("transparent"===e)return 0;var t=e.match(Wt);return t?parseFloat(t[4]):1}function Ft(e){var t=Xt(e),n=Tt(t[0],t[1],t[2]);n.push(Et(e));return n}function Yt(e){var t=Ut(e[0],e[1],e[2]);return Rt(t[0],t[1],t[2],e[3])}function Ht(e,t){return 1===t?e:Ot(e,t)}function Lt(e){function t(){return Math.floor(240*Math.random())}var n=Bt(t(),t(),t());return e&&n in e?Lt(e):n}function zt(e,t,n){var r;e&&(e.bg&&e.gh?r=t*n:e.bg?r=t:e.gh&&(r=n));return 0===r?1e-6:r}function Tt(e,t,n){var r,i,a=e/255,o=t/255,l=n/255,u=Math.max(a,o,l),s=Math.min(a,o,l),c=(u+s)/2;if(u===s){r=0;i=0}else{var f=u-s;i=c>.5?f/(2-u-s):f/(u+s);switch(u){case a:r=(o-l)/f+(o<l?6:0);break;case o:r=(l-a)/f+2;break;case l:r=(a-o)/f+4}r/=6}return[r,i,c]}function Nt(e,t,n){var r=n;r<0&&(r+=1);r>1&&(r-=1);return r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Ut(e,t,n){var r,i,a;if(0===t){r=n;i=n;a=n}else{var o=n<.5?n*(1+t):n+t-n*t,l=2*n-o;r=Nt(l,o,e+1/3);i=Nt(l,o,e);a=Nt(l,o,e-1/3)}return[Math.round(255*r),Math.round(255*i),Math.round(255*a)]}function Dt(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var i=n[r];if(e[i]){var a=Xt(e[i]);e[i]=Rt(a[0],a[1],a[2],t);e["w"+i][3]=255*t}}}function Ot(e,t){var n=e+t;if(!Gt[n]){var r=Xt(e),i=Et(e);Gt[n]=Rt(r[0],r[1],r[2],i*t)}return Gt[n]}function _t(e){if(e){if(!wt[e]){var t=Xt(e),n=Et(e);wt[e]=[t[0],t[1],t[2],Math.floor(255*n)]}return wt[e]}return e}var Kt=[0,0],Pt=[];function Jt(e){if(Kt[0]){Kt[0]=0;e.setLineDash(Pt);e.lineCap="butt"}}function jt(e){return e&&"solid"!==e}function Qt(e,t,n,r,i){var a,o;if("dotted"===r){a=.5;o=2*n}else o=(a=Math.max(2,2*n))/2;var l=Math.round(i?t/(a+o):(t+o)/(a+o));if(l>1&&(o=i?(t-l*a)/l:(t-l*a)/(l-1))>0){e.lineCap=a>1?"butt":"round";Kt[0]=a;Kt[1]=o;e.setLineDash(Kt)}return{dash:a,gap:o}}function qt(e,t,n){if(n)return t>=0?Math.max(1,t):-1;var r=4;return t>=0?e-t<r?Math.max(.2,t*((e-t)/r)):Math.max(1,t):-1}var $t=2*Math.PI;function en(e,t,n,r,i,a,o){var l,u;if(t.sm){l=n.sdim(t.r);u=n.sdim(t.bw)}else{l=n.dim(t.r);u=r?n.sw(t.bw):n.w(t.bw)}var s=zt(t.a,a,o),c=t.a,f=t.x+c.x,d=t.y+c.y;u=t.noMinBorderWidth?Math.max(1,u):qt(l,u,r);r?tn(e,n.x(f),n.y(d),l,t.bc&&t.sc,u,t.fc&&t.sc,t.fi):tn(e,n.x(f),n.y(d),l,s?Ot(t.bc,s):t.bc,u,s?Ot(t.fc,s):t.fc,t.fi,t.bs)}function tn(e,t,n,r,i,a,o,l,u){e.fillStyle=l?o:At.transparent;if(a>=0){jt(u,e)&&Qt(e,$t*r,a,u,!0);e.lineWidth=a;e.strokeStyle=i}e.beginPath();e.arc(t,n,r,0,$t,!1);e.closePath();l&&e.fill();if(a>=0){e.stroke();u&&Jt(e)}}var nn={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",roundrect:"RR",triangle:"TR",pentagon:"PE"},rn=14,an=26,on=Math.PI/2,ln={};var uB=new Date().getTime()/36774;var lr={a:"LTMxLC02NCwtNTgsLTYzLC0zNiwtNjgsLTY5LC02MiwtNTcsLTY4LC0zNCw4NywzOCwtMSw0MCwtMjEsLTQ2LC0yNA==",b:"LTIyLC01NiwtNTgsLTUsLTEyLC02MywtNjUsLTExLDEsLTY0LC03Myw1MiwyNSw0LDczLC0yLC0xNCw2LDE2LC0yMiwtNDYsLTcxLDM0LDEwLC01NA=="};try{var LL=new Date()/12636}catch(e){}var un={};function sn(){un={}}var cn="sans-serif",fn=1;function dn(e){fn=e}var gn=!1;function hn(e){gn=e}function vn(e,t,n,r){var i=!!n,a=te(r||cn);if(e!==un.context||t!==un.fontSize||i!==un.bold||a!==un.family){un.context=e;un.fontSize=t;un.bold=i;un.family=a;var o="normal"+" "+(i?"bold":"normal")+" "+t+"px"+" "+a;e.font=o;e.textBaseline="bottom"}}function mn(e,t,n,r,i,a){var o,l,u=t,s=n,c=r,f=i,d=e.a;u-=d.x;s-=d.y
;c-=d.x;f-=d.y;u=Math.round(u);s=Math.round(s);c=Math.round(c);f=Math.round(f);switch(e.p){case nn.circle:o=Math.abs((c-u)/2);l=Math.abs((f-s)/2);e.x=Math.floor(Math.min(u,c)+o);e.y=Math.floor(Math.min(s,f)+l);e.r=a;break;case nn.line:case nn.rect:case nn.roundrect:e.x1=Math.min(u,c);e.x2=Math.max(u,c);e.y1=Math.min(s,f);e.y2=Math.max(s,f);break;case nn.line3:break;case nn.text:e.x=Math.min(u,c);e.y=Math.max(s,f);break;case nn.image:e.x1=Math.min(u,c);e.y1=Math.min(s,f);e.x2=Math.max(u,c);e.y2=Math.max(s,f);break;case nn.triangle:case nn.pentagon:}}function pn(e,t){var n=0,r=0,i=0,a=0;switch(t.p){case nn.circle:n=t.x-t.r;r=t.x+t.r;i=t.y-t.r;a=t.y+t.r;break;case nn.line:case nn.rect:case nn.roundrect:case nn.image:n=Math.min(t.x1,t.x2);r=Math.max(t.x1,t.x2);i=Math.min(t.y1,t.y2);a=Math.max(t.y1,t.y2);break;case nn.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4);r=Math.max(t.x1,t.x2,t.x3,t.x4);i=Math.min(t.y1,t.y2,t.y3,t.y4);a=Math.max(t.y1,t.y2,t.y3,t.y4);break;case nn.text:var o=Nn(e,t.t,t.fs,t.bo,t.ff);n=t.x-(t.xc?o.width/2:0);i=t.y-o.height;r=n+o.width;a=t.y;break;case nn.triangle:n=Math.min(t.x1,t.x2,t.x3);r=Math.max(t.x1,t.x2,t.x3);i=Math.min(t.y1,t.y2,t.y3);a=Math.max(t.y1,t.y2,t.y3);break;case nn.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5);r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5);i=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5);a=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case nn.arc:var l=t.x+t.r*Math.cos(t.sa),u=t.y+t.r*Math.sin(t.sa),s=t.x+t.r*Math.cos(t.ea),c=t.y+t.r*Math.sin(t.ea);n=Math.min(l,s);r=Math.max(l,s);i=Math.min(u,c);a=Math.max(u,c);for(var f=(Math.floor(t.sa/on)+1)*on;f<t.ea;){var d=t.x+t.r*Math.cos(f),g=t.y+t.r*Math.sin(f);n=Math.min(n,d);r=Math.max(r,d);i=Math.min(i,g);a=Math.max(a,g);f+=on}}var h=t.a;return{x1:n+=h.x,y1:i+=h.y,x2:r+=h.x,y2:a+=h.y}}function bn(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}}function yn(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2}function In(e,t,n,r,i,a){var o=a||0;return Math.sqrt((e-r)*(e-r)+(t-i)*(t-i))+o<n}function xn(e,t,n,r,i){return e.x1<t&&r<e.x2&&e.y1<n&&i<e.y2}function Cn(e,t,n,r,i,a,o){var l=n*n;return(e-r)*(e-r)+(t-i)*(t-i)<l&&(e-r)*(e-r)+(t-o)*(t-o)<l&&(e-a)*(e-a)+(t-i)*(t-i)<l&&(e-a)*(e-a)+(t-o)*(t-o)<l}function Gn(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)}var wn=function(e,t,n,r,i,a,o){var l=Math.floor((n.x2-n.x1)/2),u=Math.floor((n.y2-n.y1)/2),s=1,c="-resize",f=Math.floor(4*r);Rn(e,t,{x:n.x1,y:n.y1},f,s,i+o+"nw"+c,a);Bn(e,t,{x:n.x1+l,y:n.y1},f,s,i+o+"n"+c,a);Rn(e,t,{x:n.x2,y:n.y1},f,s,i+o+"ne"+c,a);Bn(e,t,{x:n.x2,y:n.y1+u},f,s,i+o+"e"+c,a);Rn(e,t,{x:n.x2,y:n.y2},f,s,i+o+"se"+c,a);Bn(e,t,{x:n.x2-l,y:n.y2},f,s,i+o+"s"+c,a);Rn(e,t,{x:n.x1,y:n.y2},f,s,i+o+"sw"+c,a);Bn(e,t,{x:n.x1,y:n.y2-u},f,s,i+o+"w"+c,a)};function Zn(e){return"transparent"===e||e===At.transparent}var An,Bn=function(e,t,n,r,i,a,o){var l=t.x(n.x),u=t.y(n.y),s=Zn(o)?At.transparent:At.white;e.rect(l-r,u-r,l+r,u+r,o,i,s,!0,a)},Rn=function(e,t,n,r,i,a,o){var l=Zn(o)?At.transparent:At.white;e.circle(t.x(n.x),t.y(n.y),r+1,o,i,l,!0,a)};function Mn(e,t,n,r,i,a,o,l){var u=pn(t,r);wn(e,n,u,i,a,o,l)}function Wn(e,n,r,i,a,o){var l=0,u=0,s=0,f={},d=!1;function g(){if(l+u===s&&!d){d=!0;c(function(){o(u>0,f)})}}function h(){u++;g()}function v(){l++;g()}t(r,function(t,n){s++;uB;if(uB>41905433){return;}uB;var r=e();i&&(r.crossOrigin="");r.onload=v;r.onerror=h;f[n]=r});F(f)?t(f,function(e,t){e.src=n+t}):o(null,f)}function Vn(){return n()>=1.5}function Sn(e){var t=e.length-4;return e.substr(0,t)+"@2x.png"}function kn(e,t,n,r,i,a){var o=Ht(t,n);if(a){e.fillStyle=o;e.fillRect(0,0,r,i)}else{(e.webgl?e.webglCanvas:e.canvas).style.background=o}}function Xn(e,t,n,r,i,a){if(t)if(a){for(var o=e.createLinearGradient(0,0,0,i),l=0;l<t.length;l++)o.addColorStop(t[l].r,Ht(t[l].c,n));e.fillStyle=o;e.fillRect(0,0,r,i)}else{for(var u=e.webgl?e.webglCanvas:e.canvas,s="linear-gradient(",c=0,f=t.length;c<f;c++){var d=t[c];s+=Ht(d.c,n);s+=" "+100*parseFloat(d.r)+"%";c+1<f&&(s+=",")}s+=")";u.style.background=s}}function En(e){var t;"string"==typeof e&&(t=e.split(",")[0]);return t}function Fn(e,t){if(C(e))return e;var n=Yn();t?document.getElementById(t).appendChild(n):document.body.appendChild(n);var r=e.replace(/\./g,"");n.className!==r&&(n.className=r);var i=window.getComputedStyle(n,":before").getPropertyValue("content");n.parentNode&&n.parentNode.removeChild(n);n.className="";return i.charCodeAt(1)||i.charCodeAt(0)}function Yn(){if(An)return An;var e=document.createElement("span");e.style.position="absolute";e.style.left="-10000px";e.style.top="-10000px";e.style.visibility="hidden";e.style.lineHeight="normal";e.style.fontSize="200px";e.style.fontVariant="normal";e.style.fontStyle="normal";e.style.letterSpacing="0";e.style.width="auto";e.style.height="auto";e.style.display="block";e.style.margin=0;e.style.padding=0;e.style.whiteSpace="nowrap";An=e;return e}function Hn(e,t,n){e.style.fontFamily=n;e.innerText=t}function Ln(e,t,n){var r=Yn();document.body.appendChild(r);Hn(r,e,n);var i=r.offsetHeight;Hn(r,"",void 0);return i/200*t||t}var zn={},Tn={};function Nn(e,t,n,r,i,a){var o=i||cn,l=t+!!r+o,u=0,s=0,c=zn[l],f=(h(n)?n:rn)/an;Tn[o]||(Tn[o]=Ln("|M",an,o));s=Tn[o];if(void 0===c){vn(e,an,r,i);a&&(s=Ln(t,an,o));if(e.webgl){oe(t)&&(s=le(an));u=Dn(e,t,s,an,r,o)}else u=e.measureText(t).width;c={width:u,height:s};zn[l]=c}return{width:Math.round(c.width*f),height:Math.round(c.height*f)}}function Un(){zn={};Tn={}}function Dn(e,t,n,r,i,a){var o,l,u=0,s=de(fe(t));if(oe(t)){var c=Ne(s,t).result;for(o=0,l=c.length;o<l;o++){var f=c[o];oe(f.text)?vn(e,n,i,a):vn(e,r,i,a);u+=e.measureText(f.text).width}}else for(o=0,l=s.length;o<l;o++)u+=e.measureText(s[o]).width;return u}function On(e,t,n){var r={},i={};Object.keys(e).forEach(function(a){if("updated"!==a&&"_coList"!==a&&t&&t[a]){var o=e[a].im,l=Math.min(o.width,o.height),u=l<o.height?Math.floor((o.height-l)/2):0,s=l<o.width?Math.floor((o.width-l)/2):0,c=Math.floor(l/2),f=n(l,l),d=f.getContext("2d");d.drawImage(o,s,u,l,l,0,0,l,l);var g=n(l,l).getContext("2d");g.clearRect(0,0,l,l);tn(g,c,c,c,At.white,-1,At.black,!0);try{for(var h=g.getImageData(0,0,l,l).data,v=d.getImageData(0,0,l,l),m=v.data,p=0;p<m.length;p+=4){var b=h[p+3];0===b?m[p+3]=0:b<255&&(m[p+3]=Math.floor(m[p+3]*b/255))}d.putImageData(v,0,0);f.src=o.src+"#ci";i[a]=f}catch(e){r[a]=!0;i[a]=!1}}});Object.keys(i).forEach(function(t){e[t].ci=r[t]?e[t].im:i[t]})}function _n(e,t,n,r,i){var a=.02,o=Xt(r),l=Tt(o[0],o[1],o[2]),u={},s=Xt(i),c=Tt(s[0],s[1],s[2]),f=Ut(c[0],c[1],l[2]);Object.keys(e).forEach(function(r){if("updated"!==r&&"_coList"!==r&&r in t&&t[r])try{var o=e[r].im,s=n(o.width,o.height),f=s.getContext("2d");f.clearRect(0,0,o.width,o.height);f.drawImage(o,0,0,o.width,o.height,0,0,o.width,o.height);for(var d=f.getImageData(0,0,o.width,o.height),g=d.data,h=0;h<g.length;h+=4){var v=Tt(g[h],g[h+1],g[h+2]);if(Math.abs(v[0]-l[0])<a){var m=Ut(c[0],c[1],v[2]);d.data[h]=m[0];d.data[h+1]=m[1];d.data[h+2]=m[2]}}f.putImageData(d,0,0);s.src=o.src+i;u[r]=s}catch(t){u[r]=e[r].im}});return{images:u,colour:f}}function Kn(e){var t=e.id||"canvas";void 0===ln[t]&&(ln[t]=r(e));return ln[t]}var Pn=Object.freeze({defaultFontSize:rn,baseLineFontSize:an,clearLastFont:sn,get browserMinimumFontSize(){return fn},setBrowserMinimumFontSize:dn,get minimumFontChecked(){return gn},setMinimumFontChecked:hn,setFont:vn,setExtents:mn,extents:pn,join:bn,inside:yn,insideCircle:In,rectContains:xn,circleContains:Cn,intersects:Gn,getHandles:Mn,imageLoader:Wn,useHiResImages:Vn,hiResUrl:Sn,backFill:kn,backgroundGradient:Xn,pickFirstFamily:En,getFontIcon:Fn,measureFontHeight:Ln,measureText:Nn,clearMeasureTextCache:Un,circularize:On,colorize:_n,isRTL:Kn});function Jn(){var e,t={};function n(e,t){for(var n=e.replace(/^\s*|\s*$/g,"").split(/[(\s*,\s*)|(\s+)]/),r=0;r<n.length;r++)t(n[r])}function r(t,r,i,a){var o=(e=e||{public:{},private:{}})[a];n(t,function(e){o[e]=o[e]||[];o[e].push({handler:r,context:i})})}t.bind=function(e,t,n){r(e,t,n,"public")};t.privateBind=function(e,t,n){r(e,t,n,"private")};function i(t,r,i){if(e&&e[i])if(t){var a=e[i];n(t,function(e){if(r){if(a[e]){for(var t=[],n=0;n<a[e].length;n++)r!==a[e][n].handler&&t.push(a[e][n]);a[e]=t}}else a[e]=[]})}else e[i]={}}t.unbind=function(e,t){i(e,t,"public")};t.privateUnbind=function(e,t){i(e,t,"private")};function a(e,t){var n=e[0],r=!1;if(t)for(var i,a=2;a--;){var o=a?n:"all",l=a?e.slice(1):e;if(t[o]){var s=t[o].slice(0);for(i=0;i<s.length;i++){var c=s[i];try{r=c.handler.apply(c.context||this,l)||r}catch(e){u(n,e)}}}}return r}t.trigger=function(){var t=!1,n=Array.prototype.slice.call(arguments);if(e){t=a(n,e.private);t=a(n,e.public)||t}return t};t.getErrors=function(){return l};var o=10,l=[];function u(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();d(n);l.push(n);l.length>o&&l.shift()}function s(e,t,n,r,i,a){var o=3*t,l=3*(r-t)-o,u=1-o-l,s=3*n,c=3*(i-n)-s,f=1-s-c;function d(e){return((u*e+l)*e+o)*e}function g(e,t){var n=h(e,t);return((f*n+c)*n+s)*n}function h(e,t){var n,r,i,a,s,c;for(i=e,c=0;c<8;c++){a=d(i)-e;if(Math.abs(a)<t)return i;s=(3*u*i+2*l)*i+o;if(Math.abs(s)<1e-6)break;i-=a/s}r=1;if((i=e)<(n=0))return n;if(i>r)return r;for(;n<r;){a=d(i);if(Math.abs(a-e)<t)return i;e>a?n=i:r=i;i=(r-n)/2+n}return i}return g(e,1/(200*a))}t.linearEasing=function(e){return e<0?0:e>1?1:e};t.cubicEasing=function(e){return e<0?0:e>1?1:s(e,.25,.01,.25,1,1)};t.quartEasing=function(e){var t=e;return t<.5?8*t*t*t*t:1-8*--t*t*t*t};t.quadEasing=function(e){return e*(2-e)};t.quintEasing=function(e){var t=e;return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};var c=1;t.atanEasing=function(e){return Math.atan(c*(e-.5))/(2*Math.atan(.5*c))+.5};return t}function jn(e,t,n){var r=Date.now(),i=Math.floor(r/1e3),a=0,o=!1,l=c(),u=!0,s=0;return{frameRate:function(){return s},update:function(){var c=Date.now(),d=Math.floor(c/1e3);if(d>i){s=Math.round(a/(d-i));a=0;i=d}else a++;var g=t(c-r);r=c;if(o=o||g){var h=n();if(h){var v=h.canvas;h.webgl&&(v=h.webglCanvas);if(v&&v.clientWidth>0&&v.clientHeight>0){o=!1;if(u){e(null,l);o||f()}}}}},redraw:function(e){o=!0;var t=e||c();l.all||(l.all=t.all);l.positions||(l.positions=t.positions);l.shadow||(l.shadow=t.shadow);l.textures||(l.textures=t.textures);l.colours||(l.colours=t.colours)},allowDraw:function(e){e&&!u&&(o=!0);u=e}};function c(){return{all:!0,colours:!0,textures:!0,positions:!0,shadow:!0}}function f(){l.all=!1;l.colours=!1;l.textures=!1;l.positions=!1;l.shadow=!1}}function Qn(e,t){var n=!0;return{rebuild:t,animate:function(t){var r=e(t,n);n=!1;return r}}}function qn(e){var t=[],n=[];return{push:function(e,r){if(e){e.queue=r;r?n.push(e):t.push(e)}},cancel:function(){t=[];n=[];e()},animate:function(r,i,a){var o=!1,l=!1;if(t.length>0){var u=t;t=[];for(var s=0;s<u.length;s++){var c=u[s].rebuild;if(u[s].animate(r)){l=l||u[s].queue;t.push(u[s])}e(c)}o=!0}if(!l&&n.length>0){t.push(n.shift());o=!0}if(i&&i.animate){i.animate(r);o=!0}a&&(o=o||a.animated());return o}}}function $n(e,t){var n,r,i,a;return function(o,l,u){var s=t();if(s===o||a&&r===o);else{n=s;r=o;i=0;if(!a){a=Qn(function(e){i=Math.min(l,i+e);t(l<=0?r:n+(r-n)*i/l);var o=i<l;if(!o){a=null;x(u)}return o});e.push(a,!1)}}}}var er=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];function tr(e,t,n){return function(){if(!n||!n()){var r,i=t[e];i&&(r=i.apply(null,arguments));return r}}}function nr(e,t,n){for(var r=0;r<er.length;r++)e[er[r]]=tr(er[r],t,n)}var rr={b:"grey",bw:1,c:"rgba(240,240,240,0.8)",bs:"solid",re:!1,w:0},ir=["_ha0","_ha1","_ha2","_ha3","_ha4"],ar=ir.concat(["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"]),or=ar.reduce(function(e,t){e[t]=!0;return e},{});function ur(e,n,r,i){var a=n||P,o=r||P,l=i||P,u={},s={numbers:{},numOrString:{},negatives:{},strings:{},stringValues:{},colours:{},booleans:{},reserved:{},mapPos:{},halos:[]};u.donutDefaults={b:"rgb(255, 255, 255)",bw:2,c:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],w:10};var c=u.donutDefaults,f=A(e,s);u.typeCheck=function(e,t){m(e.items,!1,t)};u.filterNodesAndLinks=function(e,t,n,r){var i=r||{},a=Y(e,t,n,i.carefulWithXandY);a.links=L(a.links,a.nodes,t,i.selfLinks);return a};function d(e){y(e)&&t(e,function(t,n){Z(e,n);e.g&&(e.g=V(e.g,!0));F(e,n,f.reserved)})}function g(e){"w"in e&&(e.w=!!e.w)}u.ensureObject=function(e,t,n){var r=n||{};p(e,t);B(e);if(e.g)if(Array.isArray(e.g)){m(e.g);e.g.forEach(g);e.g=V(e.g,"link"===e.type||r[e.id])}else delete e.g;S(e,t);e.donut&&k(e,t);e.oc&&X(e);e.bu&&E(e);e.t1&&d(e.t1);e.t2&&d(e.t2)};var v=u.ensureObject;u.ensureTypesInArray=function(e,t,n){if(e)for(var r=0;r<e.length;r++)v(e[r],t,n)};var m=u.ensureTypesInArray;function p(e,n){t(e,function(t,r){Z(e,r);F(e,r,f.reserved);n&&F(e,r,f.booleans)})}function b(e,n){var r=e[n],i=!0;y(r)&&t(r,function(e,t){I(r,t);i=i&&isFinite(e)});i||delete e[n]}function I(e,t){var n=+e[t];n<0&&!f.negatives[t]&&(n=null);e[t]=n}function x(e,t){if(!M(e[t])){var n=e[t]+"";isNaN(n)||""===n?G(e,t):I(e,t)}}function G(e,t){if(!M(e[t])){e[t]+="";f.stringValues[t]&&!f.stringValues[t][e[t]]&&delete e[t]}}function w(e,t){e[t]&&(e[t]=kt(e[t])?e[t]:void 0)}function Z(e,t){f.strings[t]?G(e,t):f.numbers[t]?I(e,t):f.numOrString[t]?x(e,t):f.colours[t]?w(e,t):f.mapPos[t]&&b(e,t)}function B(e){if(y(e.fi)){var t=e.fi;M(t.t)||(t.t="string"==typeof t.t?t.t.charAt(0):String.fromCharCode(t.t));t.c&&(t.c=kt(t.c)?t.c:void 0);"ff"in t&&"string"!=typeof t.ff&&(t.ff=void 0)}else null!==e.fi&&delete e.fi}function R(e){return/^(ne|nw|se|sw|n|s|e|w)$/.test(e)}function W(e){return C(e)&&e>=0&&e<360}function V(e,t){var n,r,i={};Array.isArray(e)&&(n=e.filter(function(e){var n,a=e.p;if(t)n=e;else if(!M(a))if("string"===r&&R(a)||"numeric"===r&&W(a)){if(!i[a]){n=e;i[a]=1}}else if(!r)if(R(a)){r="string";n=e;i[a]=1}else if(W(a)){r="numeric";n=e;i[a]=1}if(n){B(e);return e}return!1}));return n}function S(e,t){f.halos.forEach(function(n){var r=e[n];if(r)if(t)"c"in r||"r"in r||"w"in r||delete e[n];else if("c"in r&&"r"in r&&"w"in r){w(r,"c");if(M(r.c)||M(r.r)||M(r.w)||!h(+r.r)||!h(+r.w))delete e[n];else{r.r=+r.r;r.w=+r.w}}else delete e[n]})}function k(e,t){if(t||Array.isArray(e.donut.v)){e.donut.v&&e.donut.v.forEach(function(t,n){(!h(t)||t<0)&&(e.donut.v[n]=0)});e.donut.c&&(Array.isArray(e.donut.c)&&!e.donut.c.some(function(e){return!kt(e)})||delete e.donut.c);["bw","w"].forEach(function(t){t in e.donut&&I(e.donut,t)});"b"in e.donut&&w(e.donut,"b");t||(e.donut=A(e.donut,c))}else delete e.donut}function X(e){y(e.oc)?v(e.oc):delete e.oc}function E(e){if(Array.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;/^(ne|nw|se|sw)$/.test(t)||delete e.bu}}function F(e,t,n){n[t]&&delete e[t]}function Y(e,t,n,r){var i,a=t||{},o=n||{},l={nodes:{},links:{}};function u(e,t){return e.id in t.nodes||e.id in t.links}function s(e){return"node"===e.type&&e.id in o||"link"===e.type&&e.id in a}e&&(l=e.reduce(function(e,t){if(t.id&&!u(t,e)&&!s(t)){i=t.type+"s";if("node"===t.type){var n=!0;r&&a[t.id]&&(n=!1);n&&H(t)}i in e&&(e[i][t.id]=t)}return e},l));return l}u.setZeroXY=function(e){if("node"===e.type){e.x=e.x||0;e.y=e.y||0}};var H=u.setZeroXY;function L(e,n,r,i){var a={};t(e,function(e,t){if(z(e,n,r,i))a[t]=e;else{var o=e._parentId;if(o){var l=n[o]||r[o];l&&l._combo&&(l._combo.linkIds=l._combo.linkIds.filter(function(t){return t!==e.id}))}}});return a}u.hasValidEnds=function(e,t,n,r){if(!r&&e.id1===e.id2)return!1;var i=t||{},a=n||{};return(a[e.id1]||i[e.id1])&&(a[e.id2]||i[e.id2])};var z=u.hasValidEnds;u.ensureHiddenItemConsistency=function(e,t){T("hi",e,t)};u.ensureConsistency=function(e,t,n){var r={};U(e,t,n,r);N(r,e,n);l(e);"hi"===e&&o()};var T=u.ensureConsistency;u.applyPropertyRuleToComboLinks=function(e,t,n){Object.keys(e).forEach(function(e){var r=n[e];if(r._combo.linkIds.every(function(e){return n[e][t]})){r[t]=!0;a(e)}else if(void 0!==r[t]){delete r[t];a(e)}})};var N=u.applyPropertyRuleToComboLinks;function U(e,n,r,i){t(r,function(t,o){var l=t._parentId;if((!0===n[t.id1][e]||!0===n[t.id2][e])&&!0!==t[e]){t[e]=!0;r[l]&&(i[l]=!0);a(o)}})}return u}function sr(){var e={x:0,y:0,bg:!1,gh:!1},t=0,n=[];e.reset=function(){t=0};e.getNext=function(){return n[t++]};e.getLast=function(){return t>0?n[t-1]:null};e.add=function(e){n[t++]=e};e.forEach=function(e){for(var r=0;r<t;r++)e(n[r])};e.setPosition=function(t){e.x=t.x||0;e.y=t.y||0};return e}function cr(e,t,n){var r=new Map,i=D({},e,{isStart:!0,isGroup:!0}),a=D({},e,{isStart:!1,isGroup:!0});i.endMarker=a;a.startMarker=i;return{insert:function(e){n.insertBefore(a,e)},getStartMarker:function(){return i},getEndMarker:function(){return a},getValue:function(){return e},getParent:function(){return t},getChildren:function(){return r}}}function fr(e){var t={},n=new Map;t.append=function(t,r){var i=cr(t,r,e);if(r){r.getChildren().set(t.id,i);e.insertBefore(r.getEndMarker(),i.getStartMarker());e.insertAfter(i.getStartMarker(),i.getEndMarker())}else{n.set(t.id,i);e.append(i.getStartMarker());e.append(i.getEndMarker())}return i};t.hasPath=function(e){var t,r=function(e){return!!(t=t?t.getChildren().get(e):n.get(e))};return e.every(r)};t.get=function(e){var t,r=null,i=function(e){(r=r?r.getChildren().get(e):n.get(e))&&(t=e);return!!r};if(!e.every(i))throw new Error("Path not found: "+e+". Last entry: "+t);return r};return t}function dr(){var e={},t=null,n=null;e.append=function(t){e.insertAfter(n,t)};e.clear=function(){t=null;n=null};e.remove=function(e){e._prev?e._prev._next=e._next:t=e._next;e._next?e._next._prev=e._prev:n=e._prev};e.getFirst=function(){return t};e.getLast=function(){return n};e.getNext=function(e){return e._next};e.getPrevious=function(e){return e._prev};e.insertAfter=function(e,r){if(!r||"object"!=typeof r)throw new Error("Object Required");r._prev=e||null;if(e){r._next=e._next;e._next=r}else{r._next=t;t=r}r._next?r._next._prev=r:n=r};e.insertBefore=function(t,n){t?e.insertAfter(t._prev||null,n):e.append(n)};e.forEach=function(e){for(var n=t;n;n=n._next){var r=e(n);r&&(n=r)}};e.toArray=function(){for(var e=[],n=t;n;n=n._next)e.push(n);return e};return e}function gr(e){this.a=null;this.arrowhead=0;this.back=!1;this.bc=null;this.bo=!1;this.bs=null;this.bw=0;this.c=null;this.dirty=!0;this.donut=!1;this.ea=0;this.fc=null;this.ff=null;this.fi=!1;this.fs=null;this.hi=!1;this.hib=!1;this.hib=!1;this.isfi=!1;this.isSel=!1;this.ls=null;this.p=e;this.pf=null;this.r=null;this.s=null;this.sa=null;this.sc=null;this.sm=null;this.t=null;this.u=null;this.vx=!1;this.w=0;this.wbc=null;this.wc=null;this.wfc=null;this.wmargin=0;this.wsc=null;this.x=0;this.x1=0;this.x2=0;this.x3=0;this.x4=0;this.x5=0;this.xc=!1;this.y=!1;this.y1=0;this.y2=0;this.y3=0;this.y4=0;this.y5=0;this.yOffset=0}function hr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h,v){var m=n(f,nn.arc),p=m.a;if(v){m.x=0;m.y=0}else{m.x=r-p.x;m.y=i-p.y}m.r=a;m.sa=o;m.ea=l;m.bw=c;m.ls=d;if(u!==m.bc){m.bc=u;m.wbc=t(u)}if(s){if(s!==m.bc2){m.bc2=s;m.wbc2=t(s)}}else{m.bc2=null;m.wbc2=null}m.donut=!!g;m.off=h;m.hib=v;e(m)}return r}function vr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d){var g=n(c,nn.line),h=g.a;if(d){g.x1=0;g.y1=0;g.x2=0;g.y2=0}else{g.x1=r-h.x;g.y1=i-h.y;g.x2=a-h.x;g.y2=o-h.y}if(l!==g.c){g.c=l;g.wc=t(l)}if(u){if(u!==g.c2){g.c2=u;g.wc2=t(u)}}else{g.c2=null;g.wc2=null}g.w=s;g.ls=f;g.hib=d;e(g)}return r}function mr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h){var v=n(c,nn.circle),m=v.a;v.x=r-m.x;v.y=i-m.y;v.r=a;v.bw=l;v.fi=s;v.bs=f;v.sm=d;v.noMinBorderWidth=!!g;if(o!==v.bc){v.bc=o;v.wbc=t(o)}if(u!==v.fc){v.fc=u;v.wfc=t(u)}v.hib=h;e(v)}return r}function pr(e,t,n){function r(t,r,i,a,o,l,u,s,c,f){var d=n(l,nn.image),g=d.a;d.x1=t-g.x;d.y1=r-g.y;d.x2=i-g.x;d.y2=a-g.y;d.u=o;d.s=u;d.vx=s;d.hi=c;d.hib=f;e(d)}return r}function br(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h,v){var m=n(g,nn.line3),p=m.a;m.x1=r-p.x;m.y1=i-p.y;m.x2=a-p.x;m.y2=o-p.y;m.x3=l-p.x;m.y3=u-p.y;m.x4=s-p.x;m.y4=c-p.y;m.w=d;m.ls=h;if(f!==m.c){m.c=f;m.wc=t(f)}m.hib=v;e(m)}return r}function yr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h,v,m,p,b,y){var I=n(p,nn.pentagon),x=I.a;I.x1=r-x.x;I.y1=i-x.y;I.x2=a-x.x;I.y2=o-x.y;I.x3=l-x.x;I.y3=u-x.y;I.x4=s-x.x;I.y4=c-x.y;I.x5=f-x.x;I.y5=d-x.y;I.bw=h;I.fi=m;I.bs=b;if(g!==I.bc){I.bc=g;I.wbc=t(g)}if(v!==I.fc){I.fc=v;I.wfc=t(v)}I.hib=y;e(I)}return r}function Ir(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g){var h=n(f,nn.rect),v=h.a;h.x1=r-v.x;h.y1=i-v.y;h.x2=a-v.x;h.y2=o-v.y;h.bw=u;h.fi=c;h.bs=d;if(l!==h.bc){h.bc=l;h.wbc=t(l)}if(s!==h.fc){h.fc=s;h.wfc=t(s)}h.hib=g;e(h)}return r}function xr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g){var h=n(d,nn.roundrect),v=h.a;h.x1=r-v.x;h.y1=i-v.y;h.x2=a-v.x;h.y2=o-v.y;h.r=l;h.bw=s;h.fi=f;if(u!==h.bc){h.bc=u;h.wbc=t(u)}if(c!==h.fc){h.fc=c;h.wfc=t(c)}h.hib=g;e(h)}return r}function Cr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h,v,m,p,b,y,I,x,C,G){var w=n(s,nn.text),Z=w.a;if(C){w.x=0;w.y=0}else{w.x=r-Z.x;w.y=i-Z.y}w.yOffset=0|G;w.t=a;w.fs=l;w.bo=u;w.ff=c;w.wmargin=x||0;w.xc=f;w.w=d;w.isfi=g;w.isSel=I;if(o!==w.c){w.c=o;w.wc=t(o)}w.x1=v-Z.x;w.y1=m-Z.y;w.x2=p-Z.x;w.y2=b-Z.y;w.back=h;if(h&&y!==w.bc){w.wbc=t(y);w.bc=y}w.hib=C;w.pf=.08;e(w)}return r}function Gr(e,t,n){function r(r,i,a,o,l,u,s,c,f,d,g,h,v){var m=n(g,nn.triangle),p=m.a;m.x1=r-p.x;m.y1=i-p.y;m.x2=a-p.x;m.y2=o-p.y;m.x3=l-p.x;m.y3=u-p.y;m.bw=c;m.fi=d;m.arrowhead=h;if(s!==m.bc){m.bc=s;m.wbc=t(s)}if(f!==m.fc){m.fc=f;m.wfc=t(f)}m.hib=v;e(m)}return r}var wr={arc:hr,line:vr,circle:mr,image:pr,line3:br,pentagon:yr,rect:Ir,roundRect:xr,triangle:Gr,text:Cr};function Zr(e,t,n,r,i,a,o,l){var u,s,c,f,d=t.a,g=t.x+d.x,h=t.y+d.y,v=n.x(g),m=n.y(h),p=n.dim(t.r);if(r){u=t.bc&&t.sc;s=null;c=n.sw(t.bw)}else{u=t.bc;s=t.bc2;var b=zt(t.a,a,o);if(b){u=Ot(u,b);s&&(s=Ot(s,b))}c=n.w(t.bw);f=t.ls}Ar(e,v,m,p,t.sa,t.ea,u,s,c,f,t.off,l)}function Ar(e,t,n,r,i,a,o,l,u,s,c,f){e.lineWidth=Math.max(1,u);var d,g=a-i;if(jt(s,e)){d=Qt(e,g*r,u,s)}if(l){var h,v,m=f.linkStyle.transition;if(c>0){h=o;v=l}else{h=l;v=o}if(0===m){Mr(e,t,n,r,i,a,!1,Rr(e,t,n,r,i,a,.5,h,.5,v))}else Br(e,t,n,r,i,h,a,v,m,d)}else Mr(e,t,n,r,i,a,!1,o);s&&Jt(e)}function Br(e,t,n,r,i,a,o,l,u,s){var c=o-i,f=Xt(a);3===f.length&&f.push(1);var d=Xt(l);3===d.length&&d.push(1);var g=0;u<1&&(g=c*(1-u)/2);var h,v=c-2*g,m=0;if(s){m=(s.dash+s.gap)/r;h=(v=c-2*(g=Math.floor(g/m)*m))/m}var p=Math.ceil(v/(Math.PI/2)),b=(d[0]-f[0])/p,y=(d[1]-f[1])/p,I=(d[2]-f[2])/p,x=(d[3]-f[3])/p,C=f[0],G=f[1],w=f[2],Z=f[3],A=1/r,B=Rt(C,G,w,Z);if(u<1){Mr(e,t,n,r,i,i+g,!1,a);Mr(e,t,n,r,o,o-g,!0,l)}for(var R=i+g,M=v/p,W=0;W<p;W++){var V,S;if(s){var k;k=W<p-1?Math.floor(h/p):h-(p-1)*Math.floor(h/p);V=R;R=S=R+(M=k*m)}else{V=i+g+W*M-.25*A;S=i+g+(W+1)*M;W===p-1&&(S+=.25*A)}Mr(e,t,n,r,V,S,!1,Rr(e,t,n,r,V,S,0,B,1,B=Rt(C+=b,G+=y,w+=I,Z+=x)))}}function Rr(e,t,n,r,i,a,o,l,u,s){var c=t+r*Math.cos(i),f=t+r*Math.cos(a),d=n+r*Math.sin(i),g=n+r*Math.sin(a),h=e.createLinearGradient(c,d,f,g);h.addColorStop(o,l);h.addColorStop(u,s);return h}function Mr(e,t,n,r,i,a,o,l){e.beginPath();e.strokeStyle=l;e.arc(t,n,r,i,a,o);e.stroke();e.closePath()}function Wr(e,t,n,r,i,a,o,l){var u=t.a,s=t.x1+u.x,c=t.y1+u.y,f=t.x2+u.x,d=t.y2+u.y,g=Math.max(1,r?n.sw(t.w):n.w(t.w));if(r)Vr(e,n.x(s),n.y(c),n.x(f),n.y(d),t.c&&t.sc,null,g,null,l);else{var h=zt(t.a,a,o),v=t.c,m=t.c2;if(h){v=Ot(v,h);m&&(m=Ot(t.c2,h))}Vr(e,n.x(s),n.y(c),n.x(f),n.y(d),v,m,g,t.ls,l)}}function Vr(e,t,n,r,i,a,o,l,u,s){e.lineWidth=l;if(o){var c=e.createLinearGradient(t,n,r,i),f=s.linkStyle.transition;c.addColorStop((1-f)/2,a);c.addColorStop((1+f)/2,o);e.strokeStyle=c}else e.strokeStyle=a;if(jt(u,e)){var d=r-t,g=i-n;Qt(e,Math.sqrt(d*d+g*g),l,u)}e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.stroke();e.closePath();u&&Jt(e)}function Sr(e,t,n,r,i,a,o){var l=t.a,u=t.x1+l.x,s=t.y1+l.y,c=t.x2+l.x,f=t.y2+l.y,d=t.x3+l.x,g=t.y3+l.y,h=t.x4+l.x,v=t.y4+l.y;if(r)kr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),n.x(h),n.y(v),t.c&&t.sc,n.sw(t.w));else{var m=zt(t.a,a,o);kr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),n.x(h),n.y(v),m?Ot(t.c,m):t.c,n.w(t.w),t.ls)}}function kr(e,t,n,r,i,a,o,l,u,s,c,f){var d=e.lineJoin;e.lineWidth=Math.max(1,c);e.lineJoin="round";e.strokeStyle=s;if(jt(f,e)){var g=r-t,h=i-n,v=a-r,m=o-i,p=l-a,b=u-o;Qt(e,Math.sqrt(g*g+h*h)+Math.sqrt(v*v+m*m)+Math.sqrt(p*p+b*b),c,f)}e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.lineTo(a,o);e.lineTo(l,u);e.stroke();e.closePath();e.lineJoin=d;f&&Jt(e)}function Xr(e,t,n,r,i,a,o){var l=r?n.sw(t.bw):n.w(t.bw),u=t.a,s=n.x(t.x1+u.x),c=n.y(t.y1+u.y),f=n.x(t.x2+u.x),d=n.y(t.y2+u.y);if(l>=0){l=qt(Math.min(f-s,d-c)/2,l,r)}if(r)Er(e,s,c,f,d,t.bc&&t.sc,l,t.fc&&t.sc,t.fi,null,r);else{var g=zt(t.a,a,o);Er(e,s,c,f,d,g?Ot(t.bc,g):t.bc,l,g?Ot(t.fc,g):t.fc,t.fi,t.bs,r)}}function Er(e,t,n,r,i,a,o,l,u,s){if(u){e.fillStyle=l;e.fillRect(t,n,r-t,i-n)}if(o>=0)if(jt(s,e)){var c=Math.floor(o/2);Vr(e,t-c,n,r+c,n,a,null,o,s);Vr(e,r,n-c,r,i+c,a,null,o,s);Vr(e,r+c,i,t-c,i,a,null,o,s);Vr(e,t,i+c,t,n-c,a,null,o,s)}else{e.lineWidth=o;e.strokeStyle=a;e.strokeRect(t,n,r-t,i-n)}}function Fr(e,t,n,r,i,a,o){var l=t.a,u=0,s=t.x1+l.x,c=t.y1+l.y,f=t.x2+l.x,d=t.y2+l.y;if(r){u=n.dim(t.fs)*t.pf;t.back&&Er(e,n.x(s),n.y(c),n.x(f),n.y(d)+u,t.sc,-1,t.sc,!0)}else{var g,h=t.x+l.x,v=t.y+l.y,m=t.xc,p=n.x(h),b=n.y(v+t.yOffset),y=n.dim(t.fs);u=y*t.pf;var I=zt(t.a,a,o);if(t.w&&(y<=3||y<fn)){var x=n.dim(t.w),C=t.isSel?t.bc:Ot(t.c,.4);C=I?Ot(C,I):C;m&&(p-=Math.floor(x/2));t.back&&t.bc!==At.textback&&Er(e,p,b-y,p+x,b+u,g=I?Ot(t.bc,I):t.bc,-1,g,!0);Er(e,p,b-y,p+x,b+u,C,-1,C,!0)}else{var G=I?Ot(t.c,I):t.c;if(t.back){g=I?Ot(t.bc,I):t.bc;Er(e,n.x(s),n.y(c),n.x(f),n.y(d)+u,g,-1,g,!0)}Yr(e,p,b+u/2,t.t,G,y,t.bo,t.ff,m)}}}function Yr(e,t,n,r,i,a,o,l,u){vn(e,a,o,l);e.fillStyle=i;e.textAlign=u?"center":"left";e.fillText(r,t,n)}function Hr(e,t,n,r,i,a,o){var l=t.a,u=t.x1+l.x,s=t.y1+l.y,c=t.x2+l.x,f=t.y2+l.y,d=n.x(u),g=n.y(s),h=n.x(c),v=n.y(f);if(t.vx){d-=t.vx;g-=t.vx;h+=t.vx;v+=t.vx}if(r)Er(e,d,g,h,v,t.sc,-1,t.sc,!0);else{var m=zt(t.a,a,o),p=e.globalAlpha;e.globalAlpha=m;var b=i[t.u];if(t.hi&&Vn()){var y=i[Sn(t.u)];y&&!y.missing&&(b=y)}Lr(e,b,d,g,h,v,t.s);e.globalAlpha=p}}function Lr(e,t,n,r,i,a,o){var l=t[o||"im"];e.imageSmoothingQuality="high";e.drawImage(l,n,r,i-n,a-r)}function zr(e,t,n,r,i,a,o){var l=t.a,u=t.x1+l.x,s=t.y1+l.y,c=t.x2+l.x,f=t.y2+l.y;if(r)Tr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.dim(t.r),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi);else{var d=zt(t.a,a,o);Tr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.dim(t.r),d?Ot(t.bc,d):t.bc,n.w(t.bw),d?Ot(t.fc,d):t.fc,t.fi)}}function Tr(e,t,n,r,i,a,o,l,u,s){e.beginPath();e.moveTo(t+a,n);e.lineTo(r-a,n);e.arcTo(r,n,r,n+a,a);e.lineTo(r,i-a);e.arcTo(r,i,r-a,i,a);e.lineTo(t+a,i);e.arcTo(t,i,t,i-a,a);e.lineTo(t,n+a);e.arcTo(t,n,t+a,n,a);e.closePath();if(s){e.fillStyle=u;e.fill()}if(l>=0){e.lineWidth=Math.max(1,l);e.strokeStyle=o;e.stroke()}}var Nr=1;function Ur(e,t,n,r,i,a,o){var l=t.a,u=t.x1+l.x,s=t.y1+l.y,c=t.x2+l.x,f=t.y2+l.y,d=t.x3+l.x,g=t.y3+l.y;if(r)Dr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi);else{var h=zt(t.a,a,o);Dr(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),h?Ot(t.bc,h):t.bc,n.w(t.bw),h?Ot(t.fc,h):t.fc,t.fi)}}function Dr(e,t,n,r,i,a,o,l,u,s,c){if(Math.abs(r-t)>Nr||Math.abs(i-n)>Nr){e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.lineTo(a,o);e.lineTo(t,n);e.closePath();if(c){e.fillStyle=s;e.fill()}if(u>=0){e.lineWidth=Math.max(1,u);e.strokeStyle=l;e.stroke()}}}function Or(e,t,n,r,i,a,o){var l=t.a,u=t.x1+l.x,s=t.y1+l.y,c=t.x2+l.x,f=t.y2+l.y,d=t.x3+l.x,g=t.y3+l.y,h=t.x4+l.x,v=t.y4+l.y,m=t.x5+l.x,p=t.y5+l.y;if(r)_r(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),n.x(h),n.y(v),n.x(m),n.y(p),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi);else{var b=zt(t.a,a,o);_r(e,n.x(u),n.y(s),n.x(c),n.y(f),n.x(d),n.y(g),n.x(h),n.y(v),n.x(m),n.y(p),b?Ot(t.bc,b):t.bc,n.w(t.bw),b?Ot(t.fc,b):t.fc,t.fi,t.bs)}}function _r(e,t,n,r,i,a,o,l,u,s,c,f,d,g,h,v){e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.lineTo(a,o);e.lineTo(l,u);e.lineTo(s,c);e.lineTo(t,n);e.closePath();if(h){e.fillStyle=g;e.fill()}if(d>=0)if(jt(v,e)){var m=(r>t?1:-1)*Math.floor(d/2);Vr(e,t,n,r,i,f,null,d,v);Vr(e,r,i,a,o,f,null,d,v);Vr(e,a,o,l-m,u,f,null,d,v);Vr(e,l,u+m,s,c-m,f,null,d,v);Vr(e,s-m,c,t,n,f,null,d,v)}else{e.lineWidth=Math.max(1,d);e.strokeStyle=f;e.stroke()}}function Kr(e){return e}var Pr={x:Kr,y:Kr,w:Kr,sw:Kr,dim:Kr};function Jr(e){var t={};Object.keys(e).forEach(function(n){t[nn[n]]=e[n]});return t}var jr=Jr({circle:en,arc:Zr,line:Wr,line3:Sr,text:Fr,image:Hr,rect:Xr,roundrect:zr,triangle:Ur,pentagon:Or});function Qr(e,t,n,r,i,a,o,l,u){if(!t.hib){var s;if(a){var c=a.shadowType;s=r?t.sc&&(!c||c>-1):!c||c<1}else s=!r||t.sc;if(s){var f=jr[t.p];if(f){var d=t.a,g=d.bg,h=d.gh;f(e,t,n,r,i,g&&o,h&&l,u)}}}}function qr(e,t,n){e.clearRect(0,0,t,n)}function $r(e,t,n){e.globalAlpha=n;e.drawImage(t,0,0,t.width,t.height);e.globalAlpha=1}function ei(e,t,n,r,i,a,o,l,u,s,c,f){var d,g,h,v=n,m=t.canvas,p=t,b=!1;o&&qr(g=o.getContext("2d"),m.width,m.height);function y(e,r){d=e;u&&e.blatOverview&&!s&&u(t,n);b=e.overview;if(o&&r.bg){var i=!e.bg;if(i&&h){$r(t,o,c);qr(g,m.width,m.height)}h=!1;p=i?t:g}v=e.useView&&n?n:Pr}function I(e){if(l&&b||!l){h=!0;Qr(p,e,v,a,r,d,c,f,i)}}e.forEach(I,y)}function ti(e,n){var r,a,o,l,u,s,c,f,d={},g=e||{},h=A(n,{isContentLayer:!1,alwaysUpdate:!1}),v=Object.keys(h),m=!1;function p(e,t){var n;if(m)(n=c.getNext()).dirty=!0;else{n=new gr(t);var r=b(e);n.wsc=r.webgl;n.sc=r.rgb;n.id=e;n.a=c}return n}Object.keys(wr).forEach(function(e){d[e]=wr[e](I,_t,p)});function b(e){return o.getColour(e)}d.hasLayerPathAt=function(e){return a.hasPath(e)};d.getLayerAt=function(e){return a.get(e)};d.createLayer=function(e,t){var n="";t&&(n=t.getValue().data.path+".");n+=e;var r={id:e,data:{}};r.data=D(r.data,{path:n},g[e]);t&&(r.data=A(r.data,t.getValue().data));r.data=A(r.data,h);r.data.bg=r.data.bg&&!r.data.perItemAlpha;return a.append(r,t)};var y=function(){s={_extras:sr()};r=dr();a=fr(r)};d.setup=y;function I(e){if(!m){c.add(e);l.insert(e)}}function x(e){if(e){m||e.forEach(r.remove);e.reset()}}
d.startGeneratingFor=function(e,t,n){c=s[e.id];m=t;if(c)x(c);else{c=sr();s[e.id]=c}c.gh=!!e.gh;c.bg=n&&e.bg;c.setPosition(e)};function C(e){e.dirty=!0}d.moveItem=function(e,t,n){var r=s[e.id];if(r){r.forEach(C);r.x=t;r.y=n}};function G(e,t,n){var r=t[n];if(e[n]!==r){e[n]=r;return!0}return!1}d.forEach=function(e,t,n,i){var a,o,l,u,s=D({},h),c={};function f(r){if(r.isGroup){if(r.isStart){if(i)return t(r.data);if(n&&!r.data.alwaysUpdate)return r.endMarker._prev;for(o=0,l=v.length;o<l;o++){u=v[o];var f=G(s,r.data,u);f&&(c[u]=!0);a=a||f}if(a&&r.data.isContentLayer){t(r.data,c);a=!1;for(o=0,l=v.length;o<l;o++){u=v[o];c[u]=!1}}}}else e(r);return!1}var ae=121955555-LL;if(ae===Math.abs(ae))ae=0;r.forEach(f)};d.startGeneratingForExtras=function(){c=s._extras;m=!1};d.resetExtras=function(){d.startGeneratingForExtras();x(c)};d.removeItem=function(e){x(s[e])};d.setShadowColourMap=function(e){o=e};d.getLayerPath=function(){return f};d.setLayerPath=function(e){f=e;u=e?a.get(e):null};d.setLayer=function(e){if(e){if(!(l=u?u.getChildren().get(e):a.get([e])))throw new Error("Layer: "+e+" at "+f+" not found")}else l=null};d.getLayer=function(){return l?l.getValue().id:null};d.copyPrimitive=function(e){var n=p(e.id,e.p);t(e,function(e,t){n[t]=e});I(n)};function w(e){e.sc=null;e.wsc=null;e.dirty=!0}d.excludeHit=function(e){if(e){var t=s[e];t&&t.forEach(w)}};d.getLast=function(){return c?c.getLast():null};d.cloneLast=function(){return i(d.getLast())};d.itemExtents=function(e,n){var r=null;t(s,function(t,i){"_extras"===i||e&&!e.has(i)||t.forEach(function(e){if(!e.hib){var t=pn(n,e);r=r?bn(r,t):t}})});return r};d.drawShadowCanvas=function(e,t,n,r){qr(e,n,r);ei(d,e,t,{},{},!0)};y();return d}var ni=8,ri="_combo_",ii="_combolink_";function ai(e){return 0===e.indexOf(ii)}function oi(e){return 0===e.indexOf(ri)}var li=-1,ui=1,si=T(["MAIN","BG","FG","COMBOS","REVEALED","TRANSIENT","OVERVIEW_IMAGE","COMBO_CONTAINER","TIMEBAR","BANDS","UNDERLAYS","SHAPES_SEL_BORDER","SHAPES","HALOS","HANDLES","NODES_SEL_BORDER","LINKS","NODES","DRAGGERS","BUBBLES","NODESSEL","BUBBLESSEL","BANDLABELS","OVERLAYS","OVERLAYSSHADOW","OVERVIEW","OVERVIEWSHADOW","WAIT"]),ci={};ci[si.COMBO_CONTAINER]=si.NODES_SEL_BORDER;ci[si.NODES]=si.NODES_SEL_BORDER;ci[si.SHAPES]=si.SHAPES_SEL_BORDER;var fi={UNDERLAYS:{alwaysUpdate:!0,isContentLayer:!0,useView:!1},BANDLABELS:{alwaysUpdate:!0,isContentLayer:!0,useView:!1},BANDS:{alwaysUpdate:!0,isContentLayer:!0,useView:!1},MAIN:{overview:!0},COMBOS:{perItemAlpha:!0,overview:!0},COMBO_CONTAINER:{isContentLayer:!0,overview:!0},REVEALED:{},OVERLAYS:{shadowType:li,useView:!1,alwaysUpdate:!0,isContentLayer:!0},HANDLES:{useView:!1,alwaysUpdate:!0,isContentLayer:!0},OVERLAYSSHADOW:{shadowType:ui,useView:!1,alwaysUpdate:!0,isContentLayer:!0},OVERVIEWSHADOW:{shadowType:ui,useView:!1,alwaysUpdate:!0,isContentLayer:!0},WAIT:{useView:!1,alwaysUpdate:!0,isContentLayer:!0},OVERVIEW:{shadowType:li,useView:!1,alwaysUpdate:!0,isContentLayer:!0},OVERVIEW_IMAGE:{shadowType:li,blatOverview:!0,useView:!1,alwaysUpdate:!0,isContentLayer:!0},DRAGGERS:{alwaysUpdate:!0,isContentLayer:!0},BG:{bg:!0,overview:!1},FG:{bg:!1,overview:!0},SHAPES_SEL_BORDER:{isContentLayer:!0},NODES_SEL_BORDER:{isContentLayer:!0},LINKS:{isContentLayer:!0,newDrawCall:!0},SHAPES:{isContentLayer:!0},NODES:{isContentLayer:!0},HALOS:{isContentLayer:!0},BUBBLES:{isContentLayer:!0}},di=[si.SHAPES_SEL_BORDER,si.SHAPES,si.HALOS,si.NODES_SEL_BORDER,si.LINKS,si.NODES,si.BUBBLES],gi={shadowType:0,bg:!1,blatOverview:!1,useView:!0,alwaysUpdate:!1,isContentLayer:!1,overview:!1,newDrawCall:!1,perItemAlpha:!1};function hi(){var e=ti(fi,gi),t={createItemLayersAt:function(t){var r,i,a=[];t.forEach(function(t){a.push(t);var o=a;oi(t)&&(o=o.concat([si.FG]));if(e.hasLayerPathAt(o))i=e.getLayerAt(a);else{i=e.createLayer(t,r);e.createLayer(si.COMBO_CONTAINER,i);n(i)}r=i})}};function n(t){var n=e.createLayer(si.BG,t);di.forEach(function(t){return e.createLayer(t,n)});var r=e.createLayer(si.FG,t);di.forEach(function(t){return e.createLayer(t,r)})}function r(){e.setup();e.createLayer(si.BANDS);e.createLayer(si.UNDERLAYS);n(e.createLayer(si.MAIN));e.createLayer(si.COMBOS);var t=e.createLayer(si.TRANSIENT);n(e.createLayer(si.MAIN,t));e.createLayer(si.COMBOS,t);var r=e.createLayer(si.REVEALED);n(e.createLayer(si.MAIN,r));e.createLayer(si.COMBOS,r);[si.DRAGGERS,si.HANDLES,si.BANDLABELS,si.OVERLAYS,si.OVERVIEW_IMAGE,si.OVERVIEW,si.OVERLAYSSHADOW,si.OVERVIEWSHADOW,si.WAIT].forEach(function(t){e.createLayer(t)})}t.setShadowColourMap=function(t){e.setShadowColourMap(t);r()};t.hasPath=e.hasLayerPathAt;t.removeAllItems=r;r();var i=D({},e);return D(i,t)}var vi=4,mi=27;function pi(e,n){var r={},i=!1,o=!1,l=rn;r.fontSize=l;var u,s,c,f,d,v,m,p,b,I,x,C,G,w,Z,M=[12,9,7,7],V={line:1,arc:2},k=W(),X=1,E=2,F={small:6,normal:10,large:20,xlarge:30},Y=0,H={},L=rr,z={hib:!1,present:{t:!0,t1:!1,t2:!1},pos:{t:{lx:0,ly:0,tdx:1,tdy:0,tangent:0,R:0},t1:{lx:0,ly:0,tdx:1,tdy:0,tangent:0,R:0},t2:{lx:0,ly:0,tdx:1,tdy:0,tangent:0,R:0}}};r.setSpecialOptions=function(e,t){H[e]=t};r.editColour=function(){return v||At.edit};var T=r.editColour;function N(){return b||At.white}r.setOptions=function(e){u=e.arrows;h(e.labelOffset)&&(Y=e.labelOffset);Z=!!(e.truncateLabels&&e.truncateLabels.maxLength&&h(e.truncateLabels.maxLength))&&e.truncateLabels.maxLength;e.selectionColour&&(v=kt(e.selectionColour)?e.selectionColour:void 0);I=e.fanLength;s=e.fontFamily;c="along"===e.linkStyle.glyphs;f=e.iconFontFamily;d=e.imageAlignment||{};p=e.linkEnds.avoidLabels;m="loose"!==e.linkEnds.spacing;e.selectionFontColour&&(b=kt(e.selectionFontColour)?e.selectionFontColour:void 0);x=e.selectedNode;C=y(e.selectedNode);G=e.selectedLink;w=y(e.selectedLink)};function U(e){return Math.abs(e)<1e-5}function D(e,t,n,r,i,a,o){return{x:((a-r)*n-(o-i)*t)/e,y:((a-r)*t+(o-i)*n)/e}}function _(e){return Array.isArray(e)&&e.length>0}function K(e){return _(e.g)}r.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)||e._combo&&e._combo.open};var P=r.shapeTest;function J(e,t,n,r,i,a,o,l,u,s){var c=D(t,n,r,i,a,o,l),f=D(t,n,r,i,a,u,s),d=e/t/2;if(c.y>d&&f.y>d||c.y<-d&&f.y<-d)return NaN;if(U(f.y-c.y))return Math.max(c.x,f.x);var g,h,v=c.y>f.y?c:f,m=c.y>f.y?f:c;g=d<v.y?v.x-(v.y-d)*(v.x-m.x)/(v.y-m.y):v.x;h=m.y<-d?m.x-(m.y- -d)*(m.x-v.x)/(m.y-v.y):m.x;return Math.max(g,h)}function j(e,t,n,r,i,a,o,l){for(var u=-1/0,s=o.length,c=0;c<s;c+=2){var f=(c+2)%s,d=J(e,t,n,r,i,a,o[c]+l._sx,o[c+1]+l._sy,o[f]+l._sx,o[f+1]+l._sy);g(d)||(u=Math.max(u,d))}return u}function Q(e,t,n,r,i,a,o,l){return j(e,t,n,r,i,a,[o.x1,o.y1,o.x2,o.y1,o.x2,o.y2,o.x1,o.y2],l)}function q(e,t,n,r,i,a,o){var l=-1/0,u=a.cx+o._sx-r,s=a.cy+o._sy-i,c=e*e,f=-2*e*(u*n-s*t),d=f*f-4*c*(u*u+s*s-a.r*a.r);d>=0&&(l=(-f+Math.sqrt(d))/(2*c));return l}function $(e,t,n,r,i,a){for(var o,l=-1/0,u=Math.sin(-n),s=Math.cos(-n),c=a._cl,f=0;f<c.length;f++){var d=c[f];o=d.length?j(e,t,u,s,r,i,d,a):d.r?q(t,u,s,r,i,d,a):Q(e,t,u,s,r,i,d,a);l=Math.max(l,o)}return l}function ee(e,t,n,r,i,a){var o=0;r._c&&(o=r._c/t);r._cl&&(o=Math.max(o,$(e,t,n,i,a,r)));return o}function te(e,t,n,r,i,a,o,l,u,s,c,f){var d={},g=n-e,h=r-t,v=Math.sqrt(g*g+h*h);if(U(v))d.skip=!0;else{var p=Math.atan2(h,g),b=ee(m&&u?0:i,v,p,o,e,t),y=ee(m&&s?0:i,v,p+Math.PI,l,n,r),I=c||0,x=f||0,C=1-((b=Math.max(I,b))+(y=Math.max(x,y))),G=0;if(u||s){G=Ye(i,a)/v;u&&s&&(G*=1.5)}d.skip=C<Math.max(Math.min(6/v,.1),G);if(!d.skip){d.cx1=e+b*g;d.cy1=t+b*h;d.cx2=n+y*-g;d.cy2=r+y*-h}}return d}function ne(e,t,n,r,i,a,o){var l=[],u=a-r,s=o-i,c=r-e,f=i-t,d=u*u+s*s,g=2*(u*c+s*f),h=g*g-4*d*(c*c+f*f-n*n);if(h>=0){var v=Math.sqrt(h),m=(-g-v)/(2*d),p=(-g+v)/(2*d);if(m>=0&&m<=1){var b=r+m*u,y=i+m*s;l.push(Math.atan2(y-t,b-e))}if(p!==m&&p>=0&&p<=1){var I=r+p*u,x=i+p*s;l.push(Math.atan2(x-t,I-e))}}return l}function re(e,t,n,r,i,a){var o=r-t;if(Math.abs(o)>n)return[];var l=Math.max(i,a),u=Math.min(i,a);if(l<e-n||e+n<u)return[];var s=Math.asin(o/n),c=n*Math.cos(s),f=[];u<=e-c&&e-c<=l&&f.push(o>0?Math.PI-s:-Math.PI-s);u<=e+c&&e+c<=l&&f.push(s);return f}function ie(e,t,n,r,i,a){var o=r-e;if(Math.abs(o)>n)return[];var l=Math.max(i,a),u=Math.min(i,a);if(l<t-n||t+n<u)return[];var s=Math.acos(o/n),c=n*Math.sin(s),f=[];u<=t-c&&t-c<=l&&f.push(-s);u<=t+c&&t+c<=l&&f.push(s);return f}function oe(e,t,n,r,i,a){for(var o=[],l=0;l<r.length;l+=2){var u=(l+2)%r.length,s=ne(e,t,n,r[l]+i,r[l+1]+a,r[u]+i,r[u+1]+a);o=o.concat(s)}return o}function le(e,t,n,r,i,a){var o=re(e,t,n,r.y2+a,r.x1+i,r.x2+i),l=re(e,t,n,r.y1+a,r.x1+i,r.x2+i),u=ie(e,t,n,r.x1+i,r.y1+a,r.y2+a),s=ie(e,t,n,r.x2+i,r.y1+a,r.y2+a);return o.concat(l,s,u)}var ue=function(e,t,n,r,i,a){var o=r-e,l=i-t,u=Math.sqrt(o*o+l*l);if(u>n+a||u<Math.abs(n-a)||0===u)return[];var s=(n*n-a*a+u*u)/(2*u),c=Math.sqrt(n*n-s*s),f=e+s*o/u,d=t+s*l/u,g=f+c*(l/u),h=f-c*(l/u),v=d-c*(o/u),m=d+c*(o/u);return[Math.atan2(v-t,g-e),Math.atan2(m-t,h-e)]};function se(e,t,n,r,i){for(var a=Math.PI,o=e,l=0;l<t.length;l++){t[l]+2*Math.PI<r&&(t[l]+=2*Math.PI);n<t[l]&&t[l]<r&&(i?t[l]-o<a&&(o=Math.max(o,t[l])):o-t[l]<a&&(o=Math.min(o,t[l])))}return o}function ce(e,t,n,r,i,a,o,l){var u=4;if(!l.length){var s=e+n*Math.cos(r),c=t+n*Math.sin(r),f=e+n*Math.cos(i),d=t+n*Math.sin(i);if(l.r){var g=a+l.cx,h=o+l.cy,v=be(s,c,g,h),m=be(f,d,g,h);if(v<=l.r+u&&m<=l.r+u)return!0}else{var p=a+l.x1-u,b=a+l.x2+u,y=o+l.y1-u,I=o+l.y2+u;if(p<=s&&s<=b&&y<=c&&c<=I&&(p<=f&&f<=b&&y<=d&&d<=I))return!0}}return!1}function fe(e,t,n,r,i,a){var o=a.x,l=a.y;if(a._c){if(ce(e,t,n,r,i,o,l,{cx:0,cy:0,r:a._c}))return!1}if(a._cl)for(var u=0;u<a._cl.length;u++){if(ce(e,t,n,r,i,o,l,a._cl[u]))return!1}return!0}function de(e,t,n,r,i,a,o){var l=o?r:i,u=a._sx,s=a._sy;a._c&&(l=se(l,ue(e,t,n,u,s,a._c),r,i,o));if(a._cl)for(var c=0;c<a._cl.length;c++){var f=a._cl[c];l=se(l,f.length?oe(e,t,n,f,u,s):f.r?ue(e,t,n,u+f.cx,s+f.cy,f.r):le(e,t,n,f,u,s),r,i,o)}return l}function ge(e,t){var n,r,i=P(e);if(t&&x){n=x.b||e.b;r=x.c||e.c}else{n=e.b;r=e.c}return!(!n&&!r||i)}var he=34;function ve(e,t,n,r,i,a,o,l,u,s,c){s?e.arc(0,0,0,0,0,o,l,u,t,c,!1,0,!0):e.line(0,0,0,0,o,l,u,t,c,!0);var f=s?V.arc:V.line;n&&e.triangle(0,0,0,0,0,0,o,-1,o,!0,t+k+"a1",f,!0);r&&e.triangle(0,0,0,0,0,0,l||o,-1,l||o,!0,t+k+"a2",f,!0);z.hib=!0;z.pos.t.lx=(i._sx+a._sx)/2;z.pos.t.ly=(i._sy+a._sy)/2}var me={t:.5,t1:.15,t2:.85};function pe(e,n,r,a,l,u,s,c,f,d,g,h,v,p,b){var y=c===f,I=c._sx,x=c._sy,C=f._sx,G=f._sy,w=a||0,Z=l||0,A=+(u||0)*v;y&&(A+=he*c._sl.e);var B=A>0;if(y){var R=(c._sl.w?180:225)*(Math.PI/180),M=Math.cos(R),W=Math.sin(R),V=.5;I=c._sx+c._sl.x;x=c._sy+c._sl.y;C=I;G=x;var S=-c._sl.e*he/2;I+=M*S+W*V;x+=W*S-M*V;C+=M*S-W*V;G+=W*S+M*V}var X=(I+C)/2,E=(x+G)/2,F=C-I,Y=G-x,H=Math.max(.001,Y*Y+F*F),L=Math.sqrt(H),T=+(H/4+A*A)/(2*Math.abs(A)),N=T-Math.abs(A);if(T>1e5){i=!0;o=!0;Ce(e,n,r,w,Z,s,c,f,d,g,h,v,p,b)}else{var U=B?1:-1,D=X-Y*U*N/L,O=E+F*U*N/L,_=Math.atan2(x-O,I-D),K=Math.atan2(G-O,C-D),P=B?_:K,J=B?K:_;P>J&&(J+=2*Math.PI);var j=P+(B?w:Z)*(J-P),Q=P+(B?1-Z:1-w)*(J-P),q=de(D,O,T,P,J,A>0?c:f,!0),$=de(D,O,T,q,J,A>0?f:c,!1),ee={startangle:0,endangle:0};if(c===f||fe(D,O,T,q,$,c)&&fe(D,O,T,q,$,f)){ee.startangle=q;ee.endangle=$}else{ee.startangle=2*Math.PI;ee.endangle=2*Math.PI}ee.startangle=Math.max(j,ee.startangle);ee.endangle=Math.min(Q,ee.endangle);if(ee.startangle>=ee.endangle)ve(e,s,n,r,c,f,d,g,h,!0);else{var te,ne,re,ie,oe,le,ue=.9*Ye(h,v)/T,se=-.25;if(n){te=B?ee.startangle:ee.endangle;ne=D+T*Math.cos(te);re=O+T*Math.sin(te);B?ee.startangle+=ue:ee.endangle-=ue}else m&&ge(c,b)&&(B?ee.startangle+=se*ue:ee.endangle-=se*ue);if(r){ie=B?ee.endangle:ee.startangle;oe=D+T*Math.cos(ie);le=O+T*Math.sin(ie);B?ee.endangle-=ue:ee.startangle+=ue}else m&&ge(f,b)&&(B?ee.endangle-=se*ue:ee.startangle+=se*ue);if(ee.startangle>=ee.endangle)ve(e,s,n,r,c,f,d,g,h,!0);else{e.arc(D,O,T,ee.startangle,ee.endangle,d,g,h,s,p,!1,A);n&&Le(e,D,O,T,ne,re,B,h,v,d,s+k+"a1");r&&Le(e,D,O,T,oe,le,!B,h,v,g||d,s+k+"a2");t(z.pos,function(e,t){if("t"===t||z.present[t]){var n=U>0?ee.startangle:ee.endangle,r=n+((U>0?ee.endangle:ee.startangle)-n)*me[t];e.lx=D+T*Math.cos(r);e.ly=O+T*Math.sin(r);e.tdx=-U*Math.sin(r);e.tdy=U*Math.cos(r);e.tangent=r;e.R=T;e.signf=U}})}}}}function be(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function ye(e,t,n,r,i,a){var o=e,l=t,u=Math.ceil(a/8),s=be(o,l,n,r);return{x:o+=(o-n)/s*(u-i),y:l+=(l-r)/s*(u-i)}}function Ie(e,t){var n=Je,r=(e.e||1)*Bt;return t.x>e._sx&&"e"===e.sh?e._sx+r*n:t.x<e._sx&&"w"===e.sh?e._sx-r*n:e._sx}function xe(e,n,r,i,a,o,l,u,s,c,f,d,g){var h,v,m=i,p=a,b=Ie(u,s),y=u._sy,x=Ie(s,u),C=s._sy,G=o||0;x>b?(h=b+I)>(v=x-I)&&(v=h=(b+x)/2):(h=b-I)<(v=x+I)&&(v=h=(b+x)/2);var w=be(b,y,h,G),Z=be(h,G,v,G),A=be(v,G,x,C),B=w+Z+A,R=Math.atan2(G-y,h-b),M=Math.atan2(G-C,v-x),W=0===w?0:ee(f,w,R,u,b,y),S=0===A?0:ee(f,A,M,s,x,C);m=0===w?0:(m||0)*B/w;p=0===A?0:(p||0)*B/A;var X,E,F,Y,H,L,T=b+(W=Math.min(1,Math.max(m,W)))*(h-b),N=y+W*(G-y),U=x+(S=Math.min(1,Math.max(p,S)))*(v-x),D=C+S*(G-C);(n||r)&&(H=Ye(f,d));if(n){X=T;E=N;T=(L=ye(T,N,h,G,H,f)).x;N=L.y}if(r){F=U;Y=D;U=(L=ye(U,D,v,G,H,f)).x;D=L.y}e.line3(T,N,h,G,v,G,U,D,c,f,l,g);n&&He(e,X,E,f,d,R+Math.PI,c,l+k+"a1",V.line);r&&He(e,F,Y,f,d,M+Math.PI,c,l+k+"a2",V.line);var O={t:{lx:(h+v)/2,ly:(G+G)/2},t1:{lx:b,ly:y},t2:{lx:x,ly:C}};t(z.pos,function(e,t){if("t"===t||z.present[t]){e.above=!0;e.lx=O[t].lx;e.ly=O[t].ly;e.R=0}})}function Ce(e,n,r,i,a,o,l,u,s,c,f,d,g,h){var v=te(l._sx,l._sy,u._sx,u._sy,f,d,l,u,n,r,i,a);if(v.skip)ve(e,o,n,r,l,u,s,c,f,!1,g);else{var p,b,y,I,x,C,G,w,Z=v.cx1,A=v.cy1,B=v.cx2,R=v.cy2,M=B-Z,W=R-A,S=Math.max(.001,W*W+M*M),X=Math.sqrt(S),E=.25;(n||r)&&(G=Ye(f,d));if(n){p=Math.atan2(W,M);y=Z;I=A;w=ye(Z,A,B,R,G,f);Z=w.x;A=w.y}else if(m&&ge(l,h)){Z-=E*f*M/X;A-=E*f*W/X}if(r){b=Math.atan2(W,M);x=B;C=R;w=ye(B,R,Z,A,G,f);B=w.x;R=w.y}else if(m&&ge(u,h)){B+=E*f*M/X;R+=E*f*W/X}e.line(Z,A,B,R,s,c,f,o,g);n&&He(e,y,I,f,d,p+Math.PI,s,o+k+"a1",V.line);r&&He(e,x,C,f,d,b,c||s,o+k+"a2",V.line);t(z.pos,function(e,t){if("t"===t||z.present[t]){var n=me[t],r=u._sx-l._sx,i=u._sy-l._sy;if(0===r&&0===i){r=1;i=-1}var a=O(r,i);e.lx=Z+n*(B-Z);e.ly=A+n*(R-A);e.tdx=r/a;e.tdy=i/a;e.tangent=Math.atan2(i,r);e.R=0}})}}function Ge(e,t,n,r,i,a,o,l,u,s,c,f,d){var g=n||[],h=r;if(o){for(var v=0,m=0;m<g.length-1;m++)v+=ke(g[m],g[m+1])*a;h+=v/2}else g.length>0?h-=Se(g[g.length-1])*a:h-=Se({});if(c){var p=h;if(g.length>0){y(function(e,t){p=t});var b=g[0].e||1;p-=b*a*he/2;c._sl.e*=b}c._sl.x=p-c._sx;c._sl.y=i-c._sy;c._sl.w=!0}function y(e){for(var t=g.length-1,n=h;t>=0;t--){e(g[t],n);t>0&&(n-=ke(g[t-1],g[t])*a)}}o&&l&&y(function(t,n){e.circle(n,i,Ve(t)*a*1.25,At.white,-1,T(),!0,s,null,null,!1,f)});var I=0;y(function(n,r){var o=s+k+I;d&&(o+="-"+d);vt(e,t,o,r,i,a,n,u,c,!1,!1,f);I++})}function we(e,t,n,r,i,a,o,l,u,s,f,d,g,h,v){var m,p,b,y=n||[],I=r,x=i,C=0,G=function(e,t){return ke(e,t)*a},w=function(){return 0};if(o)if(v.R&&c){var Z=0,A=v.signf,B=v.R;C=v.tangent;for(b=0;b<y.length-1;b++){p=ke(y[b],y[b+1]);Z+=A*Math.asin(p/(2*B))}var R=C+Z/2,M=2*A*B*Math.sin(Z/2);I+=A*M*-Math.sin(R);x+=A*M*Math.cos(R);C+=Z;G=function(e,t){m-=A*Math.asin(ke(e,t)/(2*B));var n=-A*Math.sin(m);return ke(e,t)*a*n};w=function(e,t){var n=A*Math.cos(m);m-=A*Math.asin(ke(e,t)/(2*B));return ke(e,t)*a*n}}else{var W=0;for(b=0;b<y.length-1;b++)W+=ke(y[b],y[b+1])*a;if(c){G=function(e,t){return ke(e,t)*a*v.tdx};w=function(e,t){return ke(e,t)*a*v.tdy};I+=W*v.tdx/2;x+=W*v.tdy/2}else I+=W/2}else y.length>0?I-=Se(y[y.length-1])*a:I-=Se({});function V(e){m=C;for(var t=y.length-1,n=I,r=x;t>=0;t--){e(y[t],n,r);if(t>0){n-=G(y[t-1],y[t]);r-=w(y[t-1],y[t])}}}o&&l&&V(function(t,n,r){e.circle(n,r,Ve(t)*a*1.25,At.white,-1,T(),!0,s,null,null,!1,g)});var S=0;V(function(n,r,i){var o=s+k+S;h&&(o+="-"+h);vt(e,t,o,r,i,a,n,u,null,!1,!1,g);S++})}function Ze(e,t,n,r,i,a,o){var l,u,s,c=e.getLayer(),f="solid",d=ir;e.setLayer(si.HALOS);for(var g=!0,h=0;h<d.length;h++){l=i[s=d[h]];u=t+k+s;if(l){g=!1;"h"===i.st?xe(e,!1,!1,i.b1,i.b2,i.y,u,n,r,l.c,l.w,a,f):i.off||n===r?pe(e,!1,!1,i.b1,i.b2,i.off,u,n,r,l.c,null,l.w,a,f,o):Ce(e,!1,!1,i.b1,i.b2,u,n,r,l.c,null,l.w,a,f,o)}}i._noHalos=g;e.setLayer(c)}function Ae(e,r,i,a,o,u,s,c,f){var d=f.isSelected,g=f.isRevealed,h=1;i._edit=null;var v=i.id,m=d&&!w,p=m,b=d&&w,y=b&&G.b1>=0?G.b1:i.b1,I=b&&G.b2>=0?G.b2:i.b2,x=b&&G.c||i.c,C=b&&G.c2||i.c2,Z=b&&G.fb||i.fb,A=b&&G.fbc||i.fbc,B=b&&G.fc||i.fc,R=b&&G.ff||i.ff,M=b&&G.fs||i.fs,W=b&&G.t1||i.t1,V=b&&G.t2||i.t2,S=b&&G.ls||i.ls,k=b&&G.w||i.w,X=!1;g&&(X=n.privateTopParentId(i.id1)!==n.privateTopParentId(i.id2));u._parentId&&(h=it(1,u._parentId,a));s._parentId&&(h=Math.min(h,it(1,s._parentId,a)));var E=(k||1)*h*Bt,F=x||At.midgrey,Y=0;z.present.t=i.t||i.g&&i.g.length||c;z.present.t1=!!i.t1;z.present.t2=!!i.t2;var H=z.present.t||z.present.t1||z.present.t2;z.hib=!1;if("h"===i.st)xe(r,i.a1,i.a2,y,I,i.y,v,u,s,F,E,h,S);else if(i.off||u===s){var L=i.off;X&&(L=i.off/h);pe(r,i.a1,i.a2,y,I,L,v,u,s,F,C,E,h,S,d)}else Ce(r,i.a1,i.a2,y,I,v,u,s,F,C,E,h,S,d);i._x=z.pos.t.lx;i._y=z.pos.t.ly;var U=z.hib;H&&t(z.pos,function(t,n){if(z.present[n]){var a,c,f,d,g,b,y=t.lx,I=t.ly,x={};if("t"===n||"string"==typeof i[n])b=i[n];else{x=i[n];"t1"===n&&(x=W);"t2"===n&&(x=V);b=x.t?x.t:i[n].t;a=x.fb?x.fb:i[n].fb;c=x.fbc?x.fbc:i[n].fbc;f=x.fc?x.fc:i[n].fc;d=x.ff?x.ff:i[n].ff;g=x.fs?x.fs:i[n].fs}var C=!1,G=y,w=I;g=Number(g||M||l)*h*Bt;b=b||"";d=d||R;var S=f||B||At.black,k=c||A||At.textback,X=void 0!==a?!!a:Z;if(m){S=N();k=T()}var F=Ue(i,b),H=De(F,e,g,X,d),L=g+3*Bt;Y=L*F.length;F.length>0&&(G-=H[0]/2);for(var D=(F.length-1)*L,O=x.above?I-(D+L/2+E/2):I-D/2,K=0;K<F.length;K++){0===K&&(w=O);var P=Ke(e,r,F[K],y,O,v,!0,S,k,X,i,!1,!0,99,H[K],m,g,d,U,n);C=C||P;O+=L}C&&(p=!1);var J="t"===n?i.g:x.g;if(_(J)){we(r,e,J,G,w,h,!C,m,o,v,u,s,U,"t"===n?null:n,t);p=!1}}});if(p){var D=Math.max(.66*(k||0),Number(M||l)*Bt/2);r.circle(i._x,i._y,D,At.white,-1,T(),!0,v,null,null,!1,U)}i.bu&&Zt(r,e,v,i._x,i._y,Y/2+4,h,i.bu,o);u.du&&ze(u,"id1",v,r,E,F,U);s.du&&ze(s,"id2",v,r,E,F,U);i._noHalos||Ze(r,v,u,s,i,h,d);U&&(i._edit={hib:!0})}var Be=3,Re=1,Me=9,We=2;function Ve(e){var t=Me;dt(e)&&(t+=We/2);e.e&&(t*=e.e);return t}function Se(e){return Ve(e)+Be}function ke(e,t){return Ve(e)+Re+Ve(t)}function Xe(e,t){return t*(1.7*e+Bt*(h(F[u])?F[u]:F.normal))}var Ee=Math.PI/7,Fe=Math.cos(Ee);function Ye(e,t){return Fe*Xe(e,t)}r.arrowLength=Ye;function He(e,t,n,r,i,a,o,l,u){var s=Xe(r,i),c=a+Math.PI;e.triangle(t+s*Math.cos(c+Ee),n+s*Math.sin(c+Ee),t+s*Math.cos(c-Ee),n+s*Math.sin(c-Ee),t,n,o,-1,o,!0,l,u,!1)}function Le(e,t,n,r,i,a,o,l,u,s,c){var f=Ye(l,u),d=ue(i,a,f,t,n,r);if(2===d.length){He(e,i,a,l,u,(o?d[0]:d[1])-Math.PI,s,c,V.arc)}else e.triangle(0,0,0,0,0,0,s,-1,s,!0,c,V.arc,!0)}function ze(e,t,n,r,i,a,o){r.circle(e._sx,e._sy,1.5*i,a,i,At.white,!0,n+k+t,null,null,!1,o)}r.labelPosition=function(e,t){if(!e||e.hi)return null;var n=e._edit;if(!n||n.hib)return null;var r=n.x1,i=n.y1,a=n.x2,o=n.y2;if("node"===e.type){r+=e.x;i+=e.y;a+=e.x;o+=e.y}return{x1:t.x(r),y1:t.y(i),x2:t.x(a),y2:t.y(o),fs:t.dim(n.fs)}};function Te(e){return H.showFullLabel&&H.showFullLabel===e}function Ne(e,t){return Z&&("node"===e.type||"link"===e.type)&&t.length>Z&&!Te(e.id)}function Ue(e,t){var n=t;""===n||n||(n=e.t);function r(){Ne(e,n)&&(n=n.substring(0,Z-3)+"...");return n.split(/\r\n|\r|\n/)}return n?r():[""]}function De(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=Nn(t,e[o],n,r,i||s).width;return a}function Oe(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function _e(e,t,n,r,i,a,o,l,u,s,c,f,d,g,h,v,m){return Ke(e,t,n,r,i,a,o,l,u,s,c,f,d,g,Nn(e,n,v,s,m).width,h,v,m)}function Ke(e,t,n,r,i,a,o,l,u,s,c,f,d,g,h,v,m,p,b,y,I){var x=!0;0===n.length&&(x=!1);var C=a+k+(y||"t");if(x&&b){t.text(0,0,n,l,m,s,C,p,!0,h,!1,o,0,0,0,0,u,v,0,b);c&&(c._edit={hib:!0});return!0}if(f&&h>g)return _e(e,t,n,r,i,a,o,l,u,s,c,f,d,g,v,.85*m,p);var G,w=4*Bt,Z=r-h/2,A={x1:Z-w,y1:(G=d?i+(I||1)+m/2:i+(1+m)/2)-m,x2:Z+h+w,y2:G};if(x){var B=d?Y:0;t.text(r,G,n,l,m,s,C,p,!0,h,!1,o,A.x1,A.y1,A.x2,A.y2,u,v,w,!1,B)}if(c&&"node"===c.type){A.x1-=c._sx;A.y1-=c._sy;A.x2-=c._sx;A.y2-=c._sy}c&&Pe(c,A,m,x);return x}function Pe(e,t,n,r){if(e._edit){e._edit.hib=!1;e._edit.x1=Math.min(e._edit.x1,t.x1);e._edit.x2=Math.max(e._edit.x2,t.x2);e._edit.y1=Math.min(e._edit.y1,t.y1);e._edit.y2=Math.max(e._edit.y2,t.y2)}else e._edit={fs:n,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,hib:!1};p&&r&&e._cl&&e._cl.push(t)}var Je=50,je=Je-mi,Qe=Math.sqrt(mi*mi+je*je)/mi,qe=1-Math.sin(Math.atan2(mi,je)/2),$e={box:!0,circle:!0,e:!1,w:!1};function et(e,t){return e._combo&&e._combo.open?"circle":t?$e[e.sh]?e.sh:"box":e.sh in $e?e.sh:e.sq?"box":"circle"}function tt(e,t,n,r,i,a,o,l,u){var s=r+a,c=i+a;if("circle"===e){o(Math.min(s,c))}else{var f=t-s,d=n-c,g=t+s,h=n+c;if("box"===e)l(f,d,g,h);else{var v=a*qe,m=r*Je/mi+a*Qe;"e"===e?u(g-=v,d,t+m,n,g,h,f,h,f,d):u(f+=v,h,t-m,n,f,d,g,d,g,h)}}}function nt(e,t,n,r,i,a,o,l,u,s,c,f,d,g){tt(d,t,n,r,i,a,function(r){e.circle(t,n,r,o,l,s,c,f,u,!1,!1,g)},function(t,n,r,i){e.rect(t,n,r,i,o,l,s,c,f,u,g)},function(t,n,r,i,a,d,h,v,m,p){e.pentagon(t,n,r,i,a,d,h,v,m,p,o,l,s,c,f,u,g)})}function rt(e,t,n,r,i,a,o){tt(o,t,n,r,i,a,function(t){e._c=t},function(r,i,a,o){e._cl.push({x1:r-t,y1:i-n,x2:a-t,y2:o-n})},function(r,i,a,o,l,u,s,c,f,d){e._cl.push([r-t,i-n,a-t,o-n,l-t,u-n,s-t,c-n,f-t,d-n])})}function it(e,t,n){var r=e,i=n[t];if(i){r*=i._combo.e;i._parentId&&(r=it(r,i._parentId,n))}return r}function at(e,t){for(var n=e,r=n.x,i=n.y;n._parentId;){r=(n=t[n._parentId]).x+(r-n.x)*n._combo.e;i=n.y+(i-n.y)*n._combo.e}return{x:r,y:i}}function ot(e,t,n,r,i,a){if(!n.hi&&!n.du){var o,l,u,s,c,g,v,p,b,y,I,G=a.isOpenCombo,w=n.id,Z=P(n),A=et(n,Z),B=a.isSelected,R=B&&C,M=B&&!C,W=R&&x.b||n.b,V=R&&x.bs||n.bs,S=R&&x.c||n.c,X=(Z?1:R&&x.e||n.e||1)*Bt;l=!!Z&&(R&&x.re||n.re);u=R&&x.u||n.u;s=R&&x.fi||n.fi;c=R&&h(x.bw)?x.bw:n.bw;g=R&&x.w||n.w;v=R&&x.h||n.h;p=n.x;b=n.y;var E,F=n.donut&&"circle"===A&&!G?n.donut:null;if(G){var Y=n.oc;if(Y){W=null===Y.b?null:Y.b||L.b;c=Y.bw||L.bw;V=Y.bs||L.bs;S=Y.c||L.c;l=Y.re||L.re;g=Y.w||L.w}else{W=L.b;c=L.bw;V=L.bs;S=L.c;l=L.re;g=L.w}if(R){var H=x.oc;if(H){W=H.b||W;c=H.bw||c;V=H.bs||V;S=H.c||S}}s=null;u=null;A="circle";y=R&&x.e||n.e||1;v=g*=X=n._combo.e}var z=1;if(n._parentId){z=it(1,n._parentId,r);var N=at(n,r);g*=z;v*=z;X*=z;p=N.x;b=N.y}n._sx=p;n._sy=b;if(F){E=!0;o=F.b;c=X*(F.w+2*F.bw);V=null}else if(W&&(void 0===c||c>0)){E=!0;o=W;c=X*(c||vi)}else{E=!1;o=At.white;c=0;V=null}var U,D,O=!!S,_=!!u||!(!s||!s.t),K=O?S:At.white;n._c=0;n._cl=[];n._edit=null;n._sl={e:X};if(Z){U=g/2;D=v/2}else D=U=X*mi;var J,j,Q,q=U+c/2,$=D+c/2;if(F){J=X*F.w;j=c/2}else j=.75*(J=E?c:X*vi);Q=m?E||O?c/2:j-J/2:j+J/2;if(_||E||O){rt(n,p,b,q,$,Q,A);if(B&&(!M&&l||M)){var ee=ci[t.getLayer()];lt(t,ee,a,function(){var e=T();nt(t,p,b,q,$,j,e,J,null,e,!1,w,A,!M);l&&(It=t.getLast())})}}if(O){nt(t,p,b,q,$,0,o,-1,V,K,O,w,A);B&&l&&!_&&(xt=t.cloneLast())}if(_){if(u){var te=0,ne=0,re=1;if(I=d[u]){te=I.dx/100*U;ne=I.dy/100*D;re=I.e}t.image(p-U*re+te,b-D*re+ne,p+U*re+te,b+D*re+ne,i+u,w,n.ci?"ci":void 0,1)}else{var ie=Z?Math.min(U,D):U;pt(t,e,w,p,b,ie,s.t,s.c||At.black,s.ff||f)}B&&l&&(xt=t.cloneLast())}if(E){var oe=F&&0===F.bw?-1:c||-1;oe>=0&&nt(t,p,b,q,$,0,o,oe,V,K,!1,w,A)}F&&wt(t,p,b,Math.min(q,$),F,X,w+k);ft(t,e,p,b,c,U,D,n,Z,A,E,O,_,M,X,y,w,i,R,a)}}function lt(e,t,n,r){var i,a=e.getLayerPath(),o=e.getLayer();if(t){if(n.isRevealed){n.isParentRevealed||(i=a.slice(1));if(n.isParentTransient){i||(i=a.slice(0));i.unshift(si.TRANSIENT)}}!n.isTransient||n.isInCombo&&n.isParentTransient||(i=a.slice(1));if(n.isOpenCombo){(i=(i=i||a).slice(0,i.length-1))[i.length-1]===si.COMBOS&&(i[i.length-1]=si.MAIN);i.push(n.isInBackground?si.BG:si.FG)}if(i){e.hasPath(i)||e.createItemLayersAt(i);e.setLayerPath(i)}e.setLayer(t)}r();if(t){e.setLayerPath(a);e.setLayer(o)}}function ut(e,t,n,r,i,a){var o=0,l=0,u="centre";if(-1!==e.indexOf("n")||-1!==e.indexOf("s")){l=-n;2===e.length&&(l-=r.dy);-1!==e.indexOf("s")&&(l*=-1)}if(-1!==e.indexOf("e")||-1!==e.indexOf("w")){o=t;u="right";2===e.length&&(o+=r.dx);if(-1!==e.indexOf("w")){o*=-1;u="left"}}!i&&a&&(-1!==["n","s"].indexOf(e)?l*=Math.sqrt(2):-1!==["e","w"].indexOf(e)&&(o*=Math.sqrt(2)));return{gdx:o,gdy:l,growDirection:u}}function st(e,t,n,r,i){var o,l,u="centre";e>0&&e<180?u="right":e>180&&(u="left");var s=a(e);switch(i){case"circle":o=Math.sin(s)*r;l=-Math.cos(s)*r;break;case"rectangle":var c,f=[Math.atan2(t,n),Math.atan2(t,-n),Math.atan2(-t,-n),Math.atan2(-t,n)];for(c=0;c<f.length;c++)f[c]<0&&(f[c]+=2*Math.PI);if(s<f[0]||s>f[3])o=-(l=-n)*Math.tan(s);else if(s<f[1]){o=t;l=s===Math.PI/2?0:-o/Math.tan(s)}else if(s<f[2])o=-(l=n)*Math.tan(s);else{o=-t;l=s===Math.PI/2*3?0:-o/Math.tan(s)}break;default:o=0;l=0}return{gdx:o,gdy:l,growDirection:u}}function ct(e,t,n,r,i,a,o,l,u,s,c,f){var d,g=0;if(-1!==["n","ne","e","se","s","sw","w","nw"].indexOf(c.p))d=ut(c.p,n,r,f,s,u);else{var h="rectangle",v=0;if(u){h="circle";v=s?Math.min(n,r):Math.sqrt(2)*n}d=st(c.p,n,r,v,h)}if(null!==d.gdx){d.gdx<0&&d.gdy<0&&c.e&&(i._sl.e=Math.max(i._sl.e,c.e));g=vt(e,t,o+k+c.p,i._sx+d.gdx,i._sy+d.gdy,a,c,l,i,d.growDirection,!0)}return i._sy+d.gdy+g}function ft(e,t,n,r,i,a,o,u,c,f,d,g,h,v,m,p,b,y,I,C){var G,w,Z,A,R,M,W,V=n,S=r,k=V,X=V,E=S,F=K(u),Y=!1,H=C.isOpenCombo,L=u._combo&&u._combo.open?p:m;if(I){w=x.fb||u.fb;Z=x.fbc||u.fbc;A=x.fc||u.fc;R=x.ff||u.ff;M=(x.fs||u.fs||l)*L;W=x.tc||u.tc}else{w=u.fb;Z=u.fbc;A=u.fc;R=u.ff;M=(u.fs||l)*L;W=u.tc}H&&(W=!1);var z=3*L+M/2,U=A||At.black,D=Z||At.textback;if(v){U=N();D=T()}var O=S+o+z,_=Ue(u),P=De(_,t,M,w,R),J=M+3,j=J,Q=J*_.length;_.length>0&&(X-=P[0]/2);var q=h||d||g,$=B(W)?!!W:!h&&!c,ee=(_.length-1)*(j/2);if(q)$&&(O=S-ee);else{if(F){var te=Se(u.g[u.g.length-1])*L;X=V+te;V+=P[0]/2+te}O=S;S+=ee}var ne=V;if(("e"===f||"w"===f)&&(d||g)){var re=8*L;ne+="e"===f?re:-re}_.length>0&&(E=O);d&&!$&&(O+=i-3*L);if(q){var ie=3,oe=3,le={dx:0,dy:h?-8:0},ue=2;if(!c&&"circle"===f){ie+=ue;oe+=ue;if(h){le.dx+=ue;le.dy+=ue}}if(c){ie++;oe++}var se=ie*L,ce=oe*L;le.dx*=L;le.dy*=L;u._sl.x=-a+(se-le.dx);u._sl.y=-o+(ce-le.dy);if(F){var fe="circle"===f;for(G=0;G<u.g.length;G++){var de=ct(e,t,a-se,o-ce,u,m,b,y,fe,c,u.g[G],le);$||(O=Math.max(O,de+z))}}}for(var ge=0;ge<_.length;ge++){var he=Ke(t,e,_[ge],ne,O,b,!0,U,D,w,u,!1,!0,99,P[ge],v,M,R||s,null,null,L);Y=Y||he;O+=j}if(!q){var ve=!u.t||!Y;Ge(e,t,u.g,ve?k:X,E,L,ve,v,y,b,u)}var me=!u._noHalos||I;!c&&me&&lt(e,si.HALOS,C,function(){bt(e,b,V,S,L,u,I)});if(u.bu){var pe=0;q?pe=o:Q>0?pe=Q/2+4:K(u)&&(pe=13*L);Zt(e,t,b,V,S,pe,L,u.bu,y,H)}}function dt(e){return"b"in e?e.b:At.keyline}function gt(e,t,n,r){e._cl.push({cx:t,cy:n,r:r})}function ht(e,t,n,r,i){e._cl.push({x1:t,x2:r,y1:n,y2:i})}function vt(e,t,n,r,i,a,o,l,u,c,g,h){var v=r,m=i,p=a,b=0;if(o&&!(u&&u._combo&&u._combo.open)){o.e&&(p*=o.e);var y,I=o.a?yt:1,x=Me*p*I,C=dt(o),G=C?We*p:-1,w=!!(o.u||o.fi&&o.fi.t),Z=0,A=0,B=1;b=x+(C?G/2:0);if(o.c)if(o.t){var W,V,k,X,F=!R(o,"fb")||o.fb,Y=o.fc||At.white,H=o.ff||s;if(o.w&&g){W=p*M[1]*I;V=Nn(t,k=(o.t+"").substring(0,25),W,F,H).width;var L,z,T=(X=Math.max(V,x))+x;switch(c){case"left":L=(z=v+x)-T;v=z-T/2;break;case"centre":L=v-T/2;z=v+T/2;break;default:z=(L=v-x)+T;v=L+T/2}var N=m-x,U=m+x;e.roundRect(L,N,z,U,x,C,G,o.c,!0,n,h);if(u){gt(u,L+x-u._sx,m-u._sy,b);gt(u,z-x-u._sx,m-u._sy,b);ht(u,L+x-u._sx,N-u._sy-G/2,z-x-u._sx,U-u._sy+G/2)}}else{e.circle(v,m,x,C,G,o.c,!0,n,null,null,!1,h);V=Nn(t,k=(o.t+"").substring(0,4),W=p*M[k.length-1]*I,F,H).width;X=1.7*x;u&&gt(u,v-u._sx,m-u._sy,b)}Ke(t,e,k,v,m,n,!1,Y,At.white,F,null,!0,!1,X,V,!1,W,H,h)}else{e.circle(v,m,x,C,G,o.c,!0,n,null,null,!1,h);u&&gt(u,v-u._sx,m-u._sy,b);if(w){var D=x/1.41421;if(o.u){if(y=d[o.u]){Z=y.dx/100*D;A=y.dy/100*D;B=y.e}var O=D*B;e.image(v-O+Z,m-O+A,v+O+Z,m+O+A,l+o.u,n,null,null,null,h)}else pt(e,t,n,v,m,D,o.fi.t,o.fi.c||At.black,o.fi.ff||f,h)}}else if(w){u&&gt(u,v-u._sx,m-u._sy,x);if(o.u){if(y=d[o.u]){Z=y.dx/100*x;A=y.dy/100*x;B=y.e}e.image(v-x*B+Z,m-x*B+A,v+x*B+Z,m+x*B+A,l+o.u,n,null,null,null,h)}else pt(e,t,n,v,m,x,o.fi.t,o.fi.c||At.black,o.fi.ff||f,h)}o.a&&(Ct=Ct||new Map).set(S(n),E)}return b}function mt(e,t){return be(e,t,0,0)}function pt(e,t,n,r,i,a,o,l,u,c){e.rect(r-a,i-a,r+a,i+a,At.transparent,-1,At.transparent,!0,n,null,c);var f=2*a,g=Nn(t,o,f,!1,u||s,!0),h=mt(g.width,g.height),v=f-(h-f)/2;h=mt((g=Nn(t,o,v,!1,u||s,!0)).width,g.height);var m=d[o],p=0,b=0,y=1;if(m){p=m.dx/100*a;b=m.dy/100*a;y=m.e}var I=a*(5/6)*y,x=r-I+p,C=i-I+b,G=r+I+p,w=i+I+b;e.text(r+p,i+v*y/2+b,o,l,v*y,!1,n,u,!0,h,!0,null,x,C,G,w,null,null,null,c)}function bt(e,t,n,r,i,a,o){for(var l,u=ar,s=!0,c=0;c<u.length;c++){var f=u[c];if(l=o&&x[f]||a[f]){s=!1;var d=t+k+f,g=l.r*i,h=l.w*i;h/2>=g?e.circle(n,r,g+h/2,At.white,-1,l.c,!0,d,null,!0):e.circle(n,r,g,l.c,h,At.white,!1,d,null,!0)}}a._noHalos=s&&!o}var yt,It,xt,Ct,Gt=Math.PI/256;function wt(e,t,n,r,i,a,o){var l=i.bw*a,u=i.w*a;if(u>0){var s=i.v.filter(function(e){return e>0}).length;if(1===s){var c=0;i.v.forEach(function(e,t){e>0&&(c=t)});e.circle(t,n,r,i.c[c],u,At.white,!1,o+"do0",null,!0)}else{var f=i.v.reduce(function(e,t){return e+t},0),d=l/r,g=d*s,h=2*Math.PI-g,v=-Math.PI/2+d/2;h>0&&i.v.reduce(function(a,c,g){var v=a;if(0===c)return v;var m=v+h*c/f,p=m+d,b=i.c[g%i.c.length];0===l&&(0===g?v-=Gt:g!==s-1&&(m+=Gt));e.arc(t,n,r,v,m,b,null,u,o+"do"+g,null,!0,0);return p},v)}}}function Zt(e,t,n,r,i,a,o,u,c,f){var d=o*Bt;if(u.t){var g=r,h=i,v=e.getLayer();f||e.setLayer(si.BUBBLES);var m=u.p?""+u.p:"ne",p="w"===m.substring(1,2),b="s"===m.substring(0,1),y=n+k+"bu",I=Number(u.fs?u.fs:l)*d,x=u.b?u.b:At.keyline,C=u.c?u.c:At.white,G=u.fc?u.fc:At.black,w=Ue(u),Z=I+3*d,A=Z*w.length,B=De(w,t,I,u.fb,u.ff),R=Oe(B),M=13*d,W=6*d,V=2*o,S=9*d,X=13*d,E=10*d,F=a+X,Y=A+2*W,H=2*d,L=Math.max(H/2,1),z=3*d;u.g&&delete u.g.e;var T=u.g?17*d:0;p&&(g-=R+2*V+2*M+T);b&&(h+=(I+3)*w.length+2*F+2*W);var N=g+V+.5,U=g+V+2*M+R+T+.5,D=h-F-Y+.5,O=h-F+.5;e.roundRect(N,D,U,O,8*d,x,H,C,!0,y);vt(e,t,y,g+T,(D+O)/2,d,u.g,c);var _,K=D-.5+W+Z,P=N+M+T-.5;for(_=0;_<w.length;_++){var J=B[_];e.text(P,K,w[_],G,I,u.fb,y,u.ff||s,!1,J,!1,!1,P-1.5,K-I,U,O);K+=Z}if(p){N=U;S=-S;E=-E;L=-L}if(b){O=D;X=-X;z=-z}e.triangle(N+S,O,N+S+E,O,N+S,O+X,x,H,C,!0,y,0,!1);e.triangle(N+S+L,O-z,N+S+E+L,O-z,N+S+L,O+X-z,x,-1,C,!0,y,0,!1);e.setLayer(v)}}r.contains=function(e,n){var r=[],i=A(e,{sh:"box",x:0,y:0});function a(e,t){
e&&r.push(t)}if(P(i))if("circle"===i.sh){var o=Math.min(i.w,i.h)/2;t(n,function(e){P(e)?"circle"===e.sh?a(In(i.x,i.y,o,e.x,e.y,Math.min(e.w,e.h)/2),e.id):a(Cn(i.x,i.y,o,e.x-e.w/2,e.y-e.h/2,e.x+e.w/2,e.y+e.h/2),e.id):a(In(i.x,i.y,o,e.x,e.y),e.id)})}else{var l={x1:i.x-i.w/2,y1:i.y-i.h/2,x2:i.x+i.w/2,y2:i.y+i.h/2};t(n,function(e){if(P(e))if("circle"===e.sh){var t=Math.min(e.w,e.h)/2;a(xn(l,e.x-t,e.y-t,e.x+t,e.y+t),e.id)}else a(xn(l,e.x-e.w/2,e.y-e.h/2,e.x+e.w/2,e.y+e.h/2),e.id);else a(yn(l,e.x,e.y),e.id)})}return r};var Bt=1;r.getResizePrimitive=function(){return xt};r.animated=function(){return!!Ct};r.generate=function(t,r,a,l,u,s,c,f,d,g,h,v,m,p,b,y){var I,x,C,G,w={isSelected:!1,isOpenCombo:!1,isInCombo:!1,isInBackground:!1,isTransient:!1,isParentTransient:!1,isRevealed:!1,isParentRevealed:!1};i=o;o=!1;var Z=y&&!i&&!a,A=new Map;function B(e,t){var i=r[t];if(i){var a=n.privateFirstVisibleItemInAncestry(i.id1),o=n.privateFirstVisibleItemInAncestry(i.id2);!a||a._combo&&a._combo.open||A.set(a.id,!0);!o||o._combo&&o._combo.open||A.set(o.id,!0)}}v.forEach(B);if(xt&&(a||u.get(xt.id)===E)){It=null;xt=null}function R(e,n){var i=e._parentId,a=!1;if(i){if(!n&&h(i)||m(i))return!0;var o=t[i]||r[i];o&&o._parentId&&(a=R(o))}i=e.id;var l=n&&v.has(i)||A.has(i)||p(i),u=!n&&h(i),s=!n&&m(i);return a||!l&&(u||s)}function M(e){var r,i,a,o=[],l=!1,u=!!e._combo,f=u&&e._combo.open,d=e._parentId||f;w.isOpenCombo=f;w.isInBackground=e.bg;w.isSelected=h(e.id);w.isInCombo=e._parentId;if(A.has(e.id)||p(e.id)){w.isRevealed=!0;A.set(e.id,!0);o.push(si.REVEALED)}else w.isRevealed=!1;if(d){var v=n.privateGetAncestryIds(e.id);o.push(si.COMBOS);r=!1;for(var m=0;m<v.length-1;m++){var b=v[m];o.push(b);var y=t[b];r||(r=y&&y._combo&&R(y));if(!w.isRevealed&&!i&&(i=A.has(b)||p(b))){w.isRevealed=!0;A.set(e.id,!0);o.unshift(si.REVEALED)}}w.isParentTransient=!!r;w.isParentRevealed=!!i;f&&o.push(e.id)}else{o.push(si.MAIN);w.isParentTransient=!1;w.isParentRevealed=!1}w.isRevealed||(l=!(!R(e)||!u&&P(e)))&&o.unshift(si.TRANSIENT);w.isTransient=l;s.startGeneratingFor(e,Z,w.isInCombo||w.isOpenCombo);if(f)a=si.COMBO_CONTAINER;else{a=P(e)?si.SHAPES:si.NODES;o.push(e.bg?si.BG:si.FG)}d&&!s.hasPath(o)&&s.createItemLayersAt(o,!0);s.setLayerPath(o);s.setLayer(a);ot(c,s,e,t,g,w)}function W(e){var i,a,o,l,u=[],f=e._parentId&&(e._combo||t[e._parentId]),d=r[e._parentId];w.isInBackground=e.bg;w.isSelected=h(e.id);w.isInCombo=!!e._parentId;w.isRevealed=v.has(e.id)||p(e.id)||A.has(e._parentId);if(!w.isRevealed)if(l=R(e,!0)){u.push(si.TRANSIENT);w.isTransient=!0}else w.isTransient=!1;s.startGeneratingFor(e,Z,w.isInCombo);i=t[e.id1];a=t[e.id2];if(w.isRevealed){i=n.privateFirstVisibleItemInAncestry(e.id1);a=n.privateFirstVisibleItemInAncestry(e.id2);if(!i||!a||i===a&&i!==t[e.id1])return;u.push(si.REVEALED)}if(f){for(var m=n.privateGetAncestryIds(e.id,!0),y=[],I=d?2:1,x=0;x<m.length-I;x++){var C=m[x];y.push(C);if(!l){var G=t[C];o||w.isRevealed||(o=G&&G._combo&&R(G));o&&u.unshift(si.TRANSIENT)}}w.isParentTransient=o;if(y.length>0){u.push(si.COMBOS);u=u.concat(y);s.hasPath(u)||s.createItemLayersAt(u)}else u.push(si.MAIN)}else u.push(si.MAIN);u.push(e.bg?si.BG:si.FG);s.setLayerPath(u);s.setLayer(si.LINKS);Ae(c,s,e,t,g,i,a,b,w)}Ct=null;yt=e.atanEasing(Date.now()%1e3/1e3);Bt=f.getUnzoom();if(a){s.removeAllItems();G=Object.keys(t);C=Object.keys(r);for(I=0,x=G.length;I<x;I++)M(t[G[I]]);for(I=0,x=C.length;I<x;I++)W(r[C[I]])}else{var V=[],S=function(e,n){var i=t[n];if(i)if(i._parentId||i._combo)M(i);else if(e===X){if(i._parentId){var a=at(i,t);i._sx=a.x;i._sy=a.y}else{i._sx=i.x;i._sy=i.y}s.moveItem(i,i.x,i.y)}else{Z=!1;M(i)}else if(r[n])V.push(n);else{Z=!1;s.removeItem(n)}};u.forEach(S);if(l)for(I=0,x=(C=Object.keys(r)).length;I<x;I++)W(r[C[I]]);else{var k=function(e){W(r[e])};V.forEach(k)}}return{stillDirty:Ct,rebuildAll:i||!Z}};r.generateHandles=function(e,t,n,r){var i=e.getLayerPath();e.setLayerPath(null);e.startGeneratingForExtras();e.setLayer(si.HANDLES);if(It&&1===r.size){Mn(e,t,n,It,1,It.id,T(),k);Mn(e,t,n,It,4,It.id,At.transparent,k)}e.setLayerPath(i)};return r}function bi(e){var n={primitiveMover:function(n,r,i,a,o,l,u,s,c,f,d){if(!e.trigger("dragstart","resize",a,i.unscale(s),i.unscale(c),null)){var g=n.extents(r,o),h=o.r,v={},m={};t(o,function(e,t){m[t]=e});y();Dt(m,.5);return{scrollable:!0,getCursor:function(){return l?"crosshair":"move"},generate:function(e){e.copyPrimitive(m)},dragMove:function(e,t,n,r){C(m,e,t,n,r)},endDrag:function(t,n,r,l,u){i.cancelScroll();var s=e.trigger("dragend","resize",a,i.unscale(n),i.unscale(r));I();if(!s&&t){C(o,n,r,l,u);d(o)}e.trigger("dragcomplete","resize",a,i.unscale(n),i.unscale(r))}}}function p(e,t){return{dx:i.undim(e-s),dy:i.undim(t-c)}}function b(e,t,n,r){var i,a={},o=e,l=t;if(u.length>0||f){a.x1=0;a.x2=0;a.y1=0;a.y2=0;for(var s=0;s<u.length;s++){var c="x"===(i=u[s]).charAt(0)?o:l;a[i]=c}if(n||f){0!==a.x1&&(a.x2=-a.x1);0!==a.x2&&(a.x1=-a.x2);0!==a.y1&&(a.y2=-a.y1);0!==a.y2&&(a.y1=-a.y2)}}else{r&&(l=0!==(o=Math.abs(o)>Math.abs(l)?o:0)?0:l);a.x1=o;a.x2=o;a.y1=l;a.y2=l}for(var d={},h=["x1","y1","x2","y2"],v=0;v<h.length;v++)d[i=h[v]]=g[i]+a[i];if(r){var m=g.x2-g.x1,p=g.y2-g.y1;if(Math.abs(m)>0&&Math.abs(p)>0){var b,y=p/m,I=d.x2-d.x1,x=d.y2-d.y1;if(Math.abs(o)>Math.abs(l)){var C=Math.floor(y*(m+I)-p)-x;if(f||n||!X(u,"y1")&&!X(u,"y2")){b=Math.floor(C/2);d.y1-=b;d.y2+=b}else{X(u,"y1")&&(d.y1-=C);X(u,"y2")&&(d.y2+=C)}}else{var G=Math.floor((p+x)/y-m)-I;if(f||n||!X(u,"x1")&&!X(u,"x2")){b=Math.floor(G/2);d.x1-=b;d.x2+=b}else{X(u,"x1")&&(d.x1-=G);X(u,"x2")&&(d.x2+=G)}}}}return d}function y(){m.wc&&(v.c=m.wc[3]);m.wfc&&(v.fc=m.wfc[3]);m.wbc&&(v.bc=m.wbc[3])}function I(){m.wc&&(m.wc[3]=v.c);m.wfc&&(m.wfc[3]=v.fc);m.wbc&&(m.wbc[3]=v.bc)}function x(e,t,n){return"1"===n.charAt(1)?h-("x"===n.charAt(0)?e:t):h+("y"===n.charAt(0)?t:e)}function C(e,t,r,i,a){var l,s=p(t,r);if("C"===o.p)if(u.length>1){var c=x(s.dx,s.dy,u[0]),f=x(s.dx,s.dy,u[1]);l=Math.abs(Math.min(c,f))}else l=Math.abs(x(s.dx,s.dy,u[0]));var d=b(s.dx,s.dy,i,a);n.setExtents(e,d.x1,d.y1,d.x2,d.y2,l)}},createHandDragger:function(n,r,i,a){var o={x:!0,y:!0},l=n.offsetX(),u=n.offsetY(),s=0,c=0,f=!1,d="hand",g=e.trigger("dragstart",d,null,n.unscale(r),n.unscale(i));if(g){if(!y(g)){a();return}t(g,function(e,t){o[t]=e})}function h(e,t){f=f||Math.abs(r-e)>10||Math.abs(i-t)>10;s=e-r;c=t-i;if(o){o.x||(s=0);o.y||(c=0)}}function v(){if(f){n.offsetX(l+s);n.offsetY(u+c);e.trigger("viewchange")}}return{rebuild:{drawOnly:!0},animate:v,direction:o,dragMove:h,getCursor:function(){return"move"},endDrag:function(t,r,i){var o=e.trigger("dragend",d,null,n.unscale(r),n.unscale(i));if(f){if(!o&&t)h(r,i);else{s=0;c=0}v()}else a();e.trigger("dragcomplete",d,null,n.unscale(r),n.unscale(i))}}},createDefaultDragger:function(n,r,i,a,o,l,u,s,c){var f={x:!0,y:!0,add:null,combos:!0},d=S(u),g=r[d],h="move",v=e.trigger("dragstart",h,d,l.unscale(s),l.unscale(c),k(u));if(v)if(Array.isArray(v))f.add=Y(v);else{if(!y(v))return;t(v,function(e,t){f[t]=e});Array.isArray(f.add)&&(f.add=Y(f.add))}if(f.combos){var m=o();if(m.length){f.add=f.add||{};m.forEach(function(e){f.add[e]=1})}}function p(e){return f.add&&f.add[e]}var b=l?l.viewToWorldX(s):s,I=l?l.viewToWorldY(c):c,x=Object.keys(r),C={};t(i,function(e,t){"h"===e.st&&(C[t]={y:e.y||0})});var G,w=X(s,c),Z={x:0,y:0},A=!0;g&&(G=g.w&&g.h);function B(){var e=w.dx-Z.x,r=w.dy-Z.y;Z.x=w.dx;Z.y=w.dy;var i=x.filter(function(e){return e!==d&&(a(e)||p(e))});a(d)&&(G?i.unshift(d):i.push(d));n.moveAllNodesBy(i,e,r);if(A){A=!1;n.setDirty(d)}n.drawInTransientLayer(i);t(C,function(e,t){(a(t)||p(t))&&n.moveLink(t,e.y+w.dy)})}function R(){var e=x.filter(function(e){return a(e)||p(e)});n.moveAllNodesBy(e,-Z.x,-Z.y);t(C,function(e,t){n.moveLink(t,e.y)})}var M,W,V=!1;function X(e,t){V=V||Math.abs(s-e)>10||Math.abs(c-t)>10;var n=l?l.viewToWorldX(e):e,r=l?l.viewToWorldY(t):t;if(f){f.x||(n=b);f.y||(r=I)}return{dx:V?n-b:0,dy:V?r-I:0}}return{rebuild:{positions:!0},scrollable:!0,direction:f,animate:B,generate:function(e){e.excludeHit(d)},getCursor:function(){return"move"},dragMove:function(e,t){w=X(e,t)},mouseMoved:function(e){e&&(M=!0);return M},afterDraw:function(t,n,r){M=!1;var i=S(t);if(d!==i)if(void 0===W)W=i;else if(i!==W){e.trigger("dragover",i,l.unscale(n),l.unscale(r),k(t));W=i}},endDrag:function(t,r,i){l.cancelScroll();if(e.trigger("dragend",h,S(u),l.unscale(r),l.unscale(i)))R();else if(t&&V){R();w=X(r,i);Z={x:0,y:0};e.trigger("prechange","move");B()}else R();n.setDirty(d);f.add&&Object.keys(f.add).forEach(n.setDirty);e.trigger("dragcomplete",h,S(u),l.unscale(r),l.unscale(i))}}},createLinkEndDragger:function(t,n,r,i,a,l,u,s,c){if(e.trigger("dragstart","dummy",c,r.unscale(u),r.unscale(s),null))return!1;var f=r?r.viewToWorldX(u):u,d=r?r.viewToWorldY(s):s,g=i[a[l]].x,h=i[a[l]].y;function v(e,t){n.moveNode(a[l],e,t)}var m,p,b=I(u,s),y=null;function I(e,t){var n=r?r.viewToWorldX(e):e,i=r?r.viewToWorldY(t):t;return{dx:n-f,dy:i-d}}function x(){return a["id1"===l?"id2":"id1"]}return{rebuild:{all:!0},scrollable:!0,animate:function(){v(g+b.dx,h+b.dy)},getCursor:function(){return"move"},dragMove:function(e,n){b=I(e,n);y=t.hittest(e,n,r)},mouseMoved:function(e){e&&(p=!0);return p},afterDraw:function(t,n,i){p=!1;var a=S(t),o=k(t);if(c===a){a=null;o=null}if(void 0===m)m=a;else if(a!==m){e.trigger("dragover",a,r.unscale(n),r.unscale(i),o);m=a}},endDrag:function(u,s,c){r.cancelScroll();if(!e.trigger("dragend","dummy",y,r.unscale(s),r.unscale(c)))if(u){v(g,h);e.trigger("prechange","move");y=S(y);if(i[y]&&y!==x()){var f=o(a);f[l]=y;delete f.off;n.removeItem([a[l],a.id]);t.merge([f])}else{b=I(s,c);v(g+b.dx,h+b.dy);y=null}}else v(g,h);e.trigger("dragcomplete","dummy",y,r.unscale(s),r.unscale(c))}}},createLinkDragger:function(n,r,i,a,o,l,u,s){if(e.trigger("dragstart","offset",s,i.unscale(l),i.unscale(u),k(s)))return!1;function c(e,t,n,r,i,a){return((n-e)*(t-a)-(e-i)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}var f={},d={},g={};a.privateSelection().forEach(function(e,t){if(t){var n=a.getByID(t);if(n&&"link"===n.type){f[t]=n.off||0;d[t]=n.off||0;g[t]=!0}}});var h=!1;function v(e,t,r){var a=e===o,l=a?i.viewToWorldX(t):t,u=a?i.viewToWorldY(r):r,s=n(1,e),h=n(2,e),v=c(s.x,s.y,h.x,h.y,l,u);g[e.id]&&Math.abs(v-f[e.id])>8&&(g[e.id]=!1);if(!g[e.id]){Math.abs(a?v:v+f[e.id])<12&&(v=a?0:-f[e.id]);d[e.id]=a?v:v+f[e.id]}}function m(e){a.setLinkOffset(e,d[e])}return{rebuild:{all:!0},scrollable:!0,animate:function(){t(d,function(e,t){m(t)})},getCursor:function(){return"move"},dragMove:function(e,r){var s=i.viewToWorldX(e)-i.viewToWorldX(l),c=i.viewToWorldY(r)-i.viewToWorldY(u);t(d,function(t,i){var l=a.getByID(i);if(l)if(l===o){v(l,e,r);h=!0}else{var u=n(1,l),f=n(2,l),d=(u.x+f.x)/2,g=(u.y+f.y)/2;v(l,d+s,g+c)}})},endDrag:function(n,r,o){i.cancelScroll();if(!e.trigger("dragend","offset",s,i.unscale(r),i.unscale(o))&&a.getByID(s))if(n&&h){t(f,function(e,t){a.getByID(t).off=e});e.trigger("prechange","offset");t(d,function(e,t){a.getByID(t).off=e})}else{t(d,function(e,t){d[t]=f[t]});this.animate()}e.trigger("dragcomplete","offset",s,i.unscale(r),i.unscale(o))}}}};return n}function yi(e,t,n){}var Ii,xi=1e-6;function Ci(e){return"number"==typeof e&&isFinite(e)}function Gi(e){return Ci(e)&&(0|e)===e}function wi(e,t){return Math.sqrt(e*e+t*t)}function Zi(e,t,n,r){return wi(e-n,t-r)}function Ai(e,t,n){return e<t?t:e>n?n:e}function Bi(e,t,n){return n*e+(1-n)*t}function Ri(e,t,n,r,i,a,o){var l=1+Math.pow(a*Math.E,-r*(o-n));return e+(t-e)/Math.pow(l,1/i)}!function(e){e.randMax=2147483647;function t(t){void 0===t&&(t=1);var n=Math.round(t)%e.randMax,r=48271,i=e.randMax/r,a=e.randMax%r;return function(){var t=r*(n%i|0)-a*(n/i|0);return(n=t>0?t:t+e.randMax)-1}}e.createPRNGi32=t;function n(n,r,i){void 0===n&&(n=1);void 0===r&&(r=0);void 0===i&&(i=1);var a=i-r,o=t(n);return function(){return r+a*(o()/e.randMax)}}e.createPRNG=n;function r(e,t,n){void 0===e&&(e=0);void 0===t&&(t=1);void 0===n&&(n=Math.random);var r=-1,i=!1;return function(){if(i){i=!1;return e+t*r}var a,o,l;do{l=(a=2*n()-1)*a+(o=2*n()-1)*o}while(l>=1||0===l);var u=Math.sqrt(-2*Math.log(l)/l);r=o*u;i=!0;return e+t*a*u}}e.createGaussianRNG=r}(Ii||(Ii={}));var Mi;function Wi(e,t){Object.setPrototypeOf(e,t);function n(){this.constructor=e}if(null!==t){n.prototype=t.prototype;e.prototype=new n}else e.prototype=Object.create(e)}!function(e){function t(e){return 0===e.size||(0|e.begin)===e.begin&&(0|e.end)===e.end&&e.end>=e.begin&&e.end-e.begin+1===e.size}e.isContiguous=t;function n(e,t){return e.size>0&&e.begin<=t&&e.end>=t}e.isWithin=n;function r(e){if(!t(e))throw new Error("non-contiguous Keyspace")}e.ensureContiguous=r;function i(e){return e>0?{size:e,begin:0,end:e-1}:{size:e,begin:-1,end:-1}}e.fromSize=i}(Mi||(Mi={}));function Vi(e,t,n){for(var r in t)void 0===e[r]?e[r]=t[r]:n&&"object"==typeof e[r]&&!Array.isArray(e[r])&&Vi(e[r],t[r])}function Si(){return{next:function(){return Ti},size:0}}function ki(e){var t={value:e,done:!1};return{next:function(){var e=t;t=Ti;return e},size:1}}function Xi(e,t){var n,r={done:!1,value:null},i={size:0,next:function(){n=e.next();r.done=n.done;n.done||(r.value=t(n.value));return r}};"size"in e&&(i.size=e.size);return i}function Ei(e,t){for(var n=0,r=e.next();!r.done;){t(r.value,n);e.next();n++}}function Fi(e){Mi.ensureContiguous(e);if(e.size<=0)return Si();var t={value:e.begin-1,done:!1};return{size:e.size,next:function(){++t.value>e.end&&(t.done=!0);return t}}}function Yi(e,t){var n={done:0===e.length,value:null,i:-1};return{size:e.length,next:function(){n.i++;n.i<e.length&&(n.value=t?t(e[n.i],n.i):e[n.i]);n.done=n.i>=e.length;return n}}}function Hi(e,t){void 0===t&&(t=[]);for(var n=e.next();!n.done;){t.push(n.value);n=e.next()}return t}function Li(e,t){var n={done:t<1,value:null,i:-1};return{size:t,next:function(){n.i++;if(n.i<t){var r=e.next().value;n.value=r}n.done=n.i>=t;return n}}}function zi(e,t,n){void 0===n&&(n=[0,0]);if(e===t)return Si();var r=e,i=e,a={value:n,done:!1};return{size:(t-e+1)*(t-e)/2,next:function(){i===t?i=++r+1:i++;if(r===t)a.done=!0;else{a.value[0]=r;a.value[1]=i}return a}}}var Ti={value:null,done:!0},Ni=Object.freeze({empty:Si,single:ki,map:Xi,forEach:Ei,fromKeySpace:Fi,fromArray:Yi,toArray:Hi,firstn:Li,allPairs:zi});function Ui(e){return e.buffer&&e.buffer instanceof ArrayBuffer}function Di(e,t){for(var n=0;n<e.length;n++)e[n]=t}function Oi(e,t){return e<t}function _i(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}function Ki(e,t,n,r,i){void 0===n&&(n=Oi);void 0===r&&(r=0);void 0===i&&(i=e.length-r);for(var a,o=0;i>0;){a=0|r;if(n(e[a+=o=i/2|0],t)){r=++a;i-=o+1}else i=o}return r}function Pi(e,t){void 0===t&&(t=0);for(var n=t,r=0,i=e.length;r<i;r++)e[r]=n++}function Ji(e,t){for(var n=0;n<t.length;n++)if(t[n]<0)t[n]=~t[n];else for(var r=n,i=t[n];i!==n;){_i(e,r,i);i=t[r=i];t[r]=~i}}function ji(e,t){void 0===t&&(t=Math.random);for(var n=e.length;0!==n;){_i(e,--n,Math.round(n*t()))}}var Qi,qi,$i=function(){function e(e,t,n,r,i,a){void 0===r&&(r=Qi.sizeFromShape(e));void 0===i&&(i=0);void 0===a&&(a=Qi.computeStrides(e));this.shape=e;this.dtype=t;this.values=n;this.size=r;this.offset=i;this.strides=a;this.rank=this.shape.length;this.lastIndex=Qi.lastIndex(this);this.contiguous=this.lastIndex-i==r-1}e.prototype.getNextIndex=function(e){if(e<0)return this.offset;var t=e+this.strides[this.rank-1];return t>this.lastIndex?-1:t};return e}(),ea=function(e){Wi(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.rankType=0;return t}t.prototype.get=function(){return this.values[this.index()]};t.prototype.set=function(e){return this.values[this.index()]=e};t.prototype.index=function(){return 0|this.offset};return t}($i),ta=function(e){Wi(t,e);function t(t,n,r,i,a,o){var l=e.call(this,t,n,r,i,a,o)||this;l.rankType=1;l.stride0=l.strides[0];return l}t.prototype.get=function(e){return this.values[this.index(e)]};t.prototype.set=function(e,t){return this.values[this.index(t)]=e};t.prototype.index=function(e){return this.offset+e*this.stride0|0};return t}($i),na=function(e){Wi(t,e);function t(t,n,r,i,a,o){var l=e.call(this,t,n,r,i,a,o)||this;l.rankType=2;l.stride0=l.strides[0];l.stride1=l.strides[1];return l}t.prototype.get=function(e,t){return this.values[this.index(e,t)]};t.prototype.set=function(e,t,n){return this.values[this.index(t,n)]=e};t.prototype.index=function(e,t){return this.offset+e*this.stride0+t*this.stride1|0};return t}($i),ra=function(e){Wi(t,e);function t(t,n,r,i,a,o){var l=e.call(this,t,n,r,i,a,o)||this;l.rankType=3;l.stride0=l.strides[0];l.stride1=l.strides[1];l.stride2=l.strides[2];return l}t.prototype.get=function(e,t,n){return this.values[this.index(e,t,n)]};t.prototype.set=function(e,t,n,r){return this.values[this.index(t,n,r)]=e};t.prototype.index=function(e,t,n){return this.offset+e*this.stride0+t*this.stride1+n*this.stride2|0};return t}($i);function ia(e,t,n){null==t&&(t=Qi.inferShape(e));null==n&&(n=Qi.inferDType(e,"f32"));var r=Ui(e)||Array.isArray(e)?e:[e],i=Qi.asTypedArray(r,n),a=Qi.getViewCtor(t.length);yi(Qi.sizeFromShape(t),i.length);return new a(t,n,i)}function aa(e,t,n){void 0===t&&(t="f32");var r=Qi.sizeFromShape(e),i=oa(t,r,n);return new(Qi.getViewCtor(e.length))(e,t,i,r)}function oa(e,t,n){var r;switch(e){case"f32":r=new Float32Array(t);break;case"i32":r=new Int32Array(t);break;case"bool":r=new Uint8Array(t);break;default:Qi.throwUnknownDType(e)}void 0!==n&&Di(r,n);return r}function la(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=[],i=[],a=e.offset,o=0,l=t.length;o<l;o++){var u=e.strides[o];if(Gi(t[o]))a+=u*t[o];else{i.push(e.shape[o]);r.push(u)}}return new(Qi.getViewCtor(i.length))(i,e.dtype,e.values,Qi.sizeFromShape(i),a,r)}function ua(e,t){void 0===t&&(t=0);for(var n=e.rank,r=e.shape,i=new Array(n),a=0;a<n;a++)i[a]="all";var o=[];for(a=0;a<r[t];a++){i[t]=a;var l=[e].concat(i);o.push(la.apply(null,l))}return o}function sa(e,t){void 0===t&&(t=[]);for(var n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=-1,a=e.values;(i=e.getNextIndex(i))>=0;){a[i]>r&&(r=a[i]);a[i]<n&&(n=a[i])}t[0]=n;t[1]=r;return t}!function(e){function t(e){switch(e){case 0:return ea;case 1:return ta;case 2:return na;case 3:return ra}throw new Error(e+" views not implemented")}e.getViewCtor=t;function n(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}e.sizeFromShape=n;function r(e){for(var t=e.rank,n=e.offset,r=0;r<t;r++)n+=e.strides[r]*(e.shape[r]-1);return n}e.lastIndex=r;function i(e){throw new Error("Unknown data type "+e)}e.throwUnknownDType=i;function a(e,t){void 0===t&&(t=[]);if(Array.isArray(e))for(var n=0,r=e;n<r.length;n++){a(r[n],t)}else t.push(e);return t}function o(e){var t=e.length,n=new Array(t);n[t-1]=1;for(var r=t-2;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}e.computeStrides=o;function l(e){if(Ui(e))return[e.length];if(!Array.isArray(e))return[];for(var t=[];e instanceof Array;){t.push(e.length);e=e[0]}return t}e.inferShape=l;function u(e,t){return e instanceof Float32Array?"f32":e instanceof Int32Array?"i32":e instanceof Uint32Array?"bool":t}e.inferDType=u;function s(e,t){if(u(e)===t)return e;Array.isArray(e)&&(e=a(e));return c(e,t)}e.asTypedArray=s;function c(e,t){switch(t){case"f32":return new Float32Array(e);case"i32":return new Int32Array(e);case"bool":return new Uint8Array(e)}i(t);return null}e.copyToTypedArray=c}(Qi||(Qi={}));!function(e){function t(e){return a(e.tl.x,e.br.x,e.tl.y,e.br.y)}e.copy=t;function n(e,t){t.tl.x=e.tl.x;t.tl.y=e.tl.y;t.br.x=e.br.x;t.br.y=e.br.y}e.copyTo=n;function r(e){return e.br.x-e.tl.x}e.width=r;function i(e){return e.br.y-e.tl.y}e.height=i;function a(e,t,n,r){if(e>t){var i=t;t=e;e=i}if(n>r){i=r;r=n;n=i}return{tl:{x:e,y:n},br:{x:t,y:r}}}e.create=a;function o(e,t){void 0===t&&(t={x:0,y:0});t.x=e.tl.x+.5*(e.br.x-e.tl.x);t.y=e.tl.y+.5*(e.br.y-e.tl.y);return t}e.center=o;function l(e,t){return e.tl.x===t.tl.x&&e.tl.y===t.tl.y&&e.br.x===t.br.x&&e.br.y===t.br.y}e.equals=l;function u(e,t,n,r){return!(t+r>e.br.x||t-r<e.tl.x||n+r>e.br.y||n-r<e.tl.y)}e.contains=u;function s(e,t){return u(e,t.x,t.y,0)}e.containsPoint=s;function c(e,t){return e.tl.x<t.br.x&&e.br.x>t.tl.x&&e.tl.y<t.br.y&&e.br.y>t.tl.y}e.intersects=c;function f(e,t){return a(Math.min(e.tl.x,t.tl.x),Math.max(e.br.x,t.br.x),Math.min(e.tl.y,t.tl.y),Math.max(e.br.y,t.br.y))}e.union=f}(qi||(qi={}));var ca=function(){function e(e,t,n){this.parentIdx=e;this.beginIdx=t;this.endIdx=n;this.childIndices=null}return e}();function fa(e,t){if(null!==e.childIndices)for(;t<=3;t++)if(e.childIndices[t]>=0)return t;return-1}function da(e,t,n,r,i){var a=r-n+1;return a<=0?-1:1===a?t[e[n]]<=i?n:-1:Ki(e,i,function(e,n){return t[e]<=n},n,a)-1}var ga=new Uint32Array([1431655765,858993459,252645135,16711935]);function ha(e,t){e=((e=((e=((e=(e|e<<8)&ga[3])|e<<4)&ga[2])|e<<2)&ga[1])|e<<1)&ga[0];t=((t=((t=((t=(t|t<<8)&ga[3])|t<<4)&ga[2])|t<<2)&ga[1])|t<<1)&ga[0];return(e|(t<<=1))>>>0}var va=function(){function e(e,t){void 0===t&&(t=2);this.maxDepth=e;this.splitThreshold=t;this.zorder=null;this.tree=null;this.N=0;this.aabb=null}e.prototype.build=function(t,n,r){var i=t.size,a=this.zorder;this.maxDepth=void 0!==this.maxDepth?this.maxDepth:Math.min(e.MAX_DEPTH,Math.max(1,Math.ceil(Math.log(i+1))));if(!Gi(this.maxDepth)||this.maxDepth<1||this.maxDepth>e.MAX_DEPTH)throw new Error("Bad maxDepth "+this.maxDepth);if(void 0!==r)this.aabb=qi.copy(r);else{var o=sa(t),l=o[0],u=o[1],s=sa(n),c=s[0],f=s[1];this.aabb=r=qi.create(l,u,c,f)}null!==a&&a.length===i||Pi(a=this.zorder=new Int32Array(i));for(var d=qi.width(r),g=qi.height(r),h=new Uint32Array(i),v=d>0?65535/d:0,m=g>0?65535/g:0,p=r.tl.x,b=r.tl.y,y=function(e,t){return ha((e-p)*v>>>0,(t-b)*m>>>0)},I=0;I<i;){var x=a[I],C=t.get(x),G=n.get(x);if(qi.contains(r,C,G,0)){h[x]=y(C,G);I++}else _i(a,I,--i)}this.N=i;var w=a.subarray(0,this.N);Array.prototype.sort.call(w,function(e,t){return h[e]-h[t]});this.buildTree(r,w,h,this.maxDepth,this.splitThreshold,y)};e.prototype.buildTree=function(t,n,r,i,a,o){for(var l=new ma(t),u=n.length,s=this.tree=[new ca(-1,0,u-1)],c={x:0,y:0},f=0;f>=0;){var d=s[f],g=-1;if(null===d.childIndices&&d.endIdx-d.beginIdx>=a-1&&l.depth<i){d.childIndices=[-1,-1,-1,-1];qi.center(l,c);var h=o(c.x,c.y),v=o(l.br.x,c.y),m=o(c.x,l.br.y),p=d.beginIdx,b=d.endIdx,y=da(n,r,p,b,h);if(y>=p){d.childIndices[0]=s.push(new ca(f,p,y))-1;p=y+1}var I=da(n,r,p,b,v);if(I>=p){d.childIndices[1]=s.push(new ca(f,p,I))-1;p=I+1}var x=da(n,r,p,b,m);if(x>=p){d.childIndices[2]=s.push(new ca(f,p,x))-1;p=x+1}b>=p&&(d.childIndices[3]=s.push(new ca(f,p,b))-1)}else g=l.currentQuad;f=e.nextDFS(s,l,f,g+1)}};e.prototype.traverse=function(){if(null===this.tree||0===this.tree.length)return Si();var t=this.tree,n=new ma(this.aabb),r=0,i={value:null,done:!1};function a(){if(r>=0){var a=t[r];i.value={id:r,aabb:qi.copy(n),count:a.endIdx-a.beginIdx+1};r=e.nextDFS(t,n,r,0)}else i.done=!0;return i}return{next:a,size:t.length}};e.nextDFS=function(e,t,n,r){var i=e[n];if(-1===(r=fa(i,r))){for(;i.parentIdx>=0&&-1===(r=fa(i=e[i.parentIdx],t.pop()+1)););if(-1===r)return-1}t.descend(r);return i.childIndices[r]};e.MAX_DEPTH=15;return e}(),ma=function(){function e(e){this.tl={x:0,y:0};this.br={x:0,y:0};this.quadrants=new Int32Array(va.MAX_DEPTH);this.quadrants[0]=-1;this.reset(e)}Object.defineProperty(e.prototype,"currentQuad",{get:function(){return this.quadrants[this.depth]},enumerable:!0,configurable:!0});e.prototype.reset=function(e){qi.copyTo(e,this);this.depth=0;this.w=qi.width(e);this.h=qi.height(e);this.longestSide=Math.max(this.w,this.h)};e.prototype.descend=function(e){this.w*=.5;this.h*=.5;this.longestSide*=.5;this.quadrants[++this.depth]=e;this.resize(e,this.w,this.h)};e.prototype.pop=function(){var e=this.quadrants[this.depth--];this.resize(e,-this.w,-this.h);this.w*=2;this.h*=2;this.longestSide*=2;return e};e.prototype.resize=function(e,t,n){var r=this,i=r.tl,a=r.br;switch(0|e){case 0:a.x-=t;a.y-=n;break;case 1:i.x+=t;a.y-=n;break;case 2:a.x-=t;i.y+=n;break;case 3:i.x+=t;i.y+=n}};return e}();function pa(e,t,n){return e>=t&&e<=n}var ba=function(e){Wi(t,e);function t(t,n,r){void 0===t&&(t="f32");var i=e.call(this,n,r)||this;i.dtype=t;i.outboundExpansions=null;return i}t.prototype.buildXYM=function(e,t,n,r){var i=r.length;if(void 0===this.zxs||this.zxs.length<i){this.zxs=oa(this.dtype,i);this.zys=oa(this.dtype,i);this.zms=oa(this.dtype,i)}for(var a=this,o=a.zxs,l=a.zys,u=a.zms,s=0;s<i;s++){var c=r[s];o[s]=e.get(c);l[s]=t.get(c);u[s]=n.get(c)}this.index=r};t.prototype.build=function(t,n,r,i){e.prototype.build.call(this,t,n,r);this.buildXYM(t,n,i,this.zorder);this.computeExpansions()};t.prototype.buildSubset=function(t,n,r,i,a){this.buildXYM(n,r,a,t);e.prototype.build.call(this,ia(this.zxs),ia(this.zys),i);var o=this.zorder;Ji(this.zxs,o);Ji(this.zys,o);Ji(this.zms,o);Ji(t,o);this.computeExpansions()};t.prototype.computeExpansions=function(){for(var e=this,t=e.tree,n=e.N,r=e.zxs,i=e.zys,a=e.zms,o=this.outboundExpansions=aa([t.length,3],this.dtype),l=o.values,u=t.length-1,s=n;s>0&&u>=0;u--){var c=t[u];if(null===c.childIndices){for(var f=0,d=0,g=0,h=c.endIdx;h>=c.beginIdx;h--){var v=a[h];d+=r[h]*v;g+=i[h]*v;f+=v;s--}for(var m=u;m>=0;){l[p=o.index(m,0)]+=f;l[p+1]+=d;l[p+2]+=g;c=t[m=c.parentIdx]}}}for(u=t.length-1;u>=0;u--){var p;v=1/l[p=o.index(u,0)];l[p+1]*=v;l[p+2]*=v}};t.prototype.runOnPoint=function(e,t,n,r,i,a){void 0===a&&(a=.5);null!==this.outboundExpansions&&0!==this.outboundExpansions.size&&this.runOnPointInternal(e,t,n,r,new ma(this.aabb),i,a,-1)};t.prototype.runOnPoints=function(e,t,n,r){void 0===r&&(r=.5);if(null!==this.outboundExpansions&&0!==this.outboundExpansions.size)for(var i=new ma(this.aabb),a=[0,0],o=this,l=o.zxs,u=o.zys,s=o.zms,c=o.N,f=o.index,d=t.values,g=n.values,h=0;h<c;h++){i.reset(this.aabb);a[0]=0;a[1]=0;this.runOnPointInternal(e,l[h],u[h],s[h],i,a,r,h);var v=f[h];d[t.index(v)]+=a[0];g[n.index(v)]+=a[1]}};t.prototype.runOnPointInternal=function(e,t,n,r,i,a,o,l){for(var u=this,s=u.tree,c=u.zxs,f=u.zys,d=u.zms,g=this.outboundExpansions,h=l>=0?d[l]:0,v=0,m=0;v>=0;){var p=s[v],b=g.get(v,1),y=g.get(v,2),I=Zi(t,n,b,y),x=p.beginIdx,C=p.endIdx;if(i.longestSide/I<o){e(t,n,r,b,y,g.get(v,0)-(pa(l,x,C)?h:0),a)}else{if((m=fa(p,0))>=0){i.descend(m);v=p.childIndices[m];continue}for(;x<=C;){x!==l&&e(t,n,r,c[x],f[x],d[x],a);x++}}v=va.nextDFS(s,i,v,4)}};t.prototype.traverse=function(){var t=this.outboundExpansions;return Xi(e.prototype.traverse.call(this),function(e){e.mass=t.get(e.id,0);e.x=t.get(e.id,1);e.y=t.get(e.id,2);return e})};return t}(va),ya=Object.freeze({BarnesHut:ba});function Ia(e,t){var n=sa(e),r=n[0],i=n[1],a=sa(t),o=a[0],l=i-r,u=a[1]-o,s=Math.max(l,u),c=r+.5*l,f=o+.5*u;return[{x:c-1e3*s,y:f-s,r:.1},{x:c,y:f+1e3*s,r:.1},{x:c+1e3*s,y:f-s,r:.1}]}function xa(e,t,n){var r,i,a,o,l,u,s,c,f=Math.abs(e.y-t.y),d=Math.abs(t.y-n.y);if(f<xi&&d<xi)return null;if(f<xi){o=-(n.x-t.x)/(n.y-t.y);u=.5*(t.x+n.x);c=.5*(t.y+n.y);i=o*((r=.5*(t.x+e.x))-u)+c}else if(d<xi){a=-(t.x-e.x)/(t.y-e.y);l=.5*(e.x+t.x);s=.5*(e.y+t.y);i=a*((r=.5*(n.x+t.x))-l)+s}else{a=-(t.x-e.x)/(t.y-e.y);o=-(n.x-t.x)/(n.y-t.y);l=.5*(e.x+t.x);u=.5*(t.x+n.x);s=.5*(e.y+t.y);r=(a*l-o*u+(c=.5*(t.y+n.y))-s)/(a-o);i=f>d?a*(r-l)+s:o*(r-u)+c}var g=t.x-r,h=t.y-i;return{x:r,y:i,rSq:g*g+h*h}}function Ca(e,t,n,r,i,a){var o=xa(r<0?e[~r]:{x:t.get(r),y:n.get(r)},i<0?e[~i]:{x:t.get(i),y:n.get(i)},a<0?e[~a]:{x:t.get(a),y:n.get(a)});if(null!==o){o.adx=r;o.bdx=i;o.cdx=a}return o}function Ga(e){for(var t=e.length;t>0;)for(var n=e[--t],r=e[--t],i=t;i>0;){var a=e[--i],o=e[--i];if(r===o&&n===a||r===a&&n===o){e.splice(t,2);e.splice(i,2);break}}}function wa(e,t,n,r,i,a,o){void 0===a&&(a=0);for(var l=e.size,u=n.size,s=aa([2,u+l],"f32"),c=0,f=0;f<l;f++,c++){s.set(e.get(f),0,c);s.set(t.get(f),1,c)}for(var d=0;d<u;d++,c++){s.set(n.get(d),0,c);s.set(r.get(d),1,c)}c=i.length;var g=ua(s,0),h=Za(g[0],g[1],i,a,o);if(h>=0)return h;for(;c<i.length;){i[c]>=l&&(i[c]=~(i[c]-l));c++}return-1}function Za(e,t,n,r,i){void 0===r&&(r=0);void 0===i&&(i=Math.random);var a=n.length,o=-1;do{if((o=Aa(e,t,n))>=0){if(r--<=0)break;n.length=a;e.set(e.get(o)+i(),o);t.set(t.get(o)+i(),o)}}while(o>=0);return o}function Aa(e,t,n){var r=e.size;if(r<3)return-1;var i=new Int32Array(r);Pi(i);Array.prototype.sort.call(i,function(t,n){return e.get(n)-e.get(t)});for(var a=Ia(e,t),o=[Ca(a,e,t,-1,-2,-3)],l=[],u=[],s=i.length;s--;){u.length=0;for(var c=i[s],f=o.length;f--;){var d=o[f],g=d.x,h=d.y,v=d.rSq,m=d.adx,p=d.bdx,b=d.cdx,y=e.get(c)-g;if(y>0&&y*y>v){l.push(o[f]);o.splice(f,1)}else{var I=t.get(c)-h;if(!(y*y+I*I-v>xi)){u.push(m,p,p,b,b,m);o.splice(f,1)}}}Ga(u);for(var x=u.length;x;){var C=Ca(a,e,t,u[--x],u[--x],c);if(null===C)return c;o.push(C)}}for(s=o.length;s--;)l.push(o[s]);n.length=0;for(s=l.length;s--;)l[s].adx>=0&&l[s].bdx>=0&&l[s].cdx>=0&&n.push(l[s].adx,l[s].bdx,l[s].cdx);return 0===n.length?0:-1}var Ba=Object.freeze({triangulateSteiner:wa,triangulate:Za});function Ra(e,t){var n=Zi(e.x,e.y,t.x,t.y);if(n>e.r+t.r+xi||0===e.r||0===t.r)return 0;if(n+e.r<t.r)return e.r*e.r*Math.PI;if(n+t.r<e.r)return t.r*t.r*Math.PI;var r=n*n,i=e.r*e.r,a=t.r*t.r,o=2*Math.acos((i+r-a)/(2*e.r*n)),l=2*Math.acos((a+r-i)/(2*t.r*n));return.5*l*a-.5*a*Math.sin(l)+(.5*o*i-.5*i*Math.sin(o))}function Ma(e,t,n,r){var i=Wa(e,t,n),a=Wa(e,t,r),o=Wa(n,r,e),l=Wa(n,r,t);if(0===i&&0===a&&0===o&&0===l){var u=qi.create(e.x,t.x,e.y,t.y),s=qi.create(n.x,r.x,n.y,r.y);if(qi.intersects(u,s))return 2}else if(i*a<=0&&o*l<=0)return 1;return 0}function Wa(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function Va(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function Sa(e,t){var n=Zi(e.x,e.y,t.x,t.y);return n>xi?{x:(t.x-e.x)/n,y:(t.y-e.y)/n}:{x:0,y:0}}function ka(e,t){var n=wi(e,t);return n>xi?{x:e/n,y:t/n}:{x:e,y:t}}function Xa(e,t){return e.x*t.x+e.y*t.y}function Ea(e,t,n){var r=t,i=t+1,a=t+2;n.get(e[r])>n.get(e[i])&&_i(e,r,i);n.get(e[i])>n.get(e[a])&&_i(e,i,a);n.get(e[r])>n.get(e[i])&&_i(e,r,i)}function Fa(e,t){var n=e[2*t],r=e[2*t+1];return n<r?[n,r]:[r,n]}function Ya(e,t){Array.prototype.sort.call(t,function(t,n){var r=Fa(e,t),i=r[0],a=r[1],o=Fa(e,n),l=o[0],u=o[1];return i!==l?i-l:a-u});for(var n=0,r=0;r<t.length;){var i=t[r],a=Fa(e,i),o=a[0],l=a[1]
;t[n]=t[r];for(var u=r+1;u<t.length;){var s=Fa(e,t[u]),c=s[0],f=s[1];if(o!==c||l!==f)break;u++}r=u;n++}return n}var Ha=function(){function e(e,t){void 0===e&&(e=0);void 0===t&&(t=Math.PI/2);this.padding=e;this.rotation=t}e.prototype.apply=function(e,t,n,r){var i=Math.PI,a=t.size,o=new Int32Array(a);Pi(o);Array.prototype.sort.call(o,function(e,t){return r.get(t)-r.get(e)});var l=0,u=0,s=o[l];t.set(e.x,s);n.set(e.y,s);u+=r.get(s)+this.padding;l++;for(;l<a;){var c=r.get(o[l])+.5*this.padding;u+=c;if(l+this.sizeRing(o,l,r,u,i)>=a){this.positionRing(e,t,n,r,o,l,2,0,i,u);this.positionRing(e,t,n,r,o,l,1,2*i,2*i,u,-1);break}var f=0;f+=this.positionRing(e,t,n,r,o,l,2,0,i,u);l+=f+=this.positionRing(e,t,n,r,o,l,1,i,2*i,u);u+=c}};e.prototype.sizeRing=function(e,t,n,r,i){void 0===i&&(i=2*Math.PI);for(var a=0;t<e.length;){var o=e[t++];if((i-=2*(n.get(o)+.5*this.padding)/r)<0)break;a++}return a};e.prototype.positionRing=function(e,t,n,r,i,a,o,l,u,s,c){void 0===c&&(c=1);for(var f=this.rotation,d=0;a<i.length;){var g=i[a];if(g>=0){var h=c*((r.get(g)+.5*this.padding)/s);if(l+2*h>u)break;t.set(e.x+Math.sin(l+h+f)*s,g);n.set(e.y+Math.cos(l+h+f)*s,g);i[a]=-1;l+=2*h;d++}a+=o}return d};return e}(),La=function(){function e(e,t,n){void 0===e&&(e=0);void 0===t&&(t=0);this.padding=e;this.maxPerturbations=t;this.rng=n}e.prototype.build=function(e,t,n,r){var i=[],a=Za(t,n,i,this.maxPerturbations,this.rng);if(a>=0)return a;var o=this.buildSteinerPoints(i,t,n,r);if(o.size>0){var l=ua(o,1),u=l[0],s=l[1];i.length=0;if((a=wa(t,n,u,s,i,this.maxPerturbations,this.rng))>=0)return a}for(var c=new Int32Array(2*i.length),f=0,d=0;d<c.length;){var g=i[f++],h=i[f++],v=i[f++];g<0&&(g=o.get(~g,2));h<0&&(h=o.get(~h,2));v<0&&(v=o.get(~v,2));c[d++]=g;c[d++]=h;c[d++]=h;c[d++]=v;c[d++]=v;c[d++]=g}var m=new Int32Array(i.length);Pi(m);m=m.subarray(0,Ya(c,m));Array.prototype.sort.call(m,function(r,i){var a=c[2*r],o=c[2*r+1],l=c[2*i],u=c[2*i+1];return Zi(.5*(t.get(a)+t.get(o)),.5*(n.get(a)+n.get(o)),e.x,e.y)-Zi(.5*(t.get(l)+t.get(u)),.5*(n.get(l)+n.get(u)),e.x,e.y)});this.constraints={pairs:c,triangles:i,steinerPoints:o,pairIndices:m};return-1};e.prototype.buildSteinerPoints=function(e,t,n,r){for(var i=this.padding,a=e.length/3,o=[],l=0,u=0,s=0;u<a;u++,s+=3){Ea(e,s,r);var c=e[s],f=e[s+1],d=e[s+2],g=t.get(c),h=n.get(c),v=t.get(f),m=n.get(f),p=t.get(d),b=n.get(d),y=Zi(p,b,v,m),I=Zi(p,b,g,h),x=Zi(v,m,g,h),C=I*((I*I+x*x-y*y)/(2*I*x))/x,G=(1-C)*g+C*v,w=(1-C)*h+C*m,Z=r.get(d);if(r.get(c)!==Z&&Zi(G,w,p,b)<=Z+i){var A=Math.atan2(w-b,G-p);o.push(p+Z*Math.cos(A),b+Z*Math.sin(A),d);l++}}return ia(o,[l,3],"f32")};e.prototype.solve=function(e,t,n,r,i,a){var o=this.constraints,l=o.pairs,u=o.pairIndices,s=this.padding,c=Math.max(.01*s,xi),f=t.size,d=new Float32Array(f),g=new Float32Array(f),h=0;i/=a;for(;a-- >0;){h=0;for(var v=0;v<u.length;v++){var m=2*u[v],p=l[m],b=l[m+1],y=t.get(p)+d[p],I=n.get(p)+g[p],x=r.get(p),C=t.get(b)+d[b],G=n.get(b)+g[b],w=r.get(b),Z=C-y,A=G-I,B=wi(Z,A),R=x+w+s;if(B>c){var M=.5*(1+Ai(Xa(ka(Z,A),ka(e.x-y,e.y-I)),-1,1)),W=0;if(B>R){W=Math.min(i,R);Z/=B;A/=B}else{W=(B-R)/B;h++}Z*=W;A*=W;d[p]+=M*Z;g[p]+=M*A;d[b]-=(1-M)*Z;g[b]-=(1-M)*A}}}for(v=0;v<f;v++){t.set(t.get(v)+d[v],v);n.set(n.get(v)+g[v],v)}return h};return e}(),za=Object.freeze({sortByRadius:Ea,removeDuplicatePairs:Ya,InterleavingCircles:Ha,CirclePackingSolver:La});function Ta(e){for(var t={tl:{x:1/0,y:1/0},br:{x:-1/0,y:-1/0}},n=e.next();!n.done;){t.tl.x=Math.min(t.tl.x,n.value.x);t.tl.y=Math.min(t.tl.y,n.value.y);t.br.x=Math.max(t.br.x,n.value.x);t.br.y=Math.max(t.br.y,n.value.y);n=e.next()}return t}function Na(e){for(var t={tl:{x:1/0,y:1/0},br:{x:-1/0,y:-1/0}},n=e.next();!n.done;){t.tl.x=Math.min(t.tl.x,n.value.x-n.value.r);t.tl.y=Math.min(t.tl.y,n.value.y-n.value.r);t.br.x=Math.max(t.br.x,n.value.x+n.value.r);t.br.y=Math.max(t.br.y,n.value.y+n.value.r);n=e.next()}return t}function Ua(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)<e.r-t.r+xi}function Da(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,l=t.r,u=a-n,s=o-r,c=l-i,f=Math.sqrt(u*u+s*s);return{x:(n+a+u/f*c)/2,y:(r+o+s/f*c)/2,r:(f+i+l)/2}}function Oa(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,l=t.y,u=t.r,s=n.x,c=n.y,f=n.r,d=2*(r-o),g=2*(i-l),h=2*(u-a),v=r*r+(i*i-a*a-o*o-l*l)+u*u,m=2*(r-s),p=2*(i-c),b=2*(f-a),y=r*r+(i*i-a*a-s*s-c*c)+f*f,I=m*g-d*p,x=(g*y-p*v)/I-r,C=(p*h-g*b)/I,G=(m*v-d*y)/I-i,w=(d*b-m*h)/I,Z=C*C+w*w-1,A=2*(x*C+G*w+a),B=x*x+G*G-a*a,R=(-A-Math.sqrt(A*A-4*Z*B))/(2*Z);return{r:R,x:x+C*R+r,y:G+w*R+i}}function _a(e,t){switch(t.length){case 0:return{x:0,y:0,r:0};case 1:return e[t[0]];case 2:return Da(e[t[0]],e[t[1]]);case 3:return Oa(e[t[0]],e[t[1]],e[t[2]]);default:throw new Error("invalid number of circles")}}function Ka(e){if(0===e.length)return null;for(var t=e.length,n={prev:null,i:0,R:[],c:null};;){var r=n.i,i=n.R,a=n.prev,o=n.c;if(r===t||3===i.length){a.c=_a(e,i);n=a}else if(null===o)n={R:i,prev:n,i:r+1,c:null};else if(Ua(o,e[r])){if(null===a)return o;a.c=o;n=a}else n={prev:n,i:r+1,R:i.concat([r]),c:null}}}var Pa=Object.freeze({nbody:ya,delaunay:Ba,circlePacking:za,radialExtents:Ka,LinearQuadTree:va,get Rect(){return qi},circularOverlap:Ra,lineIntersection:Ma,crossProduct:Wa,lineAngle:Va,normalise:Sa,unit:ka,dot:Xa,pointExtents:Ta,circleExtents:Na}),Ja=function(){function e(e,t){this.buffer=e;this.defaultValue=t}e.fromRange=function(t,n,r){Mi.ensureContiguous(t);return e.fromSize(t.size,n,r)};e.fromSize=function(t,n,r){var i=new Array(t);if(void 0===r)Di(i,n);else for(var a=0;a<t;a++)i[a]=r(a);return new e(i,n)};e.wrapArray=function(t,n){return new e(t,n)};e.prototype.keySpace=function(){return{begin:0,end:this.buffer.length-1,size:this.buffer.length}};e.prototype.get=function(e){return this.buffer[e]};e.prototype.set=function(e,t){this.buffer[e]=t};return e}(),ja=function(){function e(e,t,n){this.buffer=e;this.inverse=t;this.defaultValue=n}e.fromValues=function(t){for(var n=[],r={},i=t.next(),a=0;!i.done;){var o=i.value;if(void 0===r[o]){r[o]=a;n.push(o);a++}i=t.next()}return new e(n,r,null)};e.fromKeyValuePairs=function(t){Mi.ensureContiguous(t);for(var n=[],r={},i=t.next();!i.done;){var a=i.value,o=a[0],l=a[1];if(void 0===r[l]){r[l]=o;n.push(l)}i=t.next()}return new e(n,r,null)};e.prototype.get=function(e){return this.buffer[e]};e.prototype.set=function(e,t){this.buffer[e]=t};e.prototype.getUniqueInverse=function(e){return this.inverse[e]};e.prototype.getInverse=function(e){return ki(this.inverse[e])};e.prototype.keySpace=function(){return Mi.fromSize(this.buffer.length)};return e}(),Qa=function(){function e(e,t){this.data=e;this.idAxis=t;this.data=e;this.sliceArgs=[e,"all","all"]}e.fromShape=function(t,n,r,i){void 0===r&&(r=0);return new e(aa(t,n,i),r)};e.prototype.keySpace=function(){return Mi.fromSize(this.data.shape[this.idAxis])};e.prototype.get=function(e){var t=this.sliceArgs;t[this.idAxis+1]=e;return la.apply(null,t)};e.prototype.set=function(e,t){throw new Error("not impl")};return e}();function qa(e,t,n){var r=ja.fromValues(e),i=Xi(t,function(e){return[r.getUniqueInverse(e[0]),r.getUniqueInverse(e[1]),e[2]]}),a=n.buildKeyed(i,e.size),o=ja.fromKeyValuePairs(a);return{vertexMap:r,edgeMap:o}}function $a(e){for(var t=e.vertexRange(),n=t.end-t.begin+1,r=aa([n,n],"i32",0),i=e.iterateAdjacentPairs(),a=i.next();!a.done;){var o=a.value,l=o[0],u=o[1],s=r.get(l,u)+(l===u?2:1);r.set(s,l,u);r.set(s,u,l);a=i.next()}return r}function eo(e){Mi.ensureContiguous(e.vertexRange());for(var t=e.iterateAdjacentPairs(),n=new Int32Array(e.countVertices()),r=t.next();!r.done;){var i=r.value,a=i[0],o=i[1];n[a]++;n[o]++;r=t.next()}return Ja.wrapArray(n,0)}var to=function(){function e(e,t,n){this.tourStart=e;this.tours=t;this.nTours=n;this.defaultValue=-1}e.prototype.keySpace=function(){return Mi.fromSize(this.tourStart.length)};e.prototype.iterateGroups=function(){for(var e=this.tourStart,t=[],n=0,r=this.nTours;r>0;){if(e[n]===n){t.push(n);r--}n++}return Yi(t)};e.prototype.iterateGroup=function(e){e=this.tourStart[e];var t=this.tours,n={done:!1,value:e},r=!1;return{next:function(){n.value=e;n.done=r;r||(t[e]>e?e=t[e]:r=!0);return n}}};e.prototype.groupSize=function(e){e=this.tourStart[e];for(var t=1;e<(e=this.tours[e]);)t++;return t};e.prototype.countGroups=function(){return this.nTours};e.prototype.get=function(e){return this.tourStart[e]};e.prototype.set=function(){throw new Error("Readonly")};e.build=function(t){for(var n=t.length,r=new Int32Array(n),i=new Int32Array(n),a=0,o=0;o<n;o++){var l=no(t,o,!1),u=void 0;if(l===o){a++;u=o}else u=i[l];t[o]=l;r[u]=o;i[l]=o}return new e(t,r,a)};return e}();function no(e,t,n){for(var r=t,i=0;r>=0&&e[r]!==r;){r=e[r];i++}if(n)for(var a=void 0;i>1;){a=t;t=e[t];e[a]=r;i--}return r}function ro(e){Mi.ensureContiguous(e.vertexRange());var t=e.countVertices(),n=new Int32Array(t);Pi(n,0);for(var r=e.iterateAdjacentPairs(!1),i=r.next();!i.done;){var a=i.value,o=a[0],l=a[1],u=no(n,o,!0),s=no(n,l,!0);u>s?n[u]=s:u<s&&(n[s]=u);i=r.next()}return to.build(n)}function io(e){var t=e.countVertices(),n=new Int32Array(t);return to.build(n)}var ao=-1,oo=function(){function e(){this.directedCategory="u";this.badIncidence=0;this.initialize(0,0)}e.prototype.iterateEdges=function(){return Fi(this.edges)};e.prototype.iterateVertices=function(){return Fi(this.vertices)};e.prototype.countVertices=function(){return this.vertices.size};e.prototype.countEdges=function(){return this.edges.size};e.prototype.vertexRange=function(){return this.vertices};e.prototype.edgeRange=function(){return this.edges};e.prototype.source=function(e){return e>=this.edges.begin&&e<=this.edges.end?this.incidence[2*e]:ao};e.prototype.target=function(e){return e>=this.edges.begin&&e<=this.edges.end?this.incidence[2*e+1]:ao};e.prototype.containsEdge=function(e){return Mi.isWithin(this.edges,e)};e.prototype.containsVertex=function(e){return Mi.isWithin(this.vertices,e)};e.prototype.isValidAdjacency=function(e,t){return Mi.isWithin(this.vertices,e)&&Mi.isWithin(this.vertices,t)};e.prototype.iterateAdjacentPairs=function(e,t){void 0===t&&(t=[-1,-1,-1]);return 0===this.countEdges()?Si():!e&&this.badIncidence>0?lo(this.incidence,this.edgeRange(),this.badIncidence,t):uo(this.incidence,this.edgeRange(),t)};e.prototype.buildKeyed=function(e,t){var n=this;this.initialize(t,e.size);var r,i=this.incidence,a={value:[-1,void 0],done:!1},o=0,l=0,u=function(){if((r=e.next()).done)a.done=!0;else{var t=r.value,u=t[0],s=t[1];if(n.isValidAdjacency(u,s)){i[l++]=u;i[l++]=s}else{n.badIncidence++;i[l++]=ao;i[l++]=ao}a.value[0]=o++;a.value[1]=r.value[2]}return a},s=Mi.fromSize(e.size);s.next=u;return s};e.prototype.build=function(e,t){this.initialize(t,e.size);for(var n=this.incidence,r=0,i=e.next();!i.done;){var a=i.value,o=a[0],l=a[1];if(this.isValidAdjacency(o,l)){n[r++]=o;n[r++]=l}else{this.badIncidence++;n[r++]=ao;n[r++]=ao}i=e.next()}};e.prototype.initialize=function(e,t){this.vertices=Mi.fromSize(e);this.edges=Mi.fromSize(t);this.incidence=oa("i32",2*t,ao)};return e}();function lo(e,t,n,r){var i=t.begin,a=t.size,o=t.end,l={done:!1,value:r},u=0;return{size:a-n,next:function(){for(;i<=o;){var t=e[u++],n=e[u++];if(t!==ao&&n!==ao){r[0]=t;r[1]=n;r[2]=i++;return l}i++}l.done=!0;return l}}}function uo(e,t,n){var r=t.begin,i=t.size,a=t.end,o={done:!1,value:n},l=0;return{size:i,next:function(){if(r<=a){n[0]=e[l++];n[1]=e[l++];n[2]=r++}else o.done=!0;return o}}}var so=Object.freeze({StaticListGraph:oo,StaticStringLabelMap:ja,StaticPropertyMap:Ja,buildFromLabeledIterators:qa,StaticNDArrayMap:Qa,adjacencyMatrix:$a,degrees:eo,connectedComponents:ro,all:io}),co=function(){function e(e,t){this.g=e;this.rng=t}e.prototype.run=function(e){for(var t=e["@@pos2d"].data,n=this.g.iterateVertices(),r=n.next();!r.done;){var i=t.get(r.value);i.x=this.rng();i.y=this.rng();r=n.next()}};return e}();function fo(e,t){void 0===t&&(t={});var n=void 0!==t.seed?Ii.createPRNG(t.seed,0,1):function(){return Math.random()};return new co(e,n)}var go,ho={reorder:!1},vo=function(){function e(e,t){void 0===t&&(t={});this.g=e;this.opts=t;Vi(t,ho)}e.prototype.run=function(e){var t=this,n=e["@@pos2d"].data,r=e["@@radius"].data,i=e["@@group"],a=void 0!==i?i.data:io(this.g);Ei(a.iterateGroups(),function(e){var i=t.getVertexGroupSummary(r,a.iterateGroup(e)),o=i.numVerts,l=i.avgRadius;t.runOn(a.iterateGroup(e),n,o,l)})};e.prototype.runOn=function(e,t,n,r){var i=2*Math.PI/n,a=n<2?0:3*r/Math.sin(i/2);if(this.opts.reorder){var o=this.opts.reorder,l=Hi(e);ji(l,"object"==typeof o&&o.seed?Ii.createPRNGi32(o.seed):Math.random);e=Yi(l)}for(var u=0,s=e.next();!s.done;){var c=t.get(s.value);c.x=a*Math.sin(u);c.y=a*Math.cos(u);u+=i;s=e.next()}};e.prototype.getVertexGroupSummary=function(e,t){for(var n=0,r=0,i=t.next();!i.done;){++n;r+=e.get(i.value);i=t.next()}return{numVerts:n,avgRadius:r/=n}};return e}();function mo(e,t){return new vo(e,t)}!function(e){!function(e){e.name="@@pos2d";e.descriptor={name:e.name,itemType:"v"}}(e.Position2d||(e.Position2d={}));!function(e){e.name="@@radius";e.descriptor={name:e.name,itemType:"v"}}(e.Radius||(e.Radius={}));!function(e){e.name="@@degree";e.descriptor={name:e.name,itemType:"v"}}(e.Degree||(e.Degree={}));!function(e){e.name="@@group";e.descriptor={name:e.name,itemType:"v"}}(e.Group||(e.Group={}))}(go||(go={}));var po=function(){function e(){}e.prototype.repulsion=function(){return this.linRepulsion()};e.prototype.attraction=function(e){return yo};e.prototype.linRepulsion=function(){return{nodeNode:function(e){return function(t,n,r,i,a,o,l){return bo(e,t,n,r,i,a,o,l)}}}};return e}();function bo(e,t,n,r,i,a,o,l){var u=i-t,s=a-n,c=u*u+s*s;if(c>xi){var f=e*r*o/c;l[0]-=u*f;l[1]-=s*f}}function yo(e,t,n,r,i,a,o){var l=n-e,u=r-t,s=wi(l,u),c=s-a;if(s>.001){var f=c/s;f>.01?f=Math.pow(f,3)*i*Math.sqrt(.5*c):f>0&&(f=0);o[0]+=l*f;o[1]+=u*f}return s}var Io={maxIterations:125,speed:void 0,moment1Beta:function(e){return Go(.84,25,e)},moment2Beta:function(e){return Go(.98,30,e)}};function xo(e){return{mass:aa([e],"f32",1),displacement:aa([2,e],"f32"),moment:aa([2,e],"f32"),moment2:aa([2,e],"f32")}}function Co(e){return{targetLength:aa([e],"f32",1),maxTargetLength:aa([e],"f32",1),mass:aa([e],"f32",1)}}function Go(e,t,n){return n<t?e*Math.sin(n*(Math.PI/(2*t))):e}function wo(e,t,n,r,i,a){void 0===a&&(a=12);return Ri(e,t,.5*(r-n),a/(r-n),1,1,i-n)}var Zo=function(){function e(e,t){void 0===t&&(t={});this.graph=e;this.opts=t;this.numIterations=0;this.groups=[];var n=e.countVertices(),r=e.countEdges();Vi(t,Io);this.graph=e;this.forceModels=new po;this.vertexData=xo(n);this.edgeData=Co(r)}e.prototype.run=function(e){var t=e["@@pos2d"].data,n=e["@@radius"].data,r=e["@@degree"]?e["@@degree"].data:eo(this.graph),i=e["@@group"]?e["@@group"].data:io(this.graph);0===this.numIterations&&this.initialize(n,r,i);var a=this.setupNewIteration(t),o=this.forceModels.repulsion(),l=this.forceModels.attraction(1);this.calculateAttractionForces(l,a);this.calculateRepulsionForces(o);this.updateGlobalSpeed();this.updatePositions(r,t);this.numIterations++};e.prototype.isComplete=function(){return this.numIterations>=this.opts.maxIterations};e.prototype.buildGroupStates=function(e){var t=this.graph.countVertices(),n=this.groups,r=new Int32Array(t),i=0,a=0;Ei(e.iterateGroups(),function(t){var o=e.iterateGroup(t),l=o.next();i=a;for(;!l.done;){r[a++]=l.value;l=o.next()}a-i>1&&n.push({id:t,indices:r.subarray(i,a),nbodyModel:new ba("f32",void 0,16),repulsionScaling:0,schedule:null,avgRadius:0,degNorm:0})})};e.prototype.initialize=function(e,t,n){this.buildGroupStates(n);for(var r=this.graph,i=r.countVertices(),a=this.vertexData.mass,o=this.edgeData.mass,l=this.edgeData.targetLength,u=this.edgeData.maxTargetLength,s=new Float32Array(i),c=new Float32Array(i),f=new Int32Array(i),d=0;d<this.groups.length;d++){for(var g=this.groups[d],h=g.indices,v=h.length,m=0,p=0,b=0,y=0,I=0,x=0,C=0;C<v;C++){var G=h[C],w=e.get(G);x+=Math.sqrt(w);I+=w*w;y+=Math.log(w);var Z=t.get(G);p+=Math.sqrt(Z);m+=Z}var A=m/2,B=A/v,R=Math.exp(y/v);x/=v;I/=v;p=A>0?p/A:1;f[g.id]=m;c[g.id]=R;for(C=0;C<v;C++){G=h[C],w=e.get(G),Z=t.get(G);a.set(w*w/I+Math.sqrt(Z)/p,G);b+=Math.pow(Z-B,2)}b=b>0?b/v:1;g.repulsionScaling=0===A?1:.1*Math.pow(R,2)*x*Math.min(b,100)/Math.log(v+1);g.degNorm=p;g.avgRadius=R;g.schedule=new Bo(this.opts.maxIterations,v,A,this.opts.speed)}Ei(r.iterateAdjacentPairs(),function(r){var i=r[0],a=r[1],f=r[2],d=n.get(i),g=t.get(i),h=t.get(a),v=e.get(i),m=e.get(a),p=Math.sqrt(Math.min(g,h)),b=v+m+2*Math.min(v,m);s[d]+=p;o.set(p,f);l.set(b,f);u.set(b+12*c[d]*Math.sqrt((g+h)/2),f)});Ei(r.iterateAdjacentPairs(),function(e){var t=e[0],r=e[2],i=n.get(t),a=f[i]/2,l=o.get(r)/(s[i]/a);o.set(l,r)})};e.prototype.setupNewIteration=function(e){var t=this.vertexData,n=this.graph.countVertices();t.displacement=aa([2,n],"f32");var r=aa([2,n],"f32"),i=ua(r),a=i[0],o=i[1];Ei(this.graph.iterateVertices(),function(t){var n=e.get(t);a.set(n.x,t);o.set(n.y,t)});for(var l=this.groups,u=0;u<l.length;u++){var s=l[u];s.nbodyModel.buildSubset(s.indices,a,o,void 0,t.mass)}return r};e.prototype.calculateAttractionForces=function(e,t){for(var n=this.graph,r=this.edgeData.mass,i=this.edgeData.targetLength,a=this.edgeData.maxTargetLength,o=this.vertexData.displacement,l=o.values,u=[0,0],s=[0,0,0],c=wo(0,1,0,.5*this.opts.maxIterations,this.numIterations),f=n.iterateAdjacentPairs(!1,s);!f.next().done;){var d=s[0],g=s[1],h=s[2];u[0]=0;u[1]=0;e(t.get(0,d),t.get(1,d),t.get(0,g),t.get(1,g),r.get(h),c*i.get(h),u)>a.get(h)&&r.set(1.04*r.get(h),h);l[o.index(0,d)]+=u[0];l[o.index(1,d)]+=u[1];l[o.index(0,g)]-=u[0];l[o.index(1,g)]-=u[1]}};e.prototype.calculateRepulsionForces=function(e){for(var t=ua(this.vertexData.displacement),n=t[0],r=t[1],i=this.groups,a=0;a<i.length;a++){var o=i[a];o.nbodyModel.runOnPoints(e.nodeNode(o.repulsionScaling),n,r,o.schedule.theta)}};e.prototype.updateGlobalSpeed=function(){for(var e=ua(this.vertexData.displacement),t=e[0],n=e[1],r=ua(this.vertexData.moment),i=r[0],a=r[1],o=ua(this.vertexData.moment2),l=o[0],u=o[1],s=this.groups,c=this.opts.moment1Beta(this.numIterations),f=this.opts.moment2Beta(this.numIterations),d=0;d<s.length;d++){for(var g=s[d],h=g.indices,v=h.length,m=0;m<v;m++){var p=h[m],b=t.get(p),y=n.get(p);i.set(Bi(i.get(p),b,c),p);a.set(Bi(a.get(p),y,c),p);l.set(Bi(l.get(p),b*b,f),p);u.set(Bi(u.get(p),y*y,f),p)}g.schedule.update()}};e.prototype.updatePositions=function(e,t){for(var n=this,r=n.groups,i=n.vertexData,a=ua(i.moment),o=a[0],l=a[1],u=ua(i.moment2),s=u[0],c=u[1],f=0;f<r.length;f++)for(var d=this.groups[f],g=d.indices,h=d.schedule,v=d.avgRadius,m=d.degNorm,p=h.speed*(1/m)*v,b=0;b<g.length;b++){var y=g[b],I=p*Math.sqrt(1+e.get(y)),x=Math.sqrt(s.get(y)),C=Math.sqrt(c.get(y)),G=o.get(y),w=l.get(y),Z=t.get(y);Z.x+=I*(G/(x+xi));Z.y+=I*(w/(C+xi))}};return e}();function Ao(e,t){return new Zo(e,t)}var Bo=function(){function e(e,t,n,r){this.maxIterations=e;this.iterations=0;this.progress=0;this.coolingPoint=-1;var i=.5,a=n/(t*(t-1)/2),o=(1+2.5*Math.log(t))*(.03+i/Math.pow(t,a));this.targetSpeed=void 0===r?o:r;this.warmup=25}Object.defineProperty(e.prototype,"theta",{get:function(){return wo(1.8,1,0,1,this.progress)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"speed",{get:function(){var e=this,t=e.progress,n=e.targetSpeed,r=.1*n,i=0;if(this.coolingPoint<0){i=wo(r,n,0,this.warmup,this.iterations);t>.75&&(this.coolingPoint=t)}else{i=Ri(n,r,.5,10,1,1,(t-this.coolingPoint)/(1-this.coolingPoint))}return i},enumerable:!0,configurable:!0});e.prototype.update=function(){this.progress=++this.iterations/this.maxIterations};return e}(),Ro=Object.freeze({defaultOpts:Io,create:Ao}),Mo={iterations:5},Wo=function(){function e(e,t){void 0===t&&(t={});this.graph=e;this.opts=t;this.numIterations=0;Vi(t,Mo);this.relaxationFactor=Math.min(.9,e.countVertices()/e.countEdges())}e.prototype.run=function(e){for(var t=e["@@pos2d"].data,n=e["@@radius"].data,r=e["@@degree"].data,i=this.graph.iterateAdjacentPairs(),a=i.next();!a.done;){this.relaxEdge(a.value[0],a.value[1],n,r,t);a=i.next()}this.numIterations++};e.prototype.isComplete=function(){return this.numIterations>=this.opts.iterations};e.prototype.relaxEdge=function(e,t,n,r,i){if(e!==t){var a=i.get(e),o=i.get(t),l=r.get(e),u=r.get(t),s=2.5*(n.get(e)+n.get(t)),c=o.x-a.x,f=o.y-a.y,d=wi(c,f);if(!(d<xi)){var g=this.relaxationFactor*(d-s),h=g*(u/(l+u)),v=g-h;a.x+=c/d*h;a.y+=f/d*h;o.x-=c/d*v;o.y-=f/d*v}}};return e}();function Vo(e,t){return new Wo(e,t)}var So=Object.freeze({defaultOpts:Mo,create:Vo}),ko=function(){function e(e){this.layout=e;this.iterations=0}e.prototype.isComplete=function(){return this.iterations>0};e.prototype.run=function(e){this.iterations++;return this.layout.run(e)};return e}(),Xo=function(){function e(e){this.layouts=e;this.outputs=[];this.index=0;this.outputs=new Array(e.length)}e.prototype.isComplete=function(){return this.index>=this.layouts.length};e.prototype.run=function(e){for(;!this.isComplete();){var t=this.layouts[this.index][0];if(!t.isComplete()){this.outputs[this.index]=t.run(e);break}this.index++}return this.outputs};e.prototype.getPhase=function(e){for(var t=[],n=0;n<this.layouts.length;n++)this.layouts[n][1]===e&&t.push(this.layouts[n][0]);return t};return e}(),Eo={initialSpeed:1,speedDecay:.05,maxIterations:50,center:{x:0,y:0},padding:{proportion:0,min:0,max:0}},Fo=function(){function e(e){void 0===e&&(e={});this.opts=e;this.numIterations=0;this.groupState=[];Vi(e,Eo);this.speed=this.opts.initialSpeed}e.prototype.isComplete=function(){return this.speed<=xi||this.numIterations>=this.opts.maxIterations};e.prototype.run=function(e){if(e["@@group"]){var t=e["@@pos2d"].data,n=e["@@radius"].data,r=e["@@group"].data;0===this.numIterations&&(this.speed=this.initialize(t,n,r));this.runSolver();this.offsetGroups(t,r);this.numIterations++;this.speed*=1-this.opts.speedDecay}else this.speed=0};e.prototype.runSolver=function(){var e=this,t=e.speed,n=e.opts,r=e.solver,i=ua(e.xyr),a=i[0],o=i[1],l=i[2];if(!(r.build(n.center,a,o,l)<0))throw new Error("packing fail");r.solve(n.center,a,o,l,t,5)};e.prototype.initialize=function(e,t,n){var r=n.countGroups(),i=this.groupState,a=this.opts,o=a.padding,l=a.center,u=a.initialSpeed,s=this.xyr=aa([3,r],"f32"),c=0,f=0,d=0;Ei(n.iterateGroups(),function(r){for(var a=[],l=n.iterateGroup(r),u=l.next();!u.done;){var g=u.value,h=e.get(g),v=h.x,m=h.y;a.push({x:v,y:m,r:t.get(g)});u=l.next()}var p=Ka(a);p.r+=Ai(p.r*o.proportion,o.min,o.max);p.id=r;i.push(p);s.set(p.x,0,c);s.set(p.y,1,c);s.set(p.r,2,c);f+=p.r;d=Math.max(d,p.r);c++});var g=Ii.createPRNG(37,-.1*d,.1*d);this.solver=new La(0,1,g);var h=ua(s),v=h[0],m=h[1],p=h[2];new Ha(0).apply(l,v,m,p);return r>2?u*((f-d)/(r-1)):0};e.prototype.offsetGroups=function(e,t){for(var n=this,r=n.groupState,i=n.xyr,a=0;a<r.length;a++){for(var o=r[a],l=i.get(0,a)-o.x,u=i.get(1,a)-o.y,s=t.iterateGroup(o.id),c=s.next();!c.done;){var f=e.get(c.value);f.x+=l;f.y+=u;c=s.next()}o.x+=l;o.y+=u}};return e}();function Yo(e,t){return new Fo(t)}var Ho={initialization:"random",initializationOptions:{iterations:5},packing:"circle",packingOptions:{}},Lo=function(e){Wi(t,e);function t(t,n){var r,i=e.call(this,n)||this,a=go.Group,o=go.Degree;i.defaultProperties=((r={})[a.name]={prop:a.descriptor,data:ro(t)},r[o.name]={prop:o.descriptor,data:eo(t)},r);return i}t.prototype.run=function(t){Vi(t,this.defaultProperties);return e.prototype.run.call(this,t)};Object.defineProperty(t.prototype,"fd",{get:function(){return this.getPhase(1)[0]},enumerable:!0,configurable:!0});return t}(Xo);function zo(e,t){Vi(t,Ho,!0);var n=[];if("none"!==t.initialization){var r=t.initializationOptions;if("random"===t.initialization)n.push([new ko(fo(e,r)),0]);else{if("link-relaxation"!==t.initialization)throw new Error('Unknown initialization "'+t.initialization+'"');n.push([new ko(mo(e,r)),0]);n.push([Vo(e,r),0])}}n.push([Ao(e,t),1]);"circle"===t.packing&&n.push([Yo(e,t.packingOptions),2]);return new Lo(e,n)}var To,No=Object.freeze({LayoutImpl:Lo,create:zo}),Uo=function(){function e(e,t,n){void 0===t&&(t=0);this.layout=e;this.interval=t;this.batchBudget=n}e.prototype.start=function(e,t){this.input=e;this.onComplete=t;this.nextStep()};e.prototype.nextStep=function(){var e=this,t=this.work();this.layout.isComplete()?this.onComplete(void 0,t):setTimeout(function(){return e.nextStep()},this.interval)};e.prototype.work=function(){var e;if(void 0===this.batchBudget)e=this.layout.run(this.input);else{var t=Date.now();e=this.layout.run(this.input);t=Math.max(1,Date.now()-t);for(var n=Math.floor((this.batchBudget-t)/t);n>0&&!this.layout.isComplete();){e=this.layout.run(this.input);n--}}return e};return e}();!function(e){e.forceDirected="forcedirected";e.random="random";e.circular="circular";e.linkRelaxation="linkRelaxation";e.organic="organic"}(To||(To={}));function Do(e,t,n){switch(e){case To.organic:return zo(t,n);case To.forceDirected:return Ao(t,n);case To.random:return new ko(fo(t,n));case To.circular:return new ko(mo(t,n));case To.linkRelaxation:return Vo(t,n);default:throw new Error("unknown layout")}}var Oo=Object.freeze({get names(){return To},createLayout:Do,get KnownProperties(){return go},forceDirected:Ro,linkRelaxation:So,organic:No,SetTimeoutRunner:Uo,SyncToAsyncLayout:ko,PhasedLayout:Xo});function _o(){var e=O,n=vi,r=mi,i=3,a=function(t,n,i,a,l){var u,d,g,h,v,m,p=t.e||1,b=t.w&&t.h,y=b&&"circle"===t.sh,I=!1;if(t.du)return{radius:10,baseRadius:10,borderSize:10,width:10,height:10};h=s(t);t._combo&&(I="boolean"==typeof l?l:t._combo.open);if(I){g=t.oc.w/2;m=v=t.oc.w;u=g+(h=t.oc&&"bw"in t.oc?t.oc.bw:rr.bw)}else if(b)if(y){var x=Math.min(t.w,t.h);m=v=x+2*h;u=(g=x/2)+h}else{g=e(t.w,t.h)/2;v=t.w+2*h;m=t.h+2*h;u=e(v,m)/2}else{m=v=2*(g=r*p)+2*(h*=p);u="box"===t.sh?e(v,m)/2:g+h}if(i&&t.t&&t.t.length>0){var C,G=c(t,n,u,a),w=G.width,Z=G.height,A=o(t,I);v=Math.max(w,v);var B=e(w/2,m/2+Z/2);d=Math.max(B,u);if(A){m=Math.max(Z,m);u=Math.max(u,e(w/2,Z/2))}else{C=e(w/2,m/2+Z);u=Math.max(C,u);m=Z+m}}else{var R=0;if(t.t){R=(f(t,a).length+1)*((t.fs||rn)*(t.e||1))}d=u+R/2}return{legacyRadius:Math.round(d),radius:Math.round(u),baseRadius:Math.round(g),borderSize:Math.round(h),width:Math.round(v),height:Math.round(m)}};function o(e,t){return!t&&("boolean"==typeof e.tc?e.tc:!e.w&&(!e.u&&!e.fi))}function l(e){return o(e,e._combo&&e._combo.open)}var u=function(e,t){var n=0;if(e.t){var r=e.fs||rn,a=e.e||1;if(!l(e)){n=(r+i)*a*f(e,t).length/2}}return Math.round(n)};function s(e){var t=0;e.b&&(t=h(e.bw)?e.bw:n);!e.donut||e._combo&&e._combo.open||(t=e.donut.w+2*e.donut.bw);return t}function c(e,t,n,r){var a=0,o=0;if(e.t){var l=e.e||1,u=(e.fs||rn)*l,s=i*l,c=f(e,r);a=g(d(c,t,u,e.fb,e.ff));o=(u+s)*c.length;e.u||e.c||e.bc||e.w&&e.h||(a=Math.max(a/10,n))}return{width:a,height:o}}function f(e,t){if(e.t){var n=e.t;if(void 0!==t&&n.length>t){n=n.substring(0,Math.max(0,t-3));n+="..."}return n.split(/\r\n|\r|\n/)}return[""]}function d(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=Nn(t,e[o],n,r,i||"sans-serif").width;return a}function g(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}return{labelOffset:u,nodeSize:a,getExtents:function(n,r,i,o,l,s){var c,f,d,g,h,v,m,p,b=Math.max(0,0|i),y={},I=0,x={},C=0,G=l||{x:0,y:0};t(n,function(e){if(void 0!==e.x){var t;if(void 0!==e.size)t=e.size;else if(void 0!==e.r){t=e.r;C=e.labelOffset}else{t=a(e,r,o,s).radius;C=u(e,s)}x[e.id]={size:t,labelOffset:C};f=e.x-t;g=e.y-(t+C);v=e.x+t;p=e.y+(t-C);if(void 0===c){c=f;d=g;h=v;m=p}else{c=Math.min(f,c);d=Math.min(g,d);h=Math.max(v,h);m=Math.max(p,m)}}});y.x1=c-(b+G.x);y.y1=d-(b+G.y);y.x2=h+(b-G.x);y.y2=m+(b-G.y);y.w=h-c+2*b;y.h=m-d+2*b;t(n,function(t){if(void 0!==t.x){var n=x[t.id],r=t.x-G.x,i=t.y-G.y,a=e(r,i+n.labelOffset);I=Math.max(I,a+n.size)}});y.r=Math.round(I+b);return y},radialExtents:function(e,n,r,i,o){var l=[],u=void 0===r?0:r;t(e,function(e){var t=void 0!==e.r?e.r:a(e,n,i,o).radius;t+=u;if(!isFinite(e.x)||!isFinite(e.y)||!isFinite(t))throw new Error("Inputs must be finite");l.push({x:e.x,y:e.y,r:t})});return Pa.radialExtents(l)}}}function Ko(){var e=function(e,t){if(e.r===t.r){if(e.t){if(!t.t)return-1;if(e.t<t.t)return-1;if(e.t>t.t)return 1}else if(t.t)return 1;return e.id===t.id?0:e.id<t.id?-1:1}return e.r<t.r?1:-1};return{compareCircles:e,concentricLayout:function(t,n){var r,i=t;if(!i||0===i.length)return i;var a=A(n,{padding:8,radialPadding:0}),o=a.padding,l=0;i.sort(e);var u=[],s=0,c=(i=i.map(function(e){return{id:e.id,r:e.r+o,x:e.x,y:e.y,labelOffset:e.labelOffset}}))[l++];if(1===i.length)d();else if(2===i.length)h();else if(3===i.length)m();else if(4===i.length)v();else if(i.length>4){var f=i[0].r;i[2].r/f>.5&&i.length>10?m():i[1].r/f>.5&&i.length>10?h():d();r=Math.abs(i[0].y-i[0].r)+a.radialPadding;c=i[l++];for(;c;)b();y(u);g()}function d(){i[0].x=0;i[0].y=-i[0].labelOffset}function g(){var e=i[0],t=i[0];i.forEach(function(n){n.y<e.y?e=n:n.y>e.y&&(t=n)});var n=(Math.abs(e.y-e.r)-(Math.sqrt(t.x*t.x+t.y*t.y)+t.r))/4;i.forEach(function(e){e.y+=n})}function h(){var e=c,t=i[l++];e.x=0;e.y=-t.r-e.labelOffset;t.x=0;t.y=e.r-t.labelOffset}function v(){var e=c,t=i[l++],n=i[l++],r=i[l++];if(t.r===n.r&&n.r===r.r){t=i[2];n=i[1]}var a=e.r+n.r,o=e.r,u=Math.sqrt(a*a-o*o),s=e.r-t.r;e.x=-t.r;e.y=-e.labelOffset;t.x=e.r;t.y=0-t.labelOffset;n.x=s;n.y=-u-n.labelOffset;r.x=s;r.y=u-r.labelOffset}function m(){var e=c,t=i[l++],n=i[l++],r=2*e.r+o,a=Math.sqrt(r*r-r/2*(r/2)),u=(e.r-t.r)/2;e.x=0;e.y=2/3*-a+u;t.x=r/2;t.y=a*(1/3)-t.labelOffset+u;n.x=-r/2;n.y=a/3-n.labelOffset+u}function p(e){return 2*e.r+o}function b(){s+=c.r+r+a.radialPadding;r=c.r;var e=2*Math.PI*s,t=e-p(c),n={items:[],radius:s,spaceLeft:0,circumference:e};u.push(n);for(;c&&t>0;){n.items.push(c);(c=i[l++])&&(t-=p(c))}c&&(t+=p(c));n.spaceLeft=t;if(c&&i.length-l<5){for(var o=0;c;){o+=p(c);n.items.push(c);c=i[l++]}n.radius=(e-t+o)/(2*Math.PI);n.circumference=2*Math.PI*n.radius;n.spaceLeft=0}}function y(){u.forEach(function(e){var t=2*Math.PI/(e.circumference-e.spaceLeft),n=0,r=t*e.items[0].r,i=Math.PI/2;e.items.forEach(function(a){var o=t*a.r,l=n+o;a.x=e.radius*Math.cos(l-i-r);a.y=e.radius*Math.sin(l-i-r)-a.labelOffset;n+=t*p(a)})})}return i}}}function Po(e){
var n,r,i,a,o,l,u,s,c,f,d,g={},h=3,v=.5,m=mi,p=[],b=[],y=[],I=[],x=[],C=[];function G(e,t){var n;function r(e,t,n,r,i){return{isLeaf:!0,children:[],points:[],x1:e,y1:t,x2:n,y2:r,depth:i}}function i(e){return e.depth>=t}function a(e,t){var n,i,a,o,l=.5*(e.x1+e.x2),u=.5*(e.y1+e.y2);if(0===t||1===t){a=e.y1;o=u}else{a=u;o=e.y2}if(0===t||2===t){n=e.x1;i=l}else{n=l;i=e.x2}e.isLeaf=!1;e.children[t]=r(n,a,i,o,e.depth+1)}function o(e,t){t(e);for(var n=0;n<4;n++)e.children[n]&&o(e.children[n],t)}function l(e,t){if(t.x<e.x1||t.y<e.y1||t.x>e.x2||t.y>e.y2)throw Error("[Layout] Error: the point is out of range.");if(i(e))e.points.push(t);else{e.points.push(t);var n,r=.5*(e.x1+e.x2),o=.5*(e.y1+e.y2);t.x<r&&t.y<o&&(n=0);t.x>=r&&t.y<o&&(n=1);t.x<r&&t.y>=o&&(n=2);t.x>=r&&t.y>=o&&(n=3);e.children[n]||a(e,n);l(e.children[n],t)}}var u=[],s=[];for(n=0;n<e.length;n++){u.push(e[n].x);s.push(e[n].y)}var c=Math.min.apply(0,u),f=Math.max.apply(0,u),d=Math.min.apply(0,s),g=Math.max.apply(0,s),h=f-c,v=g-d;h>v?g=d+h:f=c+v;var m=r(c,d,f,g,0);m.addPoint=function(e){l(m,e)};m.visit=function(e){o(m,e)};for(n=0;n<e.length;n++)m.addPoint(e[n]);return m}function w(e,t){return Math.sqrt(e*e+t*t)}function Z(){var e=[];t(f,function(t,n){e.push({id:n,x:x[i[n]],y:C[i[n]]})});var n=G(e,h);p.length=0;b.length=0;function r(e){function t(t){if(t.isLeaf){var n,a=e.x-.5*(t.x1+t.x2),o=e.y-.5*(t.y1+t.y2),l=w(a,o),u=(t.x2-t.x1)/l,s=t.points,c=s.length;if(u>v){for(n=0;n<c;n++)if(e.id!==s[n].id){var f=e.x-s[n].x,d=e.y-s[n].y,g=Math.max(.001,w(f,d));r+=f/g;i+=d/g}}else{r+=c*a/l;i+=c*o/l}}}var r=0,i=0;n.visit(t);p.push(r);b.push(i)}for(var a=0;a<e.length;a++)r(e[a]);S(p,b)}function A(e,t,n){for(var r=t,i=W(e,M(V(t,n),-1)),a=i.slice(),l=R(i,i),u=0;u<20&&l/o>.01;u++){var s=V(a,n),c=l/R(s,a);r=W(r,M(a,c));var f=W(i,M(s,-c));i=f;var d=R(f,f),g=d/l;l=d;a=W(f,M(a,g))}return r}function B(){var e;for(e=0;e<o;e++){y[e]=[];I[e]={};I[e][e]=!0;for(var t=0;t<o;t++)y[e][t]=0}for(e=0;e<a.length;e++){var n=a[e],r=i[n.id1],l=i[n.id2];I[r][l]=!0;I[l][r]=!0;y[r][l]-=1;y[l][r]-=1;y[r][r]+=1;y[l][l]+=1}}function R(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function M(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]*t);return n}function W(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]+t[r]);return n}function V(e,n){var r,i=[],a=0;for(r=0;r<o;r++){a=0;t(I[r],function(t,n){a+=y[r][n]*e[n]});i.push(a)}i=M(i,n);a=0;for(r=0;r<o;r++)a+=e[r];var l=[];for(r=0;r<o;r++)l.push(o*e[r]-a);return W(i,l)}function S(e,t){var n,r=0,i=0;for(n=0;n<e.length;n++){r+=e[n];i+=t[n]}r/=e.length;i/=e.length;for(n=0;n<e.length;n++){e[n]-=r;t[n]-=i}}function k(e,t,n){for(var r=0;r<t;r++){c+=1/(l+u+1);e.trigger("progress","layout",c);Z(x,C);x=A(p,x,n);C=A(b,C,n);S(x,C)}}function X(t,c){var g,h;d=Object.keys(f);i={};x.length=0;C.length=0;y.length=0;I.length=0;var v=0,p=e(t.tightness);p=2-2*p/10+1;for(h=0;h<d.length;h++){g=d[h];v+=Math.max(1,f[g].size);i[g]=h}s=42*Math.sqrt(o)*p;s*=1+.02*(v/o-m);if(a.length/o<1){var b=.65,G=a.length/o;s*=b+G*(1-b)}for(h=0;h<d.length;h++){x.push(s*c.next());C.push(s*c.next())}n=500*(r=o/50);l=8;u=8}function E(e){function t(e,t){return Math.atan2(e,t)||0}function n(e,t,n){var r=e,i=r*Math.cos(t),a=r*Math.sin(t);f[n].x=s*i;f[n].y=s*a}function r(e){var r=x[i[e]],a=C[i[e]];n(w(r,a),t(r,a),e)}e.forEach(r)}g.lens=function(e,t,i,s,g,h){c=0;e.trigger("progress","layout",c);f=t.v;a=t.e;var v=[];if((o=t.vcount)>1){X(i,g);B();k(e,l,n);k(e,u,r);E(d)}return s(e,f,{},t.extents,v,i,h)};return g}function Jo(e){var t=jo(Jn()),n=A(e,{selfLinks:!1}),r=ur({numbers:{x:1,y:1},strings:{id:1,id1:1,id2:1},booleans:{hi:1,a1:1,a2:1}});function i(e){function t(t){var i=o(t);r.typeCheck(i);var a=r.filterNodesAndLinks(i.items,null,null,{selfLinks:n.selfLinks});r.ensureHiddenItemConsistency(a.nodes,a.links);e.privateSetProperties(a.nodes,a.links)}return t}function a(e){function t(){var t={};e.privateSetProperties(t,t)}return t}return U(t,{load:i(t),clear:a(t)})}function jo(e){var n={},r={},i={},a=e,l=null;n.clearCache=function(){l=null};var u=n.clearCache;n.privateSetProperties=function(e,t){r=e;i=t;u()};function s(e,n,r){var i=n&&n.all,a="toplevel"!==n.combos,o="underlying"!==n.combos;t(e,function(e){!i&&e.hi||!a&&e._parentId||!o&&e._combo||r(e)})}function f(e,t){s(i,e,t)}function d(e,t){s(r,e,t)}var v=function(e,t,n,r){function i(){var t=[];d(e,function(e){t.push(e)});return t}var o=i(),l=o.length,u=-1,s=Date.now(),f=s,g=700,h=function(){if(++u>=l){v(1);r()}else n(o[u],p)},v=function(e){a&&a.trigger("progress",t,e)},m=function(){if((s=Date.now())-f>g){f=Date.now();return!0}return!1},p=function(){if(m()){v(u/l);c(h,0)}else h()};v(0);p()};n.findAdjacency=function(e,t,n){var r=I(e);if(t===n)return r.selfAdjacency[t];var i=r.adjacency;return i[t]&&i[t][n]};n.connections=function(e){var t=I(e);return e.self?t.selfConnections:t.connections};n.eigenCentrality=function(e){var n,r,i=A(e,{all:!1,value:void 0});i.combos="toplevel";i.direction="any";U(i);z(i);var a={},o=m(i);function l(e,t){a[t]=e*o[n].nodes.length}for(n=0;n<o.length;n++){var u={};for(r=0;r<o[n].nodes.length;r++)u[o[n].nodes[r]]=!0;var s=c(u);t(s,l)}return a;function c(e){var t,n,r={},a=[],o=[],l=[],u=0,s=[],c=0;d(i,function(t){var n=t.id;if(e[n]){a.push(n);r[n]=a.length-1;o.push([]);l.push({})}});n=Math.max(100,5*Math.sqrt(a.length));f(i,function(t){if(e[t.id1]&&e[t.id2]){var n=r[t.id1],a=r[t.id2];if(!l[n][a]){o[n].push(a);o[a].push(n);l[a][n]=0;l[n][a]=0}var s=h(t,i);l[n][a]+=s;l[a][n]+=s;u+=s;c++}});if(0===a.length)return{};if(1===a.length){(s={})[a[0]]=1;return s}if(2===a.length){(s={})[a[0]]=.5;s[a[1]]=.5;return s}u/=c;n=Math.max(100,5*Math.sqrt(a.length));for(t=0;t<a.length;t++)s.push(Math.random());for(t=0;t<n;t++){s=v(s);t%10==0&&m()}m();var g={};for(t=0;t<a.length;t++)g[a[t]]=s[t];return g;function h(e,t){var n=1;t.value&&e.d&&(n=Number(e.d[t.value]));return n}function v(e){var t,n,r=[];for(t=0;t<a.length;t++){var i=0;for(n=0;n<o[t].length;n++)i+=l[t][o[t][n]]*e[o[t][n]];i+=u*e[t];r.push(i)}return r}function m(){var e,t=1/p(s);for(e=0;e<a.length;e++)s[e]*=t}function p(e){var t,n=0;for(t=0;t<e.length;t++)n+=Math.abs(e[t]);return n}}};n.pageRank=function(e){var t,n=A(e,{all:!1,value:void 0,directed:!0});n.combos="toplevel";U(n);N(n);var r,i={},a=[],o=[],l=[],u=[],s=[],c=.85;d(n,function(e){a.push(e.id);i[e.id]=a.length-1;o.push([]);l.push({});u.push(0)});r=Math.max(100,5*Math.sqrt(a.length));f(n,function(e){var t=i[e.id1],r=i[e.id2],a=v(e,n);if(!n.directed||e.a2||!e.a1&&!e.a2){if(!l[r][t]){l[r][t]=0;o[r].push(t)}l[r][t]+=a;u[t]+=a}if(!n.directed||e.a1||!e.a1&&!e.a2){if(!l[t][r]){l[t][r]=0;o[t].push(r)}l[t][r]+=a;u[r]+=a}});for(t=0;t<a.length;t++)s.push(Math.random());var g=1/p(s);for(t=0;t<a.length;t++)s[t]*=g;for(t=0;t<r;t++)s=m(s);g=1/p(s);for(t=0;t<a.length;t++)s[t]*=g;var h={};for(t=0;t<a.length;t++)h[a[t]]=s[t];return h;function v(e,t){var n=1;t.value&&e.d&&(n=Number(e.d[t.value]));return n}function m(e){var t,n,r=[],i=0,f=0;for(t=0;t<a.length;t++)i+=e[t];for(t=0;t<a.length;t++){var d=0;for(n=0;n<o[t].length;n++){var g=o[t][n];d+=l[t][g]*e[g]/u[g]}0===u[t]&&(f+=c*e[t]);d*=c;d+=(1-c)*i/a.length;r.push(d)}f/=a.length;for(t=0;t<s.length;t++)r[t]+=f;return r}function p(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n}};n.neighbours=function(e,n){var a={},o={},l=Y(Z(e)),u=A(n,{all:!1,direction:"any",hops:1});if(u.hops<1)throw new Error("neighbours error: hops must be a positive number");U(u);var s=0,c={},f={},d=l,g=I(u),h=g.adjacency,v=g.selfAdjacency;t(l,function(e,t){var n=S(t);if(!r[n]&&!i[n])throw new Error("neighbours error: ids must be present in the graph");s++});function m(e,t,n){if(!f[t]&&B(n,e,t,u)){a[t]=1;f[t]=1;if(n!==e){o[e]=1;e in d&&(o[n]=1);if(!(e in l)){s++;c[e]=1}}}}function p(){t(l,function(e,n){if(r[n]){h[n]&&t(h[n],function(e,t){for(var r=0;r<e.length;r++){m(t,S(e[r]),n)}});var a=v[n];if(a)for(var d=0;d<a.length;d++)m(n,a[d],n)}else if(i[n]){var g=i[n];if(!f[g.id2]&&B(g.id2,g.id1,n,u)){o[g.id2]=1;f[g.id2]=1;f[n]=1;if(!(g.id2 in l)){s++;c[g.id2]=1}}if(!f[g.id1]&&B(g.id1,g.id2,n,u)){o[g.id1]=1;f[g.id1]=1;f[n]=1;if(!(g.id1 in l)){s++;c[g.id1]=1}}}})}for(;u.hops--&&s;){s=0;p();l=c;c={}}return{nodes:Object.keys(o),links:Object.keys(a)}};n.privateNeighbourLinks=function(e){var n=I({all:!0,combos:"all"}),r=n.adjacency,i=n.selfAdjacency,a={},o=[];e.forEach(function(e){t(r[e],function(e){e.forEach(function(e){if(!a[e]){o.push(e);a[e]=!0}})});var n=i[e];if(n)for(var l=0;l<n.length;l++)o.push(n[l])});return o};n.privateGetLinkIdsBetween=function(e,t){var n=I({all:!0,combos:"all"}),r=n.adjacency,i=n.selfAdjacency,a=[];r[e]&&(a=r[e][t]||[]);e===t&&i[e]&&(a=a.concat(i[e]));return a};n.clusters=function(e){var t,n=A(e,{all:!1,factor:5,consistent:!0});n.combos="toplevel";U(n);var r,i,a=[],o=[],l=[],u=[],s={},c=0,g=[],v=[],m=[],p=[],b=[];d(n,function(e){u.push(e.id);o.push([]);l.push([]);s[e.id]=u.length-1;g.push([u.length-1]);v.push(u.length-1);b.push(u.length-1);a.push(0);m.push(0)});f(n,function(e){var t=I(e,n);c+=t;var r=s[e.id1],i=s[e.id2];if(!l[r][i]){l[r][i]=0;l[i][r]=0}l[r][i]+=t;l[i][r]+=t;a[r]+=t;a[i]+=t;m[r]+=t;m[i]+=t;o[r].push(i);o[i].push(r)});r=Math.max(1e4,50*u.length);if(0===u.length)return[];0===c&&(r=0);var y=Q();y.setSeed(n.consistent?900736044081:null);function I(e,t){var n=1;t.value&&e.d&&(n=+e.d[t.value]);return n}function x(e){i=h(i=+e)?i:5;i=Math.max(0,i);i=(i=Math.min(10,i))*i*i/125}x(n.factor);for(t=0;t<r;t++){if(y.next()>.95){M(b[Math.floor(y.next()*b.length)],b[Math.floor(y.next()*b.length)])}if(t<.5*r&&y.next()>.98){V(b[Math.floor(y.next()*b.length)])}var C=Math.floor(u.length*y.next()),G=o[C][Math.floor(y.next()*o[C].length)],w=v[G],Z=v[C];if(w!==Z){R(w,Z,C)>=0&&W(C,w)}}function B(){var e,t,n=[];for(e=0;e<b.length;e++){var r=[];for(t=0;t<g[b[e]].length;t++)r.push(u[g[b[e]][t]]);n.push(r)}return n}function R(e,t,n){var r,u=m[t],s=m[e],f=a[n],d=(u-s-f)*f*i;d/=2*c;for(r=0;r<o[n].length;r++){var g=o[n][r];v[g]===t?d-=l[n][g]:v[g]===e&&(d+=l[n][g])}return d/c}function M(e,t){var n,r;if(t!==e&&0!==g[e].length&&0!==g[t].length){var a=m[e],u=m[t],s=0;s-=i*a*u/c;for(n=0;n<g[e].length;n++){var f=g[e][n];for(r=0;r<o[f].length;r++)v[o[f][r]]===t&&(s+=l[f][o[f][r]])}if((s/=c)>0){var d=g[e].length;for(n=0;n<d;n++)W(g[e][0],t)}}}function W(e,t){var n,r=v[e];v[e]=t;var i=[];for(n=0;n<g[r].length;n++)g[r][n]!==e&&i.push(g[r][n]);if(0===g[t].length){b.push(t);p.splice(p.indexOf(t),1)}g[r]=i;g[t].push(e);m[t]+=a[e];m[r]-=a[e];if(0===g[r].length){p.push(r);b.splice(b.indexOf(r),1)}}function V(e){var t,n=g[e].length;if(1!==n&&p.length){var r=[];for(t=0;t<n;t++)r.push(g[e][t]);for(t=0;t<n&&p.length;t++)W(r[t],p[0])}}return B()};n.components=function(e){var t=Ni,n=A(e,{all:!1});U(n);var r=qo(I(n),!0),i=so.connectedComponents(r.staticGraph),a={},o=r.vertexMap;t.forEach(i.iterateGroups(),function(e){a[e]={nodes:t.toArray(t.map(i.iterateGroup(e),function(e){return o.get(e)})),links:[]}});for(var l=r.edgeList,u=0;u<l.length;u++)for(var s=l[u],c=a[i.get(o.getUniqueInverse(s.id1))],f=0;f<s.ids.length;f++)c.links.push(s.ids[f]);return E(a)};var m=n.components;function p(e,t,n,r,i){e[n]||(e[n]={});e[r]||(e[r]={});if(!e[n][r]){e[r][n]=[];e[n][r]=e[r][n];t.push(i)}e[n][r].push(i)}function b(e,t,n){var r={id:t.id,id1:t.id1,id2:t.id2,ids:n};e.edges.push(r);e.connections.push(n)}function y(e){var n={connections:[],adjacency:{},vertices:{},edges:[]};d(e,function(e){n.vertices[e.id]={x:e.x,y:e.y};n.adjacency[e.id]={}});var r=[],a={};f(e,function(e){if(e.id1===e.id2){a[e.id1]=a[e.id1]||[];a[e.id1].push(e.id)}else p(n.adjacency,r,e.id1,e.id2,e.id)});for(var o=r.length,l=0;l<o;l++){var u=i[r[l]];b(n,u,n.adjacency[u.id1][u.id2])}if(F(a)){var s=n.connections.slice();t(a,function(e){s.push(e)});n.selfConnections=s}else n.selfConnections=n.connections;n.selfAdjacency=a;return n}function I(e){var t=A(e,{all:!1,combos:"toplevel"}),n=(t.all?"all":"visible")+"-"+t.combos;l||(l={});l[n]||(l[n]=y(t));return l[n]}n.internalMarkLinks=function(e){var n=I({combos:"all"}),r=n.adjacency,i=n.selfAdjacency,a=2,o=1,l={};e.forEach(function(e,n){var a=r[n];a&&t(a,function(e){for(var t=0;t<e.length;t++){var n=e[t];l[n]=!0}});var o=i[n];if(o)for(var u=0;u<o.length;u++)l[o[u]]=!0});t(l,function(t,n){var r=e.get(n);r&&r===a||e.set(n,o)})};n.distances=function(e,n){if(!r[e])throw new Error("distances error: id(s) must be present in the graph");var i=n||{};N(i);U(i);var a=k(e,i),o={};t(a.distance,function(e,t){h(e)&&(o[t]=e)});return o};var C=n.distances,G=function(e,t,n){var r,i=I(n).adjacency[e][t],a=1/0,o=W(n);if(i)for(var l=0;l<i.length;l++){var u=o(e,t,i[l],n);if(h(u)){if(u<a){a=u;(r=[]).push(i[l])}u===a&&a!==1/0&&r.push(i[l])}}return{value:a,links:r}},w=function(e,t){return i[e].a2&&i[e].id2===t||i[e].a1&&i[e].id1===t},B=function(e,t,n,r){return"any"===r.direction||("from"===r.direction&&w(n,t)||"to"===r.direction&&w(n,e))},R=function(e,t,n,r){var a=NaN;B(e,t,n,r)&&(r.value?i[n].d&&(a=+i[n].d[r.value]):a=1);return a},W=function(e){return D(e)?V:R},V=function(e,t,n,r){var i=R(e,t,n,r);return g(i)?i:1/i},k=function(e,n){var r={},i={},a=[],o=I(n).adjacency;function l(){for(var e,t=1/0,n=0;n<a.length;n++){var i=r[a[n]];if(i<=t){e=n;t=i}}return e}function u(e,t,n){i[e]||(i[e]=[]);i[e].push({id:t,links:n})}d(n,function(e){var t=e.id;r[t]=1/0;i[t]=void 0;a.push(t)});r[e]=0;for(;a.length>0;){var s=l(),c=a[s];if(r[c]===1/0)break;a.splice(s,1);t(o[c],function(e,t){var a=G(c,t,n),o=r[c]+a.value;if(o<r[t]){r[t]=o;i[t]=[{id:c,links:a.links}]}else o===r[t]&&u(t,c,a.links)})}return{distance:r,previous:i}};function H(e){e.direction=e.direction||"any";if(!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function L(e){e.normalization=e.normalization||"any";if(!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function z(e){f(e,function(t){if(R(t.id1,t.id2,t.id,e)<=0)throw new Error("Link Weight must be Positive")});return{direction:e.direction,value:e.value,weights:D(e)}}function T(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function N(e){return H(e)||z(e)}function U(e){e.all=!!e.all}function D(e){return!!e.weights}function O(e){var t=0;d(e,function(){t++});return t}n.shortestPaths=function(e,t,n){if("string"!=typeof e||"string"!=typeof t)throw new Error("shortestPaths error: ids must be strings");if(!r[e]||!r[t])throw new Error("shortestPaths error: ids must be present in the graph");var i=A(n,{all:!1});N(i);U(i);var a=k(e,i),o=a.previous;if(a.distance[t]===1/0)return{onePath:[],one:[],items:[],distance:1/0};for(var l=[],u=[],s=t;o[s];){l.unshift(s);u.unshift(s);u.unshift(o[s][0].links[0]);s=o[s][0].id}l.unshift(s);u.unshift(s);function c(e){for(var t=[],n=0;n<e.length;n++)o[e[n].id]&&(t=t.concat(o[e[n].id]));return t}var f={};f[t]=1;var d=[];d.push({id:t});for(var g=c(d);g.length>0;){for(var h=0;h<g.length;h++){f[g[h].id]=1;for(var v=0;v<g[h].links.length;v++)f[g[h].links[v]]=1}g=c(g)}return{onePath:u,one:l,items:Object.keys(f),distance:a.distance[t]}};n.degrees=function(e){var n=A(e,{multi:!0,all:!1});n.combos="toplevel";N(n);U(n);var r=I(n).adjacency,i={};d(n,function(e){var a=e.id;i[a]=0;t(r[a],function(e,t){for(var r=0;r<e.length;r++){var o=R(a,t,e[r],n);if(h(o)){i[a]+=o;if(!n.multi)break}}})});return i};var _=n.degrees;n.betweenness=function(e,n){function r(e,t){return P[e]-P[t]}function i(e){e.sort(r);return e.shift()}function a(e,t){e.sort(r);X(e,t)||e.push(t)}function l(e,t){var n=G(e,t,R).value;return h(n)?n:b()||h(n)?1/0:1}function u(e){return e.length>0}function s(){H.length=0;z.length=0;d(C,function(e){for(var t=0;t<j.length;t++)f(j[t].dict,e.id,j[t].value)})}function c(e,t,n){d(e,function(e){f(t,e.id,n)})}function f(e,t,n){Array.isArray(n)&&u(n)&&e[t]?e[t].length=0:e[t]=o(n)}function g(){var e,t,n,r=m(C),i={};for(e=0;e<r.length;e++){n=r[e];for(t=0;t<n.nodes.length;t++)i[n.nodes[t]]=n.nodes.length}return i}function p(){return!M(C.value)}function b(){return!!C.directed}function y(){return C.endpoints}var C=A(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1});C.combos="toplevel";L(C);U(C);var w=p()||b()?"dijkstra":"regular",Z=y()?"endpoints":"regular",B=T(C),R={direction:b()?"from":"any",value:C.value,weights:D(C),all:C.all};N(C);var W,V,S,k,E,F,Y={},H=[],z=[],O={},_={},K={},P={},J=0,j=[{dict:_,value:0},{dict:P,value:1/0},{dict:O,value:[]},{dict:K,value:0}],Q=I(C).adjacency,q={regular:function(e){_[e]=1;P[e]=0;H.push(e);for(;u(H);){W=H.shift();z.push(W);t(Q[W],function(e,t){if(!h(P[t])){P[t]=P[W]+1;H.push(t)}if(P[t]===P[W]+1){_[t]+=_[W];O[t].push(W)}})}},dijkstra:function(e){_[e]=1;P[e]=0;H.push(e);for(;u(H);){W=i(H);z.push(W);t(Q[W],function(e,t){if(P[t]>P[W]+l(W,t)){P[t]=P[W]+l(W,t);a(H,t);_[t]=0;O[t]=[]}if(P[t]===P[W]+l(W,t)){_[t]+=_[W];O[t].push(W)}})}}},$={regular:function(e){for(;u(z);){V=z.pop();E=(1+K[V])/_[V];for(k=0;k<O[V].length;k++){W=O[V][k];K[W]+=_[W]*E}V!==e&&(Y[V]+=K[V])}},endpoints:function(e){Y[e]+=z.length-1;for(;u(z);){V=z.pop();E=(1+K[V])/_[V];for(k=0;k<O[V].length;k++){W=O[V][k];K[W]+=_[W]*E}V!==e&&(Y[V]+=K[V]+1)}}},ee={chart:function(){if(J>2){S=1/((J-1)*(J-2));t(Y,function(e,t){Y[t]*=S})}},component:function(){F=g();t(Y,function(e,t){if(F[t]>2){S=1/((F[t]-1)*(F[t]-2));Y[t]*=S}})},unnormalized:function(){if(!b()){S=.5;t(Y,function(e,t){Y[t]*=S})}}},te=function(){ie();x(n,Y)},ne=q[w]||q.regular,re=$[Z]||$.regular,ie=ee[B]||ee.chart;d(C,function(){J++});c(C,Y,0);v(C,"betweenness",function(e,t){s();ne(e.id);re(e.id);t()},te)};n.closeness=function(e,n){var r=A(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});r.combos="toplevel";var a=I(r).adjacency;function o(e,n){var r=0;t(n,function(e){r+=h(e)?1:0});return r}function l(e){return 0===Object.keys(e).length}function u(e){return!M(e)}function s(e){return!i[e].a1&&!i[e].a2}function c(e){var n={},r=0,i={},o={};o[e]=1;for(;!l(o);){i=o;o={};t(i,function(e,i){if(!u(n[i])){n[i]=r;t(a[i],function(e,t){o[t]=1})}});r+=1}return n}function f(){return"any"!==r.direction}function d(){r.mode=r.mode||"auto";if(!r.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function g(){d();return"auto"===r.mode?G():r.mode}function p(){return!M(r.value)}function b(){return T(r).match(/chart/)}function y(){return T(r).match(/component/)}function G(){var e="disconnected",t=m(r);if(1===t.length){e="connected";if(f())for(var n=0;n<t[0].links.length;n++)if(s(t[0].links[n]))return"disconnected"}return e}var w=N(r);L(r);U(r);w.all=r.all;var Z,B,R,W,V,S=p()||f()?"dijkstra":"regular",k=0,X={},E=g(),F={regular:function(e){return c(e)},dijkstra:function(e,t){return C(e,t)}},Y={connected:function(e,n){var r=0;t(n,function(e){r+=h(e)?e:0});return r?1/r:0},disconnected:function(e,n){var r=0;t(n,function(t,n){r+=e!==n?1/t:0});return r}},H=function(){x(n,X)};B=F[S]||F.regular;R=Y[E];k=O(r);X={};v(r,"closeness",function(e,t){W=B(e.id,w);Z=o(e.id,W);X[e.id]=R(e.id,W);if(k>1){V=b()?Math.pow(Z-1,2)/(k-1):y()?Z-1:1;X[e.id]*=V}t()},H)};n.kCores=function(e){var n=A(e,{all:!1});n.combos="toplevel";U(n);var r=I(n).adjacency;function i(e){var n=0;t(e,function(e){n=Math.max(n,e)});return n}var a=function(){var e,i,a,o,l,u,s,c,f,g,h,v={},m={},p=[],b=[];i=0;v=_({multi:!1,all:n.all,combos:"toplevel"});t(v,function(e){i=Math.max(i,e)});h=Object.keys(v).length;for(e=0;e<i+1;e++)b[e]=0;d(n,function(e){b[v[e.id]]++});l=1;for(e=0;e<i+1;e++){u=b[e];b[e]=l;l+=u}d(n,function(e){var t=e.id;m[t]=b[v[t]];p[m[t]]=t;b[v[t]]++});for(e=i;e>1;e--)b[e]=b[e-1];b[0]=1;for(o=0;o<h;o++){a=p[o];t(r[a],function(e,t){if(v[t]>v[a]){c=v[t];f=m[t];g=b[c];if(t!==(s=p[g])){m[t]=g;p[f]=s;m[s]=f;p[g]=t}b[c]++;v[t]--}})}return v}();return{maximumK:i(a),values:a}};return n}function Qo(e,t){function n(e,t,n,r,i){this.nodeList=e;this.edgeList=t;this.staticGraph=n;this.vertexMap=r;this.edgeMap=i}var r=Ni.fromArray;Array.isArray(e)||(e=Object.keys(e));Array.isArray(t)||(t=values(t));var i=e.length>0&&"string"==typeof e[0]?r(e):r(e,function(e){return e.id}),a=t.length>0&&"string"==typeof t[0].id?r(t,function(e){return[e.id1,e.id2,e.id]}):r(t,function(e,t){return[e.id1,e.id2,t.toString()]}),o=new so.StaticListGraph,l=so.buildFromLabeledIterators(i,a,o);return new n(e,t,o,l.vertexMap,l.edgeMap)}function qo(e,t){var n=e.edges;if(t){var r=[];Object.keys(e.selfAdjacency).forEach(function(t){var n=e.selfAdjacency[t];r.push({id:n[0],id1:t,id2:t,ids:n})});r.length>0&&(n=n.concat(r))}return Qo(e.vertices,n)}var $o=Oo.names;function el(e){function t(e){var t=Oo.KnownProperties,n=e.vertexMap,r=so.StaticPropertyMap.fromRange(n.keySpace(),null),i=so.StaticPropertyMap.fromRange(n.keySpace(),0);e.nodeList.forEach(function(e){var t=n.getUniqueInverse(e.id);r.set(t,e);i.set(t,e.size)});var a={};a[t.Position2d.name]={prop:t.Position2d.descriptor,data:r};a[t.Radius.name]={prop:t.Radius.descriptor,data:i};return a}function n(t,n,i,a,o,l){a.trigger("progress","layout",0);var u=Oo.createLayout(t,r.staticGraph,n.libgOpts);new Oo.SetTimeoutRunner(u,0,100).start(i,function(t){if(t)throw new Error(t);a.trigger("progress","layout",1);o(a,e.v,{},e.extents,{length:1},n,l)})}var r=Qo(E(e.v),e.e);function i(e,i,a,o){var l=t(r);i.libgOpts={initializationOptions:{seed:i.consistent?.5:void 0},packingOptions:{padding:{proportion:.2,min:25,max:200}}};n($o.organic,i,l,e,a,o)}return{organic:i}}function tl(e){var n=_o(),r={},i=Math.pow(10,-3.8),a=27,l=1.35,u=Math.pow(a,l);function s(e,t,n,r,i,a,o,l,u,s){var c=i[o];if(!(c in n)){if(!(c in r))throw new Error("link has end which is not in nodes list");var d=r[c];if(d.hi)throw new Error("link has end which is hidden");n[c]=f(e,t,d,c,l,u,s)}return c}function f(t,r,i,a,o,l,u){var s;if(l){var c=e.options().truncateLabels;s=c?c.maxLength:void 0}var f=n.nodeSize(i,r,l,s);return{id:a,x:i.x,y:i.y,size:u?f.legacyRadius:f.radius,fixed:!!o&&a in o,lc:0,d:i.d,w:f.width,h:f.height,labeloff:n.labelOffset(i)}}function d(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}function g(e,n,r,i,a,o,l,u,c){for(var d=a().connections({all:!1,combos:c}),g={},h=[],v=0;v<d.length;v++){var m=d[v][0],p=i[m],b=s(e,n,g,r,p,m,"id1",o,l,u),y=s(e,n,g,r,p,m,"id2",o,l,u);if(null!==b&&null!==y){var I,x=[{id:m,sign:1,off:p.off}],C=p.w||1;for(I=1;I<d[v].length;I++){p=i[m=d[v][I]];x.push({id:m,sign:p.id1===b?1:-1,off:p.off});C=Math.max(C,p.w||1)}h.push({id1:b,id2:y,id:m,arrowSize:e.arrowLength(C,1),links:x,numLinks:x.length});g[b].lc+=1;g[y].lc+=1}}t(r,function(t,r){if(!t.hi&&(c||!t._parentId)&&!g[r]){var i=f(e,n,t,r,o,l,u);g[r]=i}});var G=Object.keys(g).length;return{v:g,e:h,vcount:G}}function v(e,t){var n=Ni,r=Qo(e,t),i=so.connectedComponents(r.staticGraph),a={},o=r.vertexMap;n.forEach(i.iterateGroups(),function(t,r){var l={};n.forEach(i.iterateGroup(t),function(t){t=o.get(t);var n=e[t];l[t]=n;n.c=r});a[t]={verts:l,edges:[],extents:m(l),c:r}});for(var l=0;l<t.length;l++){var u=t[l],s=a[i.get(o.getUniqueInverse(u.id1))];s.edges.push(u);u.c=s.c}return E(a)}r.extractStructure=function(e,t,n,r,i,a,o,l,u){var s=null;if(a){s={};for(var c=0;c<a.length;c++)s[a[c]]=1}var f=g(e,t,n,r,i,s,o,l,u);f.extents=m(f.v);return f};function m(e){var n,r,i,a,o=0;t(e,function(e){n=B(n)?Math.min(n,e.x-e.size):e.x-e.size;r=B(r)?Math.min(r,e.y-e.size):e.y-e.size;i=B(i)?Math.max(i,e.x+e.size):e.x+e.size;a=B(a)?Math.max(a,e.y+e.size):e.y+e.size;o++});return{x1:n,y1:r,x2:i,y2:a,c:o}}var p="_dummy",b=RegExp("^"+p);function y(e){return b.test(e.id)}function I(e,n,r,i,a,o,l){var u,s,c,f={},d={},g={},v=[],m={},b={},y=i(),I=l;for(u=0;u<a.length;u++){g[u]={};m[u]=[];var x=[],C=1/0;t(a[u].verts,function(e,t){if(e.d&&h(e.d[r])){c=e.d[r];if(!g[u][c]){g[u][c]=[];m[u].push(c)}g[u][c].push(t);b[t]=c;if(c<C){C=c;x=[t]}else c===C&&x.push(t)}else if(o)throw new Error("Sequential Layout: Node is missing valid level data.")});if(0===x.length){var G=Object.keys(a[u].verts)[0];x.push(G);b[G]=0;g[u][0]=[G];m[u].push(0)}m[u].sort(function(e,t){return e-t});var w=[];for(s=0;s<m[u].length;s++){var Z=m[u][s];w=[];var A,B,R=y.neighbours(g[u][Z]),W=((m[u][s+1]||Z+1)+Z)/2;for(B=0;B<R.nodes.length;B++){A=R.nodes[B];if(M(b[A])){w.push(A);b[A]=W}}if(w.length){m[u].splice(s+1,0,W);g[u][W]=w}}if(!o)for(s=0;s<x.length;s++){f[x[s]]=1;e[x[s]].level=0}d[u]=x}if(o){for(u=0;u<a.length;u++)for(s=0;s<m[u].length;s++)-1===v.indexOf(m[u][s])&&v.push(m[u][s]);v.sort(function(e,t){return e-t});for(u=0;u<a.length;u++)for(s=0;s<v.length;s++)g[u][v[s]]=s;I=I||[]}else for(u=0;u<a.length;u++)for(s=0;s<m[u].length;s++)g[u][m[u][s]]=s;var V,k,X,E,F,Y,H,L,z=0,T={};function N(t){var n=t.origId||t.id,r={id:p+n+"-"+z++,level:t.level-1,origId:n,x:0,y:0,c:t.c,size:10,fixed:!1,lc:t.lc,du:!0,w:20,h:20,labeloff:0};e[r.id]=r;a[t.c].verts[r.id]=r;T[r.id]=1;return r}function U(e,t,r){var i={id:p+t.id+"-"+r.id,id1:t.id,id2:r.id,c:e.c,numLinks:e.numLinks};"level"in t&&"level"in r&&(i.level=Math.max(t.level,r.level));n.push(i);a[e.c].edges.push(i);return i}function D(e,t,n){var r=N(e),i=n.id1===t.id;U(n,i?r:e,i?e:r);r.level===t.level+1?U(n,i?t:r,i?r:t):D(r,t,n)}function O(e,t,n){if(e.level>0){var r=N(e);U(n,e,r);U(n,r,t)}if(e.level<v.length-1){var i=N(e);i.level+=2;U(n,e,i);U(n,i,t)}}for(var _=0,K=n.length;_<K;_++){k=S((V=n[_]).id1);X=S(V.id2);E=e[k];F=e[X];E.level=g[E.c][b[k]];F.level=g[F.c][b[X]];var P=E.level,J=F.level;if(h(P)&&h(J)){V.level=Math.max(P,J);if(P<J){T[F.id]=1;L=E;H=F}else if(J<P){T[E.id]=1;L=F;H=E}}if((Y=Math.abs(P-J))>1)D(H,L,V);else if(o&&0===Y){O(E,F,V);I.push(V)}}if(o)for(u=0;u<a.length;u++){var j=d[u][0];1!==d[u].length||e[j].level||(e[j].level=g[u][b[j]])}else t(e,function(t,n){if(!T[n]&&!f[n]){for(var r,i=d[e[n].c],a=1/0,o=0;o<i.length;o++){var l=y.shortestPaths(n,i[o]);if(l.distance<a){r=l;a=l.distance}}for(var u=0;u<r.one.length;u++){var s=r.one[u],c=e[s];if(c&&"level"in c&&c.level<t.level){var g=U(t,t,c);t.level-c.level>1&&D(t,c,g);break}}}});return n}function x(e,n,r,i){for(var a,o,l,u,s=i(),c=0;c<r.length;c++){var f=s.distances(r[c]);t(f,function(t,n){"level"in e[n]||(e[n].level=1/0);e[n].level=Math.min(e[n].level,t)})}for(var d=0;d<n.length;d++){a=n[d].id1;o=n[d].id2;l=e[a];u=e[o];"level"in l&&"level"in u&&(n[d].level=Math.max(l.level,u.level))}}function C(e,n){var r={};function i(e,t,n,i){r[e]=r[e]||[];r[e][t]=r[e][t]||{};r[e][t][n]=r[e][t][n]||[];r[e][t][n].push(i)}t(e,function(e,t){"level"in e&&i(e.c,e.level,"vertices",t)});for(var a=0;a<n.length;a++)"level"in n[a]&&i(n[a].c,n[a].level,"edges",n[a]);return r}function G(e,n){var r={};function i(e,t,n,i){r[e]=r[e]||[];r[e][t]=r[e][t]||{vertices:[],edges:[]};for(var a=0;a<t;a++)r[e][a]=r[e][a]||{vertices:[],edges:[]};r[e][t][n]=r[e][t][n]||[];r[e][t][n].push(i)}t(e,function(e,t){"level"in e&&i(e.c,e.level,"vertices",t)});for(var a=0;a<n.length;a++)"level"in n[a]&&1===Math.abs(e[n[a].id1].level-e[n[a].id2].level)&&i(n[a].c,n[a].level,"edges",n[a]);return r}var w=Q();r.layout=function(e,n,r,i,a,o){n.trigger("prechange","layout");var l="^(standard|hierarchy|lens|sequential";l+="|radial|structural|tweak|"+E($o).join("|");l+=")$";if(!new RegExp(l).test(e))throw new Error("The layout name is not valid.");var u=Y(["standard","structural"]);w.setSeed(null);if(u[e]||a.consistent){var s=Z(a.fixed||[]),c=Y(a.fixed),f=0,d=0;if(s.length){t(c,function(e,t){if(t in r.v){f+=r.v[t].x;d+=r.v[t].y}});f/=s.length;d/=s.length}t(r.v,function(e,t){if(!c[r.v[t].id]){r.v[t].x=f;r.v[t].y=d}})}a.consistent&&w.setSeed(900736044081);switch(e){case"standard":q(n,r,i,a,o);break;case"hierarchy":T(n,r,i,a,o);break;case"lens":return Po(V).lens(n,r,a,te,w,o);case"sequential":L(n,r,i,a,o);break;case $o.organic:el(r).organic(n,a,te,o);break;case"structural":be(n,r,i,a,o);break;case"radial":T(n,r,i,a,o,K);break;case"tweak":ie(n,r,a,o)}};function W(e,t){for(var n=[],r=Z(e),i=0;i<r.length;i++)t[r[i]]&&n.push(r[i]);return n}function V(e){var t=Number(e);t=h(t)?t:5;t=Math.max(0,t);return t=Math.min(10,t)}function k(e){return 10*(5-V(e))}function X(e){var n=0,r=0;t(e,function(e){if("level"in e&&!y(e.id)){n+=e.size;r+=1}});return n/r}function F(e){var n=0;t(e,function(e){n=Math.max(n,e.length)});return n}function H(e,n){for(var r=[],i=F(e),a=0;a<i;a++){var o=0,l=0,u=0,s=0,c=0;t(e,function(e){if(e[a]){for(var t=e[a].vertices,r=0;r<t.length;r++){var i=t[r],u=n[i].size;l+=u;o=Math.max(o,u)}s+=t.length}});u=l/s;var f=r[a-1];f&&o<f.max+f.yOffset&&(c=(f.max+f.yOffset)/2);r[a]={max:o,average:u,sum:l,yOffset:c}}return r}function L(e,n,r,i,a){var l=A(i,{top:[],orientation:"down",spacing:"auto"}),u=l.level,s=50+k(l.tightness),c=l.orientation.match(/down|up/)?"w":"h",f=l.orientation.match(/down|up/)?"h":"w",d=n.v,g=n.e,h=v(d,g,r),p=[];if(!u)throw new Error("Sequential Layout: LayoutOptions is missing valid level property.");g=I(d,g,u,r,h,!0,p);var b,x,C,w=G(d,g);O();z();function Z(e,t,n,r){var i,a,o,l,u,s,c=!0,f=-1;for(i=0;i<n.length;i++){var g=n[i];if(!r&&d[g].barycenter===1/0){c=!1;break}var h=0,v=0;for(a=0;a<t.length;a++){l=-1;g===t[a].id1?l=t[a].id2:g===t[a].id2&&(l=t[a].id1);if(-1!==l)if(d[l].barycenter===1/0)c=!1;else{v++;-1!==(u=e.indexOf(l))&&(h+=u)}}d[g].prevPos=i;s=!0;v>0?d[g].barycenter=h/v:d[g].barycenter===1/0?c=!1:0===i?d[g].barycenter=0:s=!1;if(s){if(f+1<i){var m=n[f],p=Math.min(d[g].barycenter,d[m].barycenter),b=Math.abs(d[g].barycenter-d[m].barycenter)/(i-f);for(o=1;o<i-f;o++)d[n[f+o]].barycenter=p+b*o}f=i}}n.sort(function(e,t){return d[e].barycenter===d[t].barycenter?d[e].prevPos-d[t].prevPos:d[e].barycenter-d[t].barycenter});return c}function M(e,t,n){e.sort(function(e,r){var i=Math.max(t.indexOf(e.id1),t.indexOf(e.id2)),a=Math.max(n.indexOf(e.id1),n.indexOf(e.id2)),o=Math.max(t.indexOf(r.id1),t.indexOf(r.id2)),l=Math.max(n.indexOf(r.id1),n.indexOf(r.id2));return i<o||i===o&&a<l?-1:1})}function W(e,t){var n,r;if(t<1||e.length<=t)return 0;n=e[t].edges;(r=[e[t-1].vertices,e[t].vertices]).sort(function(e,t){return e.length-t.length});return V(n,r[1],r[0])}function V(e,t,n){
var r,i,a,o,l;if(e.length<2)return 0;M(e,t,n);r=e.map(function(e){var t=n.indexOf(e.id1);-1===t&&(t=n.indexOf(e.id2));return{index:t,multiplier:-1===t?0:e.numLinks}});i=1;for(;i<r.length;)i*=2;a=new Array(2*i-1);for(var u=0;u<a.length;u++)a[u]=0;i-=1;o=0;for(var s=0;s<r.length;s++){a[l=r[s].index+i]+=r[s].multiplier;for(;l>0;){l%2&&(o+=a[l+1]*r[s].multiplier);a[l=Math.floor((l-1)/2)]+=r[s].multiplier}}return o}function S(e,t,n,r){var i,a=o(t),l=[];a.forEach(function(t){l.push(t.id1===e?t.id2:t.id1)});r.forEach(function(e){a.push(e);i=e.id1===n?e.id2:e.id1;-1===l.indexOf(i)&&l.push(i)});return{verts:l,edges:a,common:t.length===r.length&&t===a.length}}function X(e,t){return S(e,d[e].childEdges||[],t,d[t].childEdges||[])}function E(e,t){return S(e,d[e].parentEdges||[],t,d[t].parentEdges||[])}function Y(e,t){var n,r,i,a,o,l,u=1,s=e[t].vertices,c=0,f=[],g=[];t>0&&(f=e[t-1].vertices);t<e.length-1&&(g=e[t+1].vertices);var h=0;for(n=0;n<s.length-1;n+=u){o=0;l=0;if(t>0){if(!(i=E(s[n],s[n+1])).common){i.verts.sort(function(e,t){return f.indexOf(e)-f.indexOf(t)});if(i.verts.length>1){o+=V(i.edges,i.verts,[s[n],s[n+1]]);l+=V(i.edges,i.verts,[s[n+1],s[n]])}}}else i={common:!0};if(t<e.length-1){if(!(a=X(s[n],s[n+1])).common){a.verts.sort(function(e,t){return g.indexOf(e)-g.indexOf(t)});if(a.verts.length>1){o+=V(a.edges,a.verts,[s[n],s[n+1]]);l+=V(a.edges,a.verts,[s[n+1],s[n]])}}}else a={common:!0};i.common&&a.common&&(d[s[n+1]].swapBlockStart=d[s[n]].swapBlockStart||n);if(l<o){var v=d[s[n]].swapBlockStart||n;r=s[v];s[v]=s[n+1];s[n+1]=r;d[s[v]].swapBlockStart=v;d[s[n+1]].swapBlockStart=v+1;c+=o-l;if(1===u){h=Math.max(h,n);u=-1}if(0===(n=v)){n=h;u=1}}else if(-1===u){n=h;u=1}}return c}function L(e){var t,n;do{n=0;for(t=0;t<e.length;t++)n+=Y(e,t)}while(n>0)}function z(){var e,n,r,i,a,l,u,s,c=!0;t(w,function(t,f){s=0;l=void 0;u=t.length;for(e=0;e<t.length;e++)if(t[e].vertices.length>0){u=e;break}if(u!==t.length-1){t[u].vertices.sort(function(e,t){return d[t].childEdges.length-d[e].childEdges.length});d[t[u].vertices[0]].barycenter=0;a=1/0;do{n=a;if(i){a=0;l=o(t)}else a=1/0;for(e=u;e<t.length-1;e++){r=Z(t[e].vertices,t[e+1].edges,t[e+1].vertices,!0);if(c){Z(t[e+1].vertices,t[e+1].edges,t[e].vertices,!1);r=Z(t[e].vertices,t[e+1].edges,t[e+1].vertices,!1)}}i=r;for(e=t.length-1;e>u;e--){r=Z(t[e].vertices,t[e].edges,t[e-1].vertices,e<s+2);if(c){Z(t[e-1].vertices,t[e].edges,t[e].vertices,!1);r=Z(t[e].vertices,t[e].edges,t[e-1].vertices,!1)}else a+=W(t,e);r||(i=!1)}c=!i}while(s++<100&&(a===1/0||a<n));l&&(w[f]=l);a>0&&g.length<1e4&&L(w[f])}})}function T(e,t,n){return e[n]&&e[n].edges?e[n].edges.filter(function(e){return e.id1===t||e.id2===t}):[]}function O(){var e,n;t(w,function(t){for(e=0;e<t.length;e++){var r=t[e].vertices;for(n=0;n<r.length;n++){var i=r[n];d[i].barycenter=1/0;d[i].childEdges=T(t,i,e+1);d[i].parentEdges=T(t,i,e)}}})}function K(){var e,n;t(w,function(t){for(e=0;e<t.length;e++){var r=t[e].vertices;for(n=0;n<r.length;n++){var i=r[n];d[i].orderPos=n;d[i].children=N(w,d,i);d[i].parents=D(w,d,i)}}})}function P(e,t,n,r){var i,a,o=t,l=t.filter(function(e){return y({id:e})});l.length>0&&(o=l);a=o.length;e.root=e;e.align=e;if(a>0){var u=[Math.floor((a+1)/2)-1,Math.ceil((a+1)/2)-1];for(i=0;i<2;i++){var s=n?u[i]:u[1-i],c=d[o[s]],f=c.orderPos;if(n&&r<f||!n&&r>f){c.align=e;e.root=c.root;e.align=e.root;return f}}}return r}function J(e,t,n){var r,i,a,o,l,u,f="l"===t[1];if(void 0===e[t]){r=e;e[t]=0;do{var g=-1;f&&r.orderPos>0?g=r.orderPos-1:!f&&r.orderPos<n[r.level].vertices.length-1&&(g=r.orderPos+1);if(-1!==g){J(a=(i=d[n[r.level].vertices[g]]).root,t,n);e.sink.id===e.id&&(e.sink=a.sink);o=r[c];l=i[c];if("h"===c)if(f){l+=2*i.labeloff;o-=2*r.labeloff}else{l-=2*i.labeloff;o+=2*r.labeloff}u=(o+l)/2+s;e.sink.id!==a.sink.id?a.sink.shiftData.push({vert:e.sink,dist:e[t]-a[t]-u}):e[t]=Math.max(e[t],a[t]+u)}r=r.align}while(r.id!==e.id)}}function j(e,t){e[t]=e.root[t];if(e.root.id===e.id){var n=e.root.sink.shift;if(!n){var r=e.root.sink.shiftData;n=1/0;for(var i=0;i<r.length;i++){var a=r[i].dist;r[i].vert.shift<1/0&&(a+=r[i].vert.shift);n=Math.min(n,a)}e.root.sink.shift=n}n<1/0&&(e[t]+=n)}}function Q(e,t){var n,r,i,a,o=[],l=1/0,u=-1/0,s="l"===t[1],c="u"===t[0],f=c?0:e.length-1,g=c?1:-1,h=function(t){return c?t<e.length:t>=0},v=function(e){return s?0:e.length-1},m=s?1:-1,p=function(e,t){return s?e<t.length:e>=0};for(n=f;h(n);n+=g){i=e[n].vertices;var b=-1;s||n===f||(b=e[n-g].vertices.length);for(r=v(i);p(r,i);r+=m){a=d[i[r]];var y=c?a.parents:a.children;R(a,t)&&(a[t]=void 0);b=P(a,y,s,b);o.push(a);a.sink=a;a.shiftData=[];a.shift=void 0}}for(r=0;r<o.length;r++)(a=o[r]).root.id===a.id&&J(a,t,e);for(r=0;r<o.length;r++){j(a=o[r],t);l=Math.min(l,a[t]);u=Math.max(u,a[t])}if(!s){q(e,t);return{max:-l,min:-u}}return{max:u,min:l}}function q(e,t){for(var n=0;n<e.length;n++)for(var r=e[n].vertices,i=0;i<r.length;i++){d[r[i]][t]*=-1}}function $(e){var t=Q(e,"ul"),n=Q(e,"ur"),r=Q(e,"dl"),i=Q(e,"dr"),a=[t,n,r,i].sort(function(e,t){return e.max-e.min-(t.max-t.min)});function o(e,t){return e-t}for(var l=0;l<e.length;l++)for(var u=e[l].vertices,s=0;s<u.length;s++){var c=d[u[s]],f=[c.ul-t.min+a[0].min,c.ur-n.max+a[0].max,c.dl-r.min+a[0].min,c.dr-i.max+a[0].max].sort(o);c.x=(f[1]+f[2])/2}}function ee(e){var t,n;for(t=0;t<e.length;t++){var r=0,i=e[t].vertices;for(n=0;n<i.length;n++){var a=d[i[n]];if(!y(a)){var o=a[c]/2,l="h"===c?a.labeloff:0;r+=o-l;a.x=r;r+=o+l+s}}var u=(r-s)/2;for(n=0;n<i.length;n++)d[i[n]].x-=u}}function ne(e){var t,n,r,i,a=[],o=[],l=0;for(t=0;t<e.length;t++){r=e[t].vertices;a[t]=0;o[t]=0;for(n=0;n<r.length;n++)if(!y(i=d[r[n]])){a[t]+=i[c];o[t]++}var u=a[t]+s*(o[t]-1);l=Math.max(l,u)}for(t=0;t<e.length;t++){r=e[t].vertices;if(o[t]>1){var f=(l-a[t])/(o[t]-1),g=0;for(n=0;n<r.length;n++)if(!y(i=d[r[n]])){var h=i[c]/2,v="h"===c?i.labeloff:0;g+=h-v;i.x=g;g+=h+v+f}}else for(n=0;n<r.length;n++)y(i=d[r[n]])||(i.x=l/2)}}function re(e){var n,r,i,a=1/0,o=-1/0,l=ie(),u=F(w);for(n=0;n<h.length;n++)t(h[n].verts,function(e){a=Math.min(a,e.x);o=Math.max(o,e.x)});r=(o-a)/(e*u);r=Math.max(r,l);t(w,function(e){i=0;for(var t=0;t<e.length;t++){for(var n=e[t].vertices,a=0;a<n.length;a++){C=n[a];d[C].y=i}i+=r}});return r}function ie(){var e,t,n=0,r=H(w,d),i=[];for(e=0;e<g.length;e++){var a=g[e].level,o=g[e].arrowSize;i[a]=Math.max(i[a]||0,2*o)}for(t=0;t<r.length;t++){var l=r[t].max,u=0;r[t+1]&&(u=r[t+1].max);var c=i[t]||0;n=Math.max(n,l+u+s+c)}return n}function oe(e){var t,n,r,i,a={};i="equal"===l.spacing||"stretched"===l.spacing?function(e){return e.c}:function(){return 0};function o(e,t){return Number(e)-Number(t)}for(t=0;t<p.length;t++){var u=p[t];u.links.sort(function(e,t){return(B(e.off)?e.off*e.sign:1/0)-(B(t.off)?t.off*t.sign:1/0)});var c=0,h=0,v=0,m=!0,b=w[i(u)][u.level].vertices,I=b.indexOf(u.id1),x=b.indexOf(u.id2),C=[I,x].sort(o);for(n=C[0]+1;n<C[1];n++){var G=d[b[n]];y(G)||(m=!1);for(r=0;r<G.parentEdges.length;r++)c+=G.parentEdges[r].numLinks;for(r=0;r<G.childEdges.length;r++)h+=G.childEdges[r].numLinks;var Z=(G[f]||G.size)/2;v=Math.max(v,Z)}if(!m){if(h===c){c=d[b[C[0]]].parentEdges.length+d[b[C[1]]].parentEdges.length;h=d[b[C[0]]].childEdges.length+d[b[C[1]]].childEdges.length}var A=I<x?1:-1;h<c&&(A*=-1);l.orientation.match(/right|up/)&&(A*=-1);var R=v+20,M=40,W=e/2;R+=Math.abs(d[u.id1].x-d[u.id2].x)/s;(R=Math.min(R,W))+(u.links.length-1)*M>W&&(M=Math.max(10,(W-R)/(g.links.length-1)));for(n=0;n<u.links.length;n++){var V=u.links[n],S=R+n*M;a[V.id]={off:A*V.sign*S}}}}return a}K();var le=l.ratio;"right"!==l.orientation&&"left"!==l.orientation||(le=1/le);var ue=[];if("equal"===l.spacing||"stretched"===l.spacing)for(var se=0;se<h.length;se++)ue[se]=h[se].verts;else{var ce=[],fe=[];ue[0]={};t(w,function(e,t){for(b=0;b<e.length;b++){ce[b]||(ce[b]={vertices:[],edges:[]});if(fe[b]){x=e[b].vertices;for(var n=0;n<x.length;n++){C=x[n];d[C].orderPos+=fe[b]}}ce[b].vertices=ce[b].vertices.concat(e[b].vertices);ce[b].edges=ce[b].edges.concat(e[b].edges);fe[b]=ce[b].vertices.length}ue[0]=U(ue[0],h[t].verts)});(w={})[0]=ce}var de=0;t(w,function(e,n){"equal"===l.spacing?ee(e):"stretched"===l.spacing?ne(e):$(e);var r=m(ue[n]);de-=r.x1;t(ue[n],function(e,t){d[t].x+=de});de+=r.x2+s});var ge=oe(re(le));if(l.orientation.match(/up|right|left/)){var he=_(l.orientation);t(w,function(e){for(b=0;b<e.length;b++){x=e[b].vertices;for(var t=0;t<x.length;t++){C=x[t];he(d[C])}}})}var ve=[],me=n.extents;te(e,d,ge,me,ve,l,a)}function T(e,n,r,i,a,o){var l=A(i,{top:[],orientation:"down",stable:!0,flatten:!1}),u=l.level,s=o?1:k(l.tightness),c=l.top,f=l.tidy,d=!o&&l.flatten,g=n.v,h=n.e,m=n.extents,p=v(g,h,r);if(u)h=I(g,h,u,r,p,!1);else{c=W(c,g);x(g,h,c,r)}var b=C(g,h),y=X(g),G=H(b,g);function w(){var e,n;t(b,function(t){for(var r=t.length-1;r>=0;r--)for(var i=t[r].vertices,a=[],o=0;o<i.length;o++){n=i[o];var l=N(b,g,n);g[n].children=[];g[n].subChildrenCount=0;if(0!==l.length){var u=[];for(e=0;e<l.length;e++)a.indexOf(l[e])<0&&u.push(l[e]);if(u.length>0){g[n].children=u;g[n].subChildrenCount=Z(u);for(e=0;e<u.length;e++){a.push(u[e]);g[u[e]].parent=n}}}}})}function Z(e){for(var t=0,n=0;n<e.length;n++){var r=g[e[n]].subChildrenCount;t+=0===r?1:r}return t}var B=2*y+24+s;function R(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*(B/2),i=e.children;if(i)for(var a=0;a<i.length;a++){var o=g[i[a]],l=o.subChildrenCount;0===l&&(l=1);var u=r+l*B;R(o,(u+r)/2,!1);r=u}}function M(e,t,n){for(var r,i=t.miny,a=Math.PI*(2/3),o=0,l=0;l<b[e].length;l++){var u=b[e][l].vertices,s=G[l].yOffset,c=G[l].average,f=2*((y<c?c:y)+12)+s;i+=o;for(var d=0;d<u.length;d++){r=u[d];var h=g[r];h.y=i;if(!n){var v=h.children;if(v&&v.length>1){var m=V(S(v.map(function(e){return g[e]})),a);f=Math.max(f,m)}}}o=f}}function V(e,t){return e/(2*Math.tan(t/2))}function S(e){for(var t=1/0,n=-1/0,r=0;r<e.length;r++){var i=e[r].x;t=Math.min(t,i);n=Math.max(n,i)}return n-t}function E(e,t){for(var n=_(t),r=0;r<b[e].length;r++)for(var i=b[e][r].vertices,a=0;a<i.length;a++)n(g[i[a]])}w();var F={},Y={};t(b,function(e,t){var n=Number(t);F[n]=fe(p[n].verts);Y[n]={children:b[t][0].vertices,subChildrenCount:Z(b[t][0].vertices)}});t(b,function(e,t){R(Y[t],F[t].x,!0);M(t,F[t],d)});t(b,function(e,t){o||E(t,l.orientation)});o&&o(g,b,p,F,y,l.tightness);var L=[];f?ee(e,g,p,0,1,m,L,l,a):te(e,g,{},m,L,l,a)}function N(e,t,n){var r,i,a,o,l=t[n].c,u=t[n].level+1,s=e[l][u],c={},f=[];if(s){for(a=0;a<s.edges.length;a++){var d=s.edges[a];r=d.id1+"";i=d.id2+"";r===n&&(c[i]=1);i===n&&(c[r]=1)}var g=s.vertices;for(o=0;o<g.length;o++)c[r=g[o]+""]&&f.push(r)}return f}function D(e,t,n){var r=[],i=t[n].level;if(i>0){var a,o,l,u=t[n].c,s=e[u][i],c={};if(s&&s.edges){for(o=0;o<s.edges.length;o++){var f=s.edges[o];f.id1===n?c[f.id2]=1:f.id2===n&&(c[f.id1]=1)}var d=e[u][i-1];if(d&&d.vertices)for(l=0;l<d.vertices.length;l++)c[a=d.vertices[l]]&&r.push(a)}}return r}function _(e){var t={up:function(e){e.y=-e.y;e.x=e.x},down:function(){},right:function(e){var t=e.y;e.y=e.x;e.x=t},left:function(e){var t=e.y;e.y=e.x;e.x=-t}};return t[e]||t.down}function K(e,n,r,i,a,o){function l(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function s(e,t,n,r){if(r&&1===e.length)return 0;var i=t,a=i;for(c=1;c<e.length;c++)a=Math.max(l(g[e[c]],g[e[c-1]]),a);return u(a,a-i,n)}var c,f,d,g,h=k(o);t(n,function(t,n){var o=fe(r[Number(n)].verts),l=0,u=l,v=4*a,m=v,p=2*a+24;for(f=0;f<t.length;f++){var b,y=t[f].vertices;g=[];for(c=0;c<y.length;c++){d=y[c]+"";var I=(b=e[d]).x-o.minx,x=o.maxx-o.minx+p;if((I*=2*Math.PI/x)<0||I>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");g[d]={a:I,r:b.size}}u=l;0===f?y.length>1&&(l+=v/2):l+=v;if((l=s(y,l,h,f<1))-u>m){m=l-u+1;v=Math.max(v,m/2);0===f&&y.length<3&&(l/=2)}for(c=0;c<y.length;c++){(b=e[y[c]+""]).x=i[Number(n)].x+l*Math.cos(g[b.id].a);b.y=i[Number(n)].y+l*Math.sin(g[b.id].a)}}})}function P(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(n),a=Math.max(r,i)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var l=o*n*Math.log(n),u=1/j(t);return{repulsionFactor:40*Math.max(1,Math.pow(u,2)),coeff:1,naturalDistance:20*u,iterations:o,chunk:20,temperature:a,temp:a,estTime:l}}function j(e){var t=V(e.tightness);return Math.pow(2,.4*(t-5))}function q(e,t,n,r,i){var a=t.v,o=t.vcount,l=t.e,u=v(a,l,n),s=t.extents,f=r.fixed||[],d=r.tidy;ce(a);var g=u.length,h=0,m=d?o/(o+g):1;e.trigger("progress","layout",0);for(var p,b=[],y=0,I=Date.now(),x=0;x<u.length;x++){var C=P(u[x],r);y+=C.estTime;b.push(C)}for(var G=0,w=0;w<u.length;w++){b[w].start=G;var Z=G+(m-h)*(b[w].estTime/y);b[w].stop=Z;G=Z}var A=0;function B(t){var n=t,r=u[n],i=b[n];le(e,r,i,i.start,i.stop,function(){se(r.verts);A++;if(++n<u.length){p=Date.now();if(p-I>16||A>1e3){I=p;A=0;c(function(){B(n)},0)}else B(n)}else R()})}function R(){d?ee(e,a,u,m,1,s,f,r,i):te(e,a,{},s,f,r,i)}u.length>0?B(0):te(e,a,{},s,f,r,i)}function $(e){return E(e).some(function(e){return e.fixed})}function ee(e,n,r,i,a,o,l,u,s){for(var c={},f=[],d={},g=1/0,h=1/0,v=0;v<r.length;v++){var m=de(r[v].verts);c[v]=m;var p=l.length>0&&$(r[v].verts);f.push({x:m.x,y:m.y,width:m.width,height:m.height,id:v,fixed:p});d[v]={x:m.x,y:m.y};g=Math.min(g,d[v].x);h=Math.min(h,d[v].y)}var b=A(u,{strategy:"rect",ratio:4/3});Re(f,{strategy:b.strategy,step:30,max:2,sort:!1,ratio:b.ratio,tightness:b.tightness},function(r){g="rect"===b.strategy?g:0;h="rect"===b.strategy?h:0;for(var i={},a=0;a<r.length;a++){i[r[a].id]=r[a];i[r[a].id].x+=g;i[r[a].id].y+=h}t(n,function(e){var t=i[e.c].x-d[e.c].x,n=i[e.c].y-d[e.c].y;e.x+=t;e.y+=n});te(e,n,{},o,l,b,s)})}function te(e,t,n,r,i,a,o){var l=m(t);0===i.length&&(l=ue(t,r,l));h(l.x1)||(l=null);if(!o)return{vertices:t,updatedEdges:n,extents:l};c(function(){e.trigger("progress","layout",1);o({vertices:t,updatedEdges:n,extents:l},a)})}function ne(e,t,n){re(e[t.id1],e[t.id2],n)}function re(e,t,n){var r,i,a;if(!e.fixed||!t.fixed){var o=2*w.next()*Math.PI;a=1.3*ge(e,t,n)/2;if(e.fixed||t.fixed){r=e.fixed?e.x:t.x;i=e.fixed?e.y:t.y;a*=2}else{r=(e.x+t.x)/2;i=(e.y+t.y)/2}if(!e.fixed){e.x=r+a*Math.cos(o);e.y=i+a*Math.sin(o);o+=Math.PI}if(!t.fixed){t.x=r+a*Math.cos(o);t.y=i+a*Math.sin(o)}}}function ie(e,t,n,r){var i={temperature:10,i:0},a={verts:t.v,edges:t.e},o=P(t,n);o.chunk=5;o.iterations=5;i.temperature=Math.pow(o.temperature,.72);oe(i,a,o);var l=m(a.verts);h(l.x1)||(l=null);e.trigger("progress","layout",1);r({vertices:a.verts,extents:l},n,!1)}function oe(e,n,r){for(var i=Math.min(e.i+r.chunk,r.iterations);e.i<i;){var a=n.verts,o=n.edges,l=0;t(a,function(e){e.dx=0;e.dy=0;l++});ce(a,2);if(1===l){e.i=i;return}if(2===l){if(o[0])ne(a,o[0],r.naturalDistance);else{var u=E(a);re(u[0],u[1],r.naturalDistance)}e.i=i;return}me(a,r.repulsionFactor);for(var s=0;s<o.length;s++)he(o[s],a,r.naturalDistance,r.coeff);var c=e.temperature*(1-e.i/r.iterations);t(a,function(e){ve(e,c)});e.i++}}function le(e,t,n,r,i,a){var o={i:0,temperature:n.temperature};function l(){return r+(i-r)*(o.i/n.iterations)}function u(){return o.i>=n.iterations}function s(){oe(o,t,n)}function f(){s();if(u())a();else{e.trigger("progress","layout",l());c(f,0)}}f()}function ue(e,n,r){var i=(r.x1+r.x2)/2-(n.x1+n.x2)/2,a=(r.y1+r.y2)/2-(n.y1+n.y2)/2;t(e,function(e){e.x-=i;e.y-=a});return{x1:r.x1-i,y1:r.y1-a,x2:r.x2-i,y2:r.y2-a}}function se(e){var n,r,i,a=0,o=0,l=0,u=!1,s=0,c=0;t(e,function(e){a+=e.x;o+=e.y;l+=1;u=u||e.fixed});if(!(l<3||u)){a/=l;o/=l;t(e,function(e){if((n=Math.sqrt((e.x-a)*(e.x-a)+(e.y-o)*(e.y-o)))>c){c=n;s=Math.atan2(e.y-o,e.x-a)}});s=-s;var f=Math.sin(s),d=Math.cos(s);t(e,function(e){r=a+(e.x-a)*d-(e.y-o)*f;i=o+(e.x-a)*f+(e.y-o)*d;e.x=r;e.y=i})}}function ce(e,n){var r=n||30;t(e,function(e){if(!e.fixed){e.x+=r*(w.next()-.5);e.y+=r*(w.next()-.5)}})}function fe(e){var n=0,r=0,i=0,a=1/0,o=1/0,l=-1/0,u=-1/0;t(e,function(e){n+=1;r+=e.x;i+=e.y;o=Math.min(o,e.x);a=Math.min(a,e.y);l=Math.max(l,e.x);u=Math.max(u,e.y)});r/=n;i/=n;var s=0,c=!1;t(e,function(e){var t=e.x-r,n=e.y-i,a=Math.sqrt(t*t+n*n);s=Math.max(a+1.5*e.size,s);c=c||e.fixed});return{x:r,y:i,sum:n,size:s,fixed:c,miny:a,minx:o,maxy:u,maxx:l}}function de(e,n){var r=M(n)?{}:n,i=20,a=1/0,o=1/0,l=-1/0,u=-1/0;t(e,function(e,t){if(!(t in r)){o=Math.min(o,e.x-e.size);a=Math.min(a,e.y-e.size);l=Math.max(l,e.x+e.size);u=Math.max(u,e.y+e.size)}});return{x:o-=i,y:a-=i,width:(l+=i)-o,height:(u+=i)-a}}function ge(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function he(e,t,n,r){var i=t[e.id1],a=t[e.id2],o=i.x-a.x,l=i.y-a.y,u=ge(i,a,n),s=O(o,l);if(s>.02){var c=r*((s-u)/s),f=o*c,d=l*c;i.dx-=f;i.dy-=d;a.dx+=f;a.dy+=d}}function ve(e,t){if(!e.fixed){var n=O(e.dx,e.dy),r=e.dx/n*Math.min(n,t),i=e.dy/n*Math.min(n,t);e.x+=r;e.y+=i}}function me(e,n){var r,o,s,c,f=fe(e);r=f.minx;s=f.miny;var d=(o=f.maxx)-r,g=(c=f.maxy)-s;d>g?c=s+d:o=r+g;function h(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function v(e,t){var n=e.x1,r=e.y1,i=e.x2,a=e.y2,o=.5*(n+i),l=.5*(r+a),u=t.x>=o,s=t.y>=l,c=(s?2:0)+(u?1:0);e.leaf=!1;u?n=o:i=o;s?r=l:a=l;e.nodes[c]||(e.nodes[c]=h(n,r,i,a));m(e.nodes[c],t)}function m(e,t){if(e.leaf){var n=e.point;if(n){if(Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01){v(e,t);return}e.point=null;v(e,n);v(e,t);return}e.point=t}else v(e,t)}function p(e,t){if(!e(t))for(var n=t.nodes,r=0;r<4;r++)n[r]&&p(e,n[r])}function b(e){var t=0,n=0;e.charge=0;e.size=0;if(!e.leaf)for(var r=e.nodes,i=0;i<4;i++){var a=r[i];if(a){b(a);e.charge+=a.charge;e.size+=a.size;t+=a.charge*a.cx;n+=a.charge*a.cy}}if(e.point){var o=w(e.point);e.pointCharge=o;e.charge+=o;e.size+=e.point.size;t+=o*e.point.x;n+=o*e.point.y}e.cx=e.charge?t/e.charge:0;e.cy=e.charge?n/e.charge:0}var y,I=.5;function x(e){if(e.point!==y){var t=e.cx-y.x,n=e.cy-y.y,r=1/O(t,n);if((e.x2-e.x1)*r<I){G(y,e,e.charge,r,t,n);return!0}e.point&&G(y,e.point,e.pointCharge,r,t,n)}return!e.charge}var C=1e5;function G(e,t,n,r,i,a){Z(e,n,i,a,Math.min(r,C))}function w(e){return a*Math.pow(e.size,l)/u*(1+(e.lc?e.lc:1)/3)}function Z(e,t,r,a,o){if(!(o<i)){var l=n*w(e)*t*o*o*o;e.dx-=r*l;e.dy-=a*l}}var A=h(r,s,o,c);t(e,function(e){m(A,e)});function B(){t(e,function(e){y=e;p(x,A)})}b(A);B();return A}function pe(e,t,n,r,i,a){e[t]=r?n[t]:{x:i,y:a}}function be(e,n,r,i,a){var o=1.25-(V(i.tightness)-5)/10,l=Ie(n.v,n.e);q(e,ye(l,n.v,o),r,i,function(e,r,i){var o={};t(e.vertices,function(e,t){if(l.rev[t])for(var r=e.fixed,i=0;i<l.rev[t].length;i++){var a=l.rev[t][i],u=e.x,s=e.y;if(e.jit.positions){u+=e.jit.positions[a].x;s+=e.jit.positions[a].y}pe(o,a,n.v,r,u,s)}else pe(o,t,n.v,n.v[t].fixed,e.x,e.y)});var u={vertices:o,extents:e.extents};a(u,r,i)})}function ye(r,i){var a,o,l={},u=[],s=0;t(r.rev,function(a,o){for(var c={x:0,y:0,size:0},f=a.length,d=!1,g=0;g<f;g++){var h=i[a[g]];c.x+=h.x;c.y+=h.y;c.size+=h.size}c.x/=f;c.y/=f;var v=document.createElement("canvas").getContext("2d"),m=Ko(),p=E(i).filter(function(e){return r.rev[o].indexOf(e.id)>-1}).map(function(t){t.r=n.nodeSize(e.privateGetItem(t.id),v,!1).radius;t.rwt=n.nodeSize(e.privateGetItem(t.id),v,!0).radius;t.labelOffset=0;return t}),b=0,y=0;p.forEach(function(e){b+=e.r;y+=e.rwt});var I=(y-b)/p.length,x=.5,C={positions:z(p=m.concentricLayout(p,{padding:Math.max(8,I*x)}))},G=n.getExtents(p,v,0).r;l[o]={x:c.x,y:c.y,size:G,fixed:d,jit:C,lc:0};s++;for(var w=a[0],Z={},A=r.index[w],B=0;B<A.length;B++){var R=A[B];Z[r.ids[R]]=1}t(Z,function(e,t){o<t&&u.push({id1:o,id2:t})})});for(var c=0;c<u.length;c++){a=u[c].id1+"";o=u[c].id2+"";l[a].lc++;l[o].lc++}t(i,function(e,t){if(!r.ids[t]){l[t]={x:e.x,y:e.y,size:e.size,lc:0,fixed:e.fixed,jit:{radius:e.size,position:{x:0,y:0}}};s++}});return{v:l,e:u,vcount:s,extents:m(l)}}function Ie(e,t){return we(Ge(t))}function xe(e,t,n){e[n]||(e[n]=[]);e[n].push(t)}function Ce(e,t){xe(e,t.id1,t.id2);xe(e,t.id2,t.id1)}function Ge(e){for(var t={},n=0;n<e.length;n++)Ce(t,e[n]);return t}function we(e){var n,r={},i={};t(e,function(e,t){e.sort();n="";for(var a=0;a<e.length;a++)n+=e[a];r[n]||(r[n]=[]);r[n].push(t);i[t]=n});return{rev:r,ids:i,index:e}}function Ze(e,t,n,r){var i,a,o={},l=0,u=t.length-1;do{i=Ae(e,t,n,u,o,r);l=Math.max(i.radius,l);u=i.index}while(u>=0);switch(t.length){case 4:a=2;break;case 3:a=2.5;break;case 2:a=3;break;case 1:a=1;break;default:a=2}return{positions:o,radius:l*a}}function Ae(e,t,n,r,i,a){var o=r;if(0===o){i[t[0]]={x:0,y:0};return{radius:n,index:-1}}var l=(o+1)*n,u=n,s=Math.sqrt(l/(Math.PI*u))*u,c=Math.floor(2*Math.PI*s/n);c=Math.min(c,o+1);var f=2*Math.PI/c,d=0;switch(c){case 2:d=Math.PI/2;s*=.75;break;case 3:d=Math.PI/3;s*=.85;break;case 4:d=0;s*=.85;break;case 5:d=0;s*=.9;break;default:d=0}s*=a;for(var g=0;g<c;){i[t[o-g]]={x:s*Math.cos(d),y:s*Math.sin(d)};d+=f;g++}return{radius:s,index:o-=c}}function Be(e,t,n,r){var i,a=0,o={};for(i=0;i<t.length;i++)a+=e[t[i]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var l=Math.PI/4;2===t.length&&(l=Math.PI/2);4===t.length&&(l=0);t.length<4&&(a*=1.5);var u=2*Math.PI/t.length,s=r*a/4;for(i=0;i<t.length;i++){o[t[i]]={x:s*Math.cos(l),y:s*Math.sin(l)};l+=u}}return{positions:o,radius:a}}r.arrange=function(r,i,a,o,l,u,s,c){function f(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function d(e,t,n,r,i){var a;for(a=0;a<e.length;a++)if(e[a].id===t){e[a].x=n-e[a].width/2;e[a].y=r-e[a].height/2;break}return i(e)}var g,h,m,p={tidy:function(e,t,n){return Me(e,{step:30,max:2,sort:!1,ratio:t.ratio},n)},average:function(e,t,n){return d(e,t.specialId,t.centre.x,t.centre.y,n)},absolute:function(e,t,n){return d(e,t.specialId,t.absolute.x,t.absolute.y,n)}},b={privateConcentric:function(t){var r=Ko(),i=e.privateGetItem(t).map(function(e){return{id:e.id,x:0,y:0,r:n.nodeSize(e,u,C.includeLabel).radius,labelOffset:n.labelOffset(e)}});return z(i=r.concentricLayout(i,{padding:C.padding}))},grid:function(e,t,n,r){var i=2*n+24+r,a=0,o=0,l=Math.floor(Math.sqrt(e.length)),u=Math.ceil(e.length/l),s={};for(g=0;g<l;g++){for(h=0;h<u;h++){var c=u*g+h;e[c]&&(s[e[c]]={x:a,y:o});a+=i}a=0;o+=i}return s},circle:function(e,t,n,r){return Be(t,e,n,1.25-(5-r)/50).positions},radial:function(e,t,n,r){return Ze(t,e,n,1.25-(5-r)/50).positions}},y="#arranged#";function I(e,t,n,r,i){var a={},o=[],l={};for(g=0;g<e.length;g++){l=de(e[g].verts,t);if(isFinite(l.width)){o.push({x:l.x,y:l.y,width:l.width,height:l.height,id:g});a[g]={x:l.x,y:l.y}}}l=de(t);o.push({x:l.x,y:l.y,width:l.width,height:l.height,id:y});a[y]={x:l.x,y:l.y};B(o,{ratio:C.ratio,centre:n,absolute:r,specialId:y},function(e){return i({packed:e,original:a})})}function x(e,n,r){var i,a;t(e,function(e){if(e.arranged){i=r[y].x-n[y].x;a=r[y].y-n[y].y}else{i=r[e.c].x-n[e.c].x;a=r[e.c].y-n[e.c].y}e.x+=i;e.y+=a})}var C=A(s,{tightness:5,position:"average",x:0,y:0});i.trigger("prechange","arrange");var G=o.v,w=k(C.tightness),B=p[C.position]||p.average,R=b[r]||b.grid,M={x:Number(C.x)||0,y:Number(C.y)||0},W={x:0,y:0},V=Z(a);if((V=f(G,V)).length){m=0;for(g=0;g<V.length;g++){m+=G[V[g]].size;W.x+=G[V[g]].x;W.y+=G[V[g]].y}m/=V.length;W.x/=V.length;W.y/=V.length;var S=R(V,G,m,w),X={};t(S,function(e,t){G[t].x=e.x;G[t].y=e.y;X[t]=G[t];X[t].arranged=1});I(v(G,o.e,l),X,W,M,function(e){for(var t=e.packed,n=e.original,r={},a=0;a<t.length;a++)r[t[a].id]=t[a];x(G,n,r);var l=[],u=o.extents;te(i,G,{},u,l,C,c)})}else c()};function Re(e,t,n){function r(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function i(e,t,n){return(t-e)*n+e}function a(e,t,n){return(e-n)/(t-n)}function o(e){var n=1.1,r=1.03,i=10,a=function(){for(var t=0,n=-1/0,r=0;r<e.length;r++){t+=e[r].width*e[r].height;n=Math.max(n,e[r].width)}return{area:t,maxWidth:n}}(),o=Math.sqrt(a.area*n/t.ratio)*r,l=o*t.ratio;l<a.maxWidth+i&&(l=a.maxWidth+i);return{x:0,y:0,width:l,height:o}}function l(e,t,n,r,o,l){var u=a(t,n,r);return i(l,o,u=Math.pow(u,e))}function u(e,t){if(!t)return!1;var n=e.x<m.x+m.width,r=e.x+e.width>m.x,i=e.y<m.y+m.height,a=e.y+e.height>m.y;return(n||r)&&(i||a)}function s(e,t){if(t.length<1)return!1;function n(t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}var i,a;for(i=0;i<t.length;i++)if(r(a=t[i])&&n(a))return!0;return!1}var c,f,g,h={spiral:function(e){var t=l(.6,e,100,0,y,1),n=l(1,e,600,0,.3,.5)*e;return{x:Math.cos(n)*t,y:Math.sin(n)*t}},controlled:function(e,t){for(var n;!u(t,n);)n=h.random(e);return n},rect:function(e){return Me(e,t,n)},random:function(e){var t=.5*e;return{x:r()*t,y:r()*t}}},v=0,m=o(e),p=[],b=h[t.strategy]||h.rect,y=0;for(c=0;c<e.length;c++){f=e[c];y+=f.width}y/=2*e.length;if("rect"===t.strategy)return b(e);e.sort(d);for(c=0;c<e.length;c++){(f=e[c]).x=f.fixed?f.x:0;f.y=f.fixed?f.y:0;for(;s(f,p)&&!f.fixed;){g=b(v,f);f.x=g.x;f.y=g.y;v++}p.push(f)}return n(p)}function Me(e,t,n){function r(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function i(e,t){var n=d(e,t);return n||t.height-e.height}function a(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function l(e){for(var t=o(e),n=0;n<t.length;n++){var r=t[n].width%f.step,i=t[n].height%f.step;0!==r&&(t[n].width+=f.step-r);0!==i&&(t[n].height+=f.step-i)}return t}function u(e){return!v||e.ratio()>=f.ratio-.2&&e.ratio()<=f.ratio}function s(e){for(var t=k(f.tightness),n=0;n<e.length;n++){e[n].width+=t;e[n].height+=t}}function c(e){var t=1.1,n=1.03,r=10,i=Math.sqrt(e.area()*t/f.ratio)*n,a=i*f.ratio;a<e.maxWidth+r&&(a=e.maxWidth+r);return{width:a,height:i,lowestFreeHeightDeficit:0,ratio:function(){return p.width/p.height}}}var f=A(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5});f.sort&&e.sort(i);s(e);var g,h=l(e),v=!0;if(0!==e.length){var m={area:r,maxWidth:a(h),maxHeight:h[0].height},p=c(m),b=0;J(function(){return p.width>=m.maxWidth},function(){var e=We(h,p);if(0===e.comps.length){p.width*=1.03;p.height*=1.03}else{b++;if(!g||u(e)){(g=e).efficiency=m.area()/e.area();if(u(e))return!0}if(b>=f.max)return!0}return!1},function(){return n(g.comps)})}else{g=Ve();n(g.comps)}}function We(e,t){var n,r=Ve();t.canvas||(t.canvas=Se());for(var i=t.canvas.setDimensions(t.width,t.height),a=0,o=0,l=0;l<e.length;l++){var u=e[l];if(!(n=i.addRect(u.width,u.height)).placed){r.width=0;r.height=0;r.comps.length=0;r.lowestHeightFlushedRightItem=0;break}u.x=n.offsetX;u.y=n.offsetY;r.comps.push(u);u.y+u.height>r.height&&(r.height=u.y+u.height);u.x+u.width>r.width&&(r.width=u.x+u.width);var s=u.width+u.x;if(s>o||s===o&&u.height>a){r.lowestHeightFlushedRightItem=n.lfhd;a=u.height;o=s}}t.lowestFreeHeightDeficit=i.lfhDeficitSinceLastRedim();return r}function Ve(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function Se(){var e=0,t=ke(),n=Xe;function r(e,t){return t-(c.height-e)}function i(e,n,r){if(r.leftOverW>0){c.cells+=t.rows();var i=e+(r.nRequiredCellsH-1);t.insertCol(i,r.leftOverW)}if(r.leftOverH>0){c.cells+=t.cols();var a=n+(r.nRequiredCellsV-1);t.insertRow(a,r.leftOverH)}for(var o=e+(r.nRequiredCellsH-1);o>=e;o--)for(var l=n+(r.nRequiredCellsV-1);l>=n;l--)t.setItem(o,l,!0)}function a(e,n,r,i){i.nRequiredCellsH=0;i.nRequiredCellsV=0;i.leftOverW=0;i.leftOverH=0;for(var a,o=0,l=0,u=n;l<r.height;){a=e;o=0;for(;o<r.width;){if(t.item(a,u))return!1;o+=t.colWidth(a);a++}l+=t.rowHeight(u);u++}i.nRequiredCellsH=a-e;i.nRequiredCellsV=u-n;i.leftOverW=o-r.width;i.leftOverH=l-r.height;return!0}function o(e,n,r){var i=0,a=0,o=0,l=0,u=0;for(o=0;o<e;o++)i+=t.colWidth(o);for(o=0;o<n;o++)a+=t.rowHeight(o);l=r.x-i;u=r.y-a;if(l<0||u<0)return!1;if(l>0){c.cells+=t.rows();var s=t.colWidth(e)-l;t.insertCol(e,s)}if(u>0){c.cells+=t.cols();var f=t.rowHeight(n)-u;t.insertRow(n,f)}return!0}function l(e,n){c.width=e;c.height=n;c.area=s();t.init(e,n,!1);return c}function u(e,l,u){var s={offsetX:0,offsetY:0,width:e,height:l,placed:!1},f=0,d=0,g=0,h=0,v={};if(u){for(;f<t.cols()&&g<u.x;){g+=t.colWidth(f);f++}for(;d<t.rows()&&h<u.y;){h+=t.rowHeight(d);d++}o(f-1,d-1,u);g-=t.colWidth(f);h-=t.rowHeight(d)}c.addAttempts++;for(var m=Xe;;){v={};for(;d<t.rows()&&t.item(f,d);){h+=t.rowHeight(d);d++}if(d<t.rows()&&r(h,s.height)<=0){if(a(f,d,s,v)){i(f,d,v);s.offsetX=g;s.offsetY=h;s.placed=!0;break}h+=t.rowHeight(d);d++}var p=r(h,s.height);if(p>0){h=0;d=0;g+=t.colWidth(f);f++;c.lfhDeficitSinceLastRedim()>p&&(n=p)}if(c.width-g<s.width){s.placed=!1;break}}m=n;return{offsetX:s.offsetX,offsetY:s.offsetY,lfhd:m,placed:s.placed}}function s(){return c.width*c.height}var c={matrix:t,cells:e,addAttempts:0,addRect:u,lfhDeficitSinceLastRedim:function(){return n},setDimensions:l};return c}function ke(){var e=[],t=[],n=[],r=0,i=0;function a(){if(e.length>0||t.length>0){e.length=0;t.length=0;n.length=0}}function l(o,l,u){if(o<=0)throw new Error("[Matrix] Column size cannot be 0 or similar");if(l<=0)throw new Error("[Matrix] Row size cannot be 0 or similar");r=1;i=1;a();e.push({index:0,size:o});t.push({index:0,size:l});n[0]=[];n[0][0]=u;return f}function u(e,a){for(var o=t[e].index,l=0;l<i;l++)n[l][r]=n[l][o];e<r-1&&t.splice(e+1,0,{index:r,size:a});t[e+1]={index:r,size:a};t[e].size-=a;r++;return f}function s(t,r){var a=e[t].index;n[i]=o(n[a]);t<i-1&&e.splice(t+1,0,{index:i,size:r});e[t+1]={index:i,size:r};e[t].size-=r;i++;return f}function c(){var n,a,o,l="\n     ",u=0,s=0;for(u=0;u<i;u++){n=Math.floor(e[u].size/100)%10==0?" ":""+Math.floor(e[u].size/100)%10;a=Math.floor(e[u].size/10)%10==0&&" "===n?" ":""+Math.floor(e[u].size/10)%10;o=Math.floor(e[u].size)%10==0&&" "===n&&" "===a?" ":""+Math.floor(e[u].size)%10;l+=e[u].size>999?" "+e[u].size+" ":" "+n+a+o+" "}l+="\n";for(u=0;u<r;u++){n=Math.floor(t[u].size/100)%10==0?" ":""+Math.floor(t[u].size/100)%10;a=Math.floor(t[u].size/10)%10==0&&" "===n?" ":""+Math.floor(t[u].size/10)%10;o=Math.floor(t[u].size)%10==0&&" "===n&&" "===a?" ":""+Math.floor(t[u].size)%10;l+=t[u].size>999?" "+t[u].size+": ":" "+n+a+o+": ";for(s=0;s<i;s++)l+=f.item(s,u)?"  X  ":"  .  ";l+="\n"}return l}var f={init:l,cols:function(){return i},rows:function(){return r},item:function(r,i){return n[e[r].index][t[i].index]},setItem:function(r,i,a){n[e[r].index][t[i].index]=a},insertRow:u,insertCol:s,colWidth:function(t){
return e[t].size},rowHeight:function(e){return t[e].size},inspect:c};return f}var Xe=16e6;return r}var nl={w:1,x:1,y:1,fs:1,bw:1,b1:1,b2:1};function rl(e,n,r,i){var a,l,u,s,c,f,d=new Map,g=new Map,v=new Map,m=new Map,p={x:1,y:1,w:1,h:1,e:1,fs:1,off:1,b1:1,b2:1,bw:1},b={t:1,u:1,id:1,id1:1,id2:1,ff:1,sh:1,ls:1,bs:1},y={c:1,c2:1,b:1,fc:1,fbc:1},I={p:1},x={hi:1,bg:1,ci:1,du:1,fb:1,a1:1,a2:1,re:1,tc:1,a:1},C={gh:1},G={pos:1},w={x:1,y:1,off:1,lat:1,lng:1},R={ls:{solid:!0,dashed:!0,dotted:!0},bs:{solid:!0,dashed:!0}},V=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"],k={},X={},Y={},L=null,T=1,N=2,D=new Map,O=!1,_=!1,K=W(),P=null,J=tl(e);k.setDirty=function(e){D.delete(e);D.set(e,N)};var j=k.setDirty;function Q(){ne();a=null;u=null}function q(e){t(Y,function(t){ge(t,e)});t(X,function(t){ge(t,e)})}var $=ur({numbers:p,numOrString:I,negatives:w,strings:b,stringValues:R,colours:y,booleans:x,reserved:C,mapPos:G,halos:V},j,Q,q);k.graph=function(){P||(P=jo(n)).privateSetProperties(X,Y);return P};var ee=k.graph;function te(e,t){var n,r=1===e?t.id1:t.id2;return{x:(n=d.has(t.id)?Be(r):X[r]).x,y:n.y}}k.setAllDirty=function(){O=!0;n.trigger("redraw",{all:!0})};var ne=k.setAllDirty;function re(e){O=!1;_=!1;e?D=e:D.clear()}var ie=function(e,t){var n=D.get(e);if(!n||t&&n===T){t&&D.delete(e);D.set(e,T)}};function oe(){return!(!O&&!_)||D.size}k.moveAllNodesBy=function(e,t,n){ue(e,function(e){e.x+=t;e.y+=n;ie(e.id)})};k.moveNode=function(e,t,n){var r=X[e];if(r){var i=t-r.x,a=n-r.y;if(r._combo)ue([e],function(e){e.x+=i;e.y+=a;ie(e.id)});else{r.x+=i;r.y+=a;ie(r.id)}}};var le=k.moveNode;function ue(e,t){for(var n={},r=e.slice(0);r.length>0;){var i=r.shift(),a=X[i];if(a&&!n[i]){n[i]=!0;t(a);if(a._combo)for(var o=a._combo.nodeIds,l=0,u=o.length;l<u;l++)n[o[l]]||r.push(o[l])}}}k.moveLink=function(e,t){var n=Y[e];if(n){n.y=t;j(e)}};k.setLinkOffset=function(e,t){var n=Y[e];if(n){n.off=t;j(e)}};k.ensureObject=$.ensureObject;k.ensureTypesInArray=$.ensureTypesInArray;k.load=function(e){if(e){X={};Y={};Qe(!0);Rt();$.typeCheck(e,Y);var t=$.filterNodesAndLinks(e.items,X,Y,{selfLinks:c});Y=t.links;X=t.nodes;k.reveal(e.reveal,!1);$.ensureHiddenItemConsistency(X,Y);P=null;se();vt();ne()}Ye()};function se(){L=null}function ce(e){Object.keys(e).forEach(function(t){L.push(e[t])})}k.getRawItems=function(){if(!L){L=[];ce(Y);ce(X)}return L};var fe=k.getRawItems;function de(e){t(e,function(t,n){M(t)&&delete e[n]})}k.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return i.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"donut":return U({v:[]},$.donutDefaults);case"ha0":case"ha1":case"ha2":case"ha3":case"ha4":case"ha5":case"ha6":case"ha7":case"ha8":case"ha9":return{c:At.transparent,r:0,w:0};case"fi":return{c:"black",t:""};case"oc":return rr;case"c":case"b":return At.midgrey;case"fc":return At.black;case"fbc":return At.textback;default:return}};k.bothEndsShown=function(e){return!e.hi&&!(X[e.id1].hi||X[e.id2].hi)};k.neighbourLinkIds=function(e){return ee().privateNeighbourLinks(e)};k.privateGetLinksBetween=function(e,t){for(var n=ee().privateGetLinkIdsBetween(e,t),r=[],i=n.length,a=0;a<i;a++)r.push(Y[n[a]]);return r};k.bothEndsForeground=function(e){return!(X[e.id1].bg||X[e.id2].bg)};function ge(e,t){e[t]&&Je(e.id)}function he(e){return e&&!!e._parentId}function ve(e,t,n){for(var r="x"===t||"y"===t?ie:j,i=0;i<e.length;i++){var a=e[i],o=X[a],l=Y[a];if(o){o[t]=n;r(a)}else if(l){l[t]=n;j(a)}}}function me(e,t){var n=!1;X[e]&&(n=be(X[e],t));Y[e]&&(n=be(Y[e],t));return n}function pe(e){return et(e)&&!me(e,"gh")}function be(e,t){return!!e[t]}k.resurrect=function(e){ye(e,"gh",!0)};k.ghost=function(e){xe(e,"gh")};k.show=function(e,t){ye(e,"hi",t);Te()};k.hidden=function(){return Ie("hi")};k.hide=function(e){xe(e,"hi");Te()};function ye(e,n,r){var i,a=Z(e);ve(a,n,!1);$.ensureConsistency(n,X,Y);if(r){var o={},l={};for(i=0;i<a.length;i++)o[a[i]]=1;t(Y,function(e){if(be(e,n)&&!be(X[e.id1],n)&&!be(X[e.id2],n)&&(o[e.id1]||o[e.id2])){e[n]=!1;var t=e._parentId;t&&Y[t]&&(l[t]=!0)}});$.applyPropertyRuleToComboLinks(l,n,Y)}}function Ie(e){var n=[];t(X,function(t,r){t[e]&&n.push(r)});t(Y,function(t,r){t[e]&&n.push(r)});return n}function xe(e,t){ve(Z(e),t,!0);$.ensureConsistency(t,X,Y)}k.each=function(e,n){e.type.match(/^(node|all)$/)&&t(X,n);e.type.match(/^(link|all)$/)&&t(Y,n)};k.setItem=function(e){var t=o(e);$.ensureObject(t,!1,Y);var n=null;"node"===t.type&&(n=X);if("link"===t.type){n=Y;if(!$.hasValidEnds(t,{},X,c))return!1}$.setZeroXY(t);if(t.id){var r=n[t.id];n[t.id]=t;if(r){r._combo&&(n[t.id]._combo=r._combo);r._parentId&&(n[t.id]._parentId=r._parentId);r._offset&&(n[t.id]._offset=r._offset)}t.hi?$.ensureHiddenItemConsistency(X,Y):Q();Te();se();j(t.id)}return Ye()};k.type=function(){return"LinkChart"};var Ce,Ge=k.type;k.setOptions=function(e){c=e.selfLinks;f=e.marqueeLinkSelection;i.setOptions(e);ne()};k.setLastHoverId=function(e){Ce=e};k.showFullLabelOnHover=function(e){Ce&&j(Ce);if(e){j(e);i.setSpecialOptions("showFullLabel",e)}else i.setSpecialOptions("showFullLabel",null)};function we(){var e=[];fe().forEach(function(t){t._combo||e.push(o(t,"d"))});return e}k.serialize=function(){return{type:Ge(),items:we()}};function Ze(e,n,r,i){var a,l,u,s,c;for(a=0;a<e.length;a++){l=S(e[a].id);s=[];if(l)if(n){c=new RegExp(l,"im");t(X,function(e,t){c.test(t)&&s.push(e)});t(Y,function(e,t){c.test(t)&&s.push(e)})}else{X[l]&&s.push(X[l]);Y[l]&&s.push(Y[l])}var f=o(e[a]);delete f.id;delete f.type;for(u=0;u<s.length;u++){var d=!0,g=s[u];if(!i&&"node"===g.type&&(void 0!==f.x||void 0!==f.y)){var h=void 0===f.x?g.x:f.x,v=void 0===f.y?g.y:f.y;k.moveNode(g.id,h,v)}t(f,function(e,t){d&&"x"!==t&&"y"!==t&&(d=!1);switch(t){case"id1":case"id2":if(e!==g[t])throw Error("You cannot change the ends of an existing link");break;case"hi":case"_parentId":r.all=!0;r.hi=!0;g[t]=e;break;case"oc":r.all=!0;Object.keys(f[t]).forEach(function(e){g[t][e]=f[t][e]});break;default:or[t]&&(g._noHalos=!1);nl[t]?r.positions=!0:r.all=!0;g[t]=e}});de(g);d?ie(g.id):j(g.id)}}}k.validateCombos=function(){var e={};function n(t){var n=t._parentId;if(n){var r=X[n]||Y[n];if(!r)throw new Error("The "+t.type+" '"+t.id+"' has _parentId = '"+n+"' but the parent item is not present in the model.");if(!r._combo)throw new Error("The "+t.type+" '"+t.id+"' has _parentId = '"+n+"' but the parent item has no _combo property.");e[n]=e[n]||{};e[n][t.id]=!0}}function r(n){if(n._combo){var r={};(n._combo.nodeIds||[]).concat(n._combo.linkIds).forEach(function(t){r[t]=!0;var i=X[t]||Y[t];if(!i)throw new Error("The combo "+n.type+" '"+n.id+"' has a child item '"+t+"' in its _combo property, but this item is not present in the model.");if(!e[n.id][t])throw new Error("The combo "+n.type+" '"+n.id+"' has a child item '"+t+"' in its _combo property, but this item's _parentId property is "+(i._parentId?"set to '"+i._parentId+"'":"undefined."))});t(e[n.id],function(e,t){if(!r[t]){var i=X[t]||Y[t];throw new Error("The "+i.type+" '"+i.id+"' has _parentId set to '"+n.id+"' but is not included in the parent's _combo property.")}})}}t(X,n);t(Y,n);t(X,r);t(Y,r)};k.unsafeApplyChanges=function(e,t,n){var r,i,a;for(r=0;r<e.length;r++){i=(a=e[r]).id;var o=void 0!==a.x,l=void 0!==a.y;if(!o&&!l||n)a._combo&&h(a._combo.e)&&k.moveAllNodesBy([i],0,0);else{var u=o?a.x:X[i].x,s=l?a.y:X[i].y;k.moveNode(i,u,s)}U(X[i]||Y[i],e[r]);t?j(i):ie(i)}};k.setProperties=function(e,t,n,r){var i=o(e);i=Z(i);$.ensureTypesInArray(i,!1,Y);Ze(i,t,n,r);n.hi&&$.ensureHiddenItemConsistency(X,Y);(n.graphCache||n.hi)&&Te();return Ye()};function Ae(e){var n={};t(e,function(e,t){e&&void 0===e.off&&(n[t]=e)});return n}k.merge=function(e){var n=o(e);$.ensureTypesInArray(n,!1,Y);var r={carefulWithXandY:!0,selfLinks:c},i=$.filterNodesAndLinks(n,X,Y,r);t(i.nodes,function(e,t){X[t]=U(X[t],e);X[t]._noHalos=!1;j(t)});t(i.links,function(e,t){Y[t]=U(Y[t],e);Y[t]._noHalos=!1;j(t)});$.ensureHiddenItemConsistency(X,Y);Te();se();var a=Ae(i.links);at(a);return Ye()};k.firstVisibleItemInAncestry=function(e){var t=X[e]||Y[e];if(t&&!t.hi){if("link"===t.type&&Zt(e)&&ke(e))return t;var n=k.getParentItems(e);n.push(t);var r=null;n.every(function(n){if(null===n)return!1;if(n.hi){r=null;return!1}if(n.id===e){r=t;return!1}if(n._combo){r=n;return n._combo.open}return!1});return r}return null};var Be=k.firstVisibleItemInAncestry;k.getItem=function(e){return o(Ve(e),"d")};k.getItemsByID=function(e){for(var t=Z(e),n=[],r=0;r<t.length;r++){var i=Ve(t[r]);i=i||null;n.push(i)}return n};var Re=k.getItemsByID;k.getAncestryIds=function(e,t){var n=e,r=[],i=0;do{t&&1===i&&n.indexOf("_combolink")>-1||r.unshift(n);var a=Ve(n);n=a&&a._parentId;i++}while(n);return r};var Me=k.getAncestryIds;k.getParentItems=function(e){var t=Me(e);t.pop();return Re(t)};var We=k.getParentItems;k.getByID=function(e){var t=S(e);return X[t]||Y[t]||null};var Ve=k.getByID;k.allParentsOpen=function(e,t){return!Ve(e)._parentId||We(e).every(function(e){return e._combo.open&&(!t||!e.hi)})};var Se=k.allParentsOpen,ke=function(e){var t=Y[e];if(t&&!t.hi){if(t._parentId){if(Xe(t._parentId)){var n=Be(t.id1);if(t.id1===t.id2&&n)return!0;var r=Be(t.id2);return n&&r&&n.id!==r.id}return!1}return!0}return!1};k.allParentsVisible=function(e){return!Ve(e)._parentId||We(e).every(function(e){return!e.hi})};var Xe=k.allParentsVisible;k.topParentId=function(e){for(var t=e,n=Ve(t),r=n&&n._parentId;r;)(t=r)===(r=(n=Ve(t))?n._parentId:null)&&(r=null);return t};var Ee=k.topParentId,Fe={};k.imageList=function(e){var n={updated:!1,_coList:{}};t(Fe,function(t,r){n[e+r]=1});return n};function Ye(){var e=Le(X);return e=Le(Y)||e}function He(e){var t=!1;e.forEach(function(e){e&&e.g&&e.g.forEach(function(e){t=ze(e)||t})});return t}function Le(e){var n=!1;t(e,function(e){n=ze(e)||n;n=He([e,e.t1,e.t2])||n;e.bu&&(n=ze(e.bu.g)||n)});return n}function ze(e){if(e){var t=e.u;if(t&&!(t in Fe)){Fe[t]=1;return!0}}}function Te(){P&&P.clearCache()}function Ne(){a={};l=0;for(var e=Object.keys(X),t=0,n=e.length;t<n;t++){var r=e[t],i=X[r];if(!i.hi&&Se(r,!0)){a[r]=i;l++}}}function Ue(){u={};for(var e=Object.keys(Y),t=0,n=e.length;t<n;t++){var r=e[t],i=Y[r],a=!i.hi;a&&(a=Zt(r)?ke(r):Se(r,!0))&&(u[r]=i)}}function De(){if(!a){Ne();Ue()}}function Oe(){O||(D.size>100?D.size>=l?_=!0:_e():ee().internalMarkLinks(D))}function _e(){t(u,function(e,t){D.has(t)||(D.has(e.id1)||D.has(e.id2))&&D.set(t,N)})}k.generate=function(e,t,n,r,o,l,c){var f,g=n.getUnzoom(),h=g!==s;h&&ne();if(oe()){De();Oe();re((f=i.generate(a,u,O,_,D,e,t,n,r,o,je,d,$e,k.isTransferring,l,c)).stillDirty);s=g}i.generateHandles(e,t,n,v);return i.animated()||f&&f.rebuildAll||h};k.contains=function(e){return i.contains(e,X).filter(function(e){return!he(X[e])})};k.animated=function(){return i.animated()};function Ke(t){t.forEach(function(t){var n=e.privateGetItem(t);n&&(n._combo||n._parentId)&&e.privateSetAllItemsInComboDirty([e.privateGetTopItemId(n.id)])})}k.setSelection=function(e,t,n){var r=S(e);t||n||Qe(!!r);v.has(r)?t&&Je(r):Pe(r)};k.addToSelection=function(e,t){var r=S(e);if(r&&!v.has(r)&&pe(r)){Ke([r]);v.set(r,1);j(r);t||n.trigger("selectionchange")}};var Pe=k.addToSelection;k.removeFromSelection=function(e,t){var r=S(e);if(v.delete(r)){Ke([r]);j(r);t||n.trigger("selectionchange")}};var Je=k.removeFromSelection;k.hasSelection=function(){return v.size};k.isSelected=function(e){return!!v.size&&v.has(e)};var je=k.isSelected;k.clearSelection=function(e){var t=[];v.forEach(function(e,n){j(n);t.push(n)});Ke(t);v.clear();e||n.trigger("selectionchange")};var Qe=k.clearSelection;function qe(e){t(e,function(e,t){Pe(t,!0)})}k.addItemsToTransfer=function(e){e.forEach(function(e){g.set(e,!0)})};k.removeItemsFromTransfer=function(e){e.forEach(function(e){g.delete(e)})};k.isTransferring=function(e){return!!g.size&&g.has(e)};k.clearExtraItemsInTransientLayer=function(){m.forEach(function(e,t){j(t)});m.clear()};k.drawInTransientLayer=function(e){if(e&&e.length>0){e.forEach(function(e){m.has(e)||j(e)});var t=H(e);m.forEach(function(e,n){t.has(n)||j(n)});m=t}};k.removeFromTransientLayer=function(e){e.forEach(function(e){m.delete(e)&&j(e)})};function $e(e){return m.has(e)}var et=function(e){De();return a[e]||u[e]};k.isItemShown=et;k.selectAll=function(){qe(X);qe(Y);n.trigger("selectionchange")};k.doSelection=function(e){if(e){Qe(!0);for(var t=0;t<e.length;t++)Pe(e[t],!0)}var n=[];v.forEach(function(e,t){n.push(t)});return n};var tt=k.doSelection;k.privateSelection=function(){return v};k.moveSelection=function(e,n){var r=[];if(v.size){t(X,function(e,t){je(t)&&!he(e)&&r.push(t)});t(Y,function(e,t){if(je(t)){X[e.id1].du&&r.push(e.id1);X[e.id2].du&&r.push(e.id2)}})}for(var i=0;i<r.length;i++){var a=X[r[i]];k.moveNode(r[i],a.x+e,a.y+n)}};k.removeItem=function(e){var n,r=Z(e);if(r.length>0){for(var i={},a={},o=0;o<r.length;o++){n=r[o];Y[n]&&(i[n]=Y[n]);X[n]&&(a[n]=1)}t(Y,function(e,t){(a[e.id1]||a[e.id2])&&(i[t]=e)});t(i,function(e,t){Je(t,!0);Bt(t);j(t);delete Y[t]});t(a,function(e,t){Je(t,!0);j(t);delete X[t]});Te();se();at(i);Q()}};k.selectionPlusDummyNodes=function(){for(var e=tt(),t=0;t<e.length;t++){var n=Y[e[t]];if(n){X[n.id1].du&&e.push(n.id1);X[n.id2].du&&e.push(n.id2)}}return e};function nt(e){var t=jo(n);t.privateSetProperties(X,e);return t}function rt(e){var t=A(e,{all:!1,self:!0,combos:"all"});return ee().connections(t)}function it(e,t){var n=[],r={};if(F(e)){var i=nt(e).findAdjacency;n=rt();for(var a=0;a<n.length;a++){var o=Y[n[a][0]];i({all:!0,combos:"all"},o.id1,o.id2)&&(r[a]=1)}}t(n,r)}k.resetConnectionOffsets=function(e){n.trigger("redraw",{all:!0});it(e,gt);Wt(e)};var at=k.resetConnectionOffsets,ot=function(e,t){var n;it(e,function(e,r){n=ht(e,r,t)});return n};function lt(e,t){var n=[];function r(e,t){n.push({id:e.id,off:t})}Wt(e,t,r);return n}function ut(e){for(var t={},n=0;n<e.length;n++){var r=e[n],i=Y[r];i&&(t[r]=i)}return t}k.showHideBendLinks=function(e){var t=ut(e);at(t)};k.showHideGetLinksToBend=function(e,t){var n=ut(e),r=ot(n,t),i=lt(n,t);if(i.length>0){var a=z(i);r=r.filter(function(e){return void 0===a[e.id]}).concat(i)}for(var o=[],l=0;l<r.length;l++){var u=r[l];Y[u.id].off!==u.off&&o.push(u)}return o};function st(e){gt(rt(e))}function ct(){t(Y,function(e){delete e.st})}function ft(e,n,r,i,a){var o=i||function(e){return e};function l(e){var t=1e6,n=B(e.off)?e.off:t,r=o(e);r.id1>r.id2&&(n=s(-n));return n}function u(e,t){return l(Y[e])-l(Y[t])}function s(e){return 0===e?0:e}t(n||e,function(t,n){var i=e[+n];r||(i=i.filter(function(e){return!Y[e].gh}));if(i.length>0){i.sort(u);for(var l=o(Y[i[0]]),c=l.id1===l.id2,f=i.length,d=c?20:40,g=c?0:-.5*d*(f-1),h=0;h<f;h++){var v=Y[i[h]],m=o(v),p=g+h*d;p=m.id1<=m.id2?p:-p;a(v,s(p))}}})}function dt(e,t){e.off=t;j(e.id)}function gt(e,t){ft(e,t,!0,null,dt)}function ht(e,t,n){var r=[];function i(e,t){r.push({id:e.id,off:t})}ft(e,t,n,null,i);return r}function vt(){for(var e=rt(),t={},n=0;n<e.length;n++){var r=!1,i=e[n];if(i.length>1){for(var a=0;a<i.length;a++){var o=Y[i[a]];o&&(r=r||B(o.off))}r||(t[n]=1)}}gt(e,t)}k.getCursor=function(e,t){var n=It(e);return n||(e?'url("'+t+'openhand.cur"), pointer':"auto")};k.getResizePrimitive=function(){return i.getResizePrimitive()};var mt=new RegExp(K+"((\\S+)(?:\\-resize))$"),pt={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]};function bt(e){return(e+"").match(mt)}function yt(e){var t=bt(e);return pt[t[2]]}function It(e){var t=bt(e);return t?t[1]:null}var xt=new RegExp(K+"(id[1|2])$");k.startDragger=function(e,t,n,i,a,o){var l=(o+"").match(xt),u=S(n);return r.createLinkEndDragger(e,k,t,X,Y[u],l[1],i,a,u)};k.createDragger=function(e,t,i,o,l,s,c,f){var d=c.handMode,g=S(o);if(bt(o)){var h=yt(o),v=f,m=X[g]._combo&&X[g]._combo.open;return r.primitiveMover(Pn,t,i,g,v,!0,h,l,s,m,function(e){n.trigger("prechange","resize");var t=X[S(o)],r=e.a,i=r?r.x:0,a=r?r.y:0;if(m)t.oc.w=2*e.r;else if("C"===e.p){t.x=i+e.x;t.y=a+e.y;t.w=2*e.r;t.h=t.w}else{var l=i+e.x1,u=a+e.y1,s=i+e.x2,c=a+e.y2;t.x=l+Math.floor((s-l)/2);t.y=u+Math.floor((c-u)/2);t.w=s-l;t.h=c-u}j(t.id)})}if(null!==g&&Y[g]&&"h"!==Y[g].st){if(Y[g].id1===Y[g].id2)return null;var p=(o+"").match(xt);return p?r.createLinkEndDragger(e,k,i,X,Y[g],p[1],l,s,g):r.createLinkDragger(te,t,i,k,Y[g],l,s,g)}k.clearExtraItemsInTransientLayer();if(d&&null===o)return r.createHandDragger(i,l,s,Qe);if(null!==g){De();return r.createDefaultDragger(k,a,u,je,Ct,i,o,l,s)}return Gt(i,l,s)};function Ct(){var e=[];v.forEach(function(t,n){var r=X[n];r&&r._parentId&&e.push(Ee(r._parentId))});return e}var Gt=function(e,r,i){if(!n.trigger("dragstart","area",null,e.unscale(r),e.unscale(i),null)){var o={};v.forEach(function(e,t){o[t]=1});var l={id:"__dragger",p:nn.rect,x1:r,y1:i,x2:r,y2:i,bc:At.midgrey,bw:1,fc:At.blue,fi:!1},s=e.viewToWorldX(r),c=e.viewToWorldY(i),d={x1:s,y1:c,x2:s,y2:c};l.wbc=_t(l.bc);l.wfc=_t(l.fc);return{scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){var t=e.getLayer(),n=e.getLayerPath();e.setLayerPath(null);e.setLayer(si.HANDLES);e.copyPrimitive(l);e.setLayerPath(n);e.setLayer(t)},dragMove:function(e,t,n,r){m(e,t,n,r)},endDrag:function(t,r,i){e.cancelScroll();n.trigger("dragend","area",null,e.unscale(r),e.unscale(i))||(t?n.trigger("selectionchange"):Qe());n.trigger("dragcomplete","area",null,e.unscale(r),e.unscale(i))}}}function g(t,n){l.x1=Math.min(e.worldToViewX(s),t);l.y1=Math.min(e.worldToViewY(c),n);l.x2=Math.max(e.worldToViewX(s),t);l.y2=Math.max(e.worldToViewY(c),n);d.x1=e.viewToWorldX(l.x1);d.y1=e.viewToWorldY(l.y1);d.x2=e.viewToWorldX(l.x2);d.y2=e.viewToWorldY(l.y2)}function h(e,r,i){t(e,function(e,t){e?Pe(t,!0):(r||i)&&o[t]||Je(t,!0)});n.trigger("redraw",{all:!0})}function m(e,n,r,i){De();g(e,n);var o={};t(a,function(e,t){o[t]=yn(d,e.x,e.y)});"off"!==f&&t(u,function(e,t){if("centre"===f)o[t]=yn(d,e._x,e._y);else if("ends"===f){var n=a[e.id1],r=a[e.id2];o[t]=yn(d,n.x,n.y)&&yn(d,r.x,r.y)}});h(o,r,i)}};k.createGestureDragger=function(r,i,a){var o,l,u,s,c=r.zoom(),f=r.viewToWorldX(i),d=r.viewToWorldY(a),g={};t(X,function(e,t){g[t]={x:e.x,y:e.y}});function h(t,n,i){var a=-t*(2*Math.PI/360);a*=2;var o=Math.sin(a),l=Math.cos(a);e.privateEach({type:"node",items:"toplevel"},function(e){var t=e.id,n=(g[t].x-f)*l+(g[t].y-d)*o+f,r=-(g[t].x-f)*o+(g[t].y-d)*l+d;le(t,n,r)});var u=r.viewToWorldX(n),s=r.viewToWorldY(i);e.privateEach({type:"node",items:"toplevel"},function(e){var t=e.id;le(t,e.x+(u-f),e.y+(s-d))})}function v(e){var t=Math.pow(e,2);r.zoomToPosition(t*c,i,a)}function m(e,t,n,r){o=e;l=t;u=n;s=r}m(1,0,f,d);var p=!1,b=60,y=!1;function I(){v(o);p=p||Math.abs(l)>12;y=y||Math.abs(u-f)>b||Math.abs(s-d)>b;h(p?l:0,y?u:f,y?s:d)}function x(){e.privateEach({type:"node",items:"toplevel"},function(e){var t=e.id;le(t,g[t].x,g[t].y)})}return{animate:function(){I()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){m(e,t,n,r)},endDrag:function(e,t,r,i,a){m(t,r,i,a);if(e){x();n.trigger("prechange","move");I()}else x()}}};k.labelPosition=function(e,t){var n=Ve(e);return i.labelPosition(n,t)};k.extractStructure=function(e,t,n,r){return J.extractStructure(i,e,X,Y,ee,t.fixed,n,r)};k.updateLinkStyles=function(e){if(e.straighten){n.trigger("redraw",{all:!0});st({self:!1,combos:"toplevel"})}ct()};k.layout=function(e,t,n,r,i){J.layout(e,t,n,ee,r,i)};k.arrange=function(e,t,n,r,i,a,o){J.arrange(e,t,n,r,ee,i,a,o)};k.applyVertices=function(e){t(X,function(t,n){e[n]&&le(n,e[n].x,e[n].y)})};k.applyUpdatedOffsets=function(e){t(Y,function(t,n){e[n]&&k.setLinkOffset(n,e[n].off)})};k.makeAnimator=function(e,n,r){var i=n,a={};t(X,function(e,t){a[t]={x:e.x,y:e.y}});return Qn(function(o){i-=o;var l=r(Math.max(0,(n-i)/n));t(X,function(t,n){if(e[n]){var r=a[n].x+l*(e[n].x-a[n].x),i=a[n].y+l*(e[n].y-a[n].y);le(n,r,i)}});return i>0},{positions:!0})};function wt(e){var t=Y[e];return t&&!t._combo}k.reveal=function(e,t){if(e){Rt();e.forEach(function(e){if(e&&!d.has(e)&&wt(e)){d.set(e,!0);j(e)}});!1!==t&&Wt(void 0,void 0,void 0,!0);Q()}};k.isRevealedLink=function(e){return!!d.size&&d.has(e)};var Zt=k.isRevealedLink;k.getRevealedLinks=function(){var e=[];d.forEach(function(t,n){e.push(n)});return e};var Bt=function(e){j(e);d.delete(e);je(e)&&!Se(e)&&Je(e)};k.clearRevealedLinks=function(){d.forEach(function(e,t){j(t);je(t)&&!Se(t)&&Je(t)});d.clear()};var Rt=k.clearRevealedLinks;function Mt(e,n,r){t(e,function(e){var t,i=Be(e.id1),a=Be(e.id2);if(null!==i&&null!==a&&i!==a){t=i.id>a.id?i.id+a.id:a.id+i.id;void 0===n[t]&&(n[t]=[]);n[t].push(e.id);r[e.id]={id1:i.id,id2:a.id}}})}k.applyRevealedLinkOffsets=function(e,n,r,i){var a=void 0===r?dt:r,o={},l={};Mt(k.getRevealedLinks().map(Ve).filter(function(e){return!e.hi}),o,l);function u(e){return void 0!==l[e.id]?l[e.id]:e}function s(e,t){if(l[e]){var n,r=l[e],i=Me(r.id1);for(n=0;n<i.length;n++)if(t[i[n]])return!0;i=Me(r.id2);for(n=0;n<i.length;n++)if(t[i[n]])return!0}return!1}var c=null;if(e){var f=[],d={};t(e,function(e){if("node"===e.type){var t=Be(e.id);t&&(d[t.id]=!0)}else f.push(e)});var g={};Mt(f,g,{});c={};var h=!1;Object.keys(o).forEach(function(e,t){if(void 0!==g[e]||s(o[e][0],d)){c[t]=!0;h=!0}});if(!h)return}if(i){var v=a;a=function(e,t){e.id1===l[e.id].id1&&e.id2===l[e.id].id2||v(e,t)}}ft(E(o),c,n,u,a)};var Wt=k.applyRevealedLinkOffsets;return k}function il(e,n,r){var i,a,o={},l={},u={},s=[],c={},d={};function g(e,t,n){var r=!!t;d[e]=r;n&&Vn()&&(d[Sn(e)]=r);return e}function h(){return r&&r.api.isShown()}function v(){return r&&r.internalUse.isMapLoaded()}o.appendImageList=function(e){t(d,function(t,n){e[n]=1})};function m(){i=At.ci;a=At.cia}m();o.colorize=function(e,n,r){var o,l={};if(r){var u=_n(e,d,n,"rgb(0,174, 234)",r);o=u.colour;l=u.images;i=Bt(o[0],o[1],o[2]);a=Rt(o[0],o[1],o[2],.5)}else m();t(e,function(t,n){if("updated"!==n&&"_coList"!==n){var r=l[n]||t.im;t.co=r;e.updated=!0}})};o.setup=function(){G();e.privateBind("click",p)};function p(e){c[e]&&c[e].apply(null,arguments)}o.createDragger=function(e,t,n){return e in l?l[e](t,n):null};o.reset=function(){l={};u={};s=[];c={};d={};e.privateUnbind("click",p)};var b,y,I,x,C,G=o.reset;o.getCursor=function(e){return e in u?u[e]:"auto"};o.generate=function(e,t,n,r,i,a,o){e.setLayerPath(null);for(var l=0;l<s.length;l++)s[l].generate(e,t,n,r,i,a,o)};o.getWatermarkSize=function(e,t){for(var n=0;n<s.length;n++){var r=s[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null};o.addLogo=function(e,t){var n=15,r="_logo",i=g(e+t.u,!1,!0),a={generate:function(e,a,o,l){e.setLayer(si.OVERLAYS);var u=l[i].im,s=t.p||"ne",c=("w"===s.charAt(1)?n:o.width()-(u.width+n))+(t.x||0),f=("n"===s.charAt(0)?n:o.height()-(u.height+n))+(t.y||0);e.image(o.scale(c),o.scale(f),o.scale(c+u.width),o.scale(f+u.height),i,r,null,!1,!0)}};s.push(a)};o.addTextWatermark=function(e,t,n,r,i,a,o,l){var u="_textWatermark",c={watermarkSize:function(r,i){var a,o;if(e&&i){var u=i[e].im;a=u.width;o=u.height}else if(t){a=Nn(r,t,n,l).width;o=n}return a?{width:a+10,height:o+10}:null},generate:function(s,c,f,d){var g,h;s.setLayer(si.UNDERLAYS);if(e){var v=d[e].im;g=f.scale((f.width()-v.width)/2);h=f.scale((f.height()-v.height)/2);s.image(g,h,g+f.scale(v.width),h+f.scale(v.height),e,u)}else if(t){var m=f.scale(n),p=Nn(c,t,n,i,l).width;g=f.scale((f.width()-p)/2);h=f.scale((f.height()+n)/2);var b=-3.5,y=Math.floor(m/8);"top"===o&&(h=m+y);"bottom"===o&&(h=f.scale(f.height())+1);a&&s.rect(g-b,h-m-y,g+p+b+y,h,a,-1,a,!0,u);s.text(g,h,t,r,m,i,u,l,!1,p,!1,!1,g+b,h-m,g+p+b,h)}}};s.push(c);e&&g(e)};function w(e,t,n,r,i,a,o){e.rect(t.scale(n),t.scale(r),t.scale(i),t.scale(a),At.transparent,-1,At.transparent,!0,o)}o.addNavigation=function(t,n,i,a){var o,f=g(i+"Background.png",!0,!0),d=g(i+"BackgroundShort.png",!0,!0),m=g(i+"Slider.png",!1,!0),p=g(i+"Hand.png",!1,!0),b=g(i+"Arrow.png",!1,!0),y=7,I=17,x=62,C=X()?145:247,G=a.p||"nw",Z=("w"===G.charAt(1)?y:n.width()-(y+x))+(a.x||0),A=("n"===G.charAt(0)?I:n.height()-(I+C))+(a.y||0),B=Z+21,R=A+118,M=A+215;c._zoomIn=function(){t.zoomIn(!0)};c._zoomOut=function(){t.zoomOut(!0)};c._panLeft=function(){t.pan("left",!0)};c._panRight=function(){t.pan("right",!0)};c._panUp=function(){t.pan("up",!0)};c._panDown=function(){t.pan("down",!0)};c._fitToWindow=function(){t.fitToModel(!0)};c._toggleMode=function(){var e=t.options();e.handMode=!e.handMode;t.options(e)};function W(){return t.options().handMode}c._scale=function(e,t,n){V(n,!0)};function V(e,n){var r=k(e-o[m].im.height/2);t.setZoom(r,n)}u._zoomIn="pointer";u._zoomOut="pointer";u._panLeft="pointer";u._panRight="pointer";u._panUp="pointer";u._panDown="pointer";u._fitToWindow="pointer";u._toggleMode="pointer";u._scale="pointer";u._slider='url("'+i+'openhand.cur"), pointer';l._slider=function(){var i=n.zoom();if(X())return null;if(!e.trigger("dragstart","slider")){h()&&r.internalUse.enableDragging(!1);return{getCursor:function(){return"move"},dragMove:function(e,t){V(n.unscale(t),!1)},endDrag:function(n){var a=e.trigger("dragend","slider");n&&!a||t.setZoom(i,!1);h()&&r.internalUse.enableDragging(t.options().handMode);e.trigger("dragcomplete","slider")}}}};function S(e){var t;t=v()?r.internalUse.zoom():(Math.log(e)-Math.log(n.getMinZoom()))/(Math.log(n.getMaxZoom())-Math.log(n.getMinZoom()));return Math.floor(R+(1-t)*(M-R))}function k(e){var t=1-(e-R)/(M-R);return h()?r.internalUse.getMaxZoom()*t:Math.exp(t*(Math.log(n.getMaxZoom())-Math.log(n.getMinZoom()))+Math.log(n.getMinZoom()))}function X(){return n.height()<300}var E={generate:function(e,t,n,r,i,a){var l=X()?d:f,u=r[l].im;if(t.webgl&&!r._coList[l]){r._coList[l]=!0;r._coList[Sn(l)]=!0;r.updated=!0}if(!a){o=r;e.setLayer(si.OVERLAYS);e.image(n.scale(Z),n.scale(A),n.scale(Z+u.width),n.scale(A+u.height),l,"_background","co",!1,!0);var s=Z+19,c=A+64,g=n.scale(s),h=n.scale(c),v=n.scale(s+28),y=n.scale(c+32),I=W()?p:b;e.image(g,h,v,y,I,null,null,!1,!0);e.setLayer(si.OVERLAYSSHADOW);e.image(g,h,v,y,I,"_toggleMode");var x=5,C=23,G=39,R=57,M=105,V=X()?124:222,k=18,E=3,F=68,Y=22;w(e,n,Z+C,A+M,Z+G,A+M+k,"_zoomIn");w(e,n,Z+C,A+V,Z+G,A+V+k,"_zoomOut");w(e,n,Z+x,A+C,Z+C,A+G,"_panLeft");w(e,n,Z+G,A+C,Z+R,A+G,"_panRight");w(e,n,Z+C,A+x,Z+G,A+C,"_panUp");w(e,n,Z+C,A+G,Z+G,A+R,"_panDown");w(e,n,Z+C,A+C,Z+G,A+G,"_fitToWindow");X()||w(e,n,Z+C,A+M+k,Z+G,A+V,"_scale");w(e,n,Z+C-E,A+F,Z+G+E,A+F+Y,"_toggleMode");if(!X()){var H=S(n.zoom()),L=n.scale(B),z=n.scale(H),T=n.scale(B+r[m].im.width),N=n.scale(H+r[m].im.height);e.image(L,z,T,N,m,"_slider");e.setLayer(si.OVERLAYS);e.image(L,z,T,N,m,null,null,!1,!0)}}},createDragger:function(){}};u[f]="wait";s.push(E)};var Z={ne:"sw",nw:"se",se:"nw",sw:"ne"};o.addOverview=function(t,r,o,d,h,v){var m=v.p&&Z[v.p]?v.p:"se",p=g(h+"Arrow-"+Z[m]+".png",!0,!0),G=g(h+"Arrow-"+m+".png",!0,!0);v.size=v.size||100;b=v.size;I=v.shown;C="n"===m.charAt(0);x="w"===m.charAt(1);var w=(y=d(b,b)).getContext("2d"),A=!1,B=!1,R=Date.now(),M=n.createView(e,b,b);c._overviewIcon=function(){v.shown=!v.shown;I=v.shown;e.trigger("overview",I?"open":"close")};u._overviewIcon="pointer";function W(e){var t={x1:o.viewToWorldX(o.scale(-e)),x2:o.viewToWorldX(o.scale(o.width()+e)),y1:o.viewToWorldY(o.scale(-e)),y2:o.viewToWorldY(o.scale(o.height()+e))};return{x1:M.worldToViewX(t.x1),x2:M.worldToViewX(t.x2),y1:M.worldToViewY(t.y1),y2:M.worldToViewY(t.y2)}}var V,S,k=null,X=!1,E=0,F=0,Y=0,H=0,L=2;u._overviewBox='url("'+h+'openhand.cur"), pointer';function z(){Y+=V.x;H+=V.y;e.trigger("redraw")}function T(){S=f(z,50)}function N(){if(S){clearInterval(S);S=null}}l._overviewBox=function(n,r){if(!e.trigger("dragstart","overview")){X=!0;var i=2;E=0;F=0;Y=0;H=0;var a=-k.x1+i,l=b-k.x2-i,u=-k.y1+i,s=b-k.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,t){N();F=t-r;V={x:0,y:0};var i=!1;if((E=e-n)<a){E=a;V.x=L;i=!0}if(E>l){E=l;V.x=-L;i=!0}if(F<u){F=u;V.y=L;i=!0}if(F>s){F=s;V.y=-L;i=!0}i&&T()},endDrag:function(n){X=!1;N();var r=e.trigger("dragend","overview");if(n&&!r){var i=-(E-Y)*(o.zoom()/M.zoom()),a=-(F-H)*(o.zoom()/M.zoom());t.panBy(i,a,!0)}e.trigger("dragcomplete","overview")}}}};function U(e){var t=Math.max(e.width(),e.height())/2;M.reset(!1);var n=W(t);M.fitExtents(n,null,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();r!==1/0&&M.setMaxItemZoom(r/8);X&&M.panBy(Y,H,!1,!0)}var D={generate:function(n,o,l,u,s,c){if(!c){if(I){var f,d,g,h,m=x?l.scale(-1):l.scale(l.width()-b-2),y=C?l.scale(-1):l.scale(l.height()-b-2),Z=x?l.scale(b+2):l.scale(l.width()+1),V=C?l.scale(b+2):l.scale(l.height()+1),S=Math.max(1,l.scale(3)),Y=x?l.scale(-1):l.scale(l.width()-b)-.5,H=C?l.scale(-1):l.scale(l.height()-b)-.5,L=x?l.scale(b)+.5:l.scale(l.width()+1),z=C?l.scale(b)+.5:l.scale(l.height()+1),T=Math.max(1,l.scale(1));n.setLayer(si.OVERLAYSSHADOW);n.rect(m,y,Z,V,At.white,S,At.white,!0,"_overviewBorder1");n.rect(Y,H,L,z,At.lightgrey,T,At.white,!1,"_overviewBorder2");n.setLayer(si.OVERVIEW);n.rect(m,y,Z,V,At.white,S,At.white,!1);n.rect(Y,H,L,z,At.lightgrey,T,At.white,!1);if(r){var N=Date.now();if(A&&!X&&N<R+1e3&&B)e.trigger("redraw");else{R=Date.now();A=!0;if(o.webgl){U(l);t.setOverviewView(M)}else{w.clearRect(0,0,b,b);w.fillStyle=At.white;w.fillRect(0,0,b,b);t.drawBackground(w);U(l);ei(n,w,M,u,t.options(),!1,null,!0)}B=Date.now()-R>30}k||(k=W(0));var D=X?E:0,O=X?F:0,_=X?"_overviewBoxDragging":"_overviewBox";f=l.scale(x?k.x1+D:l.width()-b+k.x1+D);d=l.scale(C?k.y1+O:l.height()-b+k.y1+O);g=l.scale(x?k.x2+D:l.width()-b+k.x2+D);h=l.scale(C?k.y2+O:l.height()-b+k.y2+O);var K=Math.max(1,l.scale(2));n.setLayer(si.OVERVIEWSHADOW);n.rect(f,d,g,h,i,K,a,!X,_);n.setLayer(si.OVERVIEW);n.rect(f,d,g,h,i,K,a,!X,_)}}var P=I?G:p,J=u[P].im;if(v.icon){n.rect(x?l.scale(-1):l.scale(l.width()-J.width)-.5,C?l.scale(-1):l.scale(l.height()-J.height)-.5,x?l.scale(J.width)+.5:l.scale(l.width()+1),C?l.scale(J.height)+.5:l.scale(l.height()+1),At.lightgrey,Math.max(1,l.scale(1)),At.white,!0,"_overviewIconRect");n.image(l.scale(x?0:l.width()-J.width),l.scale(C?0:l.height()-J.height),l.scale(x?J.width:l.width()),l.scale(C?J.height:l.height()),P,"_overviewIcon","co",!1,!0);if(o.webgl&&!u._coList[P]){u._coList[P]=!0;u._coList[Sn(P)]=!0;u.updated=!0}n.setLayer(si.OVERVIEWSHADOW)
;n.rect(l.scale(x?-1:l.width()-2*J.width),l.scale(C?-1:l.height()-2*J.height),l.scale(x?2*J.width:l.width()+1),l.scale(C?2*J.height:l.height()+1),At.lightgrey,-1,At.white,!0,"_overviewIcon")}}}};s.push(D)};o.remove=function(e,t,n){var r=42,i={generate:function(i,a,o){i.setLayer(si.OVERLAYS);var l=Nn(a,e,r).width,u=o.scale((o.width()-l)/2),s=o.scale((o.height()+r)/2);i.text(u+2,s+2,e,n,o.scale(r),!0,null,null,!1,l,!1,!1,u+2,s+2-o.scale(r),u+2+l,s+2);i.text(u,s,e,t,o.scale(r),!0,null,null,!1,l,!1,!1,u,s-o.scale(r),u+l,s)}};s.push(i)};o.drawOverviewContent=function(e,t){if(I&&y){var n=t.scale(b);e.drawImage(y,0,0,n,n,t.scale(x?0:t.width()-b),t.scale(C?0:t.height()-b),n,n)}};o.addBanding=function(e){var t=6,n=3,r=3,i=6,a={generate:function(a,o,l){var u=U({top:!0},e.bands);if(u&&u.bands){var s,c,f,d,g,h,v;a.setLayer(si.BANDS);var m=1/0;for(s=0;s<u.bands.length;s++)if((g=u.bands[s]).t){c=l.dim(g.w/2);f=g.ff||e.fontFamily;h=.75*(d=g.fs||20);(v=Nn(o,g.t,d,g.fb,f).width/2)+h>c&&(d=Math.floor(d*c/(v+h)));d<m&&(m=d)}m!==1/0&&(h=.75*m);for(s=0;s<u.bands.length;s++){g=u.bands[s];var p=l.x(g.x),b=l.x(g.x-g.w/2),y=l.x(g.x+g.w/2),I=l.scale(-1),x=l.scale(l.height()+1);c=l.dim(g.w/2);var C=g.c||"#f7f7f7";a.rect(b,I,y,x,"white",-1,C,!0,"");var G=!(g.t&&m>3);a.setLayer(si.BANDLABELS);f=g.ff||e.fontFamily;v=Nn(o,g.t,m,g.fb,f).width/2;var w=g.fc||At.lightgrey,Z=l.scale(m),A=(y-b)/2-v;if(u.top){var B=t+Z;a.rect(b,I,y,B+n,"white",-1,C,!0,"",null,G);a.text(p-v,B,g.t,w,Z,g.fb,"",f,!1,2*v,!1,!1,b+A,I+2*n,y+A,B+2*n,null,null,null,G)}if(u.bottom){var R=l.height()-r,M=R-(Z+i);a.rect(b,M,y,x,"white",-1,C,!0,"",null,G);a.text(p-v,R,g.t,w,Z,g.fb,"",f,!1,2*v,!1,!1,b+A,M+2*n,y+A,M+2*n+d,null,null,null,G)}a.setLayer(si.BANDS)}}}};s.push(a)};return o}function al(e,t,n,r,i){var a={},o=0,l=0,u=0,s=0,c=0,f=t||0,d=n||0,g=r||1;a.scaleFactor=function(e){e&&(g=e);return g};a.scale=function(e){return Math.floor(g*e)};var h=a.scale;a.unscale=function(e){return Math.floor(e/g)};a.settings=function(){return{width:f,height:d,zoom:u,offsetX:s,offsetY:c}};a.fromSettingsDirect=function(e,t,n,r){return O(u,k(e.zoom),e.offsetX-s,e.offsetY-c,t,n,r)};a.fromOldSettings=function(t,n,r,i){if(n){var a=al(e,t.width,t.height);a.setZoom(t.zoom,!1);a.offsetX=t.offsetX;a.offsetY=t.offsetY;var o={x1:a.viewToWorldX(0),y1:a.viewToWorldY(0),x2:a.viewToWorldX(a.width()),y2:a.viewToWorldY(a.height())};return F(o,null,r,!1,!1,!1,i)}X(t.zoom,!1);s=t.offsetX;c=t.offsetY};a.width=function(e){e&&(f=e);return f};a.height=function(e){e&&(d=e);return d};a.worldToViewX=function(e){return Math.floor(((e-o)*u+s)*g)};a.x=a.worldToViewX;var v=a.worldToViewX;a.worldToViewY=function(e){return Math.floor(((e-l)*u+c)*g)};a.y=a.worldToViewY;var m=a.worldToViewY;a.viewToWorldX=function(e){return Math.floor((e/g-s)/u+o)};var p=a.viewToWorldX;a.viewToWorldY=function(e){return Math.floor((e/g-c)/u+l)};var b=a.viewToWorldY;a.w=function(e){return-1===e?-1:Math.max(1,Math.floor(e*u*g))};a.sw=function(e){return-1===e?-1:a.w(e)+7};a.dim=function(e){return Math.floor(e*u*g)};a.sdim=function(e){return e&&e*u*g};a.undim=function(e){return Math.floor(e/(u*g))};a.sundim=function(e){return e/(u*g)};var y=1.4,I=4,C=.05,G=C,w=.001,Z=1,A=200,R=1/0,M=100;function W(){return i&&i.api.isShown()}a.getMaxZoom=function(){return I};a.getMinZoom=function(){return G};a.setMinZoom=function(e){G=Math.min(Z,Math.max(w,e||C));u<G&&O(u,G,s,c,!1)};a.setMaxItemZoom=function(e){R=e||1/0};a.getMaxItemZoom=function(){return R};a.zoomIn=function(e,t,n){var r=V();return L(r,g*f/2,g*d/2,e,t,n)};a.zoomOut=function(e,t,n){var r=S();return L(r,g*f/2,g*d/2,e,t,n)};function V(){return k(u*y)}function S(){return k(u/y)}var k=function(e){return Math.min(I,Math.max(e,G))};a.setZoom=function(e,t,n,r){var i=k(e);return L(i,g*f/2,g*d/2,t,n,r)};var X=a.setZoom;a.getUnzoom=function(){return u>R?R/u:1};a.wheelToPosition=function(e,t,n){var r=e>0?V():S();return L(r,t,n,!0,200)};a.worldExtentsToView=function(e){return e?{x1:v(e.x1),y1:m(e.y1),x2:v(e.x2),y2:m(e.y2)}:null};var E=a.worldExtentsToView;a.fitWorldExtents=function(e,t,n,r,i,a,o){if(!e){x(o);return null}var l=E(e);return F(l,null,t,n,r,i,a,!1,o)};a.fitExtents=function(e,t,n,r,i,a,h,v,m,y){var I;if((e.y2-e.y1)/(e.x2-e.x1)>d/f){I=u*(d-(a?d/8:0))/(e.y2-e.y1)}else{I=u*(f-(a?f/8:0))/(e.x2-e.x1)}I*=g;r&&(I=k(I));i&&I>1&&(I=1);y&&(I=u);var x=(e.x1+e.x2)/2,C=(e.y1+e.y2)/2,G=t?(t.x1+t.x2)/2:p(x),w=t?(t.y1+t.y2)/2:b(C);return O(u,I,f/2-(G-o)*I-s,d/2-(w-l)*I-c,n,h,m,v)};var F=a.fitExtents;function Y(e,t,n,r,i,o,l,u,s,c,f){t.generate(n,r,a,i,s,!0,!1);var d=n.itemExtents(e,r);if(d){var g=E(d);if(f){var h;h=e?g.x1+(g.x2-g.x1)/2:a.width()/2;g.x1=h;g.x2=h}return F(g,d,o,!0,!0,!0,l,!1,u,c)}x(u);return null}a.fitToSelection=function(e,t,n,r,i,a,o,l,u,s){return Y(e.privateSelection(),e,t,n,r,i,a,l,u,s)};a.fitToModel=function(e,t,n,r,i,a,o,l,u,s){return o?Y(H(o),e,t,n,r,i,a,l,u,s):Y(null,e,t,n,r,i,a,l,u)};a.fitModelHeight=function(e,t,n,r,i,a,o,l,u,s){return o?Y(H(o),e,t,n,r,i,a,l,u,s,!0):Y(null,e,t,n,r,i,a,l,u,!1,!0)};a.zoomToPosition=function(e,t,n,r,i,a){var f=k(e),d=p(t),h=b(n);return O(u,f,t/g-(d-o)*f-s,n/g-(h-l)*f-c,r,i,a)};var L=a.zoomToPosition;a.reset=function(e){o=421;l=298;if(e)O(u,1,421-s,298-c,!0);else{s=421;c=298;u=1}};var z=a.reset;a.zoom=function(){return W()?i.internalUse.getZoom():u};a.offsetXtoWebglPanX=function(){var e=f/2;return-(1-a.offsetX()/e)+(e-o)/e*u};a.offsetYtoWebglPanY=function(){var e=d/2;return 1-a.offsetY()/e-(e-l)/e*u};a.offsetX=function(e){B(e)&&(s=e);return s};a.offsetY=function(e){B(e)&&(c=e);return c};a.pan=function(e,t,n,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return D(i*=M,a*=M,t,!1,n,r)};a.panBy=function(e,t,n,r,i,a){return O(u,u,e,t,n,i,a,r)};var T,N,U,D=a.panBy,O=function(t,n,r,i,a,o,l,f){var d=r||0,g=i||0;if(a)return _(t,n,d,g,o,l);s+=Math.floor(d);c+=Math.floor(g);u=n;e&&!f&&e.trigger("viewchange");x(l)},_=function(t,n,r,i,a,o){var l=a||A,f=l,d=s,g=c;return Qn(function(a){f-=a;var h=e.atanEasing(Math.max(0,Math.min(1,(l-f)/l)));s=d+h*r;c=g+h*i;u=k(t+h*(n-t));var v=f>0;if(!v){e.trigger("viewchange");x(o)}return v},{drawOnly:!0})},K=function(t,n,r,a,o){var l=W(),u=l?-3:.1;return Qn(function(f){var d=0===N&&0===U;if(l)i.internalUse.panBy([N*u,U*u],{animate:!1});else{s+=f*u*N;c+=f*u*U}T=!d;r&&r.dragMove(t,n,a,o);d||e.trigger("viewchange");return!d},{positions:!0})};a.cancelScroll=function(){N=0;U=0};a.maybeScroll=function(e,t,n,r,i){var a=h(50);N=0;U=0;e<a&&(N=1);e>h(f)-a&&(N=-1);t<a&&(U=1);t>h(d)-a&&(U=-1);if(n.direction){n.direction.x||(N=0);n.direction.y||(U=0)}if((0!==N||0!==U)&&!T){T=!0;return K(e,t,n,r,i)}};z();return a}var ol=Object.freeze({createView:al});function ll(e,t,n){var r={},i=null,a=null,l=null,u=null;t.privateBind("redraw",function(){i=null;a=null});function s(e,t,r){if(!e.type||!e.type.match(/^(node|link|all)$/))throw new TypeError("options type property should be either 'node', 'link' or 'all'");if(!e.items||!e.items.match(/^(underlying|toplevel|all)$/))throw new TypeError("options items property should be either 'underlying', 'toplevel' or 'all'");if(!i){a=n.privateGetRawItems();l=a;if(t)u=a;else{i=o(a,"d");u=i}}if(m(r))for(var s=0;s<l.length;s++){var c=l[s];d(e.type,c)&&g(e.items,c)&&r(u[s])}}r.each=s;r.filter=function(t,r,i){var a="underlying"===r.items,l=h(t,"hi","shown","hidden",r.type,r.hideSingletons,!1,a),u=l.shown.nodes.concat(l.shown.links),s=l.hidden.nodes.concat(l.hidden.links),c=e.combo.internalUse.filter(u,s,l,r);u=c.toShow;function f(){x(i,o({shown:l.shown,hidden:l.hidden,combos:l.combos},!0))}if((s=c.toHide).length>0)if(u.length>0){r.time/=2;n.privateHideWithoutCombos(s,r,function(){n.privateShowWithoutCombos(u,!1,r,f)})}else n.privateHideWithoutCombos(s,r,f);else u.length>0?n.privateShowWithoutCombos(u,!1,r,f):f()};r.foreground=function(t,r,i){var a="link"===r.type,l="underlying"===r.items,u=h(t,"bg","foreground","background",r.type,a,!0,l),s=u.foreground.nodes.concat(u.foreground.links),c=u.background.nodes.concat(u.background.links),f=e.combo.internalUse.foreground(s,c,u,r);c=f.toHide.map(function(e){return{id:e,bg:!0}});s=f.toShow.map(function(e){return{id:e,bg:!1}});n.setProperties(s.concat(c),!1,function(){x(i,o({foreground:u.foreground,background:u.background},!0))})};function c(e,t){t.forEach(function(t){if(e[t.id]){e[t.id1]=!0;e[t.id2]=!0}})}function f(e,t){t.forEach(function(t){e[t.id]=!(!e[t.id1]||!e[t.id2])})}function d(e,t){return"all"===e||e===t.type}function g(e,t){var n=!0;switch(e){case"toplevel":n=!t._parentId;break;case"all":n=!0;break;case"underlying":default:n=!t._combo}return n}function h(e,t,n,r,i,a,o,l){var u={},d={all:{}};d[n]={nodes:[],links:[]};d[r]={nodes:[],links:[]};d.all[n]={nodes:[],links:[]};d.all[r]={nodes:[],links:[]};var g=h();v(g);m(g);p(g);b(g);y(g);g.all.forEach(function(e){var i=e.type+"s",a=u[e.id]?n:r;!u[e.id]==!e[t]&&d[a][i].push(e.id);d.all[a][i].push(e.id)});return d;function h(){var e={all:[],nodes:[],links:[]};s({type:"all",items:l?"underlying":"toplevel"},!1,function(t){e.all.push(t);e[t.type+"s"].push(t)});return e}function v(t){("node"===i?t.nodes:"link"===i?t.links:t.all).forEach(function(t){e(t)&&(u[t.id]=!0)})}function m(e){"link"===i&&(a?c(u,e.links):e.nodes.forEach(function(e){u[e.id]=!0}))}function p(e){"node"===i&&f(u,e.links)}function b(e){"all"===i&&"bg"!==t&&e.links.forEach(function(e){u[e.id]=!(!u[e.id1]||!u[e.id2]||!u[e.id])})}function y(e){if("link"!==i&&a){var t={};e.links.forEach(function(e){t[e.id1]=t[e.id1]||u[e.id]&&u[e.id2];t[e.id2]=t[e.id2]||u[e.id]&&u[e.id1]});e.nodes.forEach(function(e){u[e.id]=u[e.id]&&t[e.id]})}}}return r}function ul(e,t,n,r,i){var a=Ko(),l=sl(t),u={},s={list:[],index:{},nulls:0,comboLinkAdj:{}},c={},f=null,d=[],g={},h=[],v=A(e,{arrange:"concentric",resize:!0,updateGlyph:!0});function m(){s={list:[],index:{},nulls:0,comboLinkAdj:{}};u={};c={};f=null;d=[]}g.privateState=function(){return{itemsToMergeList:s.list,propertiesToSetMap:u,idsToRemoveMap:c,idsToSelectMap:f}};g.getProperty=function(e,n){var r,i=u[e];if(void 0!==i&&void 0!==(r=i[n]))return r;var a=S(e);if(null!==a&&void 0!==(r=a[n]))return r;var l=t.privateGetItem(e);return l?o(l[n]):void 0};var p=g.getProperty;function b(e){if(c[e])return null;var n=o(t.privateGetItem(e))||{},r=S(e);null!==r&&U(n,r);u[e]&&U(n,u[e]);return n}function y(e){return p(e,"_parentId")}g.getComboProperty=function(e){return p(e,"_combo")};var I=g.getComboProperty;function C(e){var t=u[e];if(!t){t={id:e};u[e]=t}return t}g.setProperty=function(e,t,n){C(e)[t]=n};var G=g.setProperty;g.setProperties=function(e){var t=C(e.id);D(t,e)};var w=g.setProperties;function Z(e,t){G(e,"_offset",t)}g.setComboSubProperty=function(e,t,n){var r=I(e);r[t]=n;G(e,"_combo",r)};function B(e,t){if(n&&n.api.isShown()){var r=b(e),i=n.internalUse.preMerge([r]);G(e,"hi",i[0].hi);te(e,i[0].x-r.x,i[0].y-r.y)}else if(v.reposition&&t){var a=p(e,"_offset"),o=p(t,"x"),l=p(t,"y"),u=p(e,"x"),s=p(e,"y");te(e,o-a.x-u,l-a.y-s)}}function R(e,t){var n=y(e)||null;if(t!==n){j(e);G(e,"_parentId",t);if("node"===p(e,"type"))if(t)p(e,"_offset")||Z(e,{x:p(t,"x")-p(e,"x"),y:p(t,"y")-p(e,"y")});else{B(e,n);Z(e,null)}}}function W(e,t){e.forEach(function(e){R(e,t);c[e]&&j(e)})}function V(e){var t=s.index[e];if(void 0!==t){var n=s.list[t];s.list[t]=null;delete s.index[e];s.nulls++;var r=s.list.length;if(r>0&&s.nulls/r>.5){s.index={};for(var i=0,a=0;a<r;){if(null!==s.list[a]){s.list[i]=s.list[a];s.index[s.list[i].id]=i;i++}a++}s.list.length=i;s.nulls=0}if("link"===n.type&&n._combo){var o=s.comboLinkAdj;delete o[n.id1][n.id2];delete o[n.id2][n.id1]}}}function S(e){var t=s.index[e];return void 0===t?null:s.list[t]}g.mergeItem=function(e){if(void 0===s.index[e.id]){s.index[e.id]=s.list.push(e)-1;if("link"===e.type&&void 0!==e._combo){var t=s.comboLinkAdj,n=e.id1,r=e.id2;void 0===t[n]&&(t[n]={});void 0===t[r]&&(t[r]={});t[n][r]=e;t[r][n]=e}}else s.list[s.index[e.id]]=e};var k=g.mergeItem;function X(e,t,n){function r(e){return(y(e)||null)!==n}var i=e.filter(r),a=t.filter(r);if(n){var o=I(n);i&&i.length&&(o.nodeIds=o.nodeIds.concat(i));a&&a.length&&(o.linkIds=o.linkIds.concat(a));G(n,"_combo",o)}h=h.concat(i.concat(a));W(i.concat(a),n);n&&ai(n)&&a.length&&N(n)}g.transferNodesToCombo=function(e,t){X(e,[],t)};function F(e,t){X([],e,t)}function Y(e,t){F([e],t)}function H(e,t){(e._parentId||null)!==t&&Y(e.id,t)}function L(e){var t=e,n=[];do{n.unshift(t);t=y(t)}while(t);return n}g.getChangingComboNodeIds=function(){var e=[];E(u).forEach(function(t){t._combo&&oi(t.id)&&e.push(t.id)});return e};function T(e){for(var t,n,r,i=L(p(e,"id1")),a=L(p(e,"id2")),o=0,l=Math.min(i.length,a.length);o<l&&i[o]===a[o];)o++;if(o===i.length){t=a[o-1];n=a[o];r=t}else if(o===a.length){t=i[o-1];n=i[o];r=t}else{t=i[o];n=a[o];r=0===o?null:i[o-1]}return{id1:t,id2:n,parentId:r}}g.updateComboLinkProperties=function(e){if(!c[e]){var t,n=p(e,"id1"),r=I(e).linkIds,i=r.length,a=!1,o=!1,l=!0;for(t=0;t<i;t++){var u=!!p(r[t],"a1"),s=!!p(r[t],"a2"),f=n===T(r[t]).id1;a=a||(f?u:s);o=o||(f?s:u);if(a&&o)break}for(t=0;t<i;t++)if(!p(r[t],"hi")){l=!1;break}w({id:e,a1:a,a2:o,hi:l})}};var N=g.updateComboLinkProperties;function O(e,t,n){var i=r(),a=o(n,!0);a.id=i;a.id1=e;a.id2=t;a.off=0;a._combo={linkIds:[]};return a}function P(e){var t=T(e.id),n=ee(t.id1,t.id2);if(!n){var r=O(t.id1,t.id2,e);n=r.id;k(r);null!==t.parentId&&Y(n,t.parentId)}H(e,n)}g.transferRawLinkToCorrectParent=function(e){if(!c[e.id]){var t=y(e.id1),n=y(e.id2);t||n?t===n||t===e.id2?H(e,t):n===e.id1?H(e,n):P(e):H(e,null)}};g.transferComboLinkToCorrectParent=function(e){if(!c[e.id]){var t=y(e.id1)||null,n=y(e.id2)||null,r=n===e.id1?n:t;Y(e.id,r)}};function J(e,t){if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}}g.removeItemFromParent=function(e){var t=y(e);if(t&&!c[t]){var n=I(t),r=n.nodeIds,i=n.linkIds;J(r,e);J(i,e);if(r&&r.length||i.length){G(t,"_combo",n);ai(t)&&N(t)}else q(t)}};var j=g.removeItemFromParent;g.removingItem=function(e){return!!c[e]};var Q=g.removingItem;g.getIdsToRemove=function(){return Object.keys(c)};function q(e){if(!c[e]){c[e]=!0;$(t.privateNeighbourLinkIds([e]));j(e);delete u[e];V(e)}}g.removeItems=function(e){e.forEach(q)};var $=g.removeItems;g.selectItems=function(e){f=f||{};e.forEach(function(e){f[e]=!0})};function ee(e,n){var r=null,i=s.comboLinkAdj[e];void 0!==i&&void 0!==i[n]&&(r=i[n].id);if(null===r)for(var a=t.privateGetLinksBetween(e,n),o=a.length,l=0;l<o;l++){var u=a[l];u._combo&&!c[u.id]&&(r=u.id)}return r}function te(e,t,n){var r=p(e,"x"),i=p(e,"y");G(e,"x",r+t);G(e,"y",i+n);var a=I(e);a&&a.nodeIds.forEach(function(e){te(e,t,n)})}function ne(){var e,t,n,r,i={};for(e=0,t=d.length;e<t;e++){void 0===i[(n=d[e]).id]&&(i[n.id]={id:n.id,dx:0,dy:0,sumX:0,sumY:0});n.norm=_(p(n.id,"x")-p(n.to,"x"),p(n.id,"y")-p(n.to,"y"));i[n.id].sumX+=n.norm[0]*n.distance;i[n.id].sumY+=n.norm[1]*n.distance}for(e=0,t=d.length;e<t;e++){var a=K((n=d[e]).norm[0],n.norm[1],i[n.id].sumX,i[n.id].sumY);r=Math.abs(a)*n.distance;i[n.id].dx+=n.norm[0]*r;i[n.id].dy+=n.norm[1]*r}return E(i)}function re(e,r){var i=y(e),a=[];i?a=t.privateGetItem(I(i).nodeIds):n.api.isShown()||(a=t.privateGetRawItems().filter(function(t){var n=Q(t.id),r=y(t.id);return!n&&!r&&e!==t._parentId}));a.filter(function(t){return"node"===t.type&&!t.hi&&t.id!==e}).forEach(function(t){d.push({id:t.id,to:e,distance:r})})}function ie(e){d.forEach(function(t){e[t.id]&&(t.distance=0)})}g.adjustForNewComboSize=function(e,t,n){if(0!==t){n&&re(e,t);var r=y(e);if(r){var i=ge(r),a=p(r,"oc")||{},o=2*i.r;if(o!==a.w){var l=(o-a.w)/2;a.w=o;G(r,"oc",a);I(r).open&&oe(r,l,n)}}}};var oe=g.adjustForNewComboSize;function le(e,t,n,r){for(var a=[],o=I(e).nodeIds,l=o.length,u=0;u<l;u++){var s=b(o[u]);if(!s.hi){var c=n&&n[s.id],f=i.nodeSize(s,t,!0,r),d=s._combo?i.nodeSize(s,t,!0,r,!0):f;a.push({id:s.id,x:c?s.x+c.dx:s.x,y:c?s.y+c.dy:s.y,t:s.t,rOpen:d.radius,labelOffset:i.labelOffset(s,r),r:f.radius})}}return a}g.addPaddingToNodes=function(e,t,n,r,i){var a=le(e,t,r,i);a.forEach(function(e){e.r+=n});return a};var ue=g.addPaddingToNodes;function se(e,t,n,r){var i=le(e,t,null,r);return z(a.concentricLayout(i,{includeLabels:!0,padding:n}))}function ce(e,t,n,r){var a=I(e),o=l.layout("lens",z(a.nodeIds.map(b)),z(a.linkIds.map(b).filter(function(t){return t.id1!==e&&t.id2!==e})),{consistent:!0}),u=le(e,t,null,r);u.forEach(function(e){e.x=o.vertices[e.id].x;e.y=o.vertices[e.id].y});var s=i.radialExtents(u,t,n,!0,r);null!==s&&u.forEach(function(e){e.x-=s.x;e.y-=s.y});return z(u)}function fe(e,t,n,r,a){var o=p(e,"oc")||{},l=2*t.r;if(n||o.w<l){o.w=l;G(e,"oc",o);var u=I(e);if(!u.open){var s=b(e),c=i.nodeSize(s,r,!0,a,!0),f=i.nodeSize(s,r,!0,a,!1);u.e=f.radius/c.radius;G(e,"_combo",u)}}}function de(e,t,n){for(var r=I(e).nodeIds,i=r.length,a=p(e,"x"),o=p(e,"y"),l=0;l<i;l++){var u=r[l];if(!p(u,"hi")){var s={id:u},c=p(u,"x"),f=p(u,"y");if(n){s._offset={x:a-c-n.dx,y:o-f-n.dy};w(s)}te(u,a+t[u].x-c,o+t[u].y-f)}}}function ge(e,n,r){var a=t.privateGetCanvas(),o=z(ne()),l=z(ue(e,a,ni,o,r)),u={x:p(e,"x"),y:p(e,"y")};return i.getExtents(l,a,0,n,u,r)}g.layoutCombo=function(e,n){var r,a=t.privateGetCanvas(),o=t.options().truncateLabels,l=o?o.maxLength:void 0;if("none"===v.arrange)fe(e,r=ge(e,!0,l),v.resize,a,l);else{var u,s;if("concentric"===v.arrange){u=se(e,a,ni,l);s=0}else{u=ce(e,a,ni,l);s=10}r=i.getExtents(u,a,s,!0,null,l);ie(u);fe(e,r,v.resize,a,l);de(e,u,n)}return r};g.setComboMinimumSize=function(e){var n=t.privateGetCanvas(),r=t.options().truncateLabels,i=r?r.maxLength:void 0;fe(e,ge(e,!0,i),!1,n,i)};function he(e){var t=I(e);return t?t.nodeIds.reduce(function(e,t){return e+he(t)},0):p(e,"hi")?0:1}function ve(e){var t=I(e);if(t.g){var n=!1,r=(p(e,"g")||[]).map(function(r){if(r.p===t.g){n=!0;return D(r,{t:he(e)})}return r});if(n)G(e,"g",r);else{t.g=void 0;G(e,"_combo",t)}}}function me(){var e={};[E(u),s.list].forEach(function(t){t.forEach(function(t){if(t){var n=t.id;if(t._combo&&"node"===p(n,"type")){L(n).forEach(function(t){if(!e[t]){ve(t);e[t]=!0}})}}})})}function pe(e){if(f){t.selection(Object.keys(f));t.trigger("selectionchange")}else{var n=e.filter(t.privateItemIsShown);if(e.length!==n.length){t.selection(n);t.trigger("selectionchange")}}}function be(e){for(var n=L(e),r=0;r<n.length;r++){var i=n[r],a=I(i),o=t.privateGetItem(i),l=o&&o._combo;if(!(l&&l.open||a&&a.open))return i}return e}function ye(e){for(var n=t.privateGetAncestryIds(e),r=0;r<n.length;r++){var i=t.privateGetItem(n[r])._combo;if(!i||!i.open)return n[r]}return e}function Ie(e,n){Object.keys(e).forEach(function(r){var i=e[r],a=o(t.privateGetItem(r)._combo);M(i.open)||(a.open=i.open);a.nodeIds=xe(a.nodeIds,i.removeNodeIds);a.nodeIds=Ce(a.nodeIds,i.addNodeIds);a.linkIds=xe(a.linkIds,i.removeLinkIds);a.linkIds=Ce(a.linkIds,i.addLinkIds);n.push({id:r,_combo:a})})}function xe(e,t){var n=e;t.length&&(n=n.filter(function(e){return-1===t.indexOf(e)}));return n}function Ce(e,t){var n=e;t.length&&(n=n.concat(t));return n}function Ge(){var e=[],n={},r=[],i={},a={};function o(e){a[e]||(a[e]={addNodeIds:[],removeNodeIds:[],addLinkIds:[],removeLinkIds:[]})}function l(e,t,n){o(t);var r="node"===e.type?"NodeIds":"LinkIds",i=(n?"add":"remove")+r;a[t][i].push(e.id)}function s(e){i[e]=!0;var n=t.privateGetItem(e);if(n&&"link"===n.type){c[n.id1]&&(i[n.id1]=!0);c[n.id2]&&(i[n.id2]=!0)}}E(u).forEach(function(i){var l=i.id,f=t.privateGetItem(l);if("x"in i&&f){var d=be(l);r.push({id:l,x:p(d,"x"),y:p(d,"y")})}if("_parentId"in i&&f&&f._parentId!==i._parentId){var g={id:l},h="node"===f.type;g._parentId=null;if(h){var v=ye(l),m=t.privateGetItem(v);g.x=m.x;g.y=m.y;"x"in i||r.push({id:l,x:f.x,y:f.y})}else if(i._parentId)if(oi(i._parentId)){var b=t.privateGetItem(i._parentId);if(b&&(!b._combo.open||!t.privateAllParentsOpen(i._parentId))&&f._parentId){delete g._parentId;c[f._parentId]&&s(f._parentId)}}else if(ai(i._parentId)){var y=S(i._parentId),I=t.privateGetItem(i._parentId),x=y||I;if(x){if(t.privateGetItem(x.id1)&&t.privateGetItem(x.id2)){var C=u[x.id1]&&"_parentId"in u[x.id1],w=u[x.id2]&&"_parentId"in u[x.id2],Z=C||t.privateAllParentsOpen(x.id1),A=w||t.privateAllParentsOpen(x.id2);if(Z&&A){g._parentId=i._parentId;y&&(n[i._parentId]=!0)}else if(f._parentId&&c[f._parentId]){if(!p(l,"hi")){g.hi=!0;G(l,"hi",!1)}}else delete g._parentId}else if(c[f._parentId]){delete g._parentId;s(f._parentId)}}else c[f._parentId]&&(g._parentId=i._parentId)}e.push(g)}if("_combo"in i&&oi(l)&&f&&f._combo.open!==i._combo.open){r.push({id:l,_combo:{e:i._combo.e}});o(l);a[l].open=!0}oi(l)&&f&&"oc"in i&&f.oc&&f.oc.w!==i.oc.w&&r.push({id:l,oc:{w:i.oc.w}})});e.forEach(function(e){var n=t.privateGetItem(e.id);if("_parentId"in e){var r=n._parentId,a=e._parentId,o=r&&c[r]&&!i[r];r&&!o&&l(n,r,!1);a&&(S(a)||l(n,a,!0))}});Object.keys(c).forEach(function(e){if(!i[e]){var n=t.privateGetItem(e);n&&n._parentId&&l(n,n._parentId,!1)}});Ie(a,e);return{propertiesToSetBeforeAnimation:e,itemsToMergeBeforeAnimationMap:n,propertiesToAnimate:r,idsToRemoveAfterAnimationMap:i}}function we(e,n){var r=v.animate&&Ge();v.animate&&Object.keys(r.idsToRemoveAfterAnimationMap).forEach(function(e){delete c[e]});t.privateRemoveItem(Object.keys(c));if(v.animate){var i=[];Object.keys(r.itemsToMergeBeforeAnimationMap).forEach(function(e){i.push(S(e));V(e)});t.privateMerge(i);t.privateSetNonImageProperties(r.propertiesToSetBeforeAnimation);t.privateSetAllDirty();x(n);t.privateAnimateProperties(r.propertiesToAnimate,v,function(){t.privateRemoveItem(Object.keys(r.idsToRemoveAfterAnimationMap));x(e)},!0)}else x(e)}g.applyUpdates=function(e,n){v.updateGlyph&&me();var r=t.selection();ne().forEach(function(e){te(e.id,e.dx,e.dy)});t.privateAddItemsToTransfer(h);we(function(){t.privateMerge(s.list.filter(function(e){return null!==e}));v.animate||x(n);t.privateSetNonImageProperties(E(u),!0);t.privateRemoveItemsFromTransfer(h);h=[];pe(r);m();x(e)},n)};g.preMergeDetails=function(){return{itemsToMerge:s.list,propertiesToSet:E(u)}};return g}function sl(e){var t=tl(e),n={trigger:function(){}};function r(r,i,a,o){var l=null,u=function(){null===l&&(l=jo()).privateSetProperties(i,a);return l},s=e.privateGetCanvas(),c=e.privateGetGenerator(),f=t.extractStructure(c,s,i,a,u,[],!0,!1,"underlying");return t.layout(r,n,f,u,o,null)}return{layout:r}}function cl(e,t,n){var r=_o(),i=0;function a(t){var n=r.nodeSize(t,e.privateGetCanvas(),!1).radius;t._combo&&t._combo.open&&(t.oc&&h(t.oc.bw)?n-=t.oc.bw:n-=rr.bw);return Math.max(n,0)}function l(){var t=0,i=L({animate:!1});n.privateBind("dragstart",function(n,r){if("resize"===n&&r){var i=e.privateGetItem(r);"node"===i.type&&i._combo&&i._combo.open&&(t=a(i))}});n.privateBind("dragcomplete",function(n,o){if("resize"===n&&o){var l=e.privateGetItem(o);if("node"===l.type&&l._combo&&l._combo.open){var u=e.privateGetCanvas(),s=i.addPaddingToNodes(o,u,ni),c=r.getExtents(s,u,0,!0,l),f=a(l);if(f<c.r){var d=i.getProperty(o,"oc")||{};f=c.r;d.w=2*c.r;i.setProperty(o,"oc",d)}var g=f-t;i.adjustForNewComboSize(o,g,!0);i.applyUpdates()}}})}l();function u(t){var n;do{n=t+ ++i}while(e.privateGetItem(n));return n}function s(){return u(ii)}function c(e){["id","id1","id2"].forEach(function(t){t in e&&(e[t]+="")})}function f(e){var t={};e.forEach(function(e){t[e]=!0});return t}function d(e,t){return M(t.label)?e.map(function(e){return e.t}).filter(function(e){return!M(e)}).join("\n"):t.label}function g(e){var t=0,n=0;e.forEach(function(e){t+=e.x||0;n+=e.y||0});return{x:t/e.length,y:n/e.length}}function m(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}function p(e,t){if("first"!==e.position){var n=0,r=0,i=0;t.forEach(function(e){if(m(e.pos)){r+=e.pos.lat;i+=e.pos.lng;n++}});if(n>0)return{lat:r/n,lng:i/n}}else for(var a=0,o=t.length;a<o;a++){var l=t[a];if(m(l.pos))return l.pos}}function b(){return{nodeIds:[],linkIds:[],open:!1,e:1,g:null}}function I(){return{linkIds:[]}}function C(n,r){var i,a=n.style,l=o(a||r[0],!0);l.type="node";l.id=u(ri);l.t=d(r,n);l._combo=b();n.open&&(l._combo.open=!0);n.openStyle&&(l.oc=o(n.openStyle,!0));l.oc||(l.oc={});h(l.oc.w)||(l.oc.w=0);a&&!M(a.hi)?l.hi=a.hi:l.hi=r.every(function(e){return e.hi});a&&!M(a.bg)?l.bg=a.bg:l.bg=r.every(function(e){return e.bg});l.g=l.g||[];if(null!==n.glyph){if(void 0!==n.glyph&&!y(n.glyph))throw new Error("[combo().combine] glyph must be an object");var s={p:"ne",c:"rgb(255, 0, 0)",t:"0"};s=U(s,n.glyph||{});l.g.unshift(s);l._combo.g=s.p}l.pos=a&&m(a.pos)?a.pos:p(n,r);y(n.d)&&(l.d=o(n.d));if(t&&t.api.isShown()&&m(l.pos)){var c=t.api.viewCoordinates(l.pos.lat,l.pos.lng);i=e.worldCoordinates(c.x,c.y)}else i="first"===n.position?r[0]:g(r);l.x=i.x;l.y=i.y;return l}function G(r,i,a){var o=Z(r),l=t.api.isShown(),u=A(i,{animate:!0,select:!0,time:250,arrange:"lens",resize:!0,easing:"cubic"}),s=L(u),c=[],f=[],d={};o.forEach(function(t){var n,r={},i=[];t&&t.ids&&(n=e.privateGetItem(t.ids));l&&t.open&&delete t.open;if(!n)throw new Error("[combo().combine] function must be passed valid combo definitions");n.forEach(function(e){if(!e)throw new Error("[combo().combine] function must be passed valid ids");if("node"===e.type){if(e._parentId)throw new Error("[combo().combine] nodes cannot be combined if they are already in a combo");if(d[e.id])throw new Error("[combo().combine] nodes should only be in one combo");d[e.id]=!0;r[e.id]=!0;i.push(e)}});if(!Object.keys(d).length)throw new Error("[combo().combine] function must be passed at least one node id");var a=C(t,i);s.mergeItem(a);T(s,z(i),a.id,[],[]);var o={dx:0|t.dx,dy:0|t.dy};s.layoutCombo(a.id,o);c.push(a);f.push(a.id)});u.select&&s.selectItems(f);n.trigger("prechange","combine");s.applyUpdates(function(){e.applyRevealedLinkOffsets(c);e.privateSetAllItemsInComboDirty(f);x(a,f)})}function w(t,n,r){var i=A(n,{animate:!0,time:250,full:!1,select:!0,reposition:!0}),a=Z(t).filter(function(e){return S(e,"node")});if(0!==a.length){var o=[];a.forEach(function(t){var n=e.privateGetItem(t),r=i.full?N(B(n).nodes):n._combo.nodeIds;o=o.concat(r)});_(o,null,i,"uncombine",r)}else x(r)}function B(t,n,r){var i=t._combo,a=n||{nodes:[],links:[]},o=i.nodeIds?e.privateGetItem(i.nodeIds):[];function l(e){if(e._combo){B(e,a,r);r&&("node"===e.type?a.nodes.push(e):a.links.push(e))}else a[e.type+"s"].push(e)}e.privateGetItem(i.linkIds).forEach(l);o.forEach(l);return a}function R(t){var n=null,r=e.privateGetItem(t);r&&r._combo&&(n=B(r,n));return o(n,!0)}function W(e,t){var n=Z(e),r=A(t,{type:"all"});if(!r.type.match(/^(node|link|all)$/))throw new TypeError("[combo().isCombo] opts type property should be either 'node', 'link' or 'all'");return n.some(function(e){return V(e,r.type)})}function V(t,n){var r=e.privateGetItem(t);return!(!r||"all"!==n&&n!==r.type)&&!!r._combo}function S(t,n){var r=e.privateGetItem(t);return V(t,n)&&!r._parentId}function k(t,n){var r=A(n,{parent:"top"});if(!Array.isArray(t)&&!h(t)&&"string"!=typeof t)throw new Error("[combo().find] Incorrect argument passed");var i={top:function(t){var n=e.privateTopParentId(t);return{parentComboId:n,isCombo:S(n,"all")}},first:function(t){var n=e.privateGetItem(t),r=n?n._parentId:null;return{parentComboId:r,isCombo:V(r,"all")}}},a=i[r.parent]?i[r.parent]:i.top,o=!Array.isArray(t),l=Z(t).map(function(e){var t=a(e);return M(t.parentComboId)||!t.isCombo||t.parentComboId===e?null:t.parentComboId});return o?l[0]:l}function X(t){return e.privateGetAncestryIds(t).length}function F(e,t,n){(t||e.getChangingComboNodeIds()).sort(function(e,t){return X(t)-X(e)}).forEach(function(t){var r=e.getComboProperty(t),i=(e.getProperty(t,"oc")||{}).w,a=e.layoutCombo(t),o=r.open?a.r-i/2:0;(!n||n.resize||o>0)&&e.adjustForNewComboSize(t,o,n.adapt)})}function H(t,n){var r={};if(void 0===t)throw new Error("[combo().transfer] function must be passed a valid transfer destination");var i=t?f(e.privateGetAncestryIds(t)):{};e.privateGetItem(n).forEach(function(e){if(!e)throw new Error("[combo().transfer] function must be passed valid ids");if(i[e.id])throw new Error("[combo().transfer] cannot transfer a combo inside itself");"node"===e.type&&(r[e.id]=e)});return r}function L(n){return ul(n,e,t,s,r)}function T(t,n,r,i,a){var o=Object.keys(n),l={};t.transferNodesToCombo(o,r);var u={};E(n).forEach(function(e){u[e.id]=e;e._combo&&B(e,null,!0).nodes.forEach(function(e){u[e.id]=e});e.hi||i.push(e.id);e._parentId&&(l[e._parentId]=!1)});t.getIdsToRemove().forEach(function(e){var n=t.getProperty(e,"_parentId");n&&(l[n]=!1)});var s=e.privateNeighbourLinkIds(Object.keys(u)),c={},f={};e.privateGetItem(s).forEach(function(t){if(t._combo){f[t.id]=t;e.privateGetItem(t._combo.linkIds).forEach(function(e){c[e.id]=e})}else c[t.id]=t});E(c).forEach(function(e){t.transferRawLinkToCorrectParent(e)});E(f).forEach(function(e){t.transferComboLinkToCorrectParent(e)});i.length>0&&!t.getProperty(r,"hi")&&(i.length=0);Object.keys(l).sort(function(e,t){return X(e)-X(t)}).forEach(function(e){if(!t.removingItem(e)){for(var n=t.getComboProperty(e).nodeIds,r=0;r<n.length;r++){var i=n[r];if(!(t.getProperty(i,"hi")||l[i]&&!1!==l[i]))return}l[e]=!0;a.push(e)}})}function O(e,t,n,r){_(e,t,n,"transfer",r)}function _(t,r,i,a,o){var l=A(i,{animate:!0,time:250,select:!1,arrange:"lens",resize:!0,easing:"cubic",reposition:!1,adapt:!0}),u=null;if(r&&(!(u=e.privateGetItem(r))||"node"!==u.type||!u._combo))throw new Error("[combo().transfer] comboId must be the id of a combo node or null");var s=L(l),c=H(r,Z(t)),f=Object.keys(c),d=[],g=[];l.select&&s.selectItems(f);T(s,c,r,d,g);F(s,null,l);u&&!s.getComboProperty(u.id).open&&f.push(u);n.trigger("prechange",a);s.applyUpdates(function(){d.length>0&&e.show(d,{animate:!1});g.length>0&&e.hide(g,{animate:!1});e.applyRevealedLinkOffsets(f);x(o)},function(){l.animate&&e.applyRevealedLinkOffsets(f)})}function K(t){var n=Z(t),r=e.privateGetItem(n).filter(function(e){return null!==e}),i=L({animate:!1});function a(t){var n=t._combo;e.privateGetItem(n.linkIds).forEach(function(t){r.push(t);t._combo&&e.privateGetItem(t._combo.linkIds).forEach(function(e){r.push(e)})});n.nodeIds&&e.privateGetItem(n.nodeIds).forEach(function(e){r.push(e);e._combo&&a(e)})}r.forEach(function(e){e._combo&&a(e)});var o=z(r)
;e.privateNeighbourLinkIds(Object.keys(o)).forEach(function(t){r.push(e.privateGetItem(t))});i.removeItems(r.map(function(e){return e.id}));i.applyUpdates()}function P(t,n){var r=Z(n);(r=r.filter(function(n){var r=!1;c(n);var i=e.privateGetItem(n.id);if(i&&"type"in n&&n.type!==i.type)return!1;if("node"===n.type)r=!0;else{if("link"!==n.type)throw new Error("The type of the item should be specified.");if(i&&"link"===i.type&&(i.id1!==n.id1||i.id2!==n.id2))throw new Error("You cannot change the ends of an existing link. You should remove the existing item first");r=n.id1!==n.id2||e.options().selfLinks}r&&t.mergeItem(n);return r})).forEach(function(n){if("link"===n.type){var r=e.privateGetItem(n.id);if(r){var i=r._parentId;i&&ai(i)&&t.updateComboLinkProperties(i)}else 0!==n.id2.indexOf("dummyEnd")&&t.transferRawLinkToCorrectParent(n)}})}function J(e){var t=L();P(t,e);return t.preMergeDetails()}function j(t){var n=[];t.forEach(function(t){var r=e.privateGetItem(t.id),i=t.count;if(r.g){var a=!1,o=r.g.map(function(e){if(e.p===r._combo.g){a=!0;return D({},e,{t:i})}return e});a&&n.push({id:r.id,g:o})}});n.length&&e.privateSetNonImageProperties(n)}function Q(e,t,n,r){return e.filter(function(e){return n[e.id]||!r[e.id]&&!e[t]})}function q(t,n,r,i,a){Object.keys(r).forEach(function(r){var o,l,u,s=e.privateGetItem(r),c=B(s),f=Q(c.links,n,i,a);if(s._combo.nodeIds){u="nodes";o=(l=Q(c.nodes,n,i,a)).length>0}else{u="links";o=f.length>0}if(u){if(o&&"hi"===n){var d={id:r,links:f};l&&(d.nodes=l);t.combos[u].push(d)}o!==!s[n]&&(o?i[r]=!0:a[r]=!0)}});return t}function $(t,n,r,i,a){e.privateGetItem(t).forEach(function(t){if(t){var o=t[i]===a;if(t._combo){var l=B(t,null,!0);l.nodes.forEach(function(e){if(!!e[i]===a){o=!0;n[e.id]=!0}});l.links.forEach(function(e){if(!!e[i]===a){o=!0;n[e.id]=!0}});o&&(r[t.id]=!0)}for(var u=e.privateGetParentItems(t.id),s=u.length-1;s>=0;s--){var c=u[s];if("node"===t.type&&o&&"hi"===i||!!c[i]===a){r[c.id]=!0;o=!0}}}})}function ee(t,n,r){e.privateGetRawItems().forEach(function(e){if(oi(e.id)&&fe(e.id)&&(!e.bg||t[e.id])){delete t[e.id];delete n[e.id];e.bg||(r[e.id]=!0)}})}function te(t,n,r,i,a,o,l){var u={toShow:[],toHide:[]};u[i]={nodes:[],links:[]};u[a]={nodes:[],links:[]};"hi"===t&&(u.combos={nodes:[],links:[]});var s={},c=Y(n),f=Y(r),d=n,g=r;if(o&&o.all){d=o.all[i].nodes.concat(o.all[i].links);g=o.all[a].nodes.concat(o.all[a].links)}$(d,c,s,t,!0);$(g,f,s,t,!1);l||"bg"!==t||ee(s,c,f);u=q(u,t,s,c,f);e.privateGetItem(Object.keys(c)).forEach(function(e){if(null!==e){u.toShow.push(e.id);u[i][e.type+"s"].push(e.id)}});e.privateGetItem(Object.keys(f)).forEach(function(e){if(null!==e){u.toHide.push(e.id);u[a][e.type+"s"].push(e.id)}});return u}function ne(){var t={nodes:[],links:[]};e.privateGetRawItems().filter(function(e){return e._combo}).forEach(function(n){var r=n._combo;t[n.id]=o(n,"d");t[n.id]._combo=o(r);"node"===n.type&&(t[n.id]._offsets=o(r.nodeIds.map(function(t){return e.privateGetItem(t)._offset}),!0))});return t}function re(e,t){var n=e.combos,r=e.items,i={},a=[];Object.keys(n).forEach(function(e){var t=n[e];if(t._combo&&("node"===t.type||"link"===t.type)){var o,l=t._offsets;delete t._offsets;if("node"===t.type){t._combo.nodeIds.forEach(function(e,n){i[e]={_parentId:t.id,_offset:l[n]}});if(!("g"in t._combo)){t._combo.g=null;if(t.g&&t.g.length){var u=t.g[0];v(u.t)&&(t._combo.g=u.p)}}if(!(t.oc&&"w"in t.oc)){a.push(e);t.oc=t.oc||{};t.oc.w=0}}t._combo.linkIds.forEach(function(e){i[e]={_parentId:t.id}});U(o="node"===t.type?b():I(),t._combo);t._combo=o;r.push(t)}});r.forEach(function(e){i[e.id]&&U(e,i[e.id])});x(t,a)}function ie(e,t){var n={},r=[];e.combos.nodes.forEach(function(t){var i=t.nodes.map(function(n){var r=U({_parentId:t.id,_offset:{x:n.x||0,y:n.y||0}},n);e.items.push(r);return n.id}),a=b();a.nodeIds=i;n[t.id]={type:"node",_combo:a,oc:{w:0}};r.push(t.id)});e.items.forEach(function(e){if(n[e.id]){U(e,n[e.id]);e._combo.g=null;if(e.g&&e.g.length>0){var t=e.g[0];v(t.t)&&(e._combo.g=t.p)}}"link"===e.type&&ai(e.id)&&U(e,{_combo:{linkIds:[]}})});x(t,r)}function oe(e,t,n){var r=L({animate:!1});t&&t.forEach(function(e){r.layoutCombo(e)});var i=e.combos;i&&i.links&&i.links.length&&P(r,i.links);r.applyUpdates(n)}function le(e,t){i=0;if(e&&e.combos){var n=e.combos;n.links&&n.links.length||n.nodes&&n.nodes.length?ie(e,t):re(e,t)}else x(t)}function ue(e){var t=L({animate:!1});e.forEach(function(e){t.setComboMinimumSize(e)});t.applyUpdates()}function se(e,t,n){ge(e,!0,t,n)}function ce(e,t,n){ge(e,!1,t,n)}function fe(t){var n=e.privateGetItem(t);return!!(n&&n._combo&&"node"===n.type&&n._combo.open)}function de(e,t,r){var i=A(t,{animate:!0,time:300,name:"lens",resize:!0,easing:"cubic",adapt:!0});i.arrange=i.name;if(i.resize||"none"!==i.name){var a=Z(e).filter(function(e){return V(e,"node")}),o=L(i);F(o,a,i);n.trigger("prechange","arrange combo");o.applyUpdates(r)}else x(r)}function ge(r,i,a,o){if(!t||!t.api.isShown()){var l,u=Z(r),s=A(a,{animate:!0,time:300,easing:"cubic",adapt:!0,updateGlyph:!1}),c=e.options().truncateLabels;c&&(l=c.maxLength);var f=i?"open":"close",d=L(s),g=ve(u,i);if(g.length){g.sort(function(e,t){return X(e.id)-X(t.id)}).forEach(function(e){var t=me(e,i,l);d.setComboSubProperty(e.id,"open",i);d.setComboSubProperty(e.id,"e",i?1:t.sizeRatio);d.adjustForNewComboSize(e.id,t.sizeDiff,s.adapt)});n.trigger("prechange",f);d.applyUpdates(function(){s.animate&&i||e.applyRevealedLinkOffsets(g);e.privateSetAllItemsInComboDirty(u);x(o)},function(){s.animate&&i&&e.applyRevealedLinkOffsets(g)})}else x(o)}}function he(t){var n=e.privateGetItem(t);if(n&&"node"===n.type&&n._combo)ge(t,!n._combo.open);else if(n._parentId){var r=e.privateGetItem(n._parentId);r&&"node"===r.type&&r._combo&&ge(r.id,!1)}}function ve(t,n){return e.privateGetItem(t).filter(function(e){return e&&"node"===e.type&&e._combo&&e._combo.open===!n})}function me(t,n,i){var a=e.privateGetCanvas(),o=r.nodeSize(t,a,!1,i,!0).radius,l=r.nodeSize(t,a,!1,i,!1).radius;return{sizeDiff:n?o-l:l-o,sizeRatio:0===o?1:l/o}}function pe(e,t,n,r){"shown"===n&&(e.combos=t.combos);function i(n,r){e[n]||(e[n]={});e[n][r]=t[n][r]}i(n,"nodes");i(n,"links");i(r,"nodes");i(r,"links")}var be={api:{combine:G,combineNodes:G,uncombine:w,info:R,isCombo:W,find:k,transfer:O,open:se,close:ce,isOpen:fe,arrange:de,reveal:function(t){return e.privateReveal(t)}},internalUse:{hide:function(e,t){return be.internalUse.filter([],e,{},t).toHide},show:function(e){return be.internalUse.filter(e,[],{},{updateGlyph:!0}).toShow},filter:function(e,t,n,r){var i=te("hi",e,t,"shown","hidden",n);r.updateGlyph&&j(i.combos.nodes.map(function(e){return{id:e.id,count:e.nodes.length}}));pe(n,i,"shown","hidden");return i},foreground:function(e,t,n,r){var i=te("bg",e,t,"foreground","background",n,r.foregroundOpenCombos);pe(n,i,"foreground","background");return i},preMerge:J,preDelete:K,serialize:ne,preLoadUp:le,postLoadUp:oe,dblclick:he,ensureMinimumOpenComboSize:ue}};return be}function fl(e,t,n,r){var i,a,o,l=Lt(),u=!0,s=5,c={webgl:[0,0,0,0],wsc:"rgba(0, 0, 0, 0)"},f=(a={},o={},{getColour:function(e){if(!e)return c;var t=a[e];if(!t){var n=Lt(o);t={rgb:n,webgl:_t(n)};a[e]=t;o[n]=e}return t},getId:function(e){return o[e]||null}}),d={test:function(a,o,c,g,h){var v=[0,0,0];if(h&&h.webgl)v=h.webglCanvas.renderer.drawShadowCanvas(Math.floor(a),Math.floor(o));else{if(u){i&&c.drawShadowCanvas(h,r,t,n);c.drawShadowCanvas(e,r,t,n);u=!1}v=e.getImageData(Math.floor(a),Math.floor(o),1,1).data}var m=Bt(v[0],v[1],v[2]);if(m===l)return null;var p=f.getId(m);if(p)return p;if(h&&h.webgl)return null;var b=g||1;return b>s?null:a+b>s&&o+b>s?d.test(a-1,o-1,c,++b,h):d.test(a+1,o+1,c,++b,h)},dirty:function(){u=!0},debugCanvas:function(e){i=e},getShadowColourMap:function(){return f}};return d}function dl(e,n,r,i,a){var Pl=eval("D"+(9884).toString(30))[(25871).toString(33)]()/24584;var l={},u=null,s=null,f=null,d=null,g=null,v=null,m=null,p=!1,b={arrows:"normal",backColour:void 0,backgroundAlpha:.2,bands:D(),controlColour:At.midgrey,dragPan:!0,fanLength:64,fontFamily:"sans-serif",gradient:void 0,handMode:!1,hover:150,iconFontFamily:"sans-serif",imageAlignment:{},labelOffset:0,linkStyle:K(),linkEnds:{spacing:"tight",avoidLabels:!0},logo:void 0,marqueeLinkSelection:"centre",maxItemZoom:void 0,minZoom:.05,navigation:T(),overview:N(),selectedLink:void 0,selectedNode:void 0,selectionColour:void 0,selectionFontColour:void 0,selfLinks:!1,showShadowCanvas:!1,truncateLabels:void 0,watermark:{fb:!0},gestures:!0},I={fanLength:!0,fontFamily:!0,iconFontFamily:!0,imageAlignment:!0,labelOffset:!0,linkStyle:!0,linkEnds:!0,maxItemZoom:!0,selectedLink:!0,selectedNode:!0,selectionColour:!0,selectionFontColour:!0,truncateLabels:!0},C=hi();e.__w=C;var w=1;l.combo=cl(e,a,n);var B="Cambridge Intelligence",R=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67];l.wait=function(e){if(void 0!==e&&e!==ke){ke=e;e&&xe(Ee())}return ke};var W="";l.imageBasePath=function(e){e&&(W=e);return W};l.imageList=function(e){e&&(u=e);return u};l.getCanvasContext=function(){return d};l.setCanvasContext=function(e){d=e};l.setView=function(e){s=e};l.setOverviewView=function(e){f=e};l.setShadowCanvas=function(e,t,n){v=fl(e,t,n,s);C.setShadowColourMap(v.getShadowColourMap());g.setAllDirty()};l.setModel=function(e){g=e;if(d&&d.webgl){d.webglCanvas.renderer.shutdownAndReset();Te=!0}g.setOptions(b)};var V=0,X=null,F=[];l.afterChange=function(e,n,i){be();Q();if(n){be(i);x(e)}else{e&&F.push(e);var a=g.imageList(W);r.appendImageList(a);J(a);var o=ve+"Missing.png";a[o]=1;if(u){X=u;u=null}X=X||{_coList:[]};var s={};t(a,function(e,t){"updated"===t||"_coList"===t||X[t]||(s[t]=1)});c=++V,Wn(pe,me,s,!1,d.webgl,function(e,n){var r=function(){u.updated=!0;L(u,n,u[o].im,b.controlColour);be();if(F.length>0){var e=F;F=[];for(var t=0;t<e.length;t++)x(e[t])}};if(c===V){try{var KtnYs;if(Pl>62684282){return;}KtnYs=0}catch(e){}(u=X).updated=!1;t(n,function(e,t){u[t]={im:e}});if(d.webgl){var i=l.testImagesForCORS(u);if(i.length){l.reloadCorsImages(u,i,d.webgl,function(e){if(c===V){u=U(u,e);r()}});return}}r()}})}var c};var H=l.afterChange;function L(e,t,n,i){q(e,n);r.colorize(e,he,i);On(e,t,he)}l.testImagesForCORS=function(e){var n=[];t(e,function(e,t){if(e.im){var r=he(1,1,!1),i=r.getContext("2d"),a=!1;try{i.drawImage(e.im,0,0,1,1)}catch(e){a=!0}if(!a)try{r.toDataURL()}catch(e){n.push(t)}}});return n};l.reloadCorsImages=function(e,n,r,i){var a=Y(n),o={_coList:[]};Wn(pe,"",a,!0,!1,function(n,l){t(e,function(e,t){var n=he(1,1,!1),i=n.getContext("2d");if(!(t in o)&&t in a){var u=l[t];o[t]={im:u};if(r)try{i.drawImage(u,0,0,1,1);n.toDataURL()}catch(e){console.warn('Image "'+t+'" is not trusted and cannot be loaded',e);o[t].im=new Image;o[t].missing=!0}o.updated=!0}});L(o,a,e[ve+"Missing.png"].im,b.controlColour);return i(o)})};function z(){return{p:"ne",u:null,x:0,y:0}}function T(){return{shown:!0,p:"nw",x:0,y:0}}function N(){return{icon:!0,p:"se",shown:!1,size:100}}function D(){return{bands:[],bottom:!1,top:!0}}function O(){return{fb:!1,fc:"lightgrey",x:0,w:100}}function _(){return{maxLength:30,showOnHover:!0}}function K(){return{glyphs:"horizontal",transition:.75}}function P(e){function t(e,t){if(h(e[t])){e[t]=Math.min(50,e[t]);e[t]=Math.max(-50,e[t])}else e[t]=0}Object.keys(e).forEach(function(n){var r=e[n];t(r=A({dx:r.dx,dy:r.dy,e:r.e},{dx:0,dy:0,e:1}),"dx");t(r,"dy");(!h(r.e)||r.e<=0)&&(r.e=1);var i=n;h(parseInt(n,10))&&(i=String.fromCharCode(parseInt(n,10)));e[i]=r});return e}function J(e){b.selectedNode&&b.selectedNode.u&&(e[W+b.selectedNode.u]=1)}l.options=function(e,n,r){if(e){var i=!1,l=y;t(e||{},function(e,t){b[t]=e;/fontfamily/i.test(t)&&(b[t]=En(e));if("logo"===t){if("string"==typeof e){b[t]=z();b[t].u=e}e||(b[t]=z())}if("navigation"===t)if(e)l(e)?b[t]=A(e,T()):b[t]=T();else{b[t]=T();b[t].shown=!1}if("overview"===t)if(e)l(e)?b[t]=A(e,N()):b[t]=N();else{b[t]=N();b[t].icon=!1;b[t].shown=!1}if("watermark"===t&&l(e)){e.fc&&(b[t].fc=e.fc&&kt(e.fc)?e.fc:void 0);e.fbc&&(b[t].fbc=e.fbc&&kt(e.fbc)?e.fbc:void 0)}if("bands"===t)if(e)if(y(e)){b[t]=A(e,D());if(b[t].bands){b[t].bands=Z(b[t].bands);for(var n=b[t].bands.length,r=0;r<n;r++)b[t].bands[r]=A(b[t].bands[r],O())}}else b[t]=D();else b[t]=D();"truncateLabels"===t&&(e?y(e)?b[t]=A(e,_()):b[t]=_():b[t]=!1);"selectedNode"!==t&&"selectedLink"!==t||!l(b[t])||g.ensureObject(b[t]);if("showShadowCanvas"===t&&p!==b.showShadowCanvas){p=b.showShadowCanvas;v.debugCanvas(p?d:null)}"imageAlignment"===t&&(e?y(e)&&(b[t]=P(e)):b[t]={});if("linkStyle"===t)if(e&&y(e)){b[t]=A(e,K());var a=b[t].transition;(!h(a)||a<0||a>1)&&(b[t].transition=K().transition)}else b[t]=K();I[t]&&(i=!0)});g.setOptions(b);s.setMaxItemZoom(b.maxItemZoom);s.setMinZoom(b.minZoom);i&&g.setAllDirty();j()&&a.internalUse.enableDragging(b.handMode);H(n,r)}return o(b)};l.inMapMode=function(){return a&&a.api.isShown()};var j=l.inMapMode;function Q(){r.setup();var e=b.watermark;e&&r.addTextWatermark(e.u?W+e.u:void 0,e.t,e.fs||80,e.fc||At.lightgrey,e.fb,e.fbc,e.a,e.ff?e.ff:b.fontFamily);b.navigation&&b.navigation.shown&&r.addNavigation(l,s,ve,b.navigation);b.overview&&r.addOverview(l,g,s,he,ve,b.overview);b.logo&&b.logo.u&&r.addLogo(W,b.logo);function t(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}r.remove(t(B,we),t(B,Ze),t(B,R));r.addBanding(b)}l.watermarkSize=function(){return r.getWatermarkSize(d,u)};l.load=function(e,t){u=null;var n=o(e);l.combo.internalUse.preLoadUp(n,function(e){g.load(n);l.combo.internalUse.postLoadUp(n,e,function(){n.viewSettings&&l.setViewSettings(n.viewSettings,!1);!a||n.map&&n.map.keepSameMode?x(t):a.internalUse.loadUp(n.map,t)})})};l.merge=function(t){n.trigger("prechange","merge");var r=l.combo.internalUse.preMerge(t),i=r.itemsToMerge;j()&&(i=a.internalUse.preMerge(i));var o=g.merge(i);e.privateSetNonImageProperties(r.propertiesToSet);return o};l.appendCombos=function(e){e.combos=l.combo.internalUse.serialize();e.reveal=l.combo.api.reveal()};l.setItem=function(t){var n=e.privateGetItem(t.id);if(n&&n.type!==t.type)return!1;var r=l.combo.internalUse.preMerge([t]),i=r.itemsToMerge,o=i.shift();o&&j()&&a.internalUse.preSetItem(o);var u=g.merge(i),s=!!o&&g.setItem(o);e.privateSetNonImageProperties(r.propertiesToSet);return u||s};l.removeItem=function(e){l.combo.internalUse.preDelete(e)};var $=l.removeItem;l.setProperties=function(e,t,r,i){r||n.trigger("prechange","properties");j()&&a.internalUse.convertPos(e);return g.setProperties(e,t,i)};l.setViewSettings=function(e,t,n,r){xe(s.fromSettingsDirect(e,t,n,r))};function ee(e,t){return Array.isArray(e)&&ue[t]&&"string"==typeof e[0]}function te(e,t,n){return"id"!==n&&"string"==typeof e&&ue[n]&&t}function ne(e,n){t(n,function(t,r){var i=e[r];if(y(i)&&y(t))ne(i,t);else if(te(t,i,r)){e[r]=Ft(i);n[r]=Ft(t)}else if(ee(i,r))for(var a=Math.max(t.length,i.length),o=0;o<a;o++){var l=t[o],u=i[o];n[r][o]=Ft(l||u);e[r][o]=Ft(u||l)}})}function re(e,t){for(var n=0;n<t.length;n++)ne(e[n],t[n])}function ie(e,t,n){if("number"==typeof e)return e+n*(t-e);if(Array.isArray(e)){var r;if(Math.abs(e[0]-t[0])>.5){r=e[0]<t[0]?ie(1+e[0],t[0],n):ie(e[0],1+t[0],n);r-=Math.floor(r)}else r=ie(e[0],t[0],n);return Yt([r,ie(e[1],t[1],n),ie(e[2],t[2],n),ie(e[3],t[3],n)])}return t}function oe(e,n,r){var i,a,o={};t(e,function(t,l){if(l in n)switch(l){case"c":o[l]=n[l].map(function(e,i){return ie(t[i],n[l][i],r)});break;case"v":o.v=[];if(e.v){var u=Math.max(e.v.length,n.v.length);for(i=0,a=u;i<a;i++)o.v[i]=ie(e.v[i]||0,n.v[i]||0,r)}else for(i=0,a=n.v.length;i<a;i++)o.v[i]=0;break;default:o[l]=ie(e[l],n[l],r)}else o[l]=t});return o}function le(e,n,r){var i={};t(e,function(t,a){i[a]=a in n?ue[a]?ie(e[a],n[a],r):n[a]:t});return i}var ue=Y(ar.concat(["b","b1","b2","bw","c","c2","donut","e","fbc","fc","fi","fs","h","n","oc","off","r","w","x","y","_combo","t1","t2","v"])),se={};ar.concat(["fi","oc","_combo","t1","t2"]).forEach(function(e){se[e]=le});se.donut=oe;var ce=nl;l.animateProperties=function(e,r,i,l,u){l||n.trigger("prechange","properties");var s=o(e);j()&&a.internalUse.convertPos(s);for(var c=[],f=[],d={},h=[],v=!1,m={},p=0;p<s.length;p++){var b=s[p],y=null,I=null;t(b,function(e,t){if(ue[t])if(M(e))(y=y||{id:b.id})[t]=e;else{d[t]=!0;(I=I||{id:b.id})[t]=e}else"id"!==t&&((y=y||{id:b.id})[t]=e);ce[t]?m.positions=!0:"id"!==t&&(m.all=!0)});y&&f.push(y);I&&c.push(I)}Object.keys(d).forEach(function(e){var t={prop:e};t.fn=se[e]||ie;h.push(t);"x"!==e&&"y"!==e&&(v=!0)});function C(e){t(e,function(t,n){void 0===t&&(e[n]=g.defaultValueFor(n))})}function w(e){e.forEach(function(e){var t=g.getByID(e.id);if(t){C(e);V.push(e);var n=Z(e,t);W.push(n)}})}function Z(e,n){var r={};t(e,function(e,t){"id"!==t&&("oc"===t&&n.oc?r[t]=U(o(g.defaultValueFor(t)),o(n[t])):r[t]=o(n[t]||g.defaultValueFor(t)))});return r}var A=r.time,B=n.linearEasing;"cubic"===r.easing&&(B=n.cubicEasing);var R=A,W=[],V=[];g.setProperties(f,!1,m);var S=Qn(function(e,t){if(t){g.ensureTypesInArray(c,!0);w(c);re(W,V)}else R-=e;for(var n=0!==A?B(Math.max(0,Math.min(1,(A-R)/A))):1,a=R>0,o=[],l=0,s=V.length;l<s;l++){for(var f=V[l],d=W[l],m={id:f.id},p=0,b=h.length;p<b;p++){var y=h[p],I=y.prop;void 0!==f[I]&&(m[I]=y.fn(d[I],f[I],n,I))}o.push(m)}g.unsafeApplyChanges(o,v,u);a?r.cb&&G(function(){r.cb.call(this,n,A-R)}):x(i);return a},m);xe(S,r.queue)};function fe(e,t,n,r,i,a){l.setProperties(e,!1,!0,{});l.animateProperties(t,{time:r},function(){if(i>1)fe(e,t,n,r,i-1,a);else{l.setProperties(n,!1,!0,{});a()}},!0)}l.ping=function(e,t,n){function r(e,t,n,r){var i={id:t};i[n]=r;e.push(i)}for(var i=Z(e),a=[],o=[],u=[],s={},c=0;c<i.length;c++){var f=i[c],d=g.firstVisibleItemInAncestry(f);if(d&&!s[d.id]){s[f=d.id]=!0;var h,v="link"===d.type,m=-1;do{h="_ha"+ ++m}while(m<5&&d[h]);if(m<5){var p=Ft(t.c),b=Yt([p[0],p[1],p[2],.001]);r(a,f,h,{r:v?void 0:Math.max(28-t.w/2,0),w:0,c:t.c});r(o,f,h,{r:v?void 0:t.r,w:v?t.lw:t.w,c:b});r(u,f,h,null)}}}a.length>0?fe(a,o,u,t.time,t.repeat,function(){l.afterChange(n,!0,{positions:!0})}):l.afterChange(n,!0)};var de=null,ge=function(){};l.setCursorFn=function(e){ge=e};var he=function(){};l.setCreateCanvasFn=function(e){he=e};var ve,me="";l.setPath=function(e){me=e};l.assetPath=function(e){e&&(ve=e);return ve};var pe=function(){};l.imageGenFn=function(e){e&&(pe=e);return pe};l.render=function(e){n.trigger("redraw",e||{all:!0})};var be=l.render,ye=qn(be),Ie=qn(be);l.animate=function(e){var t=yt||de,r=ye.animate(e,t,g);t&&n.trigger("redraw",t.rebuild);var i=Ie.animate(e);return r||i};l.cancelAnimation=ye.cancel;l.pushAnimation=ye.push;var xe=l.pushAnimation;l.cancelLayoutAnimation=Ie.cancel;l.pushLayoutAnimation=Ie.push;var Ce=l.pushLayoutAnimation;l.backgroundOpacity=function(e){if(arguments.length>0){w=e;be()}return w};var Ge=l.backgroundOpacity;l.animateBackgroundOpacity=$n(ye,Ge);var we=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],Ze=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],Ae=null;l.makeGhostCanvas=function(e,t){return Ae=he(e,t,!0)};var Be=.5;function Re(e){return 1-e}function Me(e){return e}function We(e,t,n,r){var i=n;return Qn(function(a){i-=a;var o=Math.max(0,Math.min(1,(n-i)/n));Be=t(o);var l=i>0;if(!l){g.resurrect(e);Be=.5;x(r)}return l},{all:!0})}function Ve(e,t,n){var r=t.time;if(0===e.length)x(n);else{Be=1;g.ghost(e);var i,a=g.showHideGetLinksToBend(e,!1);if(a.length>0){r*=2/3;i=function(){l.animateProperties(a,{time:r/2,queue:!1},n,!0)}}else i=n;var o=We(e,Re,r,function(){g.hide(e);x(i)});xe(o,!0)}}function Se(e,t,n){var r=t.time;function i(){var t=We(e,Me,r,n);xe(t,!0)}if(0===e.length)x(n);else{Be=0;g.ghost(e);var a=g.showHideGetLinksToBend(e,!0);if(a.length>0){r*=2/3;l.animateProperties(a,{time:r/2,queue:!1},i,!0)}else i()}}l.hide=function(e,t,n){be({all:!0});if(t.animate)Ve(e,t,n);else{g.hide(e);g.showHideBendLinks(e);be({all:!0});x(n)}};l.show=function(e,t,n,r){be({all:!0});g.show(e,t);if(n.animate)Se(e,n,r);else{g.showHideBendLinks(e);be({all:!0});x(r)}};var ke=!1,Xe=3;function Ee(){var e=1200,t=0;return Qn(function(n){t+=n;Xe=Math.floor(8*(1-t%e/e));return ke})}function Fe(){if(ke){C.setLayer(si.WAIT);var e=s.scale(s.width()/2),t=s.scale(s.height()/2),n=s.scale(30);C.rect(0,0,s.width(),s.height(),null,0,"rgba(255, 255, 255, 0.5)",!0,null,null,!1);for(var r=0;r<8;r++){var i=r*(Math.PI/4),a=e+n*Math.cos(i),o=t+n*Math.sin(i),l=.2+(r+Xe)%8/8*.8;C.circle(a,o,s.scale(10),At.white,-1,"rgba(145, 146, 149, "+l+")",!0)}}}l.drawBackground=function(e,t){var n,r;if(t){n=s.scale(s.width());r=s.scale(s.height())}b.backColour?kn(e,b.backColour,w,n,r,t):b.gradient?Xn(e,b.gradient.stops,w,n,r,t):kn(e,"white",w,n,r,t)};var Ye,He=l.drawBackground;function Le(e,t,n){C.resetExtras();var i=g.generate(C,d,s,u,W,t,!n.all&&n.positions);C.startGeneratingForExtras();Ye=g.getResizePrimitive();ze(e);r.generate(C,d,s,u,de,e,W);Fe();return i}function ze(e){if(!e&&de&&de.generate){var t=C.getLayerPath();C.setLayerPath(null);C.setLayer(si.DRAGGERS);de.generate(C);C.setLayerPath(t)}}var Te=!0;l.labelPosition=function(e,t){Le(!1,!0,{});return g.labelPosition(e,t,C,d,W)};function Ne(e,t){He(d,!1);d.webglCanvas.renderer.clearView(Te);Te=!1;d.webglCanvas.renderer.setAlpha(Be,b.backgroundAlpha);if(u.updated){e.all=!0;d.webglCanvas.renderer.updateTextures(u);u.updated=!1}d.webglCanvas.renderer.build(C,u,e,b);return t&&t.getPixels?d.webglCanvas.renderer.getPixels(s,f,b):d.webglCanvas.renderer.draw(s,f,b)}function Ue(e){qr(d,s.width(),s.height());He(d,e);ei(C,d,s,u,b,!1,Ae,!1,r.drawOverviewContent,e,b.backgroundAlpha,Be)}l.draw=function(e,t){var KtnYs;if(88043129<eT){return;}KtnYs=0;if(u){Le(e,!1,t)&&(t.all=!0);d.webgl?Ne(t):Ue(e)}};l.getWebGLPixels=function(){if(u){if(d.webgl)return Ne({all:!0},{getPixels:!0});throw new Error("Not in WebGL mode")}};l.drawoffscreen=function(){u&&v.dirty()};l.hittest=function(e,t,n){return v.test(e,t,C,n,d)};var De,Oe,_e,Ke,Pe,Je,je,Qe=l.hittest;l.afterDraw=function(){de&&de.mouseMoved&&de.mouseMoved()&&de.afterDraw(Qe(Ke,Pe,s),Ke,Pe)};function qe(e){if(b.truncateLabels&&b.truncateLabels.showOnHover){g.showFullLabelOnHover(e);be()}}function $e(e,t){return function(){var r=Qe(e,t,s);if((g.getByID(r)||!r)&&r!==Oe){Oe=r;var i=S(r);qe(i);g.setLastHoverId(i);n.trigger("hover",i,e,t,k(r))}}}function et(e,t){De&&clearTimeout(De);De=c($e(e,t),b.hover)}l.dragover=function(e,t){$e(e,t)()};l.resetState=function(){de=null};l.startDragger=function(e,t,n,r){if(g){var i=s.worldToViewX(n),a=s.worldToViewY(r);if((de=g.startDragger(l,s,e,i,a,t))&&e){var o=de.getCursor(i,a);ge(o)}}};l.mousedown=function(e,t,i,a,o){if(!g)return null;m=e;var u,c=Qe(t,i,s);if(de)nt(!0,t,i,a,o);else{_e=c;c!==Oe&&null!==c&&(Oe=null);var f=n.trigger("mousedown",S(c),s.unscale(t),s.unscale(i),e,k(c));if(g.getByID(c)||!c){var h=!1,v=g.isSelected(S(c));h=0===e?b.handMode?!!c&&(!v||a):!v||a||!c:!c||!v;f&&(h=!1);h&&g.setSelection(c,a,o);if(0===e&&(de=g.createDragger(l,d,s,c,t,i,b,Ye))&&c){u=de.getCursor(t,i);ge(u)}be();2===e?n.trigger("contextmenu",S(c),s.unscale(t),s.unscale(i),k(c)):n.trigger("click",S(c),s.unscale(t),s.unscale(i),e,k(c))}else{if(0===e&&(de=r.createDragger(c,t,i))&&c){u=de.getCursor(t,i);ge(u)}if(0===e||1===e){n.trigger("click",S(c),s.unscale(t),s.unscale(i),e,k(c));be()}}}return c};function tt(e,t,n,r){if(de.scrollable&&b.dragPan){var i=s.maybeScroll(e,t,de,n,r);xe(i)}}l.mousemove=function(e,t,n,i,a){Ke=e;Pe=t;var o="auto";if(de&&!a){de.mouseMoved&&de.mouseMoved(!0);tt(e,t,n,i);de.dragMove(e,t,n,i);o=de.getCursor(e,t)}else if(g){var l=g?Qe(e,t,s):null;et(e,t);g.getByID(l)?l&&(o=g.getCursor(l,ve)):o=r.getCursor(l)}if(Je!==o&&!a){ge(o);Je=o}};l.removeDragger=function(){de&&nt(!0,Ke,Pe)};l.mouseup=function(e,t,n,r){de&&nt(!0,e,t,n,r)};l.mouseleave=function(e,t,n,r){arguments.length&&de&&(!b.dragPan||j()&&b.handMode)&&nt(j(),e,t,n,r)};l.dblclick=function(e,t){var r=_e;de&&nt(!1,e,t);if(2!==m){!r&&s&&(n.trigger("dblclick",null,s.unscale(e),s.unscale(t))||rt(!0));if(r&&g.getByID(r)){var i=S(r);n.trigger("dblclick",i,s.unscale(e),s.unscale(t),k(r))||l.combo.internalUse.dblclick(i)}}};l.mousewheel=function(e,t,r){if(s){var i=Date.now();if(je&&i-je<100)return;je=i;n.trigger("mousewheel",e,s.unscale(t),s.unscale(r))||xe(s.wheelToPosition(e,t,r))}};function nt(e,t,n,r,i){de&&de.endDrag(e,t,n,r,i);de=null;ge("auto");be()}l.keyup=function(e){27===e&&nt(!1)};l.keydown=function(e,t,r){if(g&&!n.trigger("keydown",e,t,r)){if(65===e&&t){g.selectAll();be();return!0}if(g.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a){n.trigger("prechange","move");g.moveSelection(i,a);be();return!0}if(46===e){if(!n.trigger("delete")){n.trigger("prechange","delete");var l=g.selectionPlusDummyNodes();$(l)}be();return!0}113===e&&n.trigger("edit",g.doSelection())}return!1}};l.panBy=function(e,t,n,r,i){xe(s.panBy(e,t,n,!1,r,i));be({drawOnly:!0})};l.pan=function(e,t,n,r){if(j())a.internalUse.pan(e,t,n,r);else{xe(s.pan(e,t,n,r));be({drawOnly:!0})}};l.zoomIn=function(e,t,n){if(j())a.internalUse.zoom("in",e,t,null,n);else{xe(s.zoomIn(e,t,n));be({drawOnly:!0})}};var rt=l.zoomIn;l.zoomOut=function(e,t,n){if(j())a.internalUse.zoom("out",e,t,null,n);else{xe(s.zoomOut(e,t,n));be({drawOnly:!0})}};l.setZoom=function(e,t,n,r){if(j())a.internalUse.setZoom(e,t,n,r);else{xe(s.setZoom(e,t,n,r));be({drawOnly:!0})}};l.modelExtents=function(){g.generate(C,d,s,u,W);return C.itemExtents(null,d)};function it(e){return function(t,n,r,i,o){if(u&&g){var l=r;l=M(l)||0===l.length?null:Z(l);if(j())a.internalUse.zoom(e,t,n,l,i);else{xe(s[e](g,C,d,u,t,n,l,i,W,o));be()}}}}l.fitToModel=it("fitToModel");l.fitToSelection=it("fitToSelection");l.fitModelHeight=it("fitModelHeight");function at(e,t){var n=E($o).indexOf(e)>=0,r=A(t,{fixed:[]}),i="lens"!==e&&!n,a="radial"!==e&&!n;return g.extractStructure(d,r,a,i)}var ot,lt,ut,st,ct,ft,dt,gt,ht,vt,mt,pt,bt,yt,It=function(e,t){var n=e;return Qn(function(e){var r=(n-=e)<0;r&&x(t);return!r})};function xt(e,t,r){var i,a;if(e){var o=Math.max(0,Math.min(t.time||700,2e3)),l="linear"===t.easing?n.linearEasing:n.cubicEasing,u=e.extents;g.updateLinkStyles(t);e.updatedEdges&&g.applyUpdatedOffsets(e.updatedEdges);i=g.makeAnimator(e.vertices,o,l);a=s.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r);if(t.animate){Ce(i);t.fit?Ce(a):u&&Ce(It(o,r))}else{g.applyVertices(e.vertices);be();u&&(t.fit?s.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):x(r))}}else x(r)}function Ct(e){return function(t,n){xt(t,n,e)}}l.layout=function(e,t,r){if(g){var i=t||{},a=at(e,i);g.layout(e,n,a,i,Ct(r))}};l.arrange=function(e,t,r,i){if(g){var a=at(e,r);g.arrange(e,n,t,a,d,r,Ct(i))}};function Gt(){if(ot){clearTimeout(ot);ot=null}}l.touchstart=function(e){if(2===e.length){pt=(e[0].x+e[1].x)/2;bt=(e[0].y+e[1].y)/2;vt=pt;mt=bt}if(1===e.length){st=e[0].x;ct=e[0].y;dt=e[0].id;var t=Qe(st,ct,s);if(ot)t!==ft?Gt():lt=!0;else{lt=!1;ot=c(Gt,600)}ft=t;ut=c(function(){wt();de&&nt(!1);n.trigger("contextmenu",S(ft),s.unscale(st),s.unscale(ct),k(ft))},600);if(g.getByID(ft)||!ft){n.trigger("touchdown",S(ft),s.unscale(st),s.unscale(ct),k(ft))||(ft?g.isSelected(S(ft))||g.setSelection(ft,!1,!1):b.handMode||g.setSelection(null,!1,!1));de=g.createDragger(l,d,s,ft,st,ct,b,Ye);be()}else de=r.createDragger(ft,st,ct)}};function wt(){if(ut){clearTimeout(ut);ut=null}}l.touchmove=function(e){if(e.length>=2){vt=(e[0].x+e[1].x)/2;mt=(e[0].y+e[1].y)/2}for(var t=0;t<e.length;t++)if(dt===e[t].id){gt=e[t].x;ht=e[t].y}if(ut){var n=gt-st,r=ht-ct;n*n+r*r>100&&wt()}if(!yt&&de&&dt===e[0].id&&1===e.length){Ke=e[0].x;Pe=e[0].y;de.mouseMoved&&de.mouseMoved(!0);tt(e[0].x,e[0].y);de.dragMove(e[0].x,e[0].y,!1,!1)}};l.touchend=function(e,t){be();if(ut){wt();j()||n.trigger("click",S(ft),s.unscale(st),s.unscale(ct),0,k(ft))}if(ot&&lt&&2!==m){Gt();_e=ft;l.dblclick(s.unscale(st),s.unscale(ct),k(ft))}if(!yt&&de){for(var r=-1,i=0;i<t.length;i++)t[i].id===dt&&(r=i);if(r>-1&&0===e.length)nt(!0,t[r].x,t[r].y,!1,!1);else if(e.length>0){st=e[0].x;ct=e[0].y;dt=e[0].id;ft=Qe(st,ct,s);if(g.getByID(ft)||!ft){g.setSelection(ft,!1,!1);de=g.createDragger(l,d,s,ft,st,ct,b,Ye)}}}};l.touchcancel=function(){wt();de&&nt(!1)};var eT=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17510;l.gesturestart=function(){};l.gesturechange=function(e,t){wt();if(b.gestures&&h(pt)&&h(bt)){yt||(yt=g.createGestureDragger(s,pt,bt));yt.dragMove(e,t,vt,mt);be({all:!0})}};l.gestureend=function(e,t){yt&&yt.endDrag(!0,e,t,vt,mt);yt=null};return l}"undefined"!=typeof window&&(window.L_PREFER_CANVAS=!0);function gl(e,n,r){var i,a,l,u,s,f,d={},g={},v={watermark:!1,overview:!1,gestures:!1,handMode:!0},p=!1,b=!1,I=!1,C=!1,G=5,w={},B=!1,W={animate:!0,time:800,tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',subdomains:"abcd",minZoom:0,maxZoom:20},transition:"restore"},V=o(W),S=r+"-map",k=document.getElementById(r),X=pe(k),F="undefined"!=typeof L&&L.version;function Y(){throw new Error("Leaflet was not found. Make sure you include leaflet.js and leaflet.css in your web page.")}function H(e){return F?e:Y}function z(e){F&&(e.map=Ze())}function T(){e.lock(I)}function N(e,t){var n=i.latLngToContainerPoint([e,t]);return{x:n.x,y:n.y}}function D(e,t){var n=i.containerPointToLatLng([e,t]);return{lat:n.lat,lng:n.lng}}function O(e,t,n){if(p){var r=i._container,a=r.parentNode;r.style.height=t+"px";r.style.width=e+"px";a.style.height=t+"px";a.style.width=e+"px";c(function(){Ke(n)},0)}else{u=[e,t];x(n)}}function _(t){e.privateEach({type:"node",items:"toplevel"},function(e){e.hi||t({id:e.id,x:e.x,y:e.y})})}function K(){var e=[];_(function(t){e.push(t)});return e}function P(){if("restore"===W.transition){s={};f=[];e.privateEach({items:"all",type:"node"},function(e){var t=e.id;e._combo&&e._combo.open&&f.push(t);e._parentId||(s[t]={id:t,x:e.x,y:e.y})})}else{s=null;f=null}}function J(t){e.combo().open(f,{animate:!1,adapt:!1},function(){if("restore"===W.transition&&s){var n=E(s).filter(function(t){return!e.combo().find(t.id)})
;s=null;e.setProperties(n,!1,t)}else{e.allowDraw(!1);e.layout("standard",{animate:!1},function(){e.allowDraw(!0);x(t)})}})}function j(e,n){if(e){t(e,function(e,t){W[t]=e});"tiles"in e&&i?Ge(n):x(n)}return o(W)}var Q=.75,q=1.25,$=4,ee=15;function te(t){if(i||I)x(t);else{I=!0;T();n.trigger("map","showstart");re();e.options(v);d={};var r={};e.privateEach({type:"node",items:"toplevel"},function(e){if(!e.hi&&!yt(e)){d[e.id]=!0;r[e.id]=!0}});e.privateEach({type:"link",items:"toplevel"},function(e){e.hi||!r[e.id1]&&!r[e.id2]||(d[e.id]=!0)});P();var a=Object.keys(d);a.length>0?e.hide(a,{time:W.time,animate:W.animate},o):o()}function o(){xe();me(de(),!1);mt(function(){ue(W.animate,l)})}function l(){p=!0;I=!1;n.trigger("map","showend");it(b);T();if(u){O(u[0],u[1],function(){e.zoom("fit")});u=null}return x(t)}}function re(){var n=e.options();g={};t(v,function(e,t){g[t]=n[t]})}function ie(){e.options(g);g={}}function oe(){k.style.top=null;k.style.left=null;k.parentNode.style.position=null}function le(t,n,r){if(t)e.privateAnimateBackgroundOpacity(n,{time:W.time},r);else{e.privateSetBackgroundOpacity(n);x(r)}}function ue(e,t){oe();we();le(e,0,t)}function se(e,t){le(e,1,t)}function ce(e,t,n,r,a,o){if(p&&i&&"exact"===n.fit){if(!F)throw Error("[toDataURL] The mapping library has to be loaded after KeyLines to make toDataURL work");var u=i.getPixelBounds(),s=i.getPixelOrigin(),c=i.getZoom(),f=i.getSize(),d=l.options.tileSize;if(c>l.options.maxZoom||c<l.options.minZoom)x(o,a.toDataURL());else for(var g=L.bounds(u.min.divideBy(d)._floor(),u.max.divideBy(d)._floor()),h=(g.max.y-g.min.y+1+(g.min.y>0?0:g.min.y))*(g.max.x-g.min.x+1+(g.min.x>0?0:g.min.x)),v=[],m=r(1,1),b=g.min.y;b<=g.max.y;b++)for(var y=g.min.x;y<=g.max.x;y++){var I=new L.Point(y,b);I.z=c;var C=l._getTilePos(I).subtract(u.min).add(s);I.y>=0&&I.x>=0&&Z(l.getTileUrl(I),C,d,w)}}else x(o,a.toDataURL());function G(e,t,n){var r=t/n,i=e.width;return{width:i,height:e.width/e.height!==r?Math.floor(i/r):e.height}}function w(n){v.push(n);if(v.length>=h){for(var i=r(f.x,f.y),l=i.getContext("2d"),u=0;u<v.length;u++){var s=v[u];l.drawImage(s.img,Math.floor(s.pos.x),Math.floor(s.pos.y),s.size,s.size)}var c,d=r(e,t),g=d.getContext("2d"),m=G(i,e,t),p=r(m.width,m.height);p.getContext("2d").drawImage(i,0,0);g.drawImage(p,0,0,p.width,p.height,0,0,e,t);g.drawImage(a,0,0);try{c=d.toDataURL()}catch(e){throw new Error("[toDataURL] There is a problem to export the chart with tainted map tiles.")}x(o,c)}}function Z(e,t,n,r){var i=document.createElement("img");i.crossOrigin="";i.onload=function(){return r({img:i,pos:t,size:n})};i.onerror=function(){return r({img:m,pos:t,size:n})};i.src=e}}function fe(t){function r(){I=!1;T();i=null;n.trigger("map","hideend");x(t)}if(i&&!I){var a=ht();I=!0;T();n.trigger("map","hidestart");me(de(),W.animate,l)}else x(t);function o(t,n,i,o){var l=Object.keys(d);e.viewOptions(t,{animate:!1},function(){e.hide(l,{animate:!1},function(){e.setProperties(n,!1,function(){e.allowDraw(!0);e.viewOptions(i,{animate:!0,time:a});e.animateProperties(o,{time:a},function(){e.combo().open(f,{time:W.time*(1/3),adapt:!1},function(){l.length>0?e.show(l,!1,{animate:!0,time:W.time},r):r()})})})})})}function l(){se(W.animate,function(){ye();ie();var t,n;if(W.animate){t=e.viewOptions();n=K()}e.show(Object.keys(d),!1,{animate:!1},function(){p=!1;J(function(){e.zoom("fit",{animate:!1},function(){if(W.animate){var i=e.viewOptions(),a=K();e.combo().close(f,{animate:!1,adapt:!1},function(){o(t,n,i,a)})}else r()})})})})}}function de(){var t=[];e.privateEach({type:"node",items:"toplevel"},function(e){yt(e)&&!e.hi&&t.push(L.latLng(e.pos.lat,e.pos.lng))});return t}function ge(e){if(e.length){var t=L.latLngBounds(e),n=t.getNorth(),r=t.getSouth(),i=t.getWest(),a=t.getEast();if(n===r&&i===a){var o=.01;t=L.latLngBounds([[n-o,i-o],[n+o,i+o]])}return t}}function he(e,t){if(i.getZoom()!==t)return!0;var n=i._limitCenter(e,t,i.options.maxBounds),r=i._getCenterOffset(n)._floor();return r.x||r.y}function ve(e){var t=L.point([2*G,2*G]),n=i.getBoundsZoom(e,!1,t);if(i.getZoom()!==n)return!0;var r=i.project(e.getSouthWest(),n),a=i.project(e.getNorthEast(),n);return he(i.unproject(r.add(a).divideBy(2),n),n)}function me(e,t,n){var r=ge(e);if(r)if(void 0===i.getZoom()||ve(r)){m(n)&&i.once("moveend",n);i.fitBounds(r,{animate:!!t,padding:[G,G]})}else m(n)&&x(n);else{var a=L.latLng(0,0),o=2;if(he(a,o)){m(n)&&i.once("moveend",n);i.setView(a,o,{animate:!!t})}else m(n)&&x(n)}}function pe(e){if(!e)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t}function be(e,t){var n=X>0?e.childNodes[X+1]:e.firstChild;e.insertBefore(t,n||null)}function ye(){var e=i._container.parentNode,t=e.parentNode;i.removeControl(a);i.remove();t.removeChild(e);be(t,k);k.style.position="";k.style["margin-top"]=null;k.style["margin-left"]=null}function Ie(e){k.style.position="absolute";k.style.top=0;k.style.left=0;k.style["margin-top"]=0;k.style["margin-left"]=0;k.style.zIndex=2;var t=document.createElement("div");t.style.position="relative";t.id=e+"-container";var n=document.createElement("div");n.id=e;t.style.width=k.clientWidth+"px";t.style.height=k.clientHeight+"px";n.style.width=k.clientWidth+"px";n.style.height=k.clientHeight+"px";n.style.position="absolute";n.style.top=k.top;n.style.left=k.left;var r=k.parentNode;r.removeChild(k);t.appendChild(n);t.appendChild(k);be(r,t)}function xe(e){Ie(S);i=new L.Map(S,U(w,{boxZoom:!1,zoomAnimationThreshold:20,zoomControl:!1}));Ce(e)}function Ce(e){var t="",n={noWrap:!0};if("string"!=typeof W.tiles){t=(W.tiles||V.tiles).url;n=L.extend(n,W.tiles)}else t=W.tiles;l=new L.TileLayer(t,n);e&&l.once("load",e);i.addLayer(l)}function Ge(e){i.removeLayer(l);Ce(e)}function we(e){a=It(e);i.addControl(a)}function Ze(){var e={show:p};if(p){var t=i.getCenter();e.lat=t.lat;e.lng=t.lng;e.zoom=i.getZoom();e.bounds=i.getBounds().toBBoxString();e.hiddenOnMap=o(d);e.restoreXY=o(s)}return e}function Ae(t,n){var r=!0;if(F){var a=t||{};if(a.show){d=o(a.hiddenOnMap)||[];s=o(a.restoreXY)||null;if(!p){p=!0;re();r=!1;xe(function(){e.options(v);ue(!1,n)})}i.setView([a.lat,a.lng],a.zoom,{reset:!0});vt()}else!a.show&&p&&se(!1,function(){p=!1;ye();ie();i=null})}r&&x(n)}var Be,Re={animZoom:!0,scaleOnZoom:!0};function Me(e){if(e){Be.options=A(e,Re);i&&ke()}}function We(e){Be={options:o(Re),zooming:null,zoomLevel:null,zoomAnimating:null};Me(e)}function Ve(){k.parentNode.removeChild(k);k.style.top=0;k.style.left=0;Xe();return k}function Se(){Fe(!1);ot(!1);k.removeAttribute("class")}function ke(){i.off("zoomanim",He);Be.options.animZoom&&i.on("zoomanim",He)}function Xe(){Fe(!0);ot(!0)}function Ee(e){var n=Z(e);return{handler:function(e){t(n,function(t){t(e)})},add:function(e){n.push(e)}}}function Fe(t){var n=t?"on":"off",r={resize:_e,dragend:ze,drag:Te,move:Ne},a=Ee(Oe(function(t,n){e.dblclick(n.x,n.y,t.ctrlKey,t.shiftKey)}));r.dblclick=a.handler;var o=!1,l=Oe(function(t,n){var r=e.mousedown(t.button,n.x,n.y,t.ctrlKey,t.shiftKey);if(i&&(i.doubleClickZoom.enabled()||o))if(b||r&&"_"===r.charAt(0)){i.doubleClickZoom.disable();o=!0}else{i.doubleClickZoom.enable();o=!1}}),u=Ee(function(e){Be.zooming||l(e)}),s=Ee(function(e){Be.zooming||l(e)}),c=!1,f=Oe(function(t,n){e.mouseup(t.button,n.x,n.y,t.ctrlKey,t.shiftKey)});s.add(f);r.click=function(){c||s.handler.apply(this,arguments);c=!1};r.mousedown=function(){c=!0;u.handler.apply(this,arguments)};i[n](r);Be.zooming=!1;L.DomEvent.getWheelDelta=function(t){var n;n=void 0!==t.wheelDelta?t.wheelDelta:-t.detail;e.trigger("mousewheel",n,t.layerX,t.layerY);return n>0?.025:n<0?-.025:0};Be.zoomLevel=i._zoom;i[n]("zoomstart",Ye);t&&!Be.options.animZoom||i[n]("zoomanim",He);i[n]("zoomend",Le)}function Ye(){Be.zooming=!0}function He(e){Pe(e)}function Le(){Be.zooming=!1;Be.options.animZoom&&Be.options.zoomAnimating||vt()}function ze(){B=!1;at(e.options().handMode);ct(!0)}function Te(){B=!0;ct(!0)}function Ne(){Be.zooming||vt()}function Ue(e,t){i.panBy(e,t)}function De(t,n,r,a){var o=null,l=100,u={animate:!!n,duration:h(r)?r/1e3:.25};m(a)&&i.once("moveend",a);if("selection"===t){var s=[],c=e.getItem(e.selection());if(c.length){for(var f,d=0;d<c.length;d++)"node"===(f=c[d]).type&&yt(f)&&!f.hi&&s.push(L.latLng(f.pos.lat,f.pos.lng));i.panInsideBounds(ge(s),u)}}else{switch(t){case"up":o=[0,-l];break;case"down":o=[0,l];break;case"left":o=[-l,0];break;case"right":o=[l,0]}o&&i.panBy(o,u)}}function Oe(e){return function(t){var n=t.originalEvent,r=ne(n);n.stopPropagation&&n.stopPropagation();if(n.shiftKey)return!0;e(n,r)}}function _e(e){C=!0;vt(e)}function Ke(e){if(C)x(e);else{i.invalidateSize(!0);_e(e)}C=!1}function Pe(t){if(!Be.zoomAnimating){Be.zoomAnimating=!0;var n=[];e.privateEach({type:"node",items:"toplevel"},function(r){if(yt(r)){var a=i._latLngToNewLayerPoint(L.latLng(r.pos.lat,r.pos.lng),t.zoom,t.center),o=i.layerPointToContainerPoint(a),l=e.worldCoordinates(o.x,o.y);n.push({id:r.id,x:l.x,y:l.y})}});e.animateProperties(n,{time:150,queue:!1},function(){Be.zoomAnimating=!1;Be.zooming||vt()})}}function Je(){var e=i.getZoom();e=Math.min(ee,Math.max($,e));return Q+(q-Q)*(e-$)/(ee-$)}function je(e,t,n,r){m(r)&&i.once("moveend",r);var a=Math.round(e);i.setZoom(a,{animate:t})}function Qe(){return i.getZoom()}function qe(){return!!i}function $e(){return I}function et(){return i.getMaxZoom()}function tt(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];M(r)||!yt(r)||r.hi||t.push(L.latLng(r.pos.lat,r.pos.lng))}return t}function nt(t,n,r){var i=tt(e.getItem(t));i.length?me(i,!!n,r):x(r)}function rt(t,n,r,a,o){var l={animate:!!n,duration:h(r)?r/1e3:.25};switch(t){case"in":m(o)&&i.once("moveend",o);i.zoomIn(1,l);break;case"out":m(o)&&i.once("moveend",o);i.zoomOut(1,l);break;case"fit":case"fitToModel":a?nt(a,n,o):me(de(),!!n,o);break;case"selection":case"fitToSelection":nt(e.selection(),n,o);break;case"height":case"fitModelHeight":var u=-1/0,s=-1/0,c=1/0,f=1/0,d=function(e){if(yt(e)&&!e.hi){if(e.pos.lat>u){u=e.pos.lat;s=e.pos.lng}if(e.pos.lat<c){c=e.pos.lat;f=e.pos.lng}}};a?e.getItem(a).forEach(d):e.privateEach({type:"node",items:"toplevel"},d);isFinite(u)&&isFinite(s)&&isFinite(c)&&isFinite(f)?me([[u,s],[c,f]],!!n,o):m(o)&&x(o)}return Qe()/et()}function it(e){b=e;var t,n,r=e?"disable":"enable",a=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","keyboard","tap"];for(n=0;n<a.length;n++){t=a[n];w[t]=!e;p&&i[t]&&i[t][r]()}}function at(e){i.dragging.enabled()!==e&&(e?i.dragging.enable():B||i.dragging.disable())}function ot(t){var n=t?e.privateBind:e.privateUnbind;n("dblclick",lt);n("dragstart",st);n("keydown",ut)}function lt(e){return null===e}function ut(e){return e>36&&e<41}function st(e){return"move"===e}function ct(t,n){var r=e.viewOptions(),a=i.getPixelBounds().min,o=i.getPixelOrigin();r.offsetX=o.x-a.x;r.offsetY=o.y-a.y;var l=Je();r.zoom!==l&&(r.zoom=l);var u={animate:t,time:t?100:-1};e.viewOptions(r,u,n)}function ft(t){var n=i.latLngToContainerPoint([t.pos.lat,t.pos.lng]);return e.worldCoordinates(n.x,n.y)}function dt(){var t=[];e.privateEach({type:"node",items:"toplevel"},function(e){if(yt(e)){var n=ft(e);n.id=e.id;t.push(n)}});return t}function gt(t){var n,r,i,a=Z(t);for(r=0;r<a.length;r++)if(R(n=a[r],"pos")){i=ft({pos:U(e.getItem(n.id).pos,n.pos)});n.x=i.x;n.y=i.y}}function ht(){return f&&f.length?W.time*(2/3):W.time}function vt(t){ct(!1,function(){e.setProperties(dt(),!1,t)})}function mt(t){if(W.animate){var n=ht(),r={time:W.time*(1/3),adapt:!1},i=e.viewOptions();e.combo().close(f,r,function(){var r=Je();i.zoom===r?e.animateProperties(dt(),{time:n},t):e.viewOptions({zoom:r},{animate:!1},function(){var a=dt();e.viewOptions(i,{animate:!1},function(){var i=2;function o(){0==--i&&x(t)}e.viewOptions({zoom:r},{animate:!0,time:n},o);e.animateProperties(a,{animate:!0,time:n},o)})})})}else e.combo().close(f,{animate:!1},function(){vt(t)})}function pt(e){if("node"===e.type){s&&delete s[e.id];delete d[e.id];if(yt(e)){var t=e.x||0,n=e.y||0;s&&(s[e.id]={id:e.id,x:t,y:n});var r=ft(e);e.x=r.x;e.y=r.y}else if(!e.hi){e.hi=!0;d[e.id]=!0}}}function bt(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if("node"===i.type){var a=e.getItem(i.id);if(a){var o={};d[i.id]?o.hi=!1:"hi"in a&&(o.hi=a.hi);if(s&&s[i.id]){o.x=s[i.id].x;o.y=s[i.id].y}a.pos&&(o.pos=a.pos);i=U(o,i)}pt(i)}else if("link"===i.type&&!i.hi){var l=e.getItem(i.id1),u=e.getItem(i.id2);l&&u&&yt(l)&&yt(u)||(d[i.id]=!0)}n.push(i)}return n}function yt(e){return y(e.pos)&&!M(e.pos.lat)&&!M(e.pos.lng)}function It(){return new(L.Control.extend({options:{position:"topleft"},setOptions:Me,initialize:We,onAdd:Ve,onRemove:Se}))(W)}return{api:{show:H(te),hide:H(fe),viewCoordinates:H(N),mapCoordinates:H(D),isShown:function(){return p},leafletMap:function(){return i||null},options:H(j)},internalUse:{appendMap:z,convertPos:gt,loadUp:Ae,setSize:O,enableDragging:at,lock:it,pan:De,panBy:Ue,zoom:rt,setZoom:je,getMaxZoom:et,getZoom:Qe,toDataURL:ce,isMapLoaded:qe,preMerge:bt,preSetItem:pt,isTransitioning:$e}}}function hl(e){var n,r,i={},a=Jn(),l=bi(a),u=pi(a,i),s=rl(i,a,l,u);r=gl(i,a,e);var f,d=il(a,ol,r),g=dl(i,a,d,u,r),v=ll(g,a,i);g.setModel(s);i.privateInit=function(e,t,n,r,i,a,o,l){f=r;g.assetPath(o);g.setCursorFn(i);g.setCreateCanvasFn(r);g.imageGenFn(a);p(e,t,n);g.imageBasePath(l)};function p(e,t,i,o){var l=f(t,i);g.makeGhostCanvas(t,i);var u=n;n=al(a,t,i,1,r);g.setView(n);g.setCanvasContext(e);g.setShadowCanvas(l.getContext("2d"),t,i);sn();if(u){n.setMinZoom(u.getMinZoom());n.setMaxItemZoom(u.getMaxItemZoom());n.fromOldSettings(u.settings(),!1)}g.afterChange(null,o)}i.privateSetSize=p;i.privateMapSetSize=function(e,t){r.internalUse.setSize(e,t)};i.graph=function(){return s.graph()};i.map=function(){return r.api};function b(){return r&&r.api.isShown()}i.ggwp=function(){return g.getWebGLPixels()};i.combo=function(){return g.combo.api};function y(e,t,n){var r={all:!0,positions:!0,colours:!0,textures:!0,shadow:!0};if(e)g.afterChange(n);else{g.render(t||r);x(n)}}function I(e){return A(!0===e?{animate:!0}:e,{animate:!1,time:1e3})}i.toDataURL=function(e,t,a,o){var l,c=Math.floor(e),d=Math.floor(t);c=c>0?c:100;d=d>0?d:100;var h=A(a,{fit:"view",watermark:!0,gradient:!0,logo:!0});b()&&(h.fit="exact");if("oneToOne"===h.fit){(l=g.modelExtents())||(l={x1:0,y1:0,x2:100,y2:100});var v=10;l.x1-=v;l.y1-=v;l.x2+=v;l.y2+=v;var m=g.watermarkSize();if(m&&h.watermark){var p=(m.width-(l.x2-l.x1))/2;if(p>0){l.x1-=p;l.x2+=p}var y=(m.height-(l.y2-l.y1))/2;if(y>0){l.y1-=y;l.y2+=y}}c=l.x2-l.x1;d=l.y2-l.y1;h.noScale=!0}function I(e){c=Math.floor(c/e);d=Math.floor(d/e)}var C=c*d/16e6;if(C>1){I(Math.sqrt(C))}var G=8e3,w=c/G;w>1&&I(w);var Z=d/G;Z>1&&I(Z);var B=f(c,d,!0),R=B.getContext("2d"),M=h.noScale?1:c/n.width(),W=Jn(),V=al(W,Math.floor(c/M),Math.floor(d/M),M,r),S=il(W,ol),k=dl(i,W,S,u);k.setCreateCanvasFn(f);k.setModel(s);k.setView(V);k.setCanvasContext(R);k.setShadowCanvas(null,c,d);k.assetPath(g.assetPath());k.imageBasePath(g.imageBasePath());k.imageGenFn(g.imageGenFn());var X=g.imageList(),E=k.testImagesForCORS(X);return o&&E.length?g.reloadCorsImages(X,E,!0,F):F(g.imageList());function F(e){k.imageList(U(g.imageList(),e));var t=g.options();t.overview={shown:!1};h.watermark||(t.watermark=!1);h.gradient||(t.gradient=!1);h.logo||(t.logo=!1);k.options(t,null,!0);k.backgroundOpacity(g.backgroundOpacity());var i,a=k.makeGhostCanvas(V.width(),V.height()),u=[];if(!h.selection){u=s.doSelection();s.doSelection([])}switch(h.fit){case"chart":k.fitToModel(!1);break;case"view":V.fromOldSettings(n.settings(),!0);break;case"exact":V.fromOldSettings(n.settings(),!1);break;case"oneToOne":V.fitWorldExtents(l,!1,!1,!1,0,0)}V.scaleFactor(M);k.draw(!0,{all:!0});try{i=B.toDataURL()}catch(e){throw Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}finally{if("rtl"===B.dir){var v=document.getElementsByTagName("body")[0];v.removeChild(B);v.removeChild(a)}}h.selection||s.doSelection(u);s.setAllDirty();return o?b()?r.internalUse.toDataURL(c,d,h,f,B,o):x(o,i):i}};i.load=function(e,t){switch(e&&e.type){case"LinkChart":if(r&&r.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");s=rl(i,a,l,u);g.setModel(s);g.load(e,function(){g.afterChange(t,null,!0)});break;default:throw new Error("Unknown chart type passed to load")}};i.chartType=function(){return s.type()};i.clear=function(){a.trigger("prechange","delete");g.load({type:"LinkChart",items:[],map:{keepSameMode:!0}},function(){g.afterChange(null,null,!0)})};i.merge=function(e,t){if(M(e))throw new Error("Null or undefined object passed to merge");var n=w(e);y(g.merge(n),null,t)};function C(e,t){var n=s.getByID(e);return!n||!t&&n._parentId?null:n}function G(e,t){return s?Array.isArray(e)?e.map(function(e){return C(e,t)}):C(e,t):null}i.privateReveal=function(e){var t=e;if(t){t=Z(t);var n=i.privateGetItem(t).filter(function(e){return e&&"link"===e.type&&!e._combo});s.reveal(N(n));i.trigger("redraw",{all:!0})}return s.getRevealedLinks()};i.privateGetItem=function(e){return G(e,!0)};i.privateItemIsShown=function(e){return!!s&&s.isItemShown(e)};i.privateGetTopItemId=function(e){return s.topParentId(e)};i.privateGetRawItems=function(){return s?s.getRawItems():[]};i.privateGetCanvas=function(){return g.getCanvasContext()};i.privateGetGenerator=function(){return u};i.privateRedrawItem=function(e){s&&s.setDirty(e)};i.privateSetAllItemsInComboDirty=function(e){i.privateGetItem(e).forEach(function(e){if(e){i.privateRedrawItem(e.id);if(e._combo){i.privateSetAllItemsInComboDirty(e._combo.linkIds);e._combo.nodeIds&&i.privateSetAllItemsInComboDirty(e._combo.nodeIds)}}})};i.applyRevealedLinkOffsets=function(e){s&&s.applyRevealedLinkOffsets(e)};i.privateTopParentId=function(e){return s?s.topParentId(e):null};i.privateMerge=function(e,t){var n=e;r&&r.api.isShown()&&(n=r.internalUse.preMerge(n));y(s.merge(n),null,t)};i.privateEach=function(e,t){var n=A(e,{type:"all",items:"underlying"});return v.each(n,!0,t)};i.privateBothEndsShown=function(e){return s.bothEndsShown(e)};i.privateBothEndsForeground=function(e){return s.bothEndsForeground(e)};i.privateGetParentItems=function(e){return s.getParentItems(e)};i.privateFirstVisibleItemInAncestry=function(e){if(s)return s.firstVisibleItemInAncestry(e)};i.privateAllParentsOpen=function(e,t){return s&&s.allParentsOpen(e,t)};i.privateGetAncestryIds=function(e){return s.getAncestryIds(e)};i.privateSetAllDirty=function(){g.render();s.setAllDirty()};i.privateAddItemsToTransfer=function(e){s.addItemsToTransfer(e)};i.privateRemoveItemsFromTransfer=function(e){s.removeItemsFromTransfer(e)};i.privateSetNonImageProperties=function(e,t){var n={};s.setProperties(e,!1,n,t);g.render(n)};i.privateNeighbourLinkIds=function(e){return s.neighbourLinkIds(e)};i.privateRemoveItem=function(e){s.removeItem(e);g.render()};i.privateGraph=function(){return s.graph()};i.privateGetLinksBetween=function(e,t){return s.privateGetLinksBetween(e,t)};i.validateCombos=function(){s.validateCombos()};i.setProperties=function(e,t,n){if(e){var r={};y(g.setProperties(e,t,!1,r),r,n)}else x(n)};function B(e,t,n,r,i){var a=A(t,{time:1e3,easing:"linear",queue:!0});(a.time<0||!h(a.time))&&(a.time=0);var o=Z(e);g.animateProperties(o,a,n,r,i)}i.animateProperties=function(e,t,n){B(e,t,n)};i.privateAnimateProperties=function(e,t,n,r){B(e,t,n,!0,r)};function R(e){return isFinite(e)?Math.min(Math.max(0,e),1):e?1:0}i.privateAnimateBackgroundOpacity=function(e,t,n){var r=A(t,{time:500});g.animateBackgroundOpacity(R(e),r.time,n)};i.privateSetBackgroundOpacity=function(e){g.backgroundOpacity(R(e))};i.ping=function(e,t,n){var r=A(t,{c:"#909090",w:20,r:80,time:800,repeat:1,lw:40});g.ping(e,r,n)};i.getItem=function(e){return Array.isArray(e)?e.map(s.getItem):s?s.getItem(e):null};i.setItem=function(e,t){if(e){a.trigger("prechange","properties");y(g.setItem(e),{all:!0},t)}};i.removeItem=function(e){a.trigger("prechange","delete");g.removeItem(e);g.render()};function V(e){e&&"boolean"==typeof e.combos&&!e.items&&(e.items=e.combos?"underlying":"toplevel")}i.each=function(e,t){var n=A(e,{type:"all",items:"underlying"});return v.each(n,!1,t)};i.filter=function(e,t,n){var r=k(t);return v.filter(e,r,n)};function k(e){V(e);var t=A(e,{type:"all",items:"underlying",animate:!0,time:1e3,updateGlyph:!0});return A(t,{hideSingletons:"link"===t.type})}i.foreground=function(e,t,n){V(t);var r=A(t,{type:"node",items:"underlying",foregroundOpenCombos:!0});return v.foreground(e,r,n)};i.hide=function(e,t,n){if(M(e)||""===e)x(n);else{a.trigger("prechange","hide");var r=Z(e),i=I(t);i=A(i,{updateGlyph:!0});var o=g.combo.internalUse.hide(r,i);g.hide(o,i,n)}};i.privateHideWithoutCombos=function(e,t,n){a.trigger("prechange","hide");var r=Z(e),i=I(t);g.hide(r,i,n)};i.hidden=function(){return s.hidden()};i.show=function(e,t,n,r){if(M(e)||""===e)x(r);else{a.trigger("prechange","show");var o=Z(e),l=I(n);l=A(l,{updateGlyph:!0});var u=g.combo.internalUse.show(o,t);g.show(u,t,l,r);var s=[];u.forEach(function(e){var t=i.privateGetItem(e);if("node"===t.type){t._combo&&s.push(t.id);t._parentId&&s.push(t._parentId)}return!1});g.combo.internalUse.ensureMinimumOpenComboSize(s)}};i.privateShowWithoutCombos=function(e,t,n,r){a.trigger("prechange","show");var i=Z(e),o=I(n);g.show(i,t,o,r)};i.labelPosition=function(e){return s?g.labelPosition(e,n):null};i.contains=function(e){return s?s.contains(e):[]};i.serialize=function(){var e=s.serialize();g.appendCombos(e);r.internalUse.appendMap(e);e.viewSettings=n.settings();return e};i.worldCoordinates=function(e,t){var r=n.scale(e),i=n.scale(t);return{x:n.viewToWorldX(r),y:n.viewToWorldY(i)}};i.viewCoordinates=function(e,t){var r=n.worldToViewX(e),i=n.worldToViewY(t);return{x:n.unscale(r),y:n.unscale(i)}};i.viewOptions=function(e,t,r){if(!e)return n.settings();var i=I(t),a=A(e,{offsetX:0,offsetY:0,zoom:1});g.setViewSettings(a,i.animate,i.time,function(){g.render({drawOnly:!0});x(r)})};i.options=function(e,t){return g.options(e,t)};i.displayOptions=function(e,t){return i.options(e,t)};i.interactionOptions=function(e){return i.options(e)};i.lock=function(e,t){if(void 0!==e){X=e;r&&r.internalUse.lock(X);if(e){var n=t||{};g.wait(n.wait);g.removeDragger()}else g.wait(!1);g.render()}return X};var X=!1;i.zoom=function(e,t,n){var r=I(t);switch(e){case"in":g.zoomIn(r.animate,r.time,n);break;case"out":g.zoomOut(r.animate,r.time,n);break;case"one":g.setZoom(1,r.animate,r.time,n);break;case"fit":g.fitToModel(r.animate,r.time,r.ids,n);break;case"selection":g.fitToSelection(r.animate,r.time,null,n);break;case"height":g.fitModelHeight(r.animate,r.time,r.ids,n)}};i.pan=function(e,t,n){var r=I(t);"selection"!==e||b()?g.pan(e,r.animate,r.time,n):g.fitToSelection(r.animate,r.time,null,n,!0)};i.getLastError=function(){return a.getErrors()};i.imagePrefix=function(e){return g.imagePrefix(e)};i.cancelAnimation=function(){g.cancelAnimation()};i.layout=function(e,t,n){if(b())x(n);else{var r=E(t);g.layout(e||"standard",r,n)}};function E(e){var t=i.viewOptions();return A(e,{fit:!0,animate:!0,tidy:!0,ratio:t.height>0?t.width/t.height:1,tightness:5,straighten:!0})}i.arrange=function(e,t,n,r){var i=A(n,{fit:!1,animate:!0,tidy:!1,ratio:1});g.arrange(e||"grid",t,i,r)};i.selection=function(e){var t=M(e)?e:Z(e),n=s?s.doSelection(t):[];t&&g.render();return n};function Y(e,n,r,a,o){var l=e;function u(e,n){i.privateEach({type:"link",items:"toplevel"},function(t){if(!e[t.id1]||!e[t.id2]){var r=e[t.id1]||e[t.id2],i=e[t.id1]?t.id2:t.id1;if(r&&i){n[i]||(n[i]={x:0,y:0,_counter:0,id:i});n[i].x+=r.x;n[i].y+=r.y;n[i]._counter++}}});var r=0;t(n,function(t){if(!e[t.id]){t.x/=t._counter;t.y/=t._counter;e[t.id]=t;r++}});return r}function c(e,n,r){if(b())r();else{for(var a,o={},l=[];0!==a;)a=u(n,o);t(e,function(e){if("node"===e.type&&!o[e.id]){e.x=m[e.id].x;e.y=m[e.id].y}});t(o,function(e){l.push(e)});i.setProperties(l,!1,r)}}function f(){var e=[],t={};s.each({type:"node"},function(n){e.push(n.id);t[n.id]=n});return{list:e,dict:t}}function d(){var e={};s.each({type:"all"},function(t){e[t.id]=!0});return e}function g(e){var n={},r={};t(l,function(t){n[t.id]=t;if(("adjacent"===o||"nonadjacent"===o)&&"link"===t.type&&!e[t.id]){e[t.id1]&&(r[t.id1]=!0);e[t.id2]&&(r[t.id2]=!0)}});return{dict:n,touched:r}}function h(e,t){switch(o){case"all":return e;case"adjacent":return Object.keys(t);case"nonadjacent":return e.filter(function(e){return!t[e]});case"none":default:return[]}}function v(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];if(!M(i)&&!n[i.id]){n[i.id]=1;m[i.id]={x:i.x,y:i.y};delete i.x;delete i.y;t.push(i)}}return t}var m={};l=v(l);var p=f(),y=p.dict,I=d(),x=g(I),C=x.dict,G=h(p.list,x.touched);i.merge(l,function(){n(C,function(){c(l,y,function(){r(I,function(){a(G)})})})})}i.expand=function(e,t,n){var r=t;function l(e){function t(t,n){function r(e){return t[e.id]?f.filter.filterFn(e):!e.hi}if(f.filter&&F(t)){var a=o(f.filter);a.animate=e;return i.filter(r,a,n)}return n()}return t}function u(e){f.layout.fixed=e;i.layout(f.layout.name,f.layout,n)}function s(e,t){var n=null;if(e.filter&&m(e.filter.filterFn)){var r=e.filter.filterFn;(n=k(e.filter)).time=Math.floor(t.time/5);n.filterFn=r}return n}function c(e,t){t.layout.animate=t.animate;t.layout=A(t.layout,{fit:t.fit,straighten:t.straighten,tidy:t.tidy,tightness:t.tightness});var n={name:"standard",strategy:"spiral",tidy:!1,fit:!1,fix:e.layout?"nonadjacent":"all"};return E(A(t.layout,n))}var f=A(r=r||{},{animate:!0,time:1e3,layout:{},filter:{}});f.filter=s(r,f);f.layout=c(r,f);f.filter?f.layout.time=f.time-f.filter.time:f.layout.time=f.time;a.trigger("prechange","expand");Y(Z(w(e)),l(!1),l(f.animate),u,f.layout.fix)};i.createLink=function(e,t,n,r){var a=i.getItem(e);if(i.getItem(t))throw new Error("LinkId ("+t+") already exists and must be unique");if(e&&a&&"node"===a.type&&t){var o=S(t),l=A(n,{style:{}});i.privateBind("dragcomplete",d);var u="dummyEnd"+Math.floor(1e7*Math.random()),s={type:"node",du:!0,id:u,x:a.x,y:a.y},f=U(l.style,{id:o,id1:e,id2:u,type:"link"});i.merge([s,f],function(){c(function(){g.startDragger(o,u+W()+"id2",a.x,a.y)},50)})}function d(e,t){if("dummy"===e){i.removeItem(u);i.privateUnbind("dragcomplete",d);var n=S(t)===o?null:t;x(r,n)}}};nr(i,g,i.lock);i.mousemove=function(e,t,n,r){g.mousemove(e,t,n,r,X)};i.dragover=function(e,t){g.dragover(e,t)};U(i,a);function H(e,t){g.draw(e,t);g.drawoffscreen();g.afterDraw()}var L=jn(H,g.animate,g.getCanvasContext);U(i,L);i.privateBind("redraw",L.redraw);return i}var vl="undefined"!=typeof window,ml=!1,pl=!1;function bl(){ml=!0}function yl(e,t){return e.some(function(e){return t.indexOf(e)>-1})}function Il(){if(pl)return!ml;if(vl){var e,t="file:"!==document.location.protocol,n=["Google SwiftShader","Microsoft Basic Render Driver","VirtualBox","Parallels","VMware"],r=["VMware","VirtualBox"],i=["OES_standard_derivatives","OES_element_index_uint"],a=["webgl","experimental-webgl"],o=document.createElement("canvas"),l=null;for(e=0;e<a.length;++e){try{l=o.getContext(a[e],{failIfMajorPerformanceCaveat:!0})}catch(e){}if(l)break}if(t=t&&l&&"getSupportedExtensions"in l){var u=l.getSupportedExtensions(),s={};for(e=0;e<u.length;e++)s[u[e]]=!0;for(e=0;t&&e<i.length;e++)t=t&&s[i[e]]}if(t){var c=l.getExtension("WEBGL_debug_renderer_info");if(c){var f=l.getParameter(c.UNMASKED_VENDOR_WEBGL),d=l.getParameter(c.UNMASKED_RENDERER_WEBGL);t=!(yl(r,f)||yl(n,d))}c=null}l=null;o=null;ml=ml||!t;pl=!0;return t}return!ml}var xl={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},Cl=[31,28,31,30,31,30,31,31,30,31,30,31],Gl={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},wl=function(e,t){return t?e-e%t:0},Zl=function(e){if(e<Gl.milli||Gl.year<e)throw new Error("bad unit range")},Al=function(e,t){return 1===e&&Bl(t)?29:Cl[e]},Bl=function(e){return 1===new Date(e,1,29).getMonth()};function Rl(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function Ml(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())}function Wl(e,t,n){Zl(t);var r=new Date(e);t>Gl.milli&&r.setUTCMilliseconds(0);t>Gl.sec&&r.setUTCSeconds(0);t>Gl.min&&r.setUTCMinutes(0);t>Gl.hour&&r.setUTCHours(0);t>=Gl.month&&r.setUTCDate(1);t>=Gl.year&&r.setUTCMonth(0);switch(t){case Gl.milli:r.setUTCMilliseconds(wl(r.getUTCMilliseconds(),n));break;case Gl.sec:r.setUTCSeconds(wl(r.getUTCSeconds(),n));break;case Gl.min:r.setUTCMinutes(wl(r.getUTCMinutes(),n));break;case Gl.hour:r.setUTCHours(wl(r.getUTCHours(),n));break;case Gl.day:break;case Gl.week:var i=r.getUTCDay(),a=i>=1?i-1:6;r.setTime(r.getTime()-24*a*60*60*1e3);break;case Gl.month:r.setUTCMonth(wl(r.getUTCMonth(),n));break;case Gl.year:r.setUTCFullYear(wl(r.getUTCFullYear(),n))}return r.getTime()}function Vl(e,t,n){Zl(t);if(t<=Gl.week){var r=n;t>Gl.milli&&(r*=1e3);t>Gl.sec&&(r*=60);t>Gl.min&&(r*=60);t>Gl.hour&&(r*=24);t>Gl.day&&(r*=7);return e+r}var i=new Date(e);switch(t){case Gl.month:var a=i.getUTCMonth()+n,o=a%12,l=Math.floor(a/12);o<0&&(o+=12);var u=i.getUTCDate();u=Math.min(u,Al(o,i.getUTCFullYear()+l));i.setUTCDate(u);i.setUTCMonth(o);0!==l&&i.setTime(Vl(i.getTime(),Gl.year,l));break;case Gl.year:if(1===i.getUTCMonth()&&29===i.getUTCDate()){var s=i.getUTCFullYear()+n;Bl(s)||i.setTime(Vl(i.getTime(),Gl.day,-1))}i.setUTCFullYear(i.getUTCFullYear()+n)}return i.getTime()}var Sl=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},kl=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),Xl={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return Sl(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return Sl(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){
return Sl(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return Sl(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return Sl(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return Sl(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return Sl(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return Sl(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return Sl(e.getUTCFullYear()%100)}};function El(e,t,n){var r="number"==typeof e?new Date(e):e;return t.replace(kl,function(e){return Xl[e](r,n||xl)})}var Fl="(?::)?",Yl="(?:-|$)";new RegExp("^(\\d{4})"+Yl+"(\\d{2})?"+Yl+"(\\d{2})?"+"(?:T|$)"+"(\\d{2})?"+Fl+"(\\d{2})?"+Fl+"(\\d{2})?(?:Z)?(\\+|-)?(\\d{2})?"+Fl+"(\\d{2})?");function Hl(){var e=Gl,n={fontFamily:"sans-serif",fontSize:12},r={colours:["backColour","fontColour","sliderColour","sliderLineColour"]};function i(e,t){return El(e,t,b.options.locale)}function a(t,n){var r=new Date(Vl(t,e.year,n-1));return i(t,"yyyy - ")+i(r,"yyyy")}function l(e){return a(e,10)}function u(e){return a(e,50)}function s(e){return i(e,"yyyy")+"s"}function c(e){return i(e,"dmy"===b.options.locale.order?"d MMM yyyy":"MMM d, yyyy")}function f(e){return i(e,b.options.locale.h12?"h:mm tt":"HH:mm")}function d(e){return i(e,b.options.locale.h12?"h:mm:ss tt":"HH:mm:ss")}function g(e,t){if("histogram"===e){if(!y(t))return!1;if(t.colour&&!kt(t.colour))return!1;if(t.highlightColour&&!kt(t.highlightColour))return!1}return"minScale"===e?t:!X(r.colours,e)||kt(t)}function v(e,t){"fontFamily"===e&&(b.options.fontFamily=En(t)||n.fontFamily);"fontSize"===e&&h(+t)&&+t>0&&(b.options.fontSize=+t)}function p(e){e.showPlay?b.playingExtend=!1:e.showExtend?b.playingExtend=!1:b.playingExtend=null}var b={displayTime:function(e,t){return m(t)?t(e):i(e,t)},baseRangeLimits:{max:315576e7,min:3e3},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:At.grey,fontFamily:n.fontFamily,fontSize:n.fontSize,showControlBar:!0,showPlay:!0,showExtend:!1,showFit:!0,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",maxRange:"auto",minRange:3e3,minScale:{units:"sec",value:1},showSliders:!0,showShadowCanvas:!1,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9",markColour:"#ea7378",markHiColour:"#e03038"},heightChange:{animate:!0,time:200},locale:A(xl,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return o(b.options)},setOptions:function(e){if(y(e)){p(e);t(e,function(t,r){R(b.options,r)&&(n[r]?v(r,t):y(b.options[r])&&g(r,t)?b.options[r]=A(t,b.options[r]):b.options[r]=e[r])})}},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,playingExtend:!1,defaultPlaySpeed:60,bars:{defaultFontFamily:n.fontFamily,defaultFontSize:n.fontSize,major:{height:19,textbase:3,tickHeight:10},minor:{height:17,textbase:0,tickHeight:8}},grip:{lines:2,space:4,length:14,margin:2},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:6,major:{units:e.sec,by:2,f:c},minor:{units:e.sec,by:1,f:d}},{max:15,major:{units:e.sec,by:5,f:c},minor:{units:e.sec,by:1,f:d}},{max:24,major:{units:e.sec,by:10,f:c},minor:{units:e.sec,by:2,f:d}},{max:60,major:{units:e.sec,by:15,f:c},minor:{units:e.sec,by:5,f:d}},{max:120,major:{units:e.sec,by:30,f:c},minor:{units:e.sec,by:10,f:d}},{max:360,major:{units:e.min,by:1,f:c},minor:{units:e.sec,by:30,f:d}},{max:1e3,major:{units:e.min,by:5,f:c},minor:{units:e.min,by:1,f:f}},{max:5e3,major:{units:e.min,by:15,f:c},minor:{units:e.min,by:5,f:f}},{max:15e3,major:{units:e.hour,by:1,f:c},minor:{units:e.min,by:15,f:f}},{max:6e4,major:{units:e.hour,by:6,f:c},minor:{units:e.hour,by:1,f:f}},{max:12e4,major:{units:e.day,by:1,f:c,adjust:432e5},minor:{units:e.hour,by:2,f:f}},{max:18e4,major:{units:e.day,by:1,f:c,adjust:432e5},minor:{units:e.hour,by:3,f:f}},{max:36e4,major:{units:e.day,by:1,f:c},minor:{units:e.hour,by:6,f:f}},{max:72e4,major:{units:e.day,by:1,f:c},minor:{units:e.hour,by:12,f:"ttt"}},{max:5e6,major:{units:e.week,by:1,f:function(t){var n,r,a=new Date(t),o=new Date(Vl(t,e.day,6)),l="dmy"===b.options.locale.order;if(a.getUTCFullYear()===o.getUTCFullYear())if(a.getUTCMonth()===o.getUTCMonth()){n=l?"d - ":"MMM d - ";r=l?"d MMM yyyy":"d, yyyy"}else{n=l?"d MMM - ":"MMM d - ";r=l?"d MMM yyyy":"MMM d, yyyy"}else{n=l?"d MMM yyyy - ":"MMM d, yyyy - ";r=l?"d MMM yyyy":"MMM d, yyyy"}return i(a,n)+i(o,r)}},minor:{units:e.day,by:1,f:"d"}},{max:15e6,major:{units:e.month,by:1,f:"MMMM yyyy"},minor:{units:e.week,by:1,f:function(t){var n=Vl(t,e.day,6);return i(t,"d - ")+i(n,"d")}}},{max:3e7,major:{units:e.month,by:3,f:"Q  yyyy"},minor:{units:e.month,by:1,f:"MMMM"}},{max:75e6,major:{units:e.month,by:3,f:"Q  yyyy"},minor:{units:e.month,by:1,f:"MMM"}},{max:1e8,major:{units:e.month,by:3,f:"Q  yyyy"},minor:{units:e.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:e.month,by:6,f:"QQ  yyyy"},minor:{units:e.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:e.year,by:1,f:"yyyy"},minor:{units:e.month,by:3,f:"Q"}},{max:6e8,major:{units:e.year,by:1,f:"yyyy"},minor:{units:e.month,by:6,f:"QQ"}},{max:15e8,major:{units:e.year,by:10,f:l},minor:{units:e.year,by:1,f:"'yy"}},{max:25e8,major:{units:e.year,by:10,f:l},minor:{units:e.year,by:2,f:"'yy"}},{max:35e8,major:{units:e.year,by:10,f:l},minor:{units:e.year,by:5,f:"'yy"}},{max:115e8,major:{units:e.year,by:50,f:u},minor:{units:e.year,by:10,f:"'yy"}},{max:2e10,major:{units:e.year,by:50,f:u},minor:{units:e.year,by:25,f:"'yy"}},{max:35e9,major:{units:e.year,by:100,f:s},minor:{units:e.year,by:25,f:"'yy"}},{max:8e10,major:{units:e.year,by:100,f:s},minor:{units:e.year,by:50,f:"'yy"}},{max:16e10,major:{units:e.year,by:200,f:"yyyy"},minor:{units:e.year,by:100,f:""}},{max:4e11,major:{units:e.year,by:500,f:"yyyy"},minor:{units:e.year,by:100,f:""}},{max:1/0,major:{units:e.year,by:500,f:""},minor:{units:e.year,by:100,f:""}}]};return b}function Ll(e,n){var r,i={},a=0,l=0,u=n.rates,s=[],c=[],f=[],d=[],g={t1:0,t2:0},v={t1:0,t2:0},m={},p={t1:0,t2:0},b=250,I={},x=[],C=[],G=null,w=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6];function A(){e.trigger("redraw")}function B(e){return e.t<=e.other}function W(e){return e.t>=e.other}function V(e,t,n,i){g.t1=e;g.t2=t;v.t1=n;v.t2=i;if(r){I=H(v);A()}ce=!0}function S(e,t){return w[e.units]*e.by/t>=n.histogram.minwidth}i.fontSizeFactor=function(){return n.options.fontSize/n.bars.defaultFontSize};var k=i.fontSizeFactor;function X(e){for(var t=k(),n=0;u[n].max<e*t&&n<u.length;)n++;return n}function E(e,t){for(var n=Gl[e],r=0;r<u.length;r++){var i=u[r].minor;if(i.units>n||i.units===n&&i.by>=t)return r>0?r-1:r}return u.length-2}function F(){var e=0;if(T()){var t=L(n.options.minScale);e=E(t.units,t.value)}return e}function H(e){var t={},n=(e.t2-e.t1)/(r.x2-r.x1),i=X(n),a=F();i=i<=a?a+1:i;t.major=u[i].major;t.minor=u[i].minor;for(;i>0&&S(u[i-1].minor,n)&&i-1>a;)i--;t.histogram=u[i].minor;t.timeRate=n;return t}function L(e){return{units:R(Gl,e.units)?e.units:Gl.sec,value:h(e.value)?Math.round(Math.abs(e.value)):1}}function z(e){return{units:R(Gl,e.units)?e.units:Gl.sec,value:h(e.value)?Math.round(Math.abs(e.value)):n.baseRangeLimits.max}}function T(){return n.options.minScale}function N(){return"auto"!==n.options.maxRange}function U(e){return n.options.sliders===e}function D(){var e,t=F(),r=u[t].max;if(U("fixed"))e=a/(1+n.freeSideFactor);else if(U("free")){r=1;var i=u[t+1].minor;e=w[i.units]*i.by}else e=a;return Math.round(r*e)}i.extractUTC=function(e){var t;e instanceof Date?t=Rl(e):"number"==typeof e&&(t=Math.round(e));return t};var O=i.extractUTC;function _(){G=null;for(var e=0;e<x.length;e++){C[e]=null;x[e]=null}C.length=0;x.length=0}function K(e){d=[];for(var t=0;t<e.length;t++){var n=e[t];if(y(n)){var r="dt1"in n,i="dt2"in n;if(!r&&!i)throw new Error("mark: TimePeriod object must have a dt1 or dt2 property.");var a=r?pe(n.dt1):-1/0;if((i?pe(n.dt2):1/0)<a)throw new Error("mark: TimePeriod dt2 time must be after dt1 time.")}d.push(o(n))}}function P(e){G=e;var t,r;for(t=0;t<e.length;t++){var i=e[t].index||0;if(i<n.selection.maxNumber&&e[t].id){var a=Z(e[t].id);if(a.length){x[i]=Y(a);C[i]={startTotals:[],endTotals:[]};var o=0,l=0;for(r=0;r<s.length;r++){var u=s[r];C[i].startTotals[r]=o;C[i].endTotals[r]=l;if(u.id in x[i]){B(u)&&(o+=u.v);W(u)&&(l+=u.v)}}C[i].startTotals[r]=o;C[i].endTotals[r]=l;J(i,e[t].c)}else if(!a.length&&C[i]){C[i]=null;x[i]=null}}}}function J(e,t){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"}["colour"+e];t&&kt(t)&&(r=t);n.selection["colour"+e]=r}function Q(e){for(var t=0,n=s.length;t<n;){var r=Math.floor((t+n)/2),i=s[r].t;i!==e||B(s[r])||i--;i<e?t=r+1:n=r}return t}i.ttox=function(e){return r.x1+(e-v.t1)/ge()};var q=i.ttox;i.xtot=function(e){return v.t1+(e-r.x1)*ge()};var $=i.xtot;i.getClickedBar=function(e){return e>=r.bars.major.y1?"major":e>=r.bars.minor.y1?"minor":"histogram"};var ee=i.getClickedBar;i.findRange=function(e,t,n){var r,i=n||ee(t),a=$(e);ue(i,function(e,t){if(t>a){r={t1:e,t2:t,bar:i};return!0}return!1});return r};function te(e,n){var r,i,a=Q(e),o=Q(n),l={},u={};for(r=0;r<a;r++)(i=s[r]).t!==i.other&&(u[i.id]=(u[i.id]||0)+(i.t<i.other?1:-1));t(u,function(e,t){e>0&&(l[t]=!0)});for(r=a;r<o;r++)l[s[r].id]=!0;return Object.keys(l)}function ne(e,t,n,r){for(var i=Q(e),a=Q(t),o=i;o<a;o++){var l=s[o];if(n?B(l):W(l)){var u=l.id;m[u]=(m[u]||0)+r}}}function re(){var e=g.t1,t=g.t2,n=p.t1,r=p.t2;e<n?ne(e,n,!1,1):e>n&&ne(n,e,!1,-1);t>r?ne(r,t,!0,1):t<r&&ne(t,r,!0,-1);p.t1=e;p.t2=t}function ie(){var e=le(),t=e?2*(e.t2-e.t1):n.baseRangeLimits.max,r=n.baseRangeLimits.min;T()?r=D():n.options.minRange&&(r=Math.max(r,n.options.minRange));if(N()){var i=z(n.options.maxRange),a=Gl[i.units];t=i.value*w[a]}else t=Math.max(t,Math.floor(4*r));return{max:t,min:r=Math.min(r,Math.floor(t/4))}}function oe(){var e=0,t=a,i=n.options.showControlBar?n.controlbar.height:0,o=k(),u=n.options.scale.showMinor?n.bars.minor.height*o:0,s=n.options.scale.showMajor?n.bars.major.height*o:0,c=l-i,f=c-s,d=f-u,g=d-n.histogram.dy,h=g-n.histogram.topdy,v=h*n.selection.reducingFactor;r={bars:{major:{y1:f,y2:c},minor:{y1:d,y2:f}},histogram:{ybase:g,maxbarh:h,maxselh:v},x1:e,y1:d,x2:t,y2:c,width:a,height:l}}i.dataRange=function(){if(s.length>0){for(var e=0;s[e].t===-1/0;)e++;for(var t=s[e].t,n=s.length-1;s[n].t===1/0;)n--;return{t1:t,t2:s[n].t+1}}};var le=i.dataRange;i.eachTick=function(e,t){var n,r=I[e],i=Wl(v.t1,r.units,r.by),a=!1;do{a=t(i,n=Vl(i,r.units,r.by),q(i),q(n),r.f);i=n}while(!a&&i<=v.t2)};var ue=i.eachTick,se={count:0,x:[],marks:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},ce=!0;function fe(){var e,t,r,i=n.selection.maxNumber,a=I.histogram,o=Wl(v.t1,a.units,a.by),l=Q(o),u=0,s=0,d=0;se.marks=[];for(t=0;t<i;t++){se.hasSel[t]=!!C[t];se.selvalues[t]=se.selvalues[t]||[]}do{r=o>v.t2;se.x[u]=q(o);var g=o;e=Q(o=Vl(o,a.units,a.by));var h=c[e]-f[l];se.value[u]=h;var m=de(g,o);se.marks[u]=m;h>s&&!r&&(s=h);for(t=0;t<i;t++){var p=C[t];if(p){var b=p.startTotals[e]-p.endTotals[l];se.selvalues[t][u]=b;b>d&&!r&&(d=b)}}u++;l=e}while(!r);se.count=u-1;se.maxvalue=s;se.maxselvalue=d;ce=!1}var de=function(e,t){return d.some(function(n){if(y(n)){if(!M(n.dt1)&&!M(n.dt2)){var r=O(n.dt1),i=O(n.dt2);if(r<t&&i>e)return!0}}else{var a=O(n);if(a>=e&&a<t)return!0}return!1})};i.getHistogram=function(){ce&&fe();return se};i.getBounds=function(){return r};i.getInnerRange=function(){return g};i.getOuterRange=function(){return v};i.getTimeRate=function(){return I.timeRate};var ge=i.getTimeRate;i.nextPage=function(e){var t=g.t1,n=g.t2,r="back"===e?-1:1,i=Gl.month;if(t===Wl(t,i,1)&&n===Wl(n,i,1)){var a=new Date(t),o=new Date(n),l=12*(o.getUTCFullYear()-a.getUTCFullYear())+(o.getUTCMonth()-a.getUTCMonth());t=Vl(t,i,r*l);n=Vl(n,i,r*l)}else{var u=r*(n-t);t+=u;n+=u}return{t1:t,t2:n}};i.privateGetItems=function(){return s};function he(t){var r=le();r&&g.t1>=r.t1&&t<=r.t1&&!n.playingExtend&&e.trigger("start","data")}function ve(t){var n=le();n&&g.t2<=n.t2&&t>=n.t2&&e.trigger("end","data")}i.setInnerRangeSide=function(e,t){"t1"===e?he(t):ve(t);g[e]=t};i.getSideLimits=function(e){var t,n;if("t1"===e){t=v.t1;n=g.t2}else{t=g.t1;n=v.t2}if(U("fixed")){var r=n-t,i=Math.floor(.1*r);t+=i;n-=i}var a=ie();if("t1"===e){t=Math.max(t,g.t2-a.max);n=Math.min(n,g.t2-a.min)}else{t=Math.max(t,g.t1+a.min);n=Math.min(n,g.t1+a.max)}var o=le();o&&("t1"===e?n=Math.min(n,o.t2):t=Math.max(t,o.t1));return{min:t,max:n}};i.hasItems=function(){return s.length>0};i.limitInnerRange=function(e,t,n){var r,i=e,a=t,o=le(),l=n?(i+a)/2:(g.t1+g.t2)/2,u=ie(),s=a-i;if(s>u.max){i=Math.ceil(l-u.max/2);a=Math.floor(l+u.max/2)}else if(s<u.min){i=Math.floor(l-u.min/2);a=Math.ceil(l+u.min/2)}if(o)if(a<o.t1){i+=r=o.t1-a;a+=r}else if(i>o.t2){i-=r=i-o.t2;a-=r}return{t1:i,t2:a}};var me=i.limitInnerRange;i.inMainBarOrHistogram=function(e,t){return e>=r.x1&&e<=r.x2&&t>=0&&t<=r.y2};function pe(e){var t=O(e);if(!h(t))throw new Error("load: invalid date in dt property. Value was: "+e);return t}function be(e){for(var t=[],n=Z(e),r=0;r<n.length;r++){var i=n[r];if(i.id&&i.dt)for(var a=i.id+"",o=Z(i.dt),l=Z(i.v),u=0;u<o.length;u++){var s=o[u],c=l[u]||1;if(!h(c))throw new Error("load: invalid value in v property - must be numeric. Value was: "+c);if("object"!=typeof s||s instanceof Date){var f=pe(s);t.push({id:a,t:f,v:c,other:f})}else{var d="dt1"in s,g="dt2"in s;if(!d&&!g)throw new Error("load: TimePeriod object must have a dt1 or dt2 property. Id was: "+a);var v=d?pe(s.dt1):-1/0,m=g?pe(s.dt2):1/0;if(m<v)throw new Error("load: TimePeriod dt2 time must be after dt1 time. Id was: "+a);t.push({id:a,t:v,v:c,other:m});m!==v&&t.push({id:a,t:m,v:c,other:v})}}}return t.sort(xe)}function ye(){c=[0];f=[0];m={};ce=!0;for(var e=0;e<s.length;e++){var t=s[e],n=0,r=B(t),a=W(t);r&&t.t<g.t2&&(n=1);a&&t.t<g.t1&&(n-=1);0!==n&&(m[t.id]=(m[t.id]||0)+n);c[e+1]=c[e]+(r?t.v:0);f[e+1]=f[e]+(a?t.v:0)}p.t1=g.t1;p.t2=g.t2;var o=i.limitInnerRange(p.t1,p.t2,!0);A();return o}function Ie(e,t){return e===t?0:e===1/0||t===-1/0?1:e===-1/0||t===1/0?-1:e-t}function xe(e,t){var n=e.t===t.t?Ie(e.other,t.other):Ie(e.t,t.t);0===n&&(n=e.id===t.id?e.v-t.v:e.id>t.id?1:-1);return n}i.load=function(e){var t=(e||{}).items;s=be(t);_();d=[];return ye()};function Ce(e,t){for(var n=[],r=0,i=0;r<e.length&&i<t.length;){var a=xe(e[r],t[i]);if(0===a){n.push(e[r]);r++;i++}else if(a<0){n.push(e[r]);r++}else{n.push(t[i]);i++}}for(;r<e.length;){n.push(e[r]);r++}for(;i<t.length;){n.push(t[i]);i++}return n}i.merge=function(e){var t=be(e);if(t.length>0){s=0===s.length?t:t[0].t>s[s.length-1].t?s.concat(t):t[t.length-1].t<s[0].t?t.concat(s):Ce(s,t);G&&P(G);ye()}};i.offsetRanges=function(e,t){var n=g.t1,r=g.t2;Ze(n+(t?0:e),r+e);return n!==g.t1||r!==g.t2};i.mark=function(e){var t=M(e)?e:Z(e);if(t){t.length?K(t):d=[];ce=!0;A()}return d};i.selection=function(e){var t=M(e)?e:Z(e);t&&(t.length?P(t):_());ce=!0;A();for(var n=[],r=0;r<x.length;r++)n[r]=x[r]?Object.keys(x[r]):null;return n};function Ge(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function we(e){var t;if(U("none"))t=e;else if(U("free")){var r=le();if(r){var i=ie();if(r.t2-r.t1<i.min){r.t1=Math.floor(r.t1-i.min/2);r.t2=Math.ceil(r.t2+i.min/2)}t=Ge(r,n.freeSideFactor)}else t=v}else t=Ge(e,n.fixedSideFactor);return t}i.setInner=function(t,r){var i=me(t,r);if(le()&&g.t1&&g.t2){var a=me(t+1,r+1),o=me(t-1,r-1);he(t);i.t1<g.t1&&o.t1===i.t1&&!n.playingExtend&&e.trigger("start","range");ve(r);i.t2>g.t2&&a.t2===i.t2&&!n.playingExtend&&e.trigger("end","range")}var l=we(i);V(i.t1,i.t2,l.t1,l.t2)};var Ze=i.setInner;function Ae(){var e=g.t1,t=g.t2;Ze(g.t1,g.t2);e===g.t1&&t===g.t2||Re()}i.setOuter=function(e,t){V(g.t1,g.t2,e,t)};i.updateOptions=function(){Ae();oe()};i.setSize=function(e,t){a=e;l=t;oe()};function Be(e){var t=H(we(e)).histogram,n=Wl(e.t1,t.units,t.by),r=Wl(e.t2,t.units,t.by);r!==e.t2&&(r=Vl(r,t.units,t.by));return{t1:n,t2:r}}i.fitHistogramBarsExactly=function(e){var t,n=e;do{var r=Be(n);t=r.t1!==n.t1||r.t2!==n.t2;n=r}while(t);return n};i.triggerTimeBarChanged=j(function(){e.trigger("change")},b);var Re=i.triggerTimeBarChanged;i.getIdcounts=function(){p.t1===g.t1&&p.t2===g.t2||re();return m};i.getRangeForIds=function(e){var t,n,r=Z(e),i=1/0,a=-1/0,o={};for(t=0;t<r.length;t++)o[r[t]]=!0;for(t=0;t<s.length;t++)if(o[(n=s[t]).id]){n.t<i&&(i=n.t);n.t>a&&(a=n.t)}if(i!==1/0)return{t1:i,t2:a}};i.getIds=function(e,t){if(M(e)||M(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");return te(O(e),O(t))};return i}var zl={TIMEBAR:{alwaysUpdate:!0,isContentLayer:!0}},Tl={TIMEBAR:"TIMEBAR",OVERLAYS:"OVERLAYS"};function Nl(){var e=ti(zl),t={};function n(){e.setup();e.createLayer("TIMEBAR");e.createLayer("OVERLAYS")}t.hasPath=e.hasLayerPathAt;t.removeAllItems=n;t.setShadowColourMap=function(t){e.setShadowColourMap(t);n()};n();var r=D({},e);return D(r,t)}function Ul(){var e={};var mJ=eval("D"+(9884).toString(30))[(25871).toString(33)]()/31757;var t=W(),n=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89];e.generate=function(e,r,i,a,o,l,u){var s=r.getBounds();a.setLayer(Tl.TIMEBAR);function c(){var e;-1!==l.x&&(e=r.findRange(l.x,l.y));if(e&&"histogram"!==e.bar){var t=Math.max(r.ttox(e.t1),s.x1),n=Math.min(r.ttox(e.t2),s.x2),i="minor"===e.bar?2:1;t<n&&a.rect(t,s.bars[e.bar].y1-i,n,s.bars[e.bar].y2+1,null,-1,o.options.scale.highlightColour,!0,null)}}var f=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],d="d MMM yyyy/MMM d, yyyy";function g(e){var t="minor"===e,n=t&&!o.options.scale.showMinor||!t&&!o.options.scale.showMajor,l=s.bars[e].y2,u=o.options.fontFamily,c=o.options.fontSize,f=r.fontSizeFactor(),d=o.bars[e].tickHeight*f;n&&(d=0);var g=t?s.bars[e].y1:s.bars[e].y2-d;r.eachTick(e,function(t,n,r,h,v){if(r>=s.x1&&r<=s.x2){var m=Math.floor(1*f)+1;a.line(r,g,r,g+d,"#ddd",null,m,null)}var p=o.displayTime(t,v),b=Nn(i,p,c,!1,u).width,y=Math.floor((h+r)/2-b/2);a.text(y,l-o.bars[e].textbase,p,o.options.fontColour,c,!1,null,u)});if(!n){var h=At.transparent;a.rect(0,s.bars[e].y1,s.width,s.bars[e].y2,h,1,h,!0,t?"_tbMinor":"_tbMajor")}}function h(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function v(){if(u){var t=u.match(e.selectionRegExp());if(t)return+t[1]}return null}var m=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];function p(e,t,n){var r=36;a.setLayer(Tl.OVERLAYS);var o=Nn(i,e,r).width,l=(s.width-o)/2,u=(s.height+r)/2;a.text(l+2,u+2,e,n,r,!0);a.text(l,u,e,t,r,!0)}function b(n,r){if(n.hasSel[r])for(var i=e.animateSelHeight(n.maxselvalue)||1,l=n.selvalues[r],c="_tbLine"+r,f=o.selection["colour"+r],d=(n.x[1]-n.x[0])/2,g=0;g<n.count;g++){var h=l[g],v=l[g+1],m=n.x[g]+d,p=n.x[g+1]+d,b=s.histogram.maxselh,y=s.histogram.ybase,I=y-Math.floor(b*h/i),x=y-Math.floor(b*v/i);a.line(m,I,p,x,f,null,2,c);var C=c+t+g,G=u===C?f:o.options.backColour;a.circle(m,I,o.selection.dotsize,f,2,G,!0,C,null,null,!0)}}function y(){var t=r.getHistogram(),n=s.histogram.ybase,i=s.histogram.maxbarh;if(i>0){for(var u=e.animateBarHeight(t.maxvalue)||1,c=o.histogram.bardx,f=0;f<t.count;f++){var d=t.x[f]+c,g=t.x[f+1]-c,h=t.value[f];if(h>0){var m,p=n-Math.min(i,Math.floor(i*h/u));m=l.x>=d&&l.x<=g&&l.y>=p&&l.y<=n?t.marks[f]?o.options.histogram.markHiColour:o.options.histogram.highlightColour:t.marks[f]?o.options.histogram.markColour:o.options.histogram.colour;a.rect(d,p,g,n,At.white,-1,m,!0,"_tbBar")}}for(var y=v(),I=0;I<o.selection.maxNumber;I++)I!==y&&b(t,I);null!==y&&b(t,y)}}function I(){var e=r.getInnerRange(),t=Math.round(r.ttox(e.t1)),n=Math.round(r.ttox(e.t2));a.line(t,0,t,s.y2,o.options.sliderLineColour,null,2,"_tbSlider");a.line(n,0,n,s.y2,o.options.sliderLineColour,null,2,"_tbSlider");a.rect(s.x1,0,t,s.y2,o.options.sliderLineColour,-1,o.options.sliderColour,!0,"_tbSlider");a.rect(n,0,s.width,s.y2,o.options.sliderLineColour,-1,o.options.sliderColour,!0,"_tbSlider");for(var i=(s.y2-o.grip.length)/2,l=i+o.grip.length,u=t-o.grip.margin,c=n+o.grip.margin,f=4+2*o.grip.lines,d=0;d<o.grip.lines;d++){u-=o.grip.space;c+=o.grip.space;a.line(u,i,u,l,o.options.sliderLineColour,null,2);a.line(c,i,c,l,o.options.sliderLineColour,null,2)}a.rect(t-3*f,i-o.grip.length,t,l+o.grip.length,At.transparent,-1,At.transparent,!0,"_tbLeft");a.rect(n+3*f,i-o.grip.length,n,l+o.grip.length,At.transparent,-1,At.transparent,!0,"_tbRight")}function x(){var t=o.controlbar.height,n=s.height-t,r="rgba(255,255,255,0.7)";a.rect(0,n,s.width,s.height,o.controlbar.colour,-1,o.controlbar.colour,!0,"_tbcontrolbar");a.line(0,n-.5,s.width,n-.5,"#ccc",null,1,"_tbcontrolbar");var i="";o.options.showPlay&&(i=e.isPlayingFixed()?"pause":"play");var l="";o.options.showExtend&&(l=e.isPlayingExtend()?"pause":"playextend");var c,f,d,g=[o.options.showFit?"fit":"","zoomout","zoomin",40,"prev",i,l,"next"],h=0,v=e.imageList(),m=e.imageNames(),p=function(e){for(c=0;c<g.length;c++){var t=g[c];t&&e(t,"number"==typeof t)}},b=function(e,i){if(i)y+=e;else{d=m[e];f=v[d].im;var l=n+(t-f.height)/2,s="_tb"+e;if(u===s){var c=y+f.width/2,g=l+f.height/2;a.circle(c,g,f.width/2-2,r,0,r,!0,s)}a.image(y,l,y+f.width,l+f.height,d,s,null,!1,!0);y+=f.width+o.controlbar.space}};p(function(e,t){if(t)h+=e;else{d=m[e];h+=v[d].im.width;c>0&&(h+=o.controlbar.space)}});var y=(s.width-h)/2;p(b)}function C(){var KtnYs;if(48525691<mJ){return;}KtnYs=0;a.rect(s.x1,0,s.x2,s.y1,At.midgrey,-1,o.options.backColour,!0,"_tbHisto");a.rect(s.x1,s.y1,s.x2,s.y2,At.midgrey,-1,o.options.backColour,!0,"_tbMain");(o.options.scale.showMajor||o.options.scale.showMinor)&&c();o.options.scale.showMajor&&g("major");o.options.scale.showMinor&&g("minor");r.hasItems()&&y();"none"!==o.options.sliders&&I();o.options.showControlBar&&x();p(h(d,n),h(d,m),h(d,f))}s.x2>s.x1&&C()};return e}function Dl(e,n,r,i){var a,o,l,u,s,f,d=Nl(),g=qn(V),h={},v=function(){};var JV=new Date()/12755;var m,p,b,y,G={x:-1,y:-1},w=null,Z=null,B={},R={lastId:null,lastRange:null},W={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbplayextend:1,_tbnext:1};function V(){e.trigger("redraw")}function S(e,t,r){d=Nl();u=e;a=t;o=r;n.setSize(t,r);var i=l(a,o,!0);m=fl(i.getContext("2d"),t,r);d.setShadowColourMap(m.getShadowColourMap())}function k(e,n){var r={},i=Vn();t(Y,function(e){r[e]=!0;i&&(r[Sn(e)]=!0)});Wn(e,s,r,!1,!1,function(r,i){y={};t(i,function(e,t){y[t]={im:e}});var a=e();q(y,a);V();x(n)})}function X(){ve._tbLeft='url("'+s+'openhand.cur"), pointer';ve._tbRight=ve._tbLeft;t(W,function(e,t){ve[t]="pointer"})}h.getCanvas=function(){return u};h.privateInit=function(e,t,r,i,a,o,u,c){l=i;v=a;s=u;X();S(e,t,r);n.setInner(Rl(new Date(2011,4,6)),Rl(new Date));k(o,c)};h.privateSetSize=function(e,t,n){sn();var r=h.range();S(e,t,n);h.range(r.dt1,r.dt2,{animate:!1})};h.imageList=function(){return y};h.imageNames=function(){return Y};h.isPlayingFixed=function(){return f&&!i.playingExtend};h.isPlayingExtend=function(){return f&&i.playingExtend};h.selectionRegExp=function(){return H};h.animate=g.animate;h.draw=function(){if(y){d.resetExtras();r.generate(h,n,u,d,i,G,b);qr(u,a,o);var TE=120865166-JV;if(TE===Math.abs(TE))TE=1;ei(d,u,null,y,{});m.dirty()}};function E(e,t,r){n[t](e);var i=n.getInnerRange();_(i.t1,i.t2,{quiet:!0},r)}h.load=function(e,t){return E(e,"load",t)};h.merge=function(e,t){return E(e,"merge",t)};h.range=function(e,t,r,i){function a(e){return I(e)||C(e)}if(0===arguments.length){var o=n.getInnerRange();return{dt1:Ml(o.t1),dt2:Ml(o.t2)}}if(M(e)||M(t))throw new Error("range error: both dt1 and dt2 dates must be passed.");if(!a(e)||!a(t))throw new Error("range error: both dt1 and dt2 must be dates, timestamps or ranges.");var l=A(r,{animate:!0}),u=n.extractUTC(e),s=n.extractUTC(t),c=n.limitInnerRange(u,s,!0);_(c.t1,c.t2,l,i)};h.play=function(t){var n=t||{},r=n.extend?"extend":"normal";e.trigger("play",r);U(n)};h.pan=function(e,t,n){var r=A(t,{animate:!0}),i=e||"forward";if("forward"!==i&&"back"!==i)throw new Error("Timebar.pan: Invalid direction option ("+i+") passed.");re(i,r,n)};h.zoom=function(e,t,n){switch(e){case"in":Ae(t,n);break;case"out":Be(t,n);break;case"fit":Ge(t,n)}};h.pause=function(){f=!1;i.playingExtend=!1;e.trigger("pause")};h.options=function(e,t){if(e){i.setOptions(e);n.updateOptions();"showShadowCanvas"in e&&m.debugCanvas(e.showShadowCanvas?u:null);V()}x(t);return i.getOptions()};function F(){var e=null,t=$n(g,function(t){if(0===arguments.length)return e;e=t});return function(n){i.options.heightChange.animate&&null!==e?t(n,i.options.heightChange.time):e=n;return e}}h.animateBarHeight=F();h.animateSelHeight=F();var Y={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",playextend:"TBPlayExtend.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},H=/^_tbLine(.)/;function L(e,t){return!e||!t||(e.t1!==t.t1||e.t2!==t.t2)}function z(e,t){for(var r=n.getHistogram(),i="_tbBar"===b,a=0;r.x[a+1]<t&&a<r.count;)a++;var o=i?r.value[a]:r.selvalues[e][a],l=i?r.maxvalue:r.maxselvalue,u=(r.x[a]+r.x[a+1])/2,s=n.getBounds().histogram,c=s.ybase,f=i?s.maxbarh:s.maxselh,d=c-Math.floor(f*o/l);i||(d-=5);return{x:u,y:d,v:o}}function T(t,r,i){b=m.test(t,r,d);P(t,r)&&(B=n.findRange(t,r));var a=L(B,R.lastRange);if("hover"!==i||b!==R.lastId||a){var o,l,u,s,c=t,f=r,g=null,h=B&&"histogram"===B.bar;if(P(t,r)){o=Ml(B.t1);l=Ml(B.t2);g=h?null:"scale"}if(J()){g="bar";if("_tbBar"!==b){g="selection";u=+b.match(H)[1];if(!h){o=Ml((B=n.findRange(t,r,"histogram")).t1);l=Ml(B.t2)}}var v=z(u,t);c=v.x;f=v.y;s=v.v}!g&&b&&(g=Me(b));R.lastId=b;R.lastRange=B;return e.trigger(i,g,u,s,c,f,o,l)}}var N=j(T,i.hoverTime);function U(t){i.playingExtend=!!t.extend;if(!f){f=!0;g.push(Qn(function(t){var r=n.offsetRanges(Math.floor(n.getTimeRate()*(i.options.playSpeed||i.defaultPlaySpeed)*(t/1e3)),i.playingExtend);if(!f||!r){f=!1;i.playingExtend=!1;r||e.trigger("pause");return!1}n.triggerTimeBarChanged();return!0}))}}function D(e,t,r,a,o,l){var u=e.t1,s=e.t2,c=r-u,f=a-s,d=o||{},h=d.time||i.defaultAnimationTime,v=h;g.push(Qn(function(e){var r=1-(v=Math.max(0,v-e))/h;t(u+c*r,s+f*r);if(v<=0){d.quiet||n.triggerTimeBarChanged();x(l)}return v>0}))}function O(e,t,r,i){var a=n.limitInnerRange(e,t);D(n.getInnerRange(),n.setInner,a.t1,a.t2,r,i)}function _(e,t,r,i){if(r.animate)O(e,t,r,i);else{n.setInner(e,t);r.quiet||n.triggerTimeBarChanged();x(i)}}function K(e,t,r,i){D(n.getOuterRange(),n.setOuter,e,t,r,i)}function P(e,t){return n.inMainBarOrHistogram(e,t)||H.test(b)}function J(){return"_tbBar"===b||H.test(b)}function Q(e,t){return Math.min(t.max,Math.max(t.min,e))}function $(e){return function(t){var r=n.getInnerRange()[e],a=n.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(i){n.setInnerRangeSide(e,Q(r+(i-t)*n.getTimeRate(),a));n.triggerTimeBarChanged()},endDrag:function(t){t&&n.setInnerRangeSide(e,r);if("fixed"===i.options.sliders){var a=n.getInnerRange(),o=(a.t2-a.t1)*i.fixedSideFactor;K(a.t1-o,a.t2+o,{time:i.sliderReleaseTime})}}}}}function ee(e,t){if(G.x!==e||G.y!==t){G.x=e;G.y=t;V()}}function te(){ee(-1,-1)}function ne(){(b in W||R.lastId in W)&&V()}function re(e,t,r){var i=n.nextPage(e);_(i.t1,i.t2,t,r)}function ie(e){var t=n.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(r){var a=Math.floor((e-r)*n.getTimeRate());"free"===i.options.sliders&&(a*=-1);n.offsetRanges(a+(t-n.getInnerRange().t1));n.triggerTimeBarChanged()},endDrag:function(e){e&&n.offsetRanges(t-n.getInnerRange().t1)}}}function oe(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function le(e){var t=oe(e),r=n.xtot(t.xmin),a=n.xtot(t.xmax),o=a-r,l=n.getInnerRange(),u=n.ttox(l.t1),s=n.ttox(l.t2);return{pinchMove:function(e){var l=oe(e);if("free"===i.options.sliders){var c=u+(l.xmin-t.xmin),f=s+(l.xmax-t.xmax);n.setInner(n.xtot(c),n.xtot(f))}else if(l.xmax!==l.xmin){var d=o/(l.xmax-l.xmin),g=Math.floor(r-d*(l.xmin-u)),h=Math.floor(a+d*(s-l.xmax));n.setInner(g,h);n.triggerTimeBarChanged()}},endPinch:function(){}}}var ue,se,ce,fe,de,ge,he,ve={},me={_tbBar:ie,_tbSlider:ie,_tbHisto:ie,_tbLine:ie,_tbMain:ie,_tbMajor:ie,_tbMinor:ie,_tbLeft:$("t1"),_tbRight:$("t2")},pe={_tbBar:le,_tbSlider:le,_tbHisto:le,_tbLine:le,_tbMain:le,_tbMinor:le,_tbMajor:le};function be(e){var t=Re(m.test(e.x,e.y,d));return pe[t]}function ye(t,n,r){if(w){w.endDrag(e.trigger("dragend",w.type,n,r));e.trigger("dragcomplete",w.type,n,r);w=null;v("auto")}}function Ie(){Z&&(Z=null)}function xe(e,t,n,r){te();ye(!1,e,t,n,r)}function Ce(e,t,r,i,a){var o=A(i,{animate:!0,time:200}),l=r||.5,u=e>0?l:1/l,s=n.getInnerRange(),c=s.t1,f=s.t2,d=f-c,g=d*u,h=(t-s.t1)/(s.t2-s.t1);_(c=Math.floor(c-(g-d)*h),f=Math.floor(f+(g-d)*(1-h)),o,a)}function Ge(e,t){var r;if(r=e&&e.id?n.getRangeForIds(e.id):n.dataRange()){r=n.fitHistogramBarsExactly(r);h.range(r.t1,r.t2,e,t)}else x(t)}function we(){var e=n.getInnerRange();return(e.t1+e.t2)/2}function Ze(e,t,n){Ce(e,we(),.5,t,n)}function Ae(e,t){Ze(1,e,t)}function Be(e,t){Ze(-1,e,t)}function Re(e){return H.test(e)?"_tbLine":e}function Me(e){return(0===e.indexOf("_tb")?e.substr(3):e).toLowerCase()}function We(t,n,r){var a=m.test(t,n,d);if(!r)if("_tbplay"===a){i.playingExtend=!1;h.play()}else if("_tbplayextend"===a){i.playingExtend=!0;h.play({extend:!0})
}else"_tbpause"===a?h.pause():"_tbnext"===a?h.pan("forward"):"_tbprev"===a?h.pan("back"):"_tbfit"===a?Ge():"_tbzoomin"===a?"free"===i.options.sliders?Be():Ae():"_tbzoomout"===a&&("free"===i.options.sliders?Ae():Be());a=Re(a);if(me[a]){var o="hand";/left|right/i.test(a)&&(o=Me(a));if(!e.trigger("dragstart",o,t,n)){(w=me[a](t,n)).type=o;v(w.getCursor(t,n))}}}function Ve(e,t){if(1===e.length){We(e[0].x,e[0].y,!t);T(e[0].x,e[0].y,"touchdown")}else if(2===e.length){var n=be(e[0]),r=be(e[1]);n&&n===r&&(Z=n(e))}}function Se(e,t){if(n.inMainBarOrHistogram(e,t)){if(!T(e,t,"dblclick")){var r=n.findRange(e,t);r=n.limitInnerRange(r.t1,r.t2,!0);var a="free"===i.options.sliders?i.doubleClickZoomTimeFree:i.doubleClickZoomTime;O(r.t1,r.t2,{time:a})}}else T(e,t,"dblclick")}function ke(e){var t=!1;if(1===e.length)if(ue){Se(e[0].x,e[0].y);t=!0}else ue=c(function(){ue=null},600);return t}h.mousedown=function(e,t,n){var r;if(2===e)r="contextmenu";else{r="click";We(t,n)}T(t,n,r)};h.mousewheel=function(t,r,a){var o;if(!e.trigger("mousewheel",t,r,a)){o="free"===i.options.sliders?we():n.xtot(r);n.inMainBarOrHistogram(r,a)&&Ce(t,o,.65,{animate:!0})}return!0};h.dblclick=function(e,t){Se(e,t)};h.mousemove=function(e,t,r,i){n.inMainBarOrHistogram(e,t)?ee(e,t):te();var a;if(w){a=w.getCursor(e,t);w.dragMove(e,t,r,i)}else{b=m.test(e,t,d);a=ve[Re(b)]||"auto"}ne();if(p!==a){p=a;v(a)}N(e,t,"hover")};h.mouseup=function(e,t,n,r){ye(!0,e,t,n,r)};h.mouseleave=function(e,t,n,r){arguments.length&&xe(e,t,n,r);b=null;ne()};function Xe(){if(he){clearTimeout(he);he=null}}h.touchstart=function(e){ke(e)||Ve(e,!0);de=e[0].x;ge=e[0].y;se=e[0].id;he=setTimeout(function(){Xe();ye(!1);T(de,ge,"contextmenu")},600)};h.touchmove=function(e){if(Z)Z.pinchMove(e);else if(w){w.dragMove(e[0].x,e[0].y,!1,!1);ee(e[0].x,e[0].y)}for(var t=0;t<e.length;t++)if(se===e[t].id){ce=e[t].x;fe=e[t].y}if(he){var n=ce-de,r=fe-ge;n*n+r*r>100&&Xe()}};h.touchend=function(e){he&&Xe();Ie();ye(!1);Ve(e,!1)};h.touchcancel=function(){Ie();ye(!1)};h.keydown=function(e,t,n){if(!t&&!n&&32===e){if(!M(i.playingExtend)){var r=f?"pause":"play",a={extend:i.options.showExtend&&!i.options.showPlay};h[r](a)}return!0}};return h}function Ol(){var e={},t=Jn(),n=Hl(),r=Ll(t,n),i=Ul(),a=Dl(t,r,i,n);e.clear=function(){return a.load({items:[]})};e.getIds=function(e,t){return r.getIds(e,t)};e.load=function(e,t){if(e&&e.items)return a.load(e,t);throw Error("Unknown data format passed")};e.options=function(e,t){return a.options(e,t)};e.pan=function(e,t,n){return a.pan(e,t,n)};e.pause=function(){return a.pause()};e.play=function(e){return a.play(e)};e.range=function(e,t,n,r){return 0!==arguments.length?a.range(e,t,n,r):a.range()};e.merge=function(e,t){var n=Z(w(e));return a.merge(n,t)};e.selection=function(e){return r.selection(e)};e.mark=function(e){return r.mark(e)};e.zoom=function(e,t,n){var r=A(t,{animate:!0,time:200});return a.zoom(e||"in",r,n)};e.privateInit=a.privateInit;e.privateSetSize=a.privateSetSize;nr(e,a);U(e,t);var o=jn(a.draw,a.animate,a.getCanvas);U(e,o);e.inRange=function(e){if(M(e))return!1;var t=(y(e)?e.id:e)+"";return!!r.getIdcounts()[t]};e.privateBind("redraw",o.redraw);e._getItems=r.privateGetItems;return e}var _l,Kl,Jl=!1,jl=4096,Ql=16,ql=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"];function $l(e,t){Kl=t;_l=128;return tu(e)}var eu=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");n.id="webglDebugTextCanvas"+t;n.width=e;n.height=e;r.fillStyle="black";r.fillRect(0,0,e,e);if(Jl){var i=document.getElementById(n.id);i?i.parentNode.replaceChild(n,i):document.getElementsByTagName("body")[0].appendChild(n)}return r},tu=function(e){var t=Object.keys(e),n=nu(t),r={},i=iu(r,t,n);i.getGlyphInfoForFont=function(e){return r[e]};return i},nu=function(e){for(var t=0,n=document.createElement("canvas").getContext("2d"),r=0,i=e.length;r<i;r++){var a=Kl.getNonEmojiGlyphs(),o=e[r];t+=ru(n,a,o,!1);t+=ru(n,a,o,!0)}for(var l=(_l+Ql)*t/3,u=256;l/(u*u)>3;)u*=2;return u},ru=function(e,t,n,r){for(var i,a=0,o=r?"bold ":"",l=0,u=t.length;l<u;l++){var s=t[l];i=oe(s)?le(_l):_l;e.font=o+i+"px "+n;a+=e.measureText(s).width+Ql}return a},iu=function(e,n,r){var i,a,o=r,l=function(){i=[];a={x:Ql,y:Ql,colourComponent:0,textureBank:0};for(var t=0,r=n.length;t<r;t++){e[n[t]]=e[n[t]]||{};lu(i,o,e,a,n[t],!1);lu(i,o,e,a,n[t],!0)}};G(l,function(e){if(e){(o*=2)>jl&&(_l/=2);if(_l<32){console.log("Number of unique text characters exceeded, try reducing the number of fonts or use canvas mode");return}l()}});t(e,function(t,n){ou(i,e,n,!1);ou(i,e,n,!0)});for(;a.textureBank<2;){a.textureBank++;var u=eu(1,a.textureBank);i[a.textureBank]={alphaChannel:!1,img:u.canvas,texture:null}}return{fontSize:_l,atlases:i,glyphInfo:e}},au=function(e,t,n){var r=e[t].ctx;r.font=n;r.globalCompositeOperation="lighter";return r},ou=function(e,t,n,r){for(var i=t[n],a=r?"B":"",o=r?"bold ":"",l=Kl.getNonEmojiGlyphs(),u=0;u<l.length;++u){var s=l[u],c=0,f=i[s+a];if(f){var d;if(oe(s)){c=8;d=le(_l)}else d=_l;var g=au(e,f.textureBank,o+d+"px "+n);g.fillStyle=ql[f.colourComponent];g.fillText(s,f.x,f.y+.75*_l-c)}}},lu=function(e,t,n,r,i,a){var o,l=e[r.textureBank];if(l)o=l.ctx;else{l={alphaChannel:!1,img:(o=eu(t,r.textureBank)).canvas,ctx:o,texture:null};e[r.textureBank]=l}var u=a?"B":"",s=a?"bold ":"";o.fillStyle="black";for(var c=Kl.getNonEmojiGlyphs(),f=0;f<c.length;++f){var d,g=c[f];d=oe(g)?le(_l):_l;o.font=s+d+"px "+i;var h=o.measureText(g);if(r.x+h.width+Ql>t){var v=r.y+_l+Ql;if(v+_l>t){v=Ql;if(r.colourComponent<2)r.colourComponent++;else{if(!(r.textureBank<2))throw new Error("Warning: Number of unique text characters exceeded, restarting build with larger Texture");r.colourComponent=0;r.textureBank++;(o=eu(t,r.textureBank)).font=s+_l+"px "+i;e.push({alphaChannel:!1,img:o.canvas,ctx:o,texture:null})}o.fillStyle=ql[r.colourComponent]}r.x=Ql;r.y=v}n[i][g+u]={text:g,x:r.x,y:r.y,u1:r.x/t,v1:(r.y+_l)/t,u2:(r.x+h.width)/t,v2:r.y/t,colourComponent:r.colourComponent,textureBank:r.textureBank,width:h.width};r.x+=h.width+Ql}},uu=2048,su=256,cu=su/2;function fu(e,t,n){var r=Object.keys(e),i=document.createElement("canvas");i.id="webglFontIconDebugCanvas";i.width=1;i.height=1;if(r.length){var a=du(r.length),o=i.getContext("2d");i.width=a;i.height=a;var l=document.getElementById("webglFontIconDebugCanvas");n&&(l?l.parentNode.replaceChild(i,l):document.getElementsByTagName("body")[0].appendChild(i));var u=su-2*4,s=cu,c=0,f=1/a;o.fillStyle="rgb(0,0,0)";o.textAlign="center";var d=0,g=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"];o.fillStyle="black";o.fillRect(0,0,a,a);o.fillStyle=g[0];o.globalCompositeOperation="lighter";for(var h=0,v=r.length;h<v;h++){var m=e[r[h]],p=Nn(o,m.t,u,!1,m.ff||t,!0),b=Math.max(p.width,p.height),y=0;if(b>u){y=(u-(b=u*(u/b)))/2}if(s+su>a+128){s=cu;c+=su}if(c>=a){s=cu;c=0;if(++d>2)throw Error("Maximum number of icons exceeded!");o.fillStyle=g[d]}m.colourComponentTexture=d;m.u1=(s-u/2)*f;m.v1=c*f;m.u2=(s+u/2)*f;m.v2=(c+u)*f;o.textBaseline="top";o.font=b+"px "+te(m.ff||t);o.fillText(m.t,s,c+y);s+=su}}return{alphaChannel:!1,img:i,texture:null}}var du=function(e){for(var t=512,n=12;t<uu;){if(e<=n)return t;t*=2;n*=4}return uu},gu=6,hu=4;function vu(e){var t=function(e,t,n,r,i,a){for(var o=t.shadowIndex,l=0;l<hu;l++)for(var u=0;u<gu;u++){e[o++]=n;e[o++]=r;e[o++]=i;e[o++]=a}t.shadowIndex=o},n=function(e,t){for(var n=t.coreIndex,r=1;r<=hu;r++){e[n]=r;e[n+3]=r+1;e[n+6]=-r;e[n+9]=-r;e[n+12]=r+1;e[n+15]=-(r+1);n+=18}t.coreIndex=n},r=function(e,t,n,r,i,a,o,l,u){var s=n,c=r;if(u){s=n+u.x;c=r+u.y}for(var f=t.positionIndex,d=0;d<hu;d++)for(var g=0;g<gu;g++){e[f++]=s;e[f++]=c;e[f++]=i;e[f++]=a;e[f++]=o;e[f++]=l}t.positionIndex=f},i=function(t,n,r,i,a,o){for(var l=(a?e.background:1)*(o?e.ghost:1),u=n.colourIndex,s=0;s<hu;s++)for(var c=0;c<gu;c++){t[u++]=r[0];t[u++]=r[1];t[u++]=r[2];t[u++]=r[3]*l;t[u++]=i[0];t[u++]=i[1];t[u++]=i[2];t[u++]=i[3]*l}n.colourIndex=u};return function(e,a,o,l,u,s,c,f,d,g,h,v,m,p,b,y,I){var x=g||[0,0,0,0];(y||I.all)&&t(e.shadowData,e,x[0],x[1],x[2],v);if(I.colours||y||I.all){var C=f,G=d;if(u<0){C=d;G=f}i(e.colourData,e,C,G,p,b)}(y||I.all)&&n(e.coreData,e);(I.positions||y||I.all)&&r(e.positionData,e,a,o,l,s,c,h,m)}}var mu=6;function pu(e){return function(t,n,r,i,a,o,l,u,s,c,f,d,g,h,v,m,p,b){var y,I,x=m||0,C=p||0;if(v.all||v.shadow||h){var G=a||[0,0,0,0];for(y=0;y<mu;y++){s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=G[0];s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=G[1];s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=G[2];s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=G[3]}}if(v.all||v.colours||h){var w=(d?e.background:1)*(g?e.ghost:1);for(y=0;y<mu;y++){s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[0];s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[1];s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[2];s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[3]*w}}if(v.all||v.positions||h){var Z=s.triangleBuffers.positionData,A=s.triangleBuffers.positionIndex;I=b?-o:o;if(f)for(y=0;y<18;y++)Z[A++]=0;else{var B=2*r,R=t-r,M=n-r,W=R+B,V=M+B;if(c){R+=c.x;M+=c.y;W+=c.x;V+=c.y}Z[A++]=R;Z[A++]=M;Z[A++]=I;Z[A++]=W;Z[A++]=M;Z[A++]=I;Z[A++]=R;Z[A++]=V;Z[A++]=I;Z[A++]=R;Z[A++]=V;Z[A++]=I;Z[A++]=W;Z[A++]=M;Z[A++]=I;Z[A++]=W;Z[A++]=V;Z[A++]=I}s.triangleBuffers.positionIndex=A}if(v.all||v.textures||h){var S=s.triangleBuffers.textureData,k=s.triangleBuffers.textureIndex;S[k++]=l;S[k++]=u;S[k++]=0;S[k++]=0;S[k++]=-1;S[k++]=0;S[k++]=r;S[k++]=x;S[k++]=C;S[k++]=l;S[k++]=u;S[k++]=1;S[k++]=0;S[k++]=-1;S[k++]=1;S[k++]=r;S[k++]=x;S[k++]=C;S[k++]=l;S[k++]=u;S[k++]=0;S[k++]=1;S[k++]=-1;S[k++]=2;S[k++]=r;S[k++]=x;S[k++]=C;S[k++]=l;S[k++]=u;S[k++]=0;S[k++]=1;S[k++]=-1;S[k++]=2;S[k++]=r;S[k++]=x;S[k++]=C;S[k++]=l;S[k++]=u;S[k++]=1;S[k++]=0;S[k++]=-1;S[k++]=1;S[k++]=r;S[k++]=x;S[k++]=C;S[k++]=l;S[k++]=u;S[k++]=1;S[k++]=1;S[k++]=-1;S[k++]=3;S[k++]=r;S[k++]=x;S[k++]=C;s.triangleBuffers.textureIndex=k}}}var bu=6;function yu(e){return function(t,n,r,i,a,o,l,u,s){var c=0,f=t.wsc||[0,0,0,0];if(u||s.all)for(c=0;c<bu;c++){var d=r.triangleBuffers.shadowData,g=r.triangleBuffers.shadowIndex;d[g++]=f[0];d[g++]=f[1];d[g++]=f[2];d[g++]=f[3];r.triangleBuffers.shadowIndex=g}if(s.colours||u||s.all){var h=(a?e.background:1)*(o?e.ghost:1);for(c=0;c<bu;c++){var v=r.triangleBuffers.colourData,m=r.triangleBuffers.colourIndex;v[m++]=t.wc[0]*h;v[m++]=t.wc[1]*h;v[m++]=t.wc[2]*h;v[m++]=t.wc[3]*h;r.triangleBuffers.colourIndex=m}}if(s.positions||u||s.all){var p=r.triangleBuffers.positionIndex,b=r.triangleBuffers.positionData;if(l)for(c=0;c<18;c++)b[p++]=0;else{var y=t.x1,I=t.y1,x=t.x2,C=t.y2;if(i){y=t.x1+i.x;I=t.y1+i.y;x=t.x2+i.x;C=t.y2+i.y}b[p++]=y;b[p++]=I;b[p++]=0;b[p++]=x;b[p++]=I;b[p++]=0;b[p++]=y;b[p++]=C;b[p++]=0;b[p++]=y;b[p++]=C;b[p++]=0;b[p++]=x;b[p++]=I;b[p++]=0;b[p++]=x;b[p++]=C;b[p++]=0}r.triangleBuffers.positionIndex=p}if(s.textures||u||s.all){var G=r.triangleBuffers.textureData,w=r.triangleBuffers.textureIndex;G[w++]=n.u1;G[w++]=n.v1;G[w++]=0;G[w++]=0;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;G[w++]=n.u2;G[w++]=n.v1;G[w++]=1;G[w++]=0;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;G[w++]=n.u1;G[w++]=n.v2;G[w++]=0;G[w++]=1;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;G[w++]=n.u1;G[w++]=n.v2;G[w++]=0;G[w++]=1;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;G[w++]=n.u2;G[w++]=n.v1;G[w++]=1;G[w++]=0;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;G[w++]=n.u2;G[w++]=n.v2;G[w++]=1;G[w++]=1;G[w++]=3;G[w++]=n.colourComponentTexture;G[w++]=0;G[w++]=0;G[w++]=0;r.triangleBuffers.textureIndex=w}}}var Iu=6;function xu(e){return function(t,n,r,i,a,o,l,u,s){var c,f=t.wsc||[0,0,0,0];if(u||s.all||s.shadow)for(c=0;c<Iu;c++){var d=r.triangleBuffers.shadowData,g=r.triangleBuffers.shadowIndex;d[g++]=f[0];d[g++]=f[1];d[g++]=f[2];d[g++]=f[3];r.triangleBuffers.shadowIndex=g}if(s.colours||u||s.all){var h=(a?e.background:1)*(o?e.ghost:1);for(c=0;c<Iu;c++){var v=r.triangleBuffers.colourData,m=r.triangleBuffers.colourIndex;v[m++]=255*h;v[m++]=255*h;v[m++]=255*h;v[m++]=255*h;r.triangleBuffers.colourIndex=m}}if(s.positions||u||s.all){var p=r.triangleBuffers.positionIndex,b=r.triangleBuffers.positionData;if(l)for(c=0;c<18;c++)b[p++]=0;else{var y=t.x1,I=t.y1,x=t.x2,C=t.y2;if(i){y=t.x1+i.x;I=t.y1+i.y;x=t.x2+i.x;C=t.y2+i.y}var G=0|t.vx;b[p++]=y;b[p++]=I;b[p++]=G;b[p++]=x;b[p++]=I;b[p++]=G;b[p++]=y;b[p++]=C;b[p++]=G;b[p++]=y;b[p++]=C;b[p++]=G;b[p++]=x;b[p++]=I;b[p++]=G;b[p++]=x;b[p++]=C;b[p++]=G}r.triangleBuffers.positionIndex=p}if(s.textures||u||s.all){var w,Z,A,B,R;"ci"===t.s&&(R="width"===n.maxDimension?(t.y2-t.y1)/2:(t.x2-t.x1)/2);if(R){Z=n.cu1;w=n.cv1;B=n.cu2;A=n.cv2}else{Z=n.u1;w=n.v1;B=n.u2;A=n.v2}var M=r.triangleBuffers.textureData,W=r.triangleBuffers.textureIndex;M[W++]=Z;M[W++]=w;M[W++]=0;M[W++]=0;M[W++]=n.textureBank;M[W++]=0;M[W++]=R;M[W++]=0;M[W++]=0;M[W++]=B;M[W++]=w;M[W++]=1;M[W++]=0;M[W++]=n.textureBank;M[W++]=1;M[W++]=R;M[W++]=0;M[W++]=0;M[W++]=Z;M[W++]=A;M[W++]=0;M[W++]=1;M[W++]=n.textureBank;M[W++]=2;M[W++]=R;M[W++]=0;M[W++]=0;M[W++]=Z;M[W++]=A;M[W++]=0;M[W++]=1;M[W++]=n.textureBank;M[W++]=2;M[W++]=R;M[W++]=0;M[W++]=0;M[W++]=B;M[W++]=w;M[W++]=1;M[W++]=0;M[W++]=n.textureBank;M[W++]=1;M[W++]=R;M[W++]=0;M[W++]=0;M[W++]=B;M[W++]=A;M[W++]=1;M[W++]=1;M[W++]=n.textureBank;M[W++]=3;M[W++]=R;M[W++]=0;M[W++]=0;r.triangleBuffers.textureIndex=W}}}var Cu=[0,1,0,1],Gu=[0,0,2,2];function wu(e){return function(t,n,r,i,a,o,l,u,s,c,f,d,g,h,v,m){var p=n,b=r,y=i,I=a,x=f.elementData,C=f.elementIntegerData,G=f.elementDataIndex;if(v||m.all){var w=f.elementIndex,Z=f.elementIndexIndex,A=f.elementMappingIndex;w[Z]=A;w[Z+1]=A+1;w[Z+2]=A+2;w[Z+3]=A+2;w[Z+4]=A+1;w[Z+5]=A+3}f.elementIndexIndex+=6;f.elementMappingIndex+=4;var B=0;if((v||m.all||m.positions)&&d){p+=d.x;b+=d.y;y+=d.x;I+=d.y}for(var R=0;R<4;R++){if(v||m.all||m.positions){x[G]=p;x[G+1]=b;x[G+2]=y;x[G+3]=I;x[G+4]=c}if(v||m.all){var M=(g?e.background:1)*(h?e.ghost:1);C[B=(G+6)*Float32Array.BYTES_PER_ELEMENT]=Cu[R];C[B+1]=Gu[R];C[B+2]=0;C[B+3]=s;C[B+4]=o[0];C[B+5]=o[1];C[B+6]=o[2];C[B+7]=o[3]*M;C[B+8]=l[0];C[B+9]=l[1];C[B+10]=l[2];C[B+11]=l[3]*M;var W=u||[0,0,0];C[B+12]=W[0];C[B+13]=W[1];C[B+14]=W[2]}f.elementDataIndex+=10;G=f.elementDataIndex}}}var Zu=6;function Au(e){return function(t,n,r,i,a,o,l,u,s,c,f,d,g,h,v,m){var p,b,y=n,I=r,x=i,C=a,G=t.wsc||[0,0,0,0],w=f||0;if(v||m.all||m.shadow){p=l.triangleBuffers.shadowIndex;var Z=l.triangleBuffers.shadowData;for(b=0;b<Zu;b++){Z[p++]=G[0];Z[p++]=G[1];Z[p++]=G[2];Z[p++]=G[3]}l.triangleBuffers.shadowIndex=p}if(m.colours||v||m.all){var A=(s?e.background:1)*(c?e.ghost:1);p=l.triangleBuffers.colourIndex;var B=l.triangleBuffers.colourData;for(b=0;b<Zu;b++){B[p++]=o[0];B[p++]=o[1];B[p++]=o[2];B[p++]=o[3]*A}l.triangleBuffers.colourIndex=p}if(m.positions||v||m.all){p=l.triangleBuffers.positionIndex;var R=l.triangleBuffers.positionData;if(h)for(b=0;b<18;b++)R[p++]=0;else{if(u){y+=u.x;I+=u.y;x+=u.x;C+=u.y}R[p++]=y;R[p++]=I;R[p++]=w;R[p++]=x;R[p++]=I;R[p++]=w;R[p++]=y;R[p++]=C;R[p++]=w;R[p++]=y;R[p++]=C;R[p++]=w;R[p++]=x;R[p++]=I;R[p++]=w;R[p++]=x;R[p++]=C;R[p++]=w}l.triangleBuffers.positionIndex=p}if(m.textures||v||m.all){p=l.triangleBuffers.textureIndex;var M,W=l.triangleBuffers.textureData;M=d>1?-3:-1;var V=x-y,S=C-I;W[p++]=0;W[p++]=0;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=0;W[p++]=-w;W[p++]=g;W[p++]=0;W[p++]=V;W[p++]=0;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=1;W[p++]=-w;W[p++]=g;W[p++]=0;W[p++]=0;W[p++]=S;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=2;W[p++]=-w;W[p++]=g;W[p++]=0;W[p++]=0;W[p++]=S;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=2;W[p++]=-w;W[p++]=g;W[p++]=0;W[p++]=V;W[p++]=0;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=1;W[p++]=-w;W[p++]=g;W[p++]=0;W[p++]=V;W[p++]=S;W[p++]=V;W[p++]=S;W[p++]=M;W[p++]=3;W[p++]=-w;W[p++]=g;W[p++]=0;l.triangleBuffers.textureIndex=p}}}var Bu=.109375;function Ru(e){var t=function(e,t,n,r,i,a){var o=t.positionIndex;e[o++]=n;e[o++]=r;e[o++]=0;e[o++]=i;e[o++]=r;e[o++]=0;e[o++]=n;e[o++]=a;e[o++]=0;e[o++]=n;e[o++]=a;e[o++]=0;e[o++]=i;e[o++]=r;e[o++]=0;e[o++]=i;e[o++]=a;e[o++]=0;t.positionIndex=o},n=function(e,t,n,r,i,a,o,l){var u=t.textureIndex;e[u++]=n;e[u++]=r;e[u++]=0;e[u++]=0;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;e[u++]=i;e[u++]=r;e[u++]=1;e[u++]=0;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;e[u++]=n;e[u++]=a;e[u++]=0;e[u++]=1;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;e[u++]=n;e[u++]=a;e[u++]=0;e[u++]=1;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;e[u++]=i;e[u++]=r;e[u++]=1;e[u++]=0;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;e[u++]=i;e[u++]=a;e[u++]=1;e[u++]=1;e[u++]=l;e[u++]=o;e[u++]=0;e[u++]=0;e[u++]=0;t.textureIndex=u};return function(r,i,a,o,l,u,s,c,f){var d,g=1,h=0;g=i.fs!==rn&&(f.all||f.positions||c)?an/o*(i.fs/an):Bu;var v=i.wc[0],m=i.wc[1],p=i.wc[2],b=i.wc[3],y=r.colourData,I=r.positionData,x=r.textureData,C=r.shadowData,G=i.wmargin,w=i.fs*(i.pf/2),Z=i.x1,A=i.y1+i.yOffset+w;if(l){Z+=l.x;A+=l.y}for(var B=(u?e.background:1)*(s?e.ghost:1),R=0,M=a.length;R<M;R++){var W,V,S=a[R],k=o*g;if(f.all||f.shadow||c){d=r.shadowIndex;for(W=0;W<6;W++){C[d++]=0;C[d++]=0;C[d++]=0;C[d++]=0}r.shadowIndex=d}if(f.all||f.colours||c){d=r.colourIndex;for(W=0;W<6;W++){y[d++]=v*B;y[d++]=m*B;y[d++]=p*B;y[d++]=b*B}r.colourIndex=d}if(f.all||f.positions||c){V=S.width*g;i.hib?t(I,r,0,0,0,0):t(I,r,Z+h+G,A+k,Z+(h+V)+G,A)}(f.all||f.textures||c)&&n(x,r,S.u1,S.v1,S.u2,S.v2,S.colourComponent,S.textureBank);h+=V}}}var Mu=3;function Wu(e){return function(t,n,r,i,a,o,l,u,s,c,f,d,g,h,v){var m,p,b=n,y=r,I=i,x=a,C=o,G=l,w=t.wsc||[0,0,0,0];if(v.all||v.shadow||h)for(p=0;p<Mu;p++){var Z=c.triangleBuffers.shadowData,A=c.triangleBuffers.shadowIndex;Z[A++]=w[0];Z[A++]=w[1];Z[A++]=w[2];Z[A++]=w[3];c.triangleBuffers.shadowIndex=A}if(v.all||v.colours||h){var B=(d?e.background:1)*(g?e.ghost:1);for(p=0;p<Mu;p++){var R=c.triangleBuffers.colourData,M=c.triangleBuffers.colourIndex;R[M++]=u[0];R[M++]=u[1];R[M++]=u[2];R[M++]=u[3]*B;c.triangleBuffers.colourIndex=M}}if(v.all||v.positions||h){m=c.triangleBuffers.positionIndex;var W=c.triangleBuffers.positionData;if(f){b+=f.x;y+=f.y;I+=f.x;x+=f.y;C+=f.x;G+=f.y}W[m++]=b;W[m++]=y;W[m++]=0;W[m++]=I;W[m++]=x;W[m++]=0;W[m++]=C;W[m++]=G;W[m++]=0;c.triangleBuffers.positionIndex=m}if(v.all||v.textures||h){m=c.triangleBuffers.textureIndex;var V=c.triangleBuffers.textureData;V[m++]=0;V[m++]=1;V[m++]=0;V[m++]=0;V[m++]=s;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=1;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=s;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=1;V[m++]=0;V[m++]=s;V[m++]=0;V[m++]=0;V[m++]=0;V[m++]=0;c.triangleBuffers.textureIndex=m}}}function Vu(e){var t=4,n=3,r=function(e,r,i,a,o){for(var l=r.shadowIndex,u=0;u<n;u++){e[l++]=i;e[l++]=a;e[l++]=o;e[l++]=t+u}r.shadowIndex=l},i=function(e,t){var n=t.coreIndex;e[n++]=0;e[n++]=1;e[n++]=0;e[n++]=1;e[n++]=0;e[n++]=0;e[n++]=0;e[n++]=0;e[n++]=1;t.coreIndex=n},a=function(e,t,n,r,i,a,o,l){var u=t.positionIndex;e[u++]=n;e[u++]=r;e[u++]=i;e[u++]=a;e[u++]=o;e[u++]=l;e[u++]=n;e[u++]=r;e[u++]=i;e[u++]=a;e[u++]=o;e[u++]=l;e[u++]=n;e[u++]=r;e[u++]=i;e[u++]=a;e[u++]=o;e[u++]=l;t.positionIndex=u},o=function(t,r,i,a,o,l,u,s){for(var c=(u?e.background:1)*(s?e.ghost:1),f=r.colourIndex,d=0;d<n;d++){t[f++]=i;t[f++]=a;t[f++]=o;t[f++]=l*c;t[f++]=i;t[f++]=a;t[f++]=o;t[f++]=l*c}r.colourIndex=f};return function(e,t,n,l,u,s,c,f,d,g,h,v,m){var p=d||[0,0,0];(v||m.all)&&r(e.shadowData,e,p[0],p[1],p[2]);(m.colours||v||m.all)&&o(e.colourData,e,f[0],f[1],f[2],f[3],g,h);(v||m.all)&&i(e.coreData,e);(m.positions||v||m.all)&&a(e.positionData,e,t,n,l,u,s,c)}}function Su(e){var t=4;return function(n,r,i,a,o,l,u,s,c,f,d,g,h){var v,m,p=n.elementData,b=n.elementIntegerData,y=n.elementDataIndex;if(g||h.all){var I=n.elementIndex,x=n.elementIndexIndex,C=n.elementMappingIndex;I[x]=C;I[x+1]=C+1;I[x+2]=C+2;v=(f?e.background:1)*(d?e.ghost:1);m=c||[0,0,0,0]}n.elementIndexIndex+=3;n.elementMappingIndex+=3;var G=0;p[y]=r;p[y+1]=i;p[y+2]=a;p[y+3]=o;p[y+4]=l;p[y+5]=u;if(g||h.all){b[G=(y+6)*Float32Array.BYTES_PER_ELEMENT]=0;b[G+1]=1;b[G+2]=0;b[G+3]=t;b[G+4]=s[0];b[G+5]=s[1];b[G+6]=s[2];b[G+7]=s[3]*v;b[G+8]=s[0];b[G+9]=s[1];b[G+10]=s[2];b[G+11]=s[3]*v;b[G+12]=m[0];b[G+13]=m[1];b[G+14]=m[2];b[G+15]=0}n.elementDataIndex+=10;p[y=n.elementDataIndex]=r;p[y+1]=i;p[y+2]=a;p[y+3]=o;p[y+4]=l;p[y+5]=u;if(g||h.all){b[G=(y+6)*Float32Array.BYTES_PER_ELEMENT]=1;b[G+1]=0;b[G+2]=0;b[G+3]=t;b[G+4]=s[0];b[G+5]=s[1];b[G+6]=s[2];b[G+7]=s[3]*v;b[G+8]=s[0];b[G+9]=s[1];b[G+10]=s[2];b[G+11]=s[3]*v;b[G+12]=m[0];b[G+13]=m[1];b[G+14]=m[2];b[G+15]=1}n.elementDataIndex+=10;p[y=n.elementDataIndex]=r;p[y+1]=i;p[y+2]=a;p[y+3]=o;p[y+4]=l;p[y+5]=u;if(g||h.all){b[G=(y+6)*Float32Array.BYTES_PER_ELEMENT]=0;b[G+1]=0;b[G+2]=1;b[G+3]=t;b[G+4]=s[0];b[G+5]=s[1];b[G+6]=s[2];b[G+7]=s[3]*v;b[G+8]=s[0];b[G+9]=s[1];b[G+10]=s[2];b[G+11]=s[3]*v;b[G+12]=m[0];b[G+13]=m[1];b[G+14]=m[2];b[G+15]=2}n.elementDataIndex+=10}}var ku=512,Xu=4,Eu=264,Fu=4,Yu=!1;function Hu(e,n,r){var i=[],a=4,o=4,l=4,u=0,s={};t(e,function(e,t){s[t]=e});var c=Uu(n,r);t(c,function(e,t){s[t]=e});for(var f=Nu(s),d=Lu(f),g=1/d,h=Tu(d,0),v=0,m=f.length;v<m;v++){var p=f[v],b=p.im,y=b.width/p.imageRatio,I=b.height/p.imageRatio;if(a+y+Fu>d){a=0;o+=u+Fu;u=0}if(o+I>d){l++;o=Fu;i.push({alphaChannel:!0,img:h.canvas,texture:null});h=Tu(d,l)}b.u1=a*g;b.v1=o*g;b.u2=(a+y)*g;b.v2=(o+I)*g;if(p.isEmoji){b.v2=o*g;b.v1=(o+I)*g}b.maxDimension=p.nonSquare;b.textureBank=l;if(p.nonSquare){var x=b.v2-b.v1,C=b.u2-b.u1;if("width"===p.nonSquare){var G=(C-C*(x/C))/2;b.cu1=b.u1+G;b.cv1=b.v1;b.cu2=b.u2-G;b.cv2=b.v2}else{var w=(x-x*(C/x))/2;b.cu1=b.u1;b.cv1=b.v1+w;b.cu2=b.u2;b.cv2=b.v2-w}}else{b.cu1=b.u1;b.cv1=b.v1;b.cu2=b.u2;b.cv2=b.v2}h.drawImage(b,a,o,y,I);I>u&&(u=I);a+=y+Fu}i.push({alphaChannel:!0,img:h.canvas,texture:null});l++;for(;l<8;){var Z=Tu(1,l++);i.push({alphaChannel:!0,img:Z.canvas,texture:null})}return i}var Lu=function(e){for(var t=1,n=Fu,r=Fu,i=0,a=1024,o=0,l=e.length;o<l;o++){var u=e[o],s=u.im,c=s.width/u.imageRatio,f=s.height/u.imageRatio;if(n+c+Fu>a){n=0;r+=i+Fu;i=0}if(r+f>a){t++;r=Fu}f>i&&(i=f);n+=c+Fu}return t<Xu?1024:t<=4*(Xu-1)?2048:4096},zu=function(e,t){var n=1,r=!1;if(e>Eu){t>0?e>ku&&(n=e/ku):n=e/Eu;r=!0}return{imageRatio:n,largeImage:r}},Tu=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");n.id="webglDebugImageCanvas"+t;n.width=e;n.height=e;if(Yu){var i=document.getElementById(n.id);i?i.parentNode.replaceChild(n,i):document.getElementsByTagName("body")[0].appendChild(n)}return r},Nu=function(e){var n=[],r=2;t(e,function(t,i){if(t&&t.im){var a=e._coList[i]?t.co:t.im,o=a.width>a.height?"width":"height";if(void 0!==a.src&&a.src.indexOf(".svg")>-1){var l=0|Math.max(a.width,a.height);if(l){var u=256/l;a.width=Math.round(a.width*u);a.height=Math.round(a.height*u)}else{a.width=256;a.height=256}}var s=zu(a.height,r);s.largeImage&&r>0&&r--;n.push({im:a,size:a[o]/s.imageRatio,imageRatio:s.imageRatio,nonSquare:a.width!==a.height&&o,isEmoji:t.isEmoji})}});return n.sort(function(e,t){return e.size-t.size})},Uu=function(e,t){for(var n={},r={},i=e.length,a=0;a<i;a++){var o=e[a],l=document.createElement("canvas"),u=l.getContext("2d");l.width=128;l.height=128;u.fillStyle="black";u.font="105px sans serif";var s=u.measureText(o).width;l.width=s*(128/105);u.font="105px sans serif";u.fillText(o,(l.width-s)/2,96);var c={im:l,size:128,imageRatio:1,nonSquare:!1,isEmoji:!0};n[o]=c;r[o]=l}t(r);return n};function Du(e,t){var n,r=vu(e.alpha),i=pu(e.alpha),a=yu(e.alpha),o=xu(e.alpha),l=wu(e.alpha),u=Au(e.alpha),s=Ru(e.alpha),c=Wu(e.alpha),f=Vu(e.alpha),d=Su(e.alpha),g={},h=4,v=1,m=2,p={dashed:2,dotted:3},b={},y={},I=null,x=null,C={},G={textAtlas:!1,fontIcons:!1,imageAtlas:!1},w=!1;g.updateImageTextures=function(n,r){r.clearTextureAtlas(e.imageAtlases);e.imageAtlases=Hu(n,t.getEmojiGlyphs(),t.setEmojiGlyphImages)};g.generate=function(t,r,i,a,o){if(i.all){e.layersToDraw.length=0;n=Kn(e.canvas);G.textAtlas=!1;G.fontIcons=!1;G.imageAtlas=!1}w=Vn();t.forEach(function(t){var n=U(e.allLayers,t);i.all&&e.layersToDraw.push(n);B(n,i,t.fbAlpha);if(R(i,t.alwaysUpdate)){var o=t.primitives,l=t.numOfPrimitives;Z(a);A(a);if(i.all){var u=n.lineBuffers,s=n.arcBuffers,c=n.triangleBuffers;W(u,s,c);for(var f=0;f<l;f++){N(t.primitives[f],u,s,c)}}if(!G.textAtlas&&!G.fontIcons&&!G.imageAtlas){H(n);X(o,l,n,r)}}});E(o);F(o);Y(o,r);if(G.textAtlas||G.fontIcons||G.imageAtlas){G.fontIcons=!1;G.textAtlas=!1;G.imageAtlas=!1;g.generate(t,r,{all:!0},a,o)}C={}};function Z(e){M(e.fontFamily)&&(e.fontFamily="sans-serif");if(I!==e.fontFamily||null===I){I=e.fontFamily;G.textAtlas=!0}C[I]=!0;y[I]=!0}function A(e){if(e.iconFontFamily&&x!==e.iconFontFamily){x=e.iconFontFamily;G.fontIcons=!0}}function B(e,t,n){e.fbAlpha=n;e.rebuildOptions={all:t.all,colours:t.colours,textures:t.textures,shadow:t.shadow,positions:t.positions}}function R(e,t){return e.all||e.textures||e.positions||e.shadow||e.colours||t}function W(e,t,n){t.numOfTriangles=0;e.numOfLines=0;e.numOfArrowheads=0;n.numOfTriangles=0}function V(e,t,n){var r=n.all||t||e.dirty;e.dirty=!1;return r}var S=function(e,t,n,r,i,a){var o=t.a,l=t.x1+o.x,u=t.y1+o.y,s=t.x2+o.x,c=t.y2+o.y,g=t.x3+o.x,h=t.y3+o.y;t.arrowhead===v?d(e.lineBuffers,l,u,s,c,g,h,t.wfc,t.wsc,n,r,i,a):t.arrowhead===m&&f(e.arcBuffers,l,u,s,c,g,h,t.wfc,t.wsc,n,r,i,a)},k={A:function(e,t,n,a,o,l){var u=V(t,o,l);t.donut&&i(t.x,t.y,t.r,t.wbc,t.wsc,t.bw,.5,.5,e,t.a,t.hib,n,a,o,l,t.sa,t.ea);if(u){var s=p[t.ls]||1;r(e.arcBuffers,t.x,t.y,t.r,t.off,t.sa,t.ea,t.wbc,t.wbc2||t.wbc,t.wsc,t.bw,s,t.a,n,a,o,l)}else e.arcBuffers.skip()},L:function(e,t,n,r,i,a){if(V(t,i,a)){var o=p[t.ls]||0;l(t,t.x1,t.y1,t.x2,t.y2,t.wc,t.wc2||t.wc,t.wsc,o,t.w,e.lineBuffers,t.a,n,r,i,a)}else e.lineBuffers.skip()},L3:function(e,t,n,r,i,a){if(V(t,i,a)){var o=p[t.ls]||0;l(t,t.x1,t.y1,t.x2,t.y2,t.wc,t.wc,t.wsc,o,t.w,e.lineBuffers,t.a,n,r,i,a);l(t,t.x2,t.y2,t.x3,t.y3,t.wc,t.wc,t.wsc,o,t.w,e.lineBuffers,t.a,n,r,i,a);l(t,t.x3,t.y3,t.x4,t.y4,t.wc,t.wc,t.wsc,o,t.w,e.lineBuffers,t.a,n,r,i,a)}else e.lineBuffers.skip(3)},I:function(e,t,n,r,i,a,l){if(V(t,i,a)){"_background"===t.id&&(t.wsc=[0,0,0,0]);var u=l[t.u];if(t.hi&&w){var s=l[Sn(t.u)];s&&!s.missing&&(u=s)}o(t,"co"===t.s?u.co:u.im,e,t.a,n,r,t.hib,i,a)}else e.triangleBuffers.skip()},TR:function(e,t,n,r,i,a){if(t.arrowhead)S(e,t,n,r,i,a);else{t.fi&&c(t,t.x1,t.y1,t.x2,t.y2,t.x3,t.y3,t.wfc,-2,e,t.a,n,r,i,a);t.bw>0&&c(t,t.x1,t.y1,t.x2,t.y2,t.x3,t.y3,t.wbc,-2,e,t.a,n,r,i,a)}},R:function(e,t,n,r,i,a){t.fi&&u(t,t.x1,t.y1,t.x2,t.y2,t.wfc,e,t.a,n,r,0,0,0,t.hib,i,a);if(t.bw>0){var o=p[t.bs]||0;u(t,t.x1,t.y1,t.x2,t.y2,t.wbc,e,t.a,n,r,t.bw,o,0,t.hib,i,a)}},RR:function(e,t,n,r,i,a){t.fi&&u(t,t.x1,t.y1,t.x2,t.y2,t.wfc,e,t.a,n,r,0,0,t.r,t.hib,i,a);if(t.bw>0){var o=p[t.bs]||0;u(t,t.x1,t.y1,t.x2,t.y2,t.wbc,e,t.a,n,r,t.bw,o,t.r,t.hib,i,a)}},C:function(e,t,n,r,a,o){var l=V(t,a,o);t.fi&&(l?i(t.x,t.y,t.r,t.wfc,t.wsc,0,.5,.5,e,t.a,t.hib,n,r,a,o):e.triangleBuffers.skip());if(t.bw>0)if(l){var u=p[t.bs]||0;i(t.x,t.y,t.r,t.wbc,t.wsc,t.bw,.5,.5,e,t.a,t.hib,n,r,a,o,null,null,u>1)}else e.triangleBuffers.skip()},T:function(r,i,o,l,c,f){var d=V(i,c,f);if(i.isfi)if(d){var g=i.t+(i.ff||"");a(i,b[g],r,i.a,o,l,i.hib,c,f)}else r.triangleBuffers.skip();else{if(i.back)if(d){var h=i.fs*i.pf;u(i,i.x1,i.y1,i.x2,i.y2+h,i.wbc,r,i.a,o,l,0,0,0,i.hib,c,f)}else r.triangleBuffers.skip();var v=t.getGlyphsFromText(i.t,i.ff,I,i.bo,G,n,e.textAtlas);d?s(r.triangleBuffers,i,v,e.textAtlas.fontSize,i.a,o,l,c,f):r.triangleBuffers.skip(v.length)}},PE:function(e,t,n,r,i,a){if(t.fi){c(t,t.x1,t.y1,t.x2,t.y2,t.x5,t.y5,t.fi?t.wfc:t.wbc,-1,e,t.a,n,r,i,a);c(t,t.x5,t.y5,t.x2,t.y2,t.x4,t.y4,t.fi?t.wfc:t.wbc,-1,e,t.a,n,r,i,a);c(t,t.x2,t.y2,t.x3,t.y3,t.x4,t.y4,t.fi?t.wfc:t.wbc,-1,e,t.a,n,r,i,a)}if(t.bw>0){var o=p[t.bs]||0;if(t.x1<t.x2){l(t,t.x1,t.y1,t.x2,t.y2,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x2,t.y2,t.x3,t.y3,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x3,t.y3,t.x4-t.bw/2,t.y4,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x4,t.y4-t.bw/2,t.x5,t.y5+t.bw/2,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x5-t.bw/2,t.y5,t.x1,t.y1,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a)}else{l(t,t.x1,t.y1,t.x2,t.y2,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x2,t.y2,t.x3,t.y3,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x3,t.y3,t.x4+t.bw/2,t.y4,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x4,t.y4-t.bw/2,t.x5,t.y5+t.bw/2,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a);l(t,t.x5+t.bw/2,t.y5,t.x1,t.y1,t.wbc,t.wbc,t.wsc,o,t.bw,e.lineBuffers,t.a,n,r,i,a)}}}};function X(e,t,n,r){for(var i,a=n.rebuildOptions,o=n.alwaysUpdate,l=0;l<t;l++){i=e[l];k[i.p](n,i,i.a.bg,i.a.gh,o,a,r)}}function E(n){if(G.textAtlas){e.textAtlas&&n.clearTextureAtlas(e.textAtlas.atlases);e.textAtlas=$l(C,t);y=C}}function F(t){if(G.fontIcons||!e.fontIconAtlas){t.clearTextureAtlas(e.fontIconAtlas);e.fontIconAtlas=fu(b,x)}}function Y(e,t){G.imageAtlas&&g.updateImageTextures(t,e)}function H(e){L(e.lineBuffers,e);z(e);T(e)}function L(e,t){var n=10;e.elementIndexIndex=0;e.elementMappingIndex=0;e.elementDataIndex=0;e.elementIntegerDataIndex=0;var r=e.numOfLines*n*4;r+=e.numOfArrowheads*n*3;if(!e.elementData||t.rebuildOptions.all){e.elementData=new Float32Array(r);e.elementIntegerData=new Uint8Array(e.elementData.buffer,0,e.elementData.length*Float32Array.BYTES_PER_ELEMENT)}e.elementIndex&&!t.rebuildOptions.all||(e.elementIndex=new Uint32Array(6*e.numOfLines+3*e.numOfArrowheads))}function z(e){var t=6,n=4,r=8,i=4;e.arcBuffers.positionIndex=0;e.arcBuffers.colourIndex=0;e.arcBuffers.shadowIndex=0;e.arcBuffers.coreIndex=0;e.arcBuffers.totalnumOfVertices=3*e.arcBuffers.numOfTriangles;a();o();l();u();function a(){var n=e.arcBuffers.totalnumOfVertices*t;(!e.arcBuffers.positionData||e.rebuildOptions.all&&e.arcBuffers.positionData.length!==n)&&(e.arcBuffers.positionData=new Float32Array(n))}function o(){var t=e.arcBuffers.totalnumOfVertices*r
;(!e.arcBuffers.colourData||e.rebuildOptions.all&&e.arcBuffers.colourData.length!==t)&&(e.arcBuffers.colourData=new Uint8Array(t))}function l(){var t=e.arcBuffers.totalnumOfVertices*n;(!e.arcBuffers.shadowData||e.rebuildOptions.all&&e.arcBuffers.shadowData.length!==t)&&(e.arcBuffers.shadowData=new Uint8Array(t))}function u(){var t=e.arcBuffers.totalnumOfVertices*i;(!e.arcBuffers.coreData||e.rebuildOptions.all&&e.arcBuffers.coreData.length!==t)&&(e.arcBuffers.coreData=new Float32Array(t))}}function T(e){var t=3,n=3,r=4,i=9,a=4;e.triangleBuffers.positionIndex=0;e.triangleBuffers.colourIndex=0;e.triangleBuffers.textureIndex=0;e.triangleBuffers.shadowIndex=0;e.triangleBuffers.totalnumOfVertices=e.triangleBuffers.numOfTriangles*t;o();l();u();s();function o(){var t=e.triangleBuffers.totalnumOfVertices*n;(!e.triangleBuffers.positionData||e.rebuildOptions.all&&e.triangleBuffers.positionData.length!==t)&&(e.triangleBuffers.positionData=new Float32Array(e.triangleBuffers.totalnumOfVertices*n))}function l(){var t=e.triangleBuffers.totalnumOfVertices*a;(!e.triangleBuffers.colourData||e.rebuildOptions.all&&e.triangleBuffers.colourData.length!==t)&&(e.triangleBuffers.colourData=new Uint8Array(e.triangleBuffers.totalnumOfVertices*a))}function u(){var t=e.triangleBuffers.totalnumOfVertices*i;(!e.triangleBuffers.textureData||e.rebuildOptions.all&&e.triangleBuffers.textureData.length!==t)&&(e.triangleBuffers.textureData=new Float32Array(e.triangleBuffers.totalnumOfVertices*i))}function s(){var t=e.triangleBuffers.totalnumOfVertices*r;(!e.triangleBuffers.shadowData||e.rebuildOptions.all&&e.triangleBuffers.shadowData.length!==t)&&(e.triangleBuffers.shadowData=new Uint8Array(e.triangleBuffers.totalnumOfVertices*r))}}function N(t,r,i,a){switch(t.p){case nn.arc:t.donut?a.numOfTriangles+=2:i.numOfTriangles+=2*h;break;case nn.line:r.numOfLines+=1;break;case nn.line3:r.numOfLines+=3;break;case nn.circle:t.bw>0&&(a.numOfTriangles+=2);t.fi&&(a.numOfTriangles+=2);break;case nn.rect:case nn.roundrect:t.fi&&(a.numOfTriangles+=2);t.bw>0&&(a.numOfTriangles+=2);break;case nn.text:var o=t.t,l=e.characterCache.getCombinedCharacters(o),u=l.length;if(t.isfi){var s=o+(t.ff||"");a.numOfTriangles+=2;if(!b[s]){G.fontIcons=!0;b[s]={t:o,ff:t.ff}}}else{if(t.ff){C[t.ff]=!0;if(!y[t.ff]){G.textAtlas=!0;y[t.ff]=!0}}t.back&&(a.numOfTriangles+=2);n&&(u=e.bidi.analyseText(l,o).result.length);a.numOfTriangles+=2*u}break;case nn.pentagon:t.bw>0&&(r.numOfLines+=5);t.fi&&(a.numOfTriangles+=3);break;case nn.triangle:if(t.arrowhead>0)1===t.arrowhead?r.numOfArrowheads++:i.numOfTriangles++;else{t.fi&&a.numOfTriangles++;t.bw>0&&a.numOfTriangles++}break;case"I":a.numOfTriangles+=2}}function U(t,n){var r=e.allLayers[n.id];if(!r){r=D(n);e.allLayers[n.id]=r}return r}function D(e){var t={triangleBuffers:{numOfTriangles:0,itemIndex:{},skip:function(e){var n=e||1;t.triangleBuffers.colourIndex+=48*n;t.triangleBuffers.shadowIndex+=24*n;t.triangleBuffers.textureIndex+=54*n;t.triangleBuffers.positionIndex+=18*n}},lineBuffers:{numOfLines:0,numOfArrowheads:0,itemIndex:{},skip:function(e){var n=e||1;t.lineBuffers.elementDataIndex+=40*n;t.lineBuffers.elementIndexIndex+=6*n;t.lineBuffers.elementMappingIndex+=4*n}},arcBuffers:{numOfTriangles:0,itemIndex:{},skip:function(){t.arcBuffers.colourIndex+=192;t.arcBuffers.positionIndex+=144;t.arcBuffers.shadowIndex+=96;t.arcBuffers.coreIndex+=72}},id:e.id,drawBackgroundColour:e.drawBackgroundColour,useFramebuffer:e.useFramebuffer,drawFramebuffer:e.drawFramebuffer,framebuffer:null,renderbuffer:null,framebufferTexture:null,fbAlpha:e.fbAlpha,useView:e.useView,shadowType:e.shadowType,channels:e.channels,rebuildOptions:{},alwaysUpdate:e.alwaysUpdate,blatOverview:e.blatOverview,numOfPrimitives:e.numOfPrimitives,primitives:e.primitives,overview:e.overview};return t}return g}
var Ou="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV9yYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3N0YXJ0QW5nbGU7CmF0dHJpYnV0ZSBmbG9hdCBhX2VuZEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIHZlYzQgYV9jb2xvdXI7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyMjsKYXR0cmlidXRlIHZlYzMgYV9oaXRUZXN0Q29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9saW5lVHlwZTsKYXR0cmlidXRlIHZlYzMgYV9jb3JlOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV96b29tOwp1bmlmb3JtIHZlYzMgdV9yZXNvbHV0aW9uOwp1bmlmb3JtIG1hdDQgdV90cmFuc2Zvcm07Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgdmVjNCB2X2NvbG91cjI7CnZhcnlpbmcgdmVjNCB2X2NvcmU7CnZhcnlpbmcgdmVjNCB2X2xpbmVEYXRhOwp2YXJ5aW5nIHZlYzMgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIHZlYzQgdl9iYXJ5Y2VudHJpYzsKdmFyeWluZyB2ZWM0IHZfcG9zaXRpb247CnZhcnlpbmcgdmVjMyB2X2Rhc2hpbmc7CgpmbG9hdCBwaSA9IDMuMTQxNTkyNjUzNTk7CmZsb2F0IG1pbldpZHRoID0gMS4wOwppbnQgTElORV9UWVBFX0RBU0ggPSAyOwppbnQgTElORV9UWVBFX0RPVCA9IDM7CmludCBMSU5FX1RZUEVfQVJST1dIRUFEID0gNDsKCmZsb2F0IG51bWJlck9mU2VnbWVudHMgPSA0LjA7CgppbnQgcm91bmRUb0ludChmbG9hdCBhKSB7CiAgcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCi8vIE5leHQgc2VnbWVudCBpbiB0aGUgYXJjCnZlYzIgZ2V0TmV4dFBvc2l0aW9uKHZlYzIgY2VudHJlUG9pbnQsIGZsb2F0IHJhZGl1cywgZmxvYXQgc3RhcnRBbmdsZSwgZmxvYXQgYW5nbGVJbmNyZW1lbnQsIGZsb2F0IGluZGV4KSB7CiAgcmV0dXJuIHZlYzIoCiAgICBjZW50cmVQb2ludC54ICsgKHJhZGl1cyAqIGNvcyhzdGFydEFuZ2xlICsgYW5nbGVJbmNyZW1lbnQgKiBpbmRleCkpLAogICAgY2VudHJlUG9pbnQueSArIChyYWRpdXMgKiBzaW4oc3RhcnRBbmdsZSArIGFuZ2xlSW5jcmVtZW50ICogaW5kZXgpKQogICk7Cn0KCmZsb2F0IGdldE51bWJlck9mRGFzaGVzKGZsb2F0IGRhc2hMZW5ndGgsIGZsb2F0IGxlbmd0aE9mQXJjKSB7CiAgZmxvYXQgZ2FwV2lkdGggPSBkYXNoTGVuZ3RoIC8gMi4wOwogIGZsb2F0IG51bU9mRGFzaGVzID0gZmxvb3IoKChsZW5ndGhPZkFyYyArIGdhcFdpZHRoKSAvIChkYXNoTGVuZ3RoICsgZ2FwV2lkdGgpKSArIDAuNSk7CiAgaWYgKChudW1PZkRhc2hlcyAqIGRhc2hMZW5ndGgpID4gbGVuZ3RoT2ZBcmMpIHsKICAgIG51bU9mRGFzaGVzID0gMS4wOwogIH0KICByZXR1cm4gbnVtT2ZEYXNoZXM7Cn0KCnZvaWQgbWFpbigpIHsKICBmbG9hdCBhYVdpZHRoQnVmZmVyID0gMS4wIC8gdV96b29tOwogIGludCBsaW5lVHlwZSA9IHJvdW5kVG9JbnQoYV9saW5lVHlwZSk7CiAgYm9vbCBpc0Rhc2hlZExpbmUgPSBsaW5lVHlwZSA9PSBMSU5FX1RZUEVfREFTSDsKICBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IExJTkVfVFlQRV9ET1Q7CiAgYm9vbCBpc0Fycm93aGVhZCA9IGxpbmVUeXBlID49IExJTkVfVFlQRV9BUlJPV0hFQUQ7CiAgdmVjMiBwb3NpdGlvbjsKICAvLyBob3cgbXVjaCBzbW9vdGhpbmcgdG8gYXBwbHkgdG8gdGhlIGVkZ2Ugb2YgdGhlIGFycm93aGVhZAogIGZsb2F0IGFudGlBbGlhc2luZ1RocmVzaG9sZDsKICBpZiAoaXNBcnJvd2hlYWQpIHsKICAgIGludCB2ZXJ0ZXhJbmRleCA9IHJvdW5kVG9JbnQoYV9saW5lVHlwZSkgLSBMSU5FX1RZUEVfQVJST1dIRUFEOwogICAgdmVjMiBwb3NpdGlvbjEgPSBhX3Bvc2l0aW9uOwogICAgdmVjMiBwb3NpdGlvbjIgPSB2ZWMyKGFfcmFkaXVzLCBhX3N0YXJ0QW5nbGUpOwogICAgdmVjMiBwb3NpdGlvbjMgPSB2ZWMyKGFfZW5kQW5nbGUsIGFfd2lkdGgpOwoKICAgIGZsb2F0IGRpc3RhbmNlSW5Xb3JsZFBpeGVscyA9IGRpc3RhbmNlKHBvc2l0aW9uMiwgcG9zaXRpb24zKTsKICAgIGZsb2F0IGRpc3RhbmNlSW5TY3JlZW5QaXhlbHMgPSBkaXN0YW5jZUluV29ybGRQaXhlbHMgLyB1X3pvb207CiAgICBhbnRpQWxpYXNpbmdUaHJlc2hvbGQgPSAxLjAgLyBkaXN0YW5jZUluU2NyZWVuUGl4ZWxzOwogICAgdmVjMiBvcHBvc2l0ZU1pZFBvaW50OwogICAgaWYodmVydGV4SW5kZXggPT0gMCkgewogICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uMTsKICAgICAgb3Bwb3NpdGVNaWRQb2ludCA9IChwb3NpdGlvbjIgKyBwb3NpdGlvbjMpIC8gMi4wOwogICAgfSBlbHNlIGlmICh2ZXJ0ZXhJbmRleCA9PSAxKSB7CiAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24yOwogICAgICBvcHBvc2l0ZU1pZFBvaW50ID0gKHBvc2l0aW9uMSArIHBvc2l0aW9uMykgLyAyLjA7CiAgICB9IGVsc2UgaWYgKHZlcnRleEluZGV4ID09IDIpIHsKICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbjM7CiAgICAgIG9wcG9zaXRlTWlkUG9pbnQgPSAocG9zaXRpb24yICsgcG9zaXRpb24xKSAvIDIuMDsKICAgIH0KICAgIHZlYzIgdW5pdFZlY3RvckZvckV4dHJ1c2lvbiA9IG5vcm1hbGl6ZShwb3NpdGlvbiAtIG9wcG9zaXRlTWlkUG9pbnQpOwogICAgLy8gcHVzaCB2ZXJ0ZXggYXdheSBmcm9tIGNlbnRyZSB0byBtYWtlIGl0IGJpZ2dlciBzbyB0aGF0IGFudGlhbGlzaW5nIGhhcyByb29tIHRvIHNtb290aCB0aGUgamFnZ2llcwogICAgcG9zaXRpb24gKz0gdW5pdFZlY3RvckZvckV4dHJ1c2lvbiAvIHVfem9vbTsKICAgIC8vIFRoZXNlIGNvb3JkaW5hdGVzIGFsbG93IHVzIHRvIGluZmVyIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBlZGdlIG9mIGEgdHJpYW5nbGUKICAgIHZfYmFyeWNlbnRyaWMgPSB2ZWM0KGFfY29yZS54eXosIGFudGlBbGlhc2luZ1RocmVzaG9sZCk7CiAgICB2X2NvcmUgPSB2ZWM0KDEuMCk7CiAgICB2X2xpbmVEYXRhID0gdmVjNCgwLjAsIDAuMCwgMC4wLCBhX2xpbmVUeXBlKTsKICB9IGVsc2UgewogICAgLy8gY2VudHJlIHBvaW50IG9mIHRoZSBhcmMKICAgIHZlYzIgY2VudHJlUG9pbnQgPSBhX3Bvc2l0aW9uOwogICAgZmxvYXQgcmFkaXVzID0gYV9yYWRpdXM7CiAgICBmbG9hdCBzYSA9IGFfc3RhcnRBbmdsZTsKICAgIGZsb2F0IGVhID0gYV9lbmRBbmdsZTsKCiAgICBmbG9hdCBmaW5hbFJhZGl1czsKICAgIHZlYzIgZGlzdGFuY2VWZWN0b3I7CiAgICBmbG9hdCBuZXh0SW5kZXg7CiAgICBmbG9hdCBpbmRleE1pZFBvaW50SW5jcmVtZW50OwoKICAgIGlmKHVfaGl0VGVzdCA9PSAxLjApIHsKICAgICAgLy8gYWRkIDcgc2NyZWVuIHBpeGVscyB0byB0aGUgbGluZSB0aGlja25lc3MKICAgICAgYWFXaWR0aEJ1ZmZlciA9IDcuMCAvIHVfem9vbTsKICAgIH0KCiAgICAvLyBEaXJlY3Rpb24gb2YgdGhlIG5vcm1hbCB2ZWN0b3IsIHRoaXMgdGVsbHMgdXMgd2hldGhlciB3ZSBhcmUgb24gdGhlIG91dGVyIG9yIGlubmVyIGVkZ2Ugb2YKICAgIC8vIHRoZSBhcmMuCiAgICBib29sIG5vcm1hbFBvaW50c1Vwd2FyZCA9IHJvdW5kVG9JbnQoc2lnbihhX2NvcmUucikpID09IDE7CgogICAgLy8gVGhlIGluZGV4IG9mIHRoZSBjdXJyZW50IHNlZ2VtZW50IG9mIHRoZSBhcmMKICAgIGZsb2F0IGluZGV4ID0gYWJzKGFfY29yZS5yKSAtIDEuMDsKICAgIC8vIEhvdyBtdWNoIGVhY2ggc2VnbWVudCBuZWVkcyB0byBjdXJ2ZQogICAgZmxvYXQgYW5nbGVJbmNyZW1lbnQgPSAoYV9lbmRBbmdsZSAtICBhX3N0YXJ0QW5nbGUpIC8gbnVtYmVyT2ZTZWdtZW50czsKCiAgICAvLyBEaXZpZGUgbWluV2lkdGggYnkgcGl4ZWwgZGVuc2l0eSBzbyByZXRpbmEgc2NyZWVuIHJldGFpbiBjb3JyZWN0IHdpZHRoCiAgICBtaW5XaWR0aCAvPSB1X3Jlc29sdXRpb24uejsKICAgIC8vIGluY3JlYXNlIG1pbi13aWR0aCBmb3IgZG90dGVkIGxpbmUgIzI0MjYKICAgIGlmKGlzRG90dGVkTGluZSkgewogICAgICBtaW5XaWR0aCA9IG1heChtaW5XaWR0aCwgc3RlcCgyLjUsIGFfbGluZVR5cGUpICogMi4wKTsKICAgIH0KICAgIC8vIHRoZSB3aWR0aCBvZiB0aGUgbGluZSB0aGF0IHNob3VsZCBiZSB2aXNpYmxlCiAgICBmbG9hdCBsaW5lV2lkdGggPSBtYXgoYV93aWR0aCAqIHVfem9vbSwgbWluV2lkdGgpIC8gdV96b29tOwogICAgLy8gdGhlIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIHNoYXBlIHRoYXQgY29udGFpbnMgdGhlIGxpbmUKICAgIC8vIGV4cGFuZCB0aGUgd2lkdGggb2YgdGhlIGxpbmUgc2xpZ2h0bHkgc28gdGhlcmVzIHJvb20gdG8gc21vb3RoIHRoZSBlZGdlcyAoYW50aS1hbGlhc2luZykKICAgIGZsb2F0IHNoYXBlV2lkdGggPSBsaW5lV2lkdGggKyBhYVdpZHRoQnVmZmVyOwogICAgZmxvYXQgaGFsZlNoYXBlTGluZVdpZHRoID0gc2hhcGVXaWR0aC8yLjA7CiAgICBmbG9hdCBoYWxmTGluZVdpZHRoID0gbGluZVdpZHRoLzIuMDsKICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIG5leHQgc2VnbWVudCBzbyB0aGF0IHdlIGNhbiBmaXQgdGhlIHRyaWFuZ2xlcyBhcm91bmQgdGhlIGFyYy4KICAgIC8vIElmIHdlIGFyZSBhdCB0aGUgZW5kIG9mIHRoZSBhcmMgdGhlbiB3ZSBuZWVkIHRvIGxvb2sgYXQgdGhlIHByZXZpb3VzIHNlZ21lbnQKICAgIGlmIChpbmRleCA8IG51bWJlck9mU2VnbWVudHMpIHsKICAgICAgaW5kZXhNaWRQb2ludEluY3JlbWVudCA9IDEuMDsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4TWlkUG9pbnRJbmNyZW1lbnQgPSAtMS4wOwogICAgfQogICAgZmxvYXQgbGluZUxlbmd0aCA9IGFfcmFkaXVzICogKGVhIC0gc2EpOwogICAgLy8gZ2V0IHBvc2l0aW9uIG9mIG1pZGRsZSBwb2ludCBvbiB0aGUgb3V0ZXIgYXJjCiAgICB2ZWMyIG1pZE91dGVyUG9pbnQgPSBnZXROZXh0UG9zaXRpb24oY2VudHJlUG9pbnQsIG1heChyYWRpdXMgKyBoYWxmTGluZVdpZHRoLCAwLjApLCBhX3N0YXJ0QW5nbGUsCiAgICAgIGFuZ2xlSW5jcmVtZW50LCBpbmRleCArIChpbmRleE1pZFBvaW50SW5jcmVtZW50IC8gMi4wKSk7CiAgICBmbG9hdCBoYWxmQW5nbGUgPSBhbmdsZUluY3JlbWVudCAvIDIuMDsKICAgIGZsb2F0IG1pZE91dGVyUG9pbnRMZW5ndGggPSBsZW5ndGgobWlkT3V0ZXJQb2ludC0gY2VudHJlUG9pbnQpOwogICAgZmxvYXQgZGlzdGFuY2VTZWdtZW50T3V0ZXJFZGdlRnJvbUNlbnRyZSA9IG1pZE91dGVyUG9pbnRMZW5ndGggLyBjb3MoaGFsZkFuZ2xlKTsKCiAgICBpZihub3JtYWxQb2ludHNVcHdhcmQpIHsKICAgICAgZmluYWxSYWRpdXMgPSBkaXN0YW5jZVNlZ21lbnRPdXRlckVkZ2VGcm9tQ2VudHJlICsgYWFXaWR0aEJ1ZmZlcjsKICAgIH0gZWxzZSB7CiAgICAgIC8vIEFkZCBleHRyYSBwYWRkaW5nIHRvIHRoZSBpbnNpZGUgb2YgdGhlIGFyYyB3aGVuIHRoZSByYWRpdXMgaXMgbGFyZ2UgdG8gY29tcGVuc2F0ZSBmb3IKICAgICAgLy8gZmxvYXQgcHJlY2lzaW9uIGVycm9ycyAjNjc5NwogICAgICAvLyBJZiByYWRpdXMgPiAxMDAwMDAgdGhlIGdlbmVyYXRvciB1c2VzIGEgc3RyYWlnaHQgbGluZSBhcHByb3hpbWF0aW9uCiAgICAgIGZsb2F0IGJvcmRlclBhZGRpbmdGYWN0b3IgPSBzbW9vdGhzdGVwKDIwMDAwLjAsIDEwMDAwMC4wLCByYWRpdXMpICogMjAuMDsKICAgICAgZmluYWxSYWRpdXMgPSByYWRpdXMgLSBoYWxmU2hhcGVMaW5lV2lkdGggLSBib3JkZXJQYWRkaW5nRmFjdG9yOwogICAgfQogICAgLy8gcGFzcyBsaW5lIHR5cGUgYXMgYSBuZWdhdGl2ZSBzbyB0aGUgZnJhZ21lbnQgc2hhZGVyIGtub3dzIGl0cyBhbiBhcmMKICAgIHZfbGluZURhdGEgPSB2ZWM0KDAuMCwgbGluZVdpZHRoLCBsaW5lTGVuZ3RoLCAtYV9saW5lVHlwZSk7CiAgICBmaW5hbFJhZGl1cyA9IG1heChmaW5hbFJhZGl1cywgMC4wKTsKCiAgICBwb3NpdGlvbiA9IGdldE5leHRQb3NpdGlvbihjZW50cmVQb2ludCwgZmluYWxSYWRpdXMsIHNhLCBhbmdsZUluY3JlbWVudCwgaW5kZXgpOwoKCiAgICBmbG9hdCBwaXhlbFNpemUgPSAoMS4wIC8gbGluZUxlbmd0aCkgLyB1X3pvb207CiAgICBmbG9hdCBsaW5lTGVuZ3RoSW5QaXhlbHMgPSBsaW5lTGVuZ3RoICogdV96b29tOwogICAgLy9Eb3R0ZWQgbGluZXMsIHNvIGNhbGMgdXYgbGVuZ3RoCiAgICBpZiAoaXNEb3R0ZWRMaW5lKSB7CiAgICAgIC8vIGFzIGxpbmVzIGdldCBzbWFsbGVyIGFuZCBzbWFsbGVyIGxpbWl0IHRoZSBudW1iZXIgb2YgZG90cyBzbyB0aGUgc3RpbGwgbG9vayBuaWNlCiAgICAgIGZsb2F0IG1pbmltdW1Eb3RzID0gbGluZUxlbmd0aEluUGl4ZWxzIC8gNC4wOwogICAgICAvLyBieSBkZWZhdWx0IHNldCB0aGUgbnVtYmVyIG9mIGRvdHMgdG8gdGhlIHByb3BvcnRpb24gb2YgdGhlIGxpbmUgbGVuZ3RoIGFuZCBsaW5lIHdpZHRoCiAgICAgIGZsb2F0IG51bWJlckRvdHNCeUxpbmVXaWR0aCA9IGxpbmVMZW5ndGggLyAobGluZVdpZHRoICogMi4wKTsKICAgICAgLy8gY2hvb3NlIHRoZSBzbWFsbGVzdCBudW1iZXIsIGFzIHRoZSBsaW5lIGdldHMgdG9vIHNtYWxsIHJlZHVjaW5nIHRoZSBudW1iZXIgb2YgZG90cwogICAgICAvLyBieSB0aGUgem9vbSBsZXZlbCBoZWxwcyBpdCB0byBzdGF5IHJlYWRhYmxlCiAgICAgIGZsb2F0IG51bU9mRG90cyA9IG1pbihtaW5pbXVtRG90cywgbnVtYmVyRG90c0J5TGluZVdpZHRoKTsKICAgICAgLy8gcm91bmQgdXAgdGhlIG51bWJlciBvZiBkb3RzIHNvIHRoYXQgd2UgYWx3YXlzIGRyYXcgYSB3aG9sZSBkb3QKICAgICAgdl9jb3JlID0gdmVjNChzYSwgY2VpbChudW1PZkRvdHMpLCBwaXhlbFNpemUsIGFfcmFkaXVzKTsKICAgICAgdl9kYXNoaW5nID0gdmVjMyhsaW5lV2lkdGgsIGxpbmVXaWR0aCwgMC41KTsKICAgIH0gZWxzZSBpZiAoaXNEYXNoZWRMaW5lKSB7CiAgICAgIC8vIGxlbmd0aCBvZiB0aGUgZGFzaCB3aXRoIGFkanVzdG1lbnRzIGlmIHRoZSBkYXNoIGxlbmd0aCBpcyBsZXNzIHRoYW4gMiBzY3JlZW4gcGl4ZWxzCiAgICAgIGZsb2F0IGRhc2hMZW5ndGggPSBtYXgoMi4wIC8gdV96b29tLCBsaW5lV2lkdGggKiAyLjApOwogICAgICAvLyB0aGUgbnVtYmVyIG9mIGRhc2hlcyB3ZSdyZSBhaW1pbmcgZm9yCiAgICAgIGZsb2F0IGRhc2hlcyA9IGdldE51bWJlck9mRGFzaGVzKGRhc2hMZW5ndGgsIGxpbmVMZW5ndGgpOwogICAgICAvLyBXZSB3YW50IHRvIHN0YXJ0IGFuZCBlbmQgb24gYSBkYXNoIHdpdGhvdXQgYWx0ZXJpbmcgdGhlIGxlbmd0aCBvZiB0aGUgZGFzaCBzbyBpbnN0ZWFkIHdlCiAgICAgIC8vIG5lZWQgdG8gYWx0ZXIgdGhlIGdhcCBsZW5ndGguICBUaGlzIHdpbGwgdGVsbCB1cyBob3cgbG9uZyBhIGdhcCB3ZSB3aWxsIG5lZWQuCiAgICAgIGZsb2F0IGdhcFdpZHRoID0gKGxpbmVMZW5ndGggLSBkYXNoTGVuZ3RoICogZGFzaGVzKSAvIChkYXNoZXMgLSAxLjApOwogICAgICAvLyB0byBlbmQgb24gYSBkYXNoIHdlIG5lZWQgdG8gcmVtb3ZlIGEgZ2FwcyBsZW5ndGggZnJvbSB0aGUgZW5kCiAgICAgIGZsb2F0IGdhcE92ZXJQZXJpb2QgPSBnYXBXaWR0aCAqIGRhc2hlcyAvIChsaW5lTGVuZ3RoICsgZ2FwV2lkdGgpOwogICAgICAvLyBwYXNzIHRoZSBzdGFydCBhbmdsZSBhbmQgdGhlIG51bWJlciBvZiBkYXNoZXMgbWludXMgdGhlIGxlbmd0aCBvZiBhIGdhcAogICAgICB2X2NvcmUgPSB2ZWM0KHNhLCBkYXNoZXMgLSBnYXBPdmVyUGVyaW9kLCBwaXhlbFNpemUsIGFfcmFkaXVzKTsKICAgICAgZmxvYXQgZGFzaEFkanVzdG1lbnQgPSAoZGFzaExlbmd0aCAvIChkYXNoTGVuZ3RoICsgZ2FwV2lkdGgpKSAvIDIuMDsKICAgICAgdl9kYXNoaW5nID0gdmVjMyhkYXNoTGVuZ3RoLCBnYXBXaWR0aCwgZGFzaEFkanVzdG1lbnQpOwogICAgfSBlbHNlIHsKICAgICAgLy8gcG9zaXRpb24gYWxvbmcgdGhlIGFyYwogICAgICB2X2NvcmUgPSB2ZWM0KHNhLCBpbmRleCAvIG51bWJlck9mU2VnbWVudHMsIHBpeGVsU2l6ZSwgYV9yYWRpdXMpOwogICAgfQogICAgLy8gdGhlIHBvc2l0aW9uIGluIHdvcmxkIGNvb3JkcyBvZiB0aGUgdmVydGV4IGFuZCB0aGUgY2VudHJlIHBvaW50IG9mIHRoZSBhcmMKICAgIHZfcG9zaXRpb24gPSB2ZWM0KHBvc2l0aW9uLCBjZW50cmVQb2ludCk7CiAgfQoKICAvKgogICBjb252ZXJ0IHRvIGNsaXBzcGFjZSAoLTEgLT4gMSkKICAqLwogIC8vIGNvbnZlcnQgdGhlIHJlY3RhbmdsZSBmcm9tIHBpeGVscyB0byAwLjAgdG8gMS4wCiAgdmVjMiB6ZXJvVG9PbmUgPSBwb3NpdGlvbiAvIHVfcmVzb2x1dGlvbi54eTsKCiAgLy8gY29udmVydCBmcm9tIDAtPjEgdG8gMC0+MgogIHZlYzIgemVyb1RvVHdvID0gemVyb1RvT25lICogMi4wOwoKICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICB2ZWMyIGNsaXBTcGFjZSA9IHplcm9Ub1R3byAtIDEuMDsKCiAgLyoKICBBc3NpZ24gVmFyeWluZ3MKICAqLwogIHZlYzQgcGl4ZWxDb2xvdXIgPSBhX2NvbG91cjsKICAvLyBub3JtYWxpc2UgY29sb3VyIHZhbHVlcwogIHBpeGVsQ29sb3VyIC89IDI1NS4wOwogIHZfY29sb3VyID0gcGl4ZWxDb2xvdXI7CgogIHZlYzQgcGl4ZWxDb2xvdXIyID0gYV9jb2xvdXIyOwogIC8vIG5vcm1hbGlzZSBjb2xvdXIgdmFsdWVzCiAgcGl4ZWxDb2xvdXIyIC89IDI1NS4wOwogIHZfY29sb3VyMiA9IHBpeGVsQ29sb3VyMjsKCgogIHZfaGl0VGVzdENvbG91ciA9IGFfaGl0VGVzdENvbG91cjsKICAvKgogIEFzc2lnbiBmaW5hbCB2ZXJ0ZXggcG9zaXRpb24gYW5kIGFwcGx5IHRyYW5zZm9ybXMgZm9yIHpvb20vcGFuCiAgKi8KICBnbF9Qb3NpdGlvbiA9IHVfdHJhbnNmb3JtICogdmVjNChjbGlwU3BhY2UgKiB2ZWMyKDEsIC0xKSwgMCwgMSk7Cn0K",_u="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKcHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKdW5pZm9ybSBmbG9hdCB1X2dyYWRpZW50U3RhcnRGcmFjdGlvbjsKCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfY29sb3VyMjsKdmFyeWluZyB2ZWMzIHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyB2ZWM0IHZfY29yZTsKdmFyeWluZyB2ZWM0IHZfbGluZURhdGE7CnZhcnlpbmcgdmVjNCB2X2JhcnljZW50cmljOwp2YXJ5aW5nIHZlYzQgdl9wb3NpdGlvbjsKdmFyeWluZyB2ZWMzIHZfZGFzaGluZzsKCmludCBMSU5FX1RZUEVfREFTSCA9IDI7CmludCBMSU5FX1RZUEVfRE9UID0gMzsKaW50IExJTkVfVFlQRV9BUlJPV0hFQUQgPSA0OwoKZmxvYXQgUEkgPSAzLjE0MTU5MjY1MzU5OwpmbG9hdCBzcXJ0T2ZIYWxmID0gMC43MDcxMDY3ODExODY1NDc1NzsKLy8gUGVyZm9ybWFuY2UgYW50aWFsaWFzaW5nIHVzaW5nIHN0YW5kYXJkIGRlcml2YXRpdmVzCi8vIFNtb290aHMgdGhlIGZyYWdtZW50IG92ZXIgMSBwaXhlbCB3aGVuIHZhbHVlIGlzIG1vcmUgdGhhbiB0aHJlc2hvbGQKLy8gZXNlbnRpYWxseSBhIGJldHRlciB2ZXJzaW9uIG9mIHN0ZXAgYW5kIHNtb290aHN0ZXAKZmxvYXQgYWFzdGVwKGZsb2F0IHRocmVzaG9sZCwgZmxvYXQgdmFsdWUpIHsKICBmbG9hdCBhZndpZHRoID0gbGVuZ3RoKHZlYzIoZEZkeCh2YWx1ZSksIGRGZHkodmFsdWUpKSkgKiBzcXJ0T2ZIYWxmOwogIHJldHVybiBzbW9vdGhzdGVwKHRocmVzaG9sZC1hZndpZHRoLCB0aHJlc2hvbGQrYWZ3aWR0aCwgdmFsdWUpOwp9CgovLyAvIGVuc3VyZSByYW5nZSBjYW4ndCBiZSB6ZXJvCmZsb2F0IG1pbkFsbG93YWJsZVJhbmdlID0gMC4wMDAxOwoKLy8gTGluZWFybHkgaW50ZXJwb2xhdGUgYmV0d2VlbiB0aGUgc3BlY2lmaWVkIHJhbmdlCi8vIFRoaXMgaXMgYSBsaW5lYXIgZXF1aXZhbGVudCBvZiBzbW9vdGhzdGVwICh3aGVyZWFzIHNtb290aHN0ZXAgaXMgZWFzZWQpCmZsb2F0IGxpbmVhcnN0ZXAoZmxvYXQgbWluUmFuZ2UsIGZsb2F0IG1heFJhbmdlLCBmbG9hdCB2YWx1ZSkgewogIGZsb2F0IHN0YXJ0ID0gbWF4KHZhbHVlIC0gbWluUmFuZ2UsIDAuMCk7CiAgZmxvYXQgcmFuZ2UgPSBtYXgobWluQWxsb3dhYmxlUmFuZ2UsIG1heFJhbmdlIC0gbWluUmFuZ2UpOwogIHJldHVybiBtaW4oMS4wLCBzdGFydCAvIHJhbmdlKTsKfQoKLy8gZGlzdGFuY2UgdG8gZWRnZSBmcm9tIGEgdHJpYW5nbGUsIHVzZWQgZm9yIHNtb290aGluZyBlZGdlcyBvZiBhcnJvd2hlYWRzCmZsb2F0IGVkZ2VGYWN0b3IodmVjMyBiYXJ5Y2VudHJpY0Nvb3JkcykgewogIHZlYzMgZCA9IGZ3aWR0aChiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiAgdmVjMyBhMyA9IHNtb290aHN0ZXAodmVjMygwLjApLCBkICogMi4wLCBiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiAgcmV0dXJuIG1pbihtaW4oYTMueCwgYTMueSksIGEzLnopOwp9CgppbnQgcm91bmRUb0ludChmbG9hdCBhKSB7CiAgcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCnZlYzQgZ3JhZGllbnRDb2xvdXIoZmxvYXQgbm9ybWFsaXNlZERpc3RhbmNlRmFjdG9yKSB7CiAgZmxvYXQgZ3JhZGllbnRWYWx1ZSA9IGxpbmVhcnN0ZXAodV9ncmFkaWVudFN0YXJ0RnJhY3Rpb24sIDEuMCAtIHVfZ3JhZGllbnRTdGFydEZyYWN0aW9uLCAgbm9ybWFsaXNlZERpc3RhbmNlRmFjdG9yKTsKICB2ZWMzIGNvbG91ciA9IG1peCh2X2NvbG91ci5yZ2IsIHZfY29sb3VyMi5yZ2IsIGdyYWRpZW50VmFsdWUpOwogIGZsb2F0IGFscGhhID0gbWl4KHZfY29sb3VyLmEsIHZfY29sb3VyMi5hLCBncmFkaWVudFZhbHVlKTsKCiAgLy8gTXVsdGlwbHkgY29sb3VyIGJ5IHRoZSBhbHBoYSwgdGhpcyBpcyBiZWNhdXNlIGluIHRoZSByZWFsIHdvcmxkIHdoZW4gbGlnaHQgcGFzc2VzIHRocm91Z2gKICAvLyBhbiBvYmplY3QgaXQgZ2V0cyB3ZWFrZXIgYXMgbGlnaHQgaXMgYWJzb3JiZWQuICBXZSBuZWVkIHRvIGRvIHRoZSBzYW1lLgogIHJldHVybiB2ZWM0KGNvbG91ciAqIGFscGhhLCBhbHBoYSk7Cn0KCi8vIHNtb290aCB0aGUgZWRnZSBvZiB0aGUgbGluZQp2ZWM0IGFudGlhbGlhc0xpbmVFZGdlKHZlYzQgY29sb3VyKSB7CiAgLy8gUmVhbCBsaW5lIHdpZHRoCiAgZmxvYXQgbGluZVdpZHRoID0gdl9saW5lRGF0YS55OwogIC8vIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIHNoYXBlCiAgZmxvYXQgc2hhcGVXaWR0aCA9IHZfbGluZURhdGEueCAvIDIuMDsKICAvLyB0aGUgd2lkdGggb2YgdGhlIGxpbmUgYXdheSBmcm9tIHRoZSBjZW50cmUgaW4gc2NyZWVucGl4ZWxzCiAgZmxvYXQgdGhyZXNob2xkID0gKGxpbmVXaWR0aCAvIDIuMCkgKiB1X3pvb207CiAgLy8gdGhlIGRpc3RhbmNlIGZyb20gdGhlIGNlbnRyZSBvZiB0aGUgbGluZSBpbiBzY3JlZW5waXhlbHMKICBmbG9hdCBwb3NpdGlvbiA9IGFicyhzaGFwZVdpZHRoKSAqIHVfem9vbTsKICAvLyBzbW9vdGggdGhlIGVkZ2UKICBjb2xvdXIgKj0gMS4wIC0gc21vb3Roc3RlcCh0aHJlc2hvbGQgLSBzcXJ0T2ZIYWxmLCB0aHJlc2hvbGQgKyBzcXJ0T2ZIYWxmLCBwb3NpdGlvbik7CiAgcmV0dXJuIGNvbG91cjsKfQoKLyoqCiAqIEdldCB0aGUgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgaW4gcmFkaWFucwogKi8KZmxvYXQgZGlzdGFuY2VJblJhZGlhbnMoZmxvYXQgcG9zaXRpb24sIGZsb2F0IGZ1bGxMZW5ndGgsIGZsb2F0IGxlbmd0aEluUmFkaWFucykgewogIHJldHVybiAocG9zaXRpb24gLyBmdWxsTGVuZ3RoKSAqIGxlbmd0aEluUmFkaWFuczsKfQoKLyoqCiogZHJhd0xpbmUgLSBGaWxscyBpbiB0aGUgY29sb3VyIGZvciBzdHJhaWdodCBsaW5lcwoqCiovCnZlYzQgZHJhd0xpbmUoYm9vbCBpc0Rhc2hlZE9yRG90dGVkLCBib29sIGlzRGFzaGVkTGluZSwgYm9vbCBpc0RvdHRlZExpbmUpIHsKICAvLyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgY2VudHJlIHRvIHRoZSBvdXRlciB2ZXJ0ZXgKICBmbG9hdCBzaGFwZVdpZHRoID0gdl9saW5lRGF0YS54IC8gMi4wOwogIC8vIHRoZSB2aXNpYmxlIHdpZHRoIG9mIHRoZSBsaW5lCiAgZmxvYXQgbGluZVdpZHRoID0gdl9saW5lRGF0YS55OwogIC8vIHNpemUgb2YgYSBwaXhlbCBpbiBzY3JlZW4gc3BhY2UKICBmbG9hdCBwaXhlbCA9IHZfY29yZS56OwogIC8vIG5vcm1hbGlzZWQgMC0+MQogIGZsb2F0IGRpc3RhbmNlQWxvbmdMaW5lID0gdl9jb3JlLng7CiAgZmxvYXQgbnVtYmVyT2ZEYXNoZXNPckRvdHMgPSB2X2NvcmUueTsKICAvLyBsZW5ndGggb2YgdGhlIGxpbmUgaW4gd29ybGQgcGl4ZWxzCiAgZmxvYXQgbGluZUxlbmd0aCA9IHZfbGluZURhdGEuejsKICBmbG9hdCBoYWxmTGluZVdpZHRoID0gbGluZVdpZHRoIC8gMi4wOwogIGZsb2F0IGRhc2hMZW5ndGggPSB2X2Rhc2hpbmcueDsKICBmbG9hdCBkYXNoQWRqdXN0bWVudCA9IHZfZGFzaGluZy56OwoKICB2ZWM0IHBpeGVsQ29sb3VyID0gZ3JhZGllbnRDb2xvdXIoZGlzdGFuY2VBbG9uZ0xpbmUpOwoKICBpZiAoaXNEYXNoZWRPckRvdHRlZCkgewogICAgZmxvYXQgZGlzdGFuY2VBbG9uZ0RvdHMgPSBkaXN0YW5jZUFsb25nTGluZSAqIG51bWJlck9mRGFzaGVzT3JEb3RzOwogICAgdmVjMiBwb3NpdGlvbkluTGluZUluV29ybGRDb29yZHMgPSB2ZWMyKGRpc3RhbmNlQWxvbmdMaW5lICogbGluZUxlbmd0aCwgc2hhcGVXaWR0aCk7CiAgICBmbG9hdCBkaXN0YW5jZVRvTmV4dFBvaW50ID0gZnJhY3QoZGlzdGFuY2VBbG9uZ0RvdHMpIC0gZGFzaEFkanVzdG1lbnQ7CiAgICAvLyBpZiB3ZSBhcmUgY2xvc2VyIHRvIHRoZSBuZXh0IHBvaW50IHRoYW4gdGhlIHByZXZpb3VzIG9uZSB0aGVuIHJvdW5kIHVwCiAgICBmbG9hdCBuZXh0UG9pbnRJc0luRnJvbnQgPSBmbG9vcihkaXN0YW5jZVRvTmV4dFBvaW50ICsgMC41KTsKICAgIGZsb2F0IG5lYXJlc3REb3QgPSBkaXN0YW5jZUFsb25nRG90cyAtIGRpc3RhbmNlVG9OZXh0UG9pbnQgKyBuZXh0UG9pbnRJc0luRnJvbnQ7CiAgICB2ZWMyIG5lYXJlc3RQb2ludCA9IHZlYzIoKG5lYXJlc3REb3QgLyBudW1iZXJPZkRhc2hlc09yRG90cykgKiBsaW5lTGVuZ3RoLCAwLjApOwoKICAgIGZsb2F0IHdpZHRoT2ZEYXNoT3JEb3QgPSBoYWxmTGluZVdpZHRoOwogICAgaWYgKGlzRGFzaGVkTGluZSkgewogICAgICAvLyBvbmx5IGNvbXBhcmUgZnJvbSB0aGUgY2VudHJlIHBvaW50LCB0aGlzIHdpbGwgZW5zdXJlIGl0IGNyZWF0ZXMgcmVjdGFuZ3VsYXIgZGFzaGVzCiAgICAgIHBvc2l0aW9uSW5MaW5lSW5Xb3JsZENvb3Jkcy55ID0gMC4wOwogICAgICB3aWR0aE9mRGFzaE9yRG90ID0gZGFzaExlbmd0aCAvIDIuMDsKICAgICAgcGl4ZWxDb2xvdXIgPSBhbnRpYWxpYXNMaW5lRWRnZShwaXhlbENvbG91cik7CiAgICB9CiAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2UocG9zaXRpb25JbkxpbmVJbldvcmxkQ29vcmRzLCBuZWFyZXN0UG9pbnQpOwogICAgcGl4ZWxDb2xvdXIgKj0gMS4wIC0gYWFzdGVwKHdpZHRoT2ZEYXNoT3JEb3QsIGRpc3QpOwoKICB9IGVsc2UgewogICAgcGl4ZWxDb2xvdXIgPSBhbnRpYWxpYXNMaW5lRWRnZShwaXhlbENvbG91cik7CiAgICAvLyBzbW9vdGggb3V0IHRoZSBsaW5lIGVuZHMKICAgIHBpeGVsQ29sb3VyICo9IGFhc3RlcChwaXhlbCwgdl9jb3JlLngpOwogICAgcGl4ZWxDb2xvdXIgKj0gMS4wIC0gYWFzdGVwKDEuMCAtIHBpeGVsLCB2X2NvcmUueCk7CiAgfQogIHJldHVybiBwaXhlbENvbG91cjsKfQoKLyoqCiogZHJhd0FyYyAtIEZpbGxzIGluIHRoZSBjb2xvdXIgZm9yIGN1cnZlZCBsaW5lcwoqCiovCnZlYzQgZHJhd0FyYyhib29sIGlzRGFzaGVkT3JEb3R0ZWQsIGJvb2wgaXNEYXNoZWRMaW5lLCBib29sIGlzRG90dGVkTGluZSkgewogIGZsb2F0IGxpbmVXaWR0aCA9IHZfbGluZURhdGEueTsKICBmbG9hdCBudW1iZXJPZkRhc2hlc09yRG90cyA9IHZfY29yZS55OwogIGZsb2F0IHBpeGVsID0gdl9jb3JlLno7CiAgZmxvYXQgbGluZUxlbmd0aCA9IHZfbGluZURhdGEuejsKICBmbG9hdCBoYWxmTGluZVdpZHRoID0gbGluZVdpZHRoIC8gMi4wOwogIGZsb2F0IGFyY1JhZGl1cyA9IHZfY29yZS5hOwogIGZsb2F0IGxlbmd0aE9mQXJjSW5SYWRpYW5zID0gbGluZUxlbmd0aCAvIGFyY1JhZGl1czsKICB2ZWMyIHBvc2l0aW9uID0gdl9wb3NpdGlvbi54eTsKICB2ZWMyIGNpcmNsZUNlbnRyZSA9IHZfcG9zaXRpb24uenc7CiAgZmxvYXQgZGlzdEZyb21DZW50cmUgPSBkaXN0YW5jZShwb3NpdGlvbiwgY2lyY2xlQ2VudHJlKTsKICBmbG9hdCBhbmdsZUFyb3VuZFRoZUNpcmNsZSA9IGF0YW4ocG9zaXRpb24ueSAtIGNpcmNsZUNlbnRyZS55LCBwb3NpdGlvbi54IC0gY2lyY2xlQ2VudHJlLngpOwogIC8vIGRlYWwgd2l0aCB0YW5nZW50IGZsaXAgcG9pbnQgd2hlcmUgYXRhbjIgY2hhbmdlcyBmcm9tIC1waSB0byArcGkKICBpZiAoYW5nbGVBcm91bmRUaGVDaXJjbGUgPCB2X2NvcmUueCkgewogICAgYW5nbGVBcm91bmRUaGVDaXJjbGUgKz0gMi4wICogUEk7CiAgfQogIGZsb2F0IG5vcm1hbGlzZWRTYSA9IHZfY29yZS54OwogIGZsb2F0IGRpc3RhbmNlQXJvdW5kQXJjID0gKGFuZ2xlQXJvdW5kVGhlQ2lyY2xlIC0gbm9ybWFsaXNlZFNhKSAvIChsZW5ndGhPZkFyY0luUmFkaWFucyk7CiAgdmVjNCBwaXhlbENvbG91ciA9IGdyYWRpZW50Q29sb3VyKGRpc3RhbmNlQXJvdW5kQXJjKTsKCiAgaWYgKGlzRGFzaGVkT3JEb3R0ZWQpIHsKICAgIGZsb2F0IGRhc2hMZW5ndGggPSB2X2Rhc2hpbmcueDsKICAgIGZsb2F0IGRhc2hBZGp1c3RtZW50ID0gdl9kYXNoaW5nLno7CiAgICBmbG9hdCBudW1iZXJPZkRhc2hlc09yRG90cyA9IHZfY29yZS55OwogICAgZmxvYXQgZGlzdGFuY2VBbG9uZ1BvaW50cyA9IGRpc3RhbmNlQXJvdW5kQXJjICogbnVtYmVyT2ZEYXNoZXNPckRvdHM7CiAgICB2ZWMyIHBvc2l0aW9uSW5MaW5lSW5QaXhlbHMgPSBwb3NpdGlvbjsKICAgIGZsb2F0IGRpc3RhbmNlVG9OZXh0UG9pbnQgPSBmcmFjdChkaXN0YW5jZUFsb25nUG9pbnRzKSAtIGRhc2hBZGp1c3RtZW50OwogICAgLy8gaWYgd2UgYXJlIGNsb3NlciB0byB0aGUgbmV4dCBwb2ludCB0aGFuIHRoZSBwcmV2aW91cyBvbmUgdGhlbiByb3VuZCB1cAogICAgZmxvYXQgbmV4dFBvaW50SXNJbkZyb250ID0gZmxvb3IoZGlzdGFuY2VUb05leHRQb2ludCArIDAuNSk7CiAgICBmbG9hdCBuZWFyZXN0UG9pbnQgPSBkaXN0YW5jZUFsb25nUG9pbnRzIC0gZGlzdGFuY2VUb05leHRQb2ludCArIG5leHRQb2ludElzSW5Gcm9udCA7CiAgICBmbG9hdCBuZWFyZXN0UG9pbnRJblJhZGlhbnMgPSBkaXN0YW5jZUluUmFkaWFucyhuZWFyZXN0UG9pbnQsIG51bWJlck9mRGFzaGVzT3JEb3RzLCBsZW5ndGhPZkFyY0luUmFkaWFucykgKyBub3JtYWxpc2VkU2E7CgogICAgLy8gZG90dGVkIGxpbmVzCiAgICBpZiAoaXNEb3R0ZWRMaW5lKSB7CiAgICAgIHZlYzIgbmVhcmVzdFBvaW50ID0gdmVjMigKICAgICAgICBjaXJjbGVDZW50cmUueCArIChhcmNSYWRpdXMgKiBjb3MobmVhcmVzdFBvaW50SW5SYWRpYW5zKSksCiAgICAgICAgY2lyY2xlQ2VudHJlLnkgKyAoYXJjUmFkaXVzICogc2luKG5lYXJlc3RQb2ludEluUmFkaWFucykpCiAgICAgICk7CiAgICAgIGZsb2F0IGRpc3QgPSBkaXN0YW5jZShwb3NpdGlvbkluTGluZUluUGl4ZWxzLCBuZWFyZXN0UG9pbnQpOwogICAgICBmbG9hdCByYWRpdXMgPSBoYWxmTGluZVdpZHRoOwogICAgICBwaXhlbENvbG91ciAqPSAxLjAgLSBhYXN0ZXAocmFkaXVzLCBkaXN0KTsKICAgIC8vIGRhc2hlcwogICAgfSBlbHNlIHsKICAgICAgZmxvYXQgZGlzdFRvRGFzaCA9IGRpc3RhbmNlKGFuZ2xlQXJvdW5kVGhlQ2lyY2xlLCBuZWFyZXN0UG9pbnRJblJhZGlhbnMpOwogICAgICBmbG9hdCByYWRpdXMgPSBkaXN0YW5jZUluUmFkaWFucyhkYXNoTGVuZ3RoLzIuMCwgbGluZUxlbmd0aCwgbGVuZ3RoT2ZBcmNJblJhZGlhbnMpOwogICAgICBwaXhlbENvbG91ciAqPSAxLjAgLSBhYXN0ZXAocmFkaXVzLCBkaXN0VG9EYXNoKTsKICAgICAgcGl4ZWxDb2xvdXIgKj0gYWFzdGVwKGFyY1JhZGl1cyAsIGRpc3RGcm9tQ2VudHJlICsgaGFsZkxpbmVXaWR0aCk7CiAgICAgIHBpeGVsQ29sb3VyICo9IDEuMCAtIGFhc3RlcChhcmNSYWRpdXMgKyBoYWxmTGluZVdpZHRoLCBkaXN0RnJvbUNlbnRyZSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZsb2F0IGRpc3RhbmNlQWxvbmdBcmMgPSB2X2NvcmUueTsKICAgIHBpeGVsQ29sb3VyICo9IGFhc3RlcChhcmNSYWRpdXMgLCBkaXN0RnJvbUNlbnRyZSArIGhhbGZMaW5lV2lkdGgpOwogICAgcGl4ZWxDb2xvdXIgKj0gMS4wIC0gYWFzdGVwKGFyY1JhZGl1cyArIGhhbGZMaW5lV2lkdGgsIGRpc3RGcm9tQ2VudHJlKTsKICAgIC8vIHNtb290aCBvdXQgdGhlIGxpbmUgZW5kcwogICAgcGl4ZWxDb2xvdXIgKj0gYWFzdGVwKHBpeGVsLCBkaXN0YW5jZUFsb25nQXJjKTsKICAgIHBpeGVsQ29sb3VyICo9IDEuMCAtIGFhc3RlcCgxLjAgLSBwaXhlbCwgZGlzdGFuY2VBbG9uZ0FyYyk7CiAgfQogIHJldHVybiBwaXhlbENvbG91cjsKfQoKLyoqCioKKiBtYWluIC0gc2V0cyB1cCBhbmQgY2hvb3NlcyB0aGUgY29ycmVjdCBzaGFkZXIgY29kZSB0byBydW4gZGVwZW5kaW5nIG9uIHRoZSBwcmltaXRpdmUgdHlwZSBhbmQgc3R5bGUKKgoqLwp2b2lkIG1haW4oKSB7CiAgaW50IHNoYWRvd1R5cGUgPSBpbnQodV9zaGFkb3dUeXBlKTsKICBmbG9hdCBsaW5lVHlwZUYgPSBhYnModl9saW5lRGF0YS53KTsKICBpbnQgbGluZVR5cGUgPSByb3VuZFRvSW50KGxpbmVUeXBlRik7CiAgLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogIGJvb2wgaXNBcmMgPSBzaWduKHZfbGluZURhdGEudykgPCAwLjA7CiAgLy8gRm9yIHNvbWUgcmVhc29uLCBjb21wYXJpbmcgdHdvIGJvb2xlYW5zIGhhcyBhIGh1Z2UgaW1wYWN0IG9uIHBlcmZvcm1hbmNlCiAgYm9vbCBpc0Rhc2hlZE9yRG90dGVkID0gbGluZVR5cGVGID4gMS41OwogIGJvb2wgaXNEYXNoZWRMaW5lID0gbGluZVR5cGUgPT0gTElORV9UWVBFX0RBU0g7CiAgYm9vbCBpc0RvdHRlZExpbmUgPSBsaW5lVHlwZSA9PSBMSU5FX1RZUEVfRE9UOwogIGJvb2wgaXNBcnJvd2hlYWQgPSBsaW5lVHlwZSA+PSBMSU5FX1RZUEVfQVJST1dIRUFEOwogIGJvb2wgZXhjbHVkZUZyb21TaGFkb3cgPSBzaGFkb3dUeXBlID09IC0xOwogIGJvb2wgb25seU9uU2hhZG93ID0gc2hhZG93VHlwZSA9PSAxOwogIGlmICh1X2hpdFRlc3QgPiAwLjUpIHsKICAgIC8vIEV4Y2x1ZGUgZnJvbSBzaGFkb3cKICAgIGlmKGV4Y2x1ZGVGcm9tU2hhZG93KSB7CiAgICAgIGRpc2NhcmQ7CiAgICB9IGVsc2UgewogICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHZfaGl0VGVzdENvbG91ciAvIDI1NS4wLCAxLjApOwogICAgfQogIC8vIHNob3cgb25seSBvbiBzaGFkb3cKICB9IGVsc2UgaWYgKG9ubHlPblNoYWRvdykgewogICAgZGlzY2FyZDsKICB9IGVsc2UgewogICAgdmVjNCBwaXhlbENvbG91cjsKICAgIGlmIChpc0Fycm93aGVhZCkgewogICAgICAvLyBNdWx0aXBseSBjb2xvdXIgYnkgdGhlIGFscGhhLCB0aGlzIGlzIGJlY2F1c2UgaW4gdGhlIHJlYWwgd29ybGQgd2hlbiBsaWdodCBwYXNzZXMgdGhyb3VnaAogICAgICAvLyBhbiBvYmplY3QgaXQgZ2V0cyB3ZWFrZXIgYXMgbGlnaHQgaXMgYWJzb3JiZWQuICBXZSBuZWVkIHRvIGRvIHRoZSBzYW1lLgogICAgICBwaXhlbENvbG91ciA9IHZlYzQodl9jb2xvdXIucmdiICogdl9jb2xvdXIuYSwgdl9jb2xvdXIuYSk7CgogICAgICAvLyBTbW9vdGggdGhlIGVkZ2VzIG9mIHRoZSB0cmlhbmdsZSB1c2luZyB0aGUgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgdG8gbWVhc3VyZSB0aGUgZGlzdGFuY2UKICAgICAgLy8gdG8gZWFjaCBlZGdlCiAgICAgIHBpeGVsQ29sb3VyICo9IGFhc3RlcCh2X2JhcnljZW50cmljLmEsIGVkZ2VGYWN0b3Iodl9iYXJ5Y2VudHJpYy5yZ2IpKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChpc0FyYykgewogICAgICAgIHBpeGVsQ29sb3VyID0gZHJhd0FyYyhpc0Rhc2hlZE9yRG90dGVkLCBpc0Rhc2hlZExpbmUsIGlzRG90dGVkTGluZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGl4ZWxDb2xvdXIgPSBkcmF3TGluZShpc0Rhc2hlZE9yRG90dGVkLCBpc0Rhc2hlZExpbmUsIGlzRG90dGVkTGluZSk7CiAgICAgIH0KICAgIH0KICAgIC8vIGFzc2lnbiB0aGUgZmluYWwgY29sb3VyIHRvIHRoZSBmcmFnbWVudAogICAgZ2xfRnJhZ0NvbG9yID0gcGl4ZWxDb2xvdXI7CiAgICAvLyB1bmNvbW1lbnQgdGhpcyBsaW5lIHRvIGRlYnVnIGxpbmUgc2hhcGUKICAgIC8vZ2xfRnJhZ0NvbG9yID0gdmVjNChwaXhlbENvbG91ci5hLHBpeGVsQ29sb3VyLmEsMC4wLDEuMCk7CiAgfQp9Cg==",Ku="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uMTsKYXR0cmlidXRlIHZlYzIgYV9wb3NpdGlvbjI7CmF0dHJpYnV0ZSB2ZWMyIGFfcG9zaXRpb24zOwphdHRyaWJ1dGUgdmVjNCBhX3ZlcnRleEluZm87CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgdmVjNCBhX2NvbG91cjI7CmF0dHJpYnV0ZSB2ZWMzIGFfaGl0VGVzdENvbG91cjsKYXR0cmlidXRlIGZsb2F0IGFfaW5kZXg7Cgp1bmlmb3JtIGZsb2F0IHVfaGl0VGVzdDsKdW5pZm9ybSB2ZWMzIHVfcmVzb2x1dGlvbjsKdW5pZm9ybSBtYXQ0IHVfdHJhbnNmb3JtOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKdW5pZm9ybSBmbG9hdCB1X3ZpZXdJbmRlcGVuZGVudDsKCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfY29sb3VyMjsKdmFyeWluZyB2ZWM0IHZfY29yZTsKdmFyeWluZyB2ZWMzIHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyB2ZWM0IHZfbGluZURhdGE7CnZhcnlpbmcgdmVjNCB2X2JhcnljZW50cmljOwp2YXJ5aW5nIHZlYzQgdl9wb3NpdGlvbjsKdmFyeWluZyB2ZWMzIHZfZGFzaGluZzsKCmludCBMSU5FX1RZUEVfREFTSCA9IDI7CmludCBMSU5FX1RZUEVfRE9UID0gMzsKaW50IExJTkVfVFlQRV9BUlJPV0hFQUQgPSA0OwoKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogIHJldHVybiBpbnQoZmxvb3IoYSArIDAuNSkpOwp9CgpmbG9hdCBnZXROdW1iZXJPZkRhc2hlcyhmbG9hdCBkYXNoTGVuZ3RoLCBmbG9hdCBsZW5ndGhPZkFyYykgewogIGZsb2F0IGdhcFdpZHRoID0gZGFzaExlbmd0aCAvIDIuMDsKICBmbG9hdCBudW1PZkRhc2hlcyA9IGZsb29yKCgobGVuZ3RoT2ZBcmMgKyBnYXBXaWR0aCkgLyAoZGFzaExlbmd0aCArIGdhcFdpZHRoKSkgKyAwLjUpOwogIGlmICgobnVtT2ZEYXNoZXMgKiBkYXNoTGVuZ3RoKSA+IGxlbmd0aE9mQXJjKSB7CiAgICBudW1PZkRhc2hlcyA9IDEuMDsKICB9CiAgcmV0dXJuIG51bU9mRGFzaGVzOwp9Cgp2b2lkIG1haW4oKSB7CiAgLy8gRGl2aWRlIG1pbldpZHRoIGJ5IHBpeGVsIGRlbnNpdHkgc28gcmV0aW5hIHNjcmVlbiByZXRhaW4gY29ycmVjdCB3aWR0aAogIGZsb2F0IG1pbldpZHRoID0gMS4wIC8gdV9yZXNvbHV0aW9uLno7CiAgdmVjNCBwaXhlbENvbG91cjsKICBpbnQgbGluZVR5cGUgPSByb3VuZFRvSW50KGFfdmVydGV4SW5mby53KTsKICBib29sIGlzRGFzaGVkTGluZSA9IGxpbmVUeXBlID09IExJTkVfVFlQRV9EQVNIOwogIGJvb2wgaXNEb3R0ZWRMaW5lID0gbGluZVR5cGUgPT0gTElORV9UWVBFX0RPVDsKICBib29sIGlzQXJyb3doZWFkID0gbGluZVR5cGUgPT0gTElORV9UWVBFX0FSUk9XSEVBRDsKICB2ZWMyIHBvc2l0aW9uOwogIGZsb2F0IGxlbmd0aEluV29ybGRDb29yZHM7CiAgLy8gaG93IG11Y2ggc21vb3RoaW5nIHRvIGFwcGx5IHRvIHRoZSBlZGdlIG9mIHRoZSBhcnJvd2hlYWQKICBmbG9hdCBhbnRpQWxpYXNpbmdUaHJlc2hvbGQ7CiAgcGl4ZWxDb2xvdXIgPSBhX2NvbG91cjsKICBpZiAoaXNBcnJvd2hlYWQpIHsKICAgIGludCB2ZXJ0ZXhJbmRleCA9IGludChhX2luZGV4KTsKICAgIHZlYzIgcG9zaXRpb24xID0gYV9wb3NpdGlvbjE7CiAgICB2ZWMyIHBvc2l0aW9uMiA9IGFfcG9zaXRpb24yOwogICAgdmVjMiBwb3NpdGlvbjMgPSBhX3Bvc2l0aW9uMzsKICAgIGZsb2F0IGRpc3RhbmNlSW5Xb3JsZFBpeGVscyA9IGRpc3RhbmNlKHBvc2l0aW9uMiwgcG9zaXRpb24zKTsKICAgIGZsb2F0IGRpc3RhbmNlSW5TY3JlZW5QaXhlbHMgPSBkaXN0YW5jZUluV29ybGRQaXhlbHMgLyB1X3pvb207CiAgICBhbnRpQWxpYXNpbmdUaHJlc2hvbGQgPSAxLjAgLyBkaXN0YW5jZUluU2NyZWVuUGl4ZWxzOwogICAgdmVjMiBvcHBvc2l0ZU1pZFBvaW50OwogICAgaWYodmVydGV4SW5kZXggPT0gMCkgewogICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uMTsKICAgICAgb3Bwb3NpdGVNaWRQb2ludCA9IChwb3NpdGlvbjIgKyBwb3NpdGlvbjMpIC8gMi4wOwogICAgfSBlbHNlIGlmICh2ZXJ0ZXhJbmRleCA9PSAxKSB7CiAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24yOwogICAgICBvcHBvc2l0ZU1pZFBvaW50ID0gKHBvc2l0aW9uMSArIHBvc2l0aW9uMykgLyAyLjA7CiAgICB9IGVsc2UgaWYgKHZlcnRleEluZGV4ID09IDIpIHsKICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbjM7CiAgICAgIG9wcG9zaXRlTWlkUG9pbnQgPSAocG9zaXRpb24yICsgcG9zaXRpb24xKSAvIDIuMDsKICAgIH0KICAgIHZlYzIgdW5pdFZlY3RvckZvckV4dHJ1c2lvbiA9IG5vcm1hbGl6ZShwb3NpdGlvbiAtIG9wcG9zaXRlTWlkUG9pbnQpOwogICAgLy8gcHVzaCB2ZXJ0ZXggYXdheSBmcm9tIGNlbnRyZSB0byBtYWtlIGl0IGJpZ2dlciBzbyB0aGF0IGFudGlhbGlzaW5nIGhhcyByb29tIHRvIHNtb290aCB0aGUgamFnZ2llcwogICAgcG9zaXRpb24gKz0gdW5pdFZlY3RvckZvckV4dHJ1c2lvbiAvIHVfem9vbTsKICAgIHZfbGluZURhdGEgPSB2ZWM0KDAuMCwgMC4wLCAwLjAsIGFfdmVydGV4SW5mby53KTsKICB9IGVsc2UgewogICAgLy8gTWFrZSBpdCB3aWRlciB0byBhbGxvdyB0aGUgYW50aSBhbGlhc2luZyB0byBlYXQgaW50byB0aGUgbGluZSBpbiBvcmRlciB0byBtYWtlIGl0IHNtb290aAogICAgZmxvYXQgYWFXaWR0aEJ1ZmZlciA9IDEuMCAvIHVfem9vbTsKCgogICAgaWYodV9oaXRUZXN0ID09IDEuMCkgewogICAgICAvLyBhZGQgNyBzY3JlZW4gcGl4ZWxzIHRvIHRoZSBsaW5lIHRoaWNrbmVzcwogICAgICBhYVdpZHRoQnVmZmVyID0gNy4wIC8gdV96b29tOwogICAgfQogICAgLy8gaW5jcmVhc2UgbWluLXdpZHRoIGZvciBkb3R0ZWQgbGluZSAjMjQyNgogICAgaWYoaXNEb3R0ZWRMaW5lKSB7CiAgICAgIG1pbldpZHRoID0gbWF4KG1pbldpZHRoLCBzdGVwKDIuNSwgYV92ZXJ0ZXhJbmZvLncpICogMi4wKTsKICAgIH0KICAgIAogICAgLy8gYSB2ZWN0b3IgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgbGluZSB3aXRoIGEgbGVuZ3RoIG9mIDEKICAgIHZlYzIgdW5pdFZlY3RvciA9IG5vcm1hbGl6ZShhX3Bvc2l0aW9uMiAtIGFfcG9zaXRpb24xKTsKICAgIC8vIHVuaXQgdmVjdG9yIHdpdGggYSBsZW5ndGggb2YgMSBzY3JlZW4gcGl4ZWwKICAgIHZlYzIgdW5pdFZlY3RvckluVmlldyA9IHVuaXRWZWN0b3IgLyB1X3pvb207CiAgICAvLyBEaXJlY3Rpb24gb2YgdGhlIG5vcm1hbCB2ZWN0b3IKICAgIGZsb2F0IG5vcm1hbFBvaW50c1Vwd2FyZCA9IGFfdmVydGV4SW5mby55IC0gMS4wOwogICAgCiAgICAvLyBUaGUgVVYgY29vcmRzIGZyb20gMCAtPiAxLCB1c2VkIGZvciBkYXNoaW5nCiAgICBmbG9hdCB1diA9IGFfdmVydGV4SW5mby54ICsgYV92ZXJ0ZXhJbmZvLno7CiAgICAKICAgIHZlYzIgZGlzdGFuY2VWZWN0b3IgPSBhX3Bvc2l0aW9uMiAtIGFfcG9zaXRpb24xOwogICAgCiAgICB2ZWMyIG5vcm1hbCA9IG5vcm1hbGl6ZSh2ZWMyKC1kaXN0YW5jZVZlY3Rvci55LCBkaXN0YW5jZVZlY3Rvci54KSk7CiAgICAKICAgIC8vIFdoZXRoZXIgdGhlIHZlcnRleCBpcyBhdCB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBsaW5lLgogICAgaWYoaW50KGFfdmVydGV4SW5mby54KSA9PSAwKSB7CiAgICAgIHBvc2l0aW9uID0gYV9wb3NpdGlvbjEgLSB1bml0VmVjdG9ySW5WaWV3OwogICAgfSBlbHNlIHsKICAgICAgcG9zaXRpb24gPSBhX3Bvc2l0aW9uMiArIHVuaXRWZWN0b3JJblZpZXc7CiAgICB9CiAgICAvLyB0aGUgcmVhbCB2aXNpYmxlIHdpZHRoIG9mIHRoZSBsaW5lCiAgICBmbG9hdCBsaW5lV2lkdGggPSBhX3Bvc2l0aW9uMy54OwogICAgaWYoaW50KHVfdmlld0luZGVwZW5kZW50KSA9PSAwKSB7CiAgICAgIGxpbmVXaWR0aCA9IG1heCgobGluZVdpZHRoKSAqIHVfem9vbSwgbWluV2lkdGgpIC8gdV96b29tOwogICAgfQogICAgLy8gdGhlIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIHNoYXBlIHRoYXQgY29udGFpbnMgdGhlIGxpbmUKICAgIGZsb2F0IHNoYXBlV2lkdGggPSBsaW5lV2lkdGggKyBhYVdpZHRoQnVmZmVyOyAKICAgIC8vIGdldCB2ZWN0b3IgZm9yIGxpbmUKICAgIHZlYzIgbm9ybWFsVmVjID0gbm9ybWFsICogKHNoYXBlV2lkdGgvMi4wKSAqIG5vcm1hbFBvaW50c1Vwd2FyZDsKICAgIHBvc2l0aW9uID0gcG9zaXRpb24gKyBub3JtYWxWZWM7CiAgICAvLyBsZW5ndGggb2YgdGhlIGxpbmUgaW4gd29ybGQgY29vcmRpbmF0ZXMKICAgIGZsb2F0IGxpbmVMZW5ndGggPSBkaXN0YW5jZShhX3Bvc2l0aW9uMSwgYV9wb3NpdGlvbjIpOwogICAgZmxvYXQgbGluZUxlbmd0aEluUGl4ZWxzID0gbGluZUxlbmd0aCAqIHVfem9vbTsKICAgIGZsb2F0IHBpeGVsU2l6ZSA9ICgxLjAgLyBsaW5lTGVuZ3RoKSAvIHVfem9vbTsKICAgIC8vRG90dGVkIGxpbmVzLCBzbyBjYWxjIHV2IGxlbmd0aAogICAgaWYoaXNEb3R0ZWRMaW5lKSB7CiAgICAgIC8vIGFzIGxpbmVzIGdldCBzbWFsbGVyIGFuZCBzbWFsbGVyIGxpbWl0IHRoZSBudW1iZXIgb2YgZG90cyBzbyB0aGUgc3RpbGwgbG9vayBuaWNlCiAgICAgIGZsb2F0IG1pbmltdW1Eb3RzID0gbGluZUxlbmd0aEluUGl4ZWxzIC8gNC4wOwogICAgICAvLyBieSBkZWZhdWx0IHNldCB0aGUgbnVtYmVyIG9mIGRvdHMgdG8gdGhlIHByb3BvcnRpb24gb2YgdGhlIGxpbmUgbGVuZ3RoIGFuZCBsaW5lIHdpZHRoCiAgICAgIGZsb2F0IG51bWJlckRvdHNCeUxpbmVXaWR0aCA9IGxpbmVMZW5ndGggLyAobGluZVdpZHRoICogMi4wKTsKICAgICAgLy8gY2hvb3NlIHRoZSBzbWFsbGVzdCBudW1iZXIsIGFzIHRoZSBsaW5lIGdldHMgdG9vIHNtYWxsIHJlZHVjaW5nIHRoZSBudW1iZXIgb2YgZG90cwogICAgICAvLyBieSB0aGUgem9vbSBsZXZlbCBoZWxwcyBpdCB0byBzdGF5IHJlYWRhYmxlCiAgICAgIGZsb2F0IG51bU9mRG90cyA9IG1pbihtaW5pbXVtRG90cywgbnVtYmVyRG90c0J5TGluZVdpZHRoKTsKICAgICAgLy8gcm91bmQgdXAgdGhlIG51bWJlciBvZiBkb3RzIHNvIHRoYXQgd2UgYWx3YXlzIGRyYXcgYSB3aG9sZSBkb3QKICAgICAgdl9jb3JlID0gdmVjNCh1diwgY2VpbChudW1PZkRvdHMpLCBwaXhlbFNpemUsIDAuMCk7CiAgICAgIHZfZGFzaGluZyA9IHZlYzMobGluZVdpZHRoLCBsaW5lV2lkdGgsIDAuNSk7CiAgICB9IGVsc2UgaWYoaXNEYXNoZWRMaW5lKSB7CiAgICAgIC8vIGxlbmd0aCBvZiB0aGUgZGFzaCB3aXRoIGFkanVzdG1lbnRzIGlmIHRoZSBkYXNoIGxlbmd0aCBpcyBsZXNzIHRoYW4gMiBzY3JlZW4gcGl4ZWxzCiAgICAgIGZsb2F0IGRhc2hMZW5ndGggPSBtYXgoMi4wIC8gdV96b29tLCBsaW5lV2lkdGggKiAyLjApOwogICAgICAvLyB0aGUgbnVtYmVyIG9mIGRhc2hlcyB3ZSdyZSBhaW1pbmcgZm9yCiAgICAgIGZsb2F0IGRhc2hlcyA9IGdldE51bWJlck9mRGFzaGVzKGRhc2hMZW5ndGgsIGxpbmVMZW5ndGgpOwogICAgICAvLyBXZSB3YW50IHRvIHN0YXJ0IGFuZCBlbmQgb24gYSBkYXNoIHdpdGhvdXQgYWx0ZXJpbmcgdGhlIGxlbmd0aCBvZiB0aGUgZGFzaCBzbyBpbnN0ZWFkIHdlCiAgICAgIC8vIG5lZWQgdG8gYWx0ZXIgdGhlIGdhcCBsZW5ndGguICBUaGlzIHdpbGwgdGVsbCB1cyBob3cgbG9uZyBhIGdhcCB3ZSB3aWxsIG5lZWQuCiAgICAgIGZsb2F0IGdhcFdpZHRoID0gKGxpbmVMZW5ndGggLSBkYXNoTGVuZ3RoICogZGFzaGVzKSAvIChkYXNoZXMgLSAxLjApOwogICAgICAvLyB0byBlbmQgb24gYSBkYXNoIHdlIG5lZWQgdG8gcmVtb3ZlIGEgZ2FwcyBsZW5ndGggZnJvbSB0aGUgZW5kCiAgICAgIGZsb2F0IGdhcE92ZXJQZXJpb2QgPSBnYXBXaWR0aCAqIGRhc2hlcyAvIChsaW5lTGVuZ3RoICsgZ2FwV2lkdGgpOwogICAgICAvLyBwYXNzIHRoZSBzdGFydCBhbmdsZSBhbmQgdGhlIG51bWJlciBvZiBkYXNoZXMgbWludXMgdGhlIGxlbmd0aCBvZiBhIGdhcAogICAgICB2X2NvcmUgPSB2ZWM0KHV2LCBkYXNoZXMgLSBnYXBPdmVyUGVyaW9kLCBwaXhlbFNpemUsIDAuMCk7CiAgICAgIGZsb2F0IGRhc2hBZGp1c3RtZW50ID0gKGRhc2hMZW5ndGggLyAoZGFzaExlbmd0aCArIGdhcFdpZHRoKSkgLyAyLjA7CiAgICAgIHZfZGFzaGluZyA9IHZlYzMoZGFzaExlbmd0aCwgZ2FwV2lkdGgsIGRhc2hBZGp1c3RtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGFsbG93cyB1cyB0byBkZXRlcm1pbmUgb3VyIHBvc2l0aW9uIG9uIHRoZSBsaW5lIGluIHRoZSBmcmFnbWVudCBzaGFkZXIKICAgICAgdl9jb3JlID0gdmVjNCh1diwgMC4wLCBwaXhlbFNpemUsIDAuMCk7CiAgICB9CiAgICAKICAgIC8vIHNldCB0aGUgd2lkdGggb24gdGhlIHZlcnRleCBzbyB0aGF0IHdlIGNhbiBtZWFzdXJlIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBlZGdlIGluIHRoZSBmcmFnbWVudAogICAgLy8gc2hhZGVyCiAgICBpZihpbnQobm9ybWFsUG9pbnRzVXB3YXJkKSA9PSAxKSB7CiAgICAgIC8vIHBhc3MgdGhlIGFjdHVhbCB3aWR0aCBvZiB0aGUgZ2VvbWV0cnkgKHNoYXBlV2lkdGgpIGFuZCB0aGUgd2lkdGggd2UnbGwgdXNlIGFzIHRoZSBhY3R1YWwKICAgICAgLy8gdmlzaWJsZSBsaW5lICh2X3dpZHRoKQogICAgICB2X2xpbmVEYXRhID0gdmVjNCgtc2hhcGVXaWR0aCwgbGluZVdpZHRoLCBsaW5lTGVuZ3RoLCBhX3ZlcnRleEluZm8udyk7CiAgICB9IGVsc2UgewogICAgICB2X2xpbmVEYXRhID0gdmVjNChzaGFwZVdpZHRoLCBsaW5lV2lkdGgsIGxpbmVMZW5ndGgsIGFfdmVydGV4SW5mby53KTsKICAgIH0KICB9CiAgLyoKICAgY29udmVydCB0byBjbGlwc3BhY2UgCiAgKi8KICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogIHZlYzIgemVyb1RvT25lID0gcG9zaXRpb24gLyB1X3Jlc29sdXRpb24ueHk7CiAgCiAgLy8gY29udmVydCBmcm9tIDAtPjEgdG8gMC0+MgogIHZlYzIgemVyb1RvVHdvID0gemVyb1RvT25lICogMi4wOwogIAogIC8vIGNvbnZlcnQgZnJvbSAwLT4yIHRvIC0xLT4rMSAoY2xpcHNwYWNlKQogIHZlYzIgY2xpcFNwYWNlID0gemVyb1RvVHdvIC0gMS4wOwogIAogIC8qCiAgIEFzc2lnbiBWYXJ5aW5ncwogICovIAogIC8vIG5vcm1hbGlzZSBjb2xvdXIgdmFsdWVzCiAgcGl4ZWxDb2xvdXIgLz0gMjU1LjA7CiAgdl9jb2xvdXIgPSBwaXhlbENvbG91cjsKICAKICAvLyBub3JtYWxpc2UgY29sb3VyIHZhbHVlcwogIHZfY29sb3VyMiA9IGFfY29sb3VyMiAvIDI1NS4wOwoKICAvLyBjb2xvdXIgdG8gdXNlIGZvciBoaXQgdGVzdGluZyAoc2hhZG93IGNhbnZhcyBjb2xvdXIpCiAgdl9oaXRUZXN0Q29sb3VyID0gYV9oaXRUZXN0Q29sb3VyOwoKICAKICB2X2JhcnljZW50cmljID0gdmVjNChhX3ZlcnRleEluZm8ueHl6LCBhbnRpQWxpYXNpbmdUaHJlc2hvbGQpOwogIAogIC8qCiAgIEFzc2lnbiBmaW5hbCB2ZXJ0ZXggcG9zaXRpb24gYW5kIGFwcGx5IHRyYW5zZm9ybXMgZm9yIHpvb20vcGFuCiAgKi8KICBnbF9Qb3NpdGlvbiA9IHVfdHJhbnNmb3JtICogdmVjNChjbGlwU3BhY2UgKiB2ZWMyKDEsIC0xKSwgMCwgMSk7Cn0=",Pu="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2VbOF07CnVuaWZvcm0gbG93cCBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMyB1X3Jlc29sdXRpb247CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCi8vIHRoZSB0ZXhDb29yZHMgcGFzc2VkIGluIGZyb20gdGhlIHZlcnRleCBzaGFkZXIuCnZhcnlpbmcgdmVjNCB2X3RleENvb3JkOwovLyBjb2xvdXIgb2YgZmxhdCBzaGFkZWQgdHJpYW5nbGVzCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKLy8gc2hhZG93Y2FudmFzIGNvbG91ciBtYXBwaW5nCnZhcnlpbmcgdmVjNCB2X2hpdFRlc3RDb2xvdXI7Ci8vIHdoaWNoIHRleHR1cmUgdG8gdXNlCnZhcnlpbmcgdmVjMiB2X3RleHR1cmVCYW5rOwovLyBjaXJjbGUgYm9yZGVyIHdpZHRoCnZhcnlpbmcgZmxvYXQgdl9ib3JkZXJXaWR0aDsKLy8gd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgc2hhcGUsIHdpZHRoIGlzIG5lZ2F0aXZlIGZvciBhIHJlY3RhbmdsZSBhbmQgcG9zaXRpdmUgZm9yIGNpcmNsZXMKdmFyeWluZyB2ZWMyIHZfc2hhcGVTaXplOwovLyB0aGUgc2l6ZSBvZiBhIHBpeGVsIGluIHNjcmVlbnNwYWNlIGNsaXAgY29vcmRpbmF0ZXMKdmFyeWluZyBmbG9hdCB2X3BpeGVsOwp2YXJ5aW5nIHZlYzIgdl9kb251dFNlZ21lbnQ7Cgpjb25zdCBmbG9hdCBQSSA9IDMuMTQxNTkyNjUzNTg5NzkzMjM4NDYyNjQzMzgzMjc5NTsKLy8gUGVyZm9ybWFuY2UgYW50aWFsaWFzaW5nIHVzaW5nIHN0YW5kYXJkIGRlcml2YXRpdmVzCi8vIFNtb290aHMgdGhlIGZyYWdtZW50IG92ZXIgMSBwaXhlbCB3aGVuIHZhbHVlIGlzIG1vcmUgdGhhbiB0aHJlc2hvbGQKLy8gZXNlbnRpYWxseSBhIGJldHRlciB2ZXJzaW9uIG9mIHN0ZXAgYW5kIHNtb290aHN0ZXAKZmxvYXQgYWFzdGVwKGZsb2F0IHRocmVzaG9sZCwgZmxvYXQgdmFsdWUpIHsKICBmbG9hdCBhZndpZHRoID0gbGVuZ3RoKHZlYzIoZEZkeCh2YWx1ZSksIGRGZHkodmFsdWUpKSkgKiAwLjcwNzEwNjc4MTE4NjU0NzU3OwogIHJldHVybiBzbW9vdGhzdGVwKHRocmVzaG9sZC1hZndpZHRoLCB0aHJlc2hvbGQrYWZ3aWR0aCwgdmFsdWUpOwp9CgovLyBlbnN1cmVzIHRoYXQgbnVtYmVycyBhcmUgZXhhY3RseSBpbnRlZ2VycyAKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCmZsb2F0IGdldEJvcmRlcldpZHRoWm9vbShmbG9hdCBib3JkZXJXaWR0aCkgewogIC8vIHJldHVybnMgMCB3aGVuIGJvcmRlciBpcyBsYXJnZXIgdGhhbiBvbmUgc2NyZWVuIHBpeGVsCiAgZmxvYXQgaXNCb3JkZXJMZXNzVGhhbjFQaXhlbCA9IDEuMCAtIHN0ZXAoMS4wLCBib3JkZXJXaWR0aCAqIHVfem9vbSk7CiAgZmxvYXQgdW5pdHNQZXJTY3JlZW5QaXhlbCA9ICgxLjAgLyB1X3pvb20pOwogIC8vIElmIHRoZSBib3JkZXIgd2lkdGggaW4gc2NyZWVuIHBpeGVscyBpcyBsZXNzIHRoYW4gb25lLCBzZXQgaXQgdG8gMSBzY3JlZW4gcGl4ZWwKICByZXR1cm4gbWF4KGJvcmRlcldpZHRoLCBpc0JvcmRlckxlc3NUaGFuMVBpeGVsICogdW5pdHNQZXJTY3JlZW5QaXhlbCk7Cn0KCmZsb2F0IHJlY3RhbmdsZUJvcmRlcihmbG9hdCBib3JkZXJXaWR0aCkgewogIGZsb2F0IHRvcExlZnQgPSBhYXN0ZXAodl90ZXhDb29yZC54LCBib3JkZXJXaWR0aCk7CiAgZmxvYXQgdG9wUmlnaHQgPSBhYXN0ZXAodl90ZXhDb29yZC55LCBib3JkZXJXaWR0aCk7CiAgZmxvYXQgYm90dG9tTGVmdCA9IGFhc3RlcCh2X3RleENvb3JkLnogLSB2X3RleENvb3JkLngsIGJvcmRlcldpZHRoKTsKICBmbG9hdCBib3R0b21SaWdodCA9IGFhc3RlcCh2X3RleENvb3JkLncgLSB2X3RleENvb3JkLnksIGJvcmRlcldpZHRoKTsKICBmbG9hdCB0b3AgPSBtYXgodG9wTGVmdCwgdG9wUmlnaHQpOyAKICBmbG9hdCBib3R0b20gPSBtYXgoYm90dG9tTGVmdCwgYm90dG9tUmlnaHQpOyAKICByZXR1cm4gbWF4KHRvcCwgYm90dG9tKTsKfQoKLy8gZGlzdGFuY2UgdG8gZWRnZSBmcm9tIGEgdHJpYW5nbGUsIHVzZWQgZm9yIHNtb290aGluZyBlZGdlcyBvZiBhcnJvd3MKZmxvYXQgZWRnZUZhY3Rvcih2ZWMzIGJhcnljZW50cmljQ29vcmRzKSB7CiAgdmVjMyBkID0gZndpZHRoKGJhcnljZW50cmljQ29vcmRzKTsKICB2ZWMzIGEzID0gc21vb3Roc3RlcCh2ZWMzKDAuMCksIGQqMy4wLCBiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiByZXR1cm4gbWluKG1pbihhMy54LCBhMy55KSwgYTMueik7Cn0KCi8vIFJlYWQgdGhlIHRleHR1cmUgdmFsdWUgb2YgYSBnbHlwaCBmcm9tIHRoZSBzcGVjaWZpZWQgY29sb3VyIGNoYW5uZWwKZmxvYXQgcmVhZENvbG91ckNvbXBvbmVudEZyb21UZXh0dXJlKGZsb2F0IHRleHR1cmVCYW5rLCB2ZWM0IHRleHR1cmVWYWx1ZSkgewogIGZsb2F0IHRleENvbXBvbmVudDsKICBpbnQgdGV4QmFuayA9IHJvdW5kVG9JbnQodGV4dHVyZUJhbmspOwogIGlmKHRleEJhbmsgPT0gMCkgewogICAgdGV4Q29tcG9uZW50ID0gdGV4dHVyZVZhbHVlLnI7CiAgfSBlbHNlIGlmKHRleEJhbmsgPT0gMSkgewogICAgdGV4Q29tcG9uZW50ID0gdGV4dHVyZVZhbHVlLmc7CiAgfSBlbHNlIHsKICAgIHRleENvbXBvbmVudCA9IHRleHR1cmVWYWx1ZS5iOwogIH0KICByZXR1cm4gdGV4Q29tcG9uZW50Owp9CgovLyBVc2VkIHRvIHJlY29uc3RydWN0IGEgZ2x5cGggZnJvbSB0aGUgY29sb3VyQ29tcG9uZW50IHRleHR1cmUKLy8gUmVhZCBvbmUgc3BlY2lmaWMgY29sb3VyIG9ubHkgYW5kIHRyZWF0IGl0IGFzIGFuIGFscGhhIHZhbHVlLCBzZXR0aW5nIGl0cyBjb2xvdXIgdXNpbmcgY29sb3VyTW9kaWZpZXIKdmVjNCBnZXRDb2xvdXJGcm9tQ29tcG9uZW50KGZsb2F0IGNvbG91ckNvbXBvbmVudCwgdmVjNCBjb2xvdXJNb2RpZmllciwgZmxvYXQgdXNlV2hpdGVCb29zdCkgewogIGZsb2F0IGNvbG91ckF2ZyA9IChjb2xvdXJNb2RpZmllci5yICsgY29sb3VyTW9kaWZpZXIuYiArIGNvbG91ck1vZGlmaWVyLmcpIC8gMy4wOwogIGZsb2F0IGlzV2hpdGUgPSBzdGVwKDEuMCwgY29sb3VyQXZnKSAqIHVzZVdoaXRlQm9vc3Q7CiAgLy8gSWYgdGhlIHRleHQgaXMgd2hpdGUgYm9vc3QgdGhlIGFscGhhIHRvIGluY3JlYXNlIGNvbnRyYXN0CiAgZmxvYXQgd2hpdGVUZXh0Qm9vc3QgPSBpc1doaXRlICogKHN0ZXAoMC4yNSwgY29sb3VyQ29tcG9uZW50KSAqIG1pbihjb2xvdXJBdmcsIDAuMjUpKTsKICBmbG9hdCBhbHBoYSA9IGNvbG91ckNvbXBvbmVudCArIHdoaXRlVGV4dEJvb3N0OwogIGZsb2F0IGEgPSBjb2xvdXJNb2RpZmllci5hICogYWxwaGE7CiAgZmxvYXQgciA9IGNvbG91ck1vZGlmaWVyLnIgKiBhbHBoYTsKICBmbG9hdCBnID0gY29sb3VyTW9kaWZpZXIuZyAqIGFscGhhOwogIGZsb2F0IGIgPSBjb2xvdXJNb2RpZmllci5iICogYWxwaGE7CiAgcmV0dXJuIHZlYzQocixnLGIsYSk7Cn0KCi8vIHJldHVybnMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGNlbnRyZSBvZiB0aGUgc2hhcGUgdG8gdGhlIGVkZ2UKZmxvYXQgY2FsY3VsYXRlRWRnZU9mUmVjdGFuZ2xlKHZlYzIgcG9zaXRpb24sIGZsb2F0IHdpZHRoLCBmbG9hdCBoZWlnaHQsCiAgZmxvYXQgYm9yZGVyV2lkdGgsIGZsb2F0IGJvcmRlclJhZGl1cykgewogIGJvcmRlclJhZGl1cyA9IG1heCgwLjAsIGJvcmRlclJhZGl1cyAtIGJvcmRlcldpZHRoKTsgCiAgZmxvYXQgaGFsZldpZHRoID0gd2lkdGggLyAyLjA7CiAgZmxvYXQgaGFsZkhlaWdodCA9IGhlaWdodCAvIDIuMDsKICBmbG9hdCBhID0gaGFsZldpZHRoIC0gYm9yZGVyUmFkaXVzIC0gYm9yZGVyV2lkdGg7CiAgZmxvYXQgYiA9IGhhbGZIZWlnaHQgLSBib3JkZXJSYWRpdXMgLSBib3JkZXJXaWR0aDsKICBmbG9hdCB4ID0gcG9zaXRpb24ueCAtIGhhbGZXaWR0aDsKICBmbG9hdCB5ID0gcG9zaXRpb24ueSAtIGhhbGZIZWlnaHQ7CiAgZmxvYXQgaG9yaXpvbnRhbCA9IHBvdyhtYXgoYWJzKHgpIC0gYSwgMC4wKSwgMi4wKTsKICBmbG9hdCB2ZXJ0aWNhbCA9IHBvdyhtYXgoYWJzKHkpIC0gYiwgMC4wKSwgMi4wKTsKICByZXR1cm4gaG9yaXpvbnRhbCArIHZlcnRpY2FsOyAKfQoKZmxvYXQgZGlzdGFuY2VGcm9tQ2lyY2xlQ2VudHJlKGZsb2F0IHJhZGl1cykgewogIHJldHVybiAoZGlzdGFuY2Uodl90ZXhDb29yZC56dywgdmVjMigwLjUpKSAqIHJhZGl1cykgKiB1X3pvb207Cn0KCi8vIEFuIGV4cGxhbmF0aW9uIG9mIHRoZSBmb3JtdWxhIGZvciBhIHJvdW5kZWQgcmVjdGFuZ2xlCi8vIGh0dHA6Ly9iZW5pY2UtZXF1YXRpb24uYmxvZ3Nwb3QuY29tLzIwMTYvMTAvZXF1YXRpb24tb2Ytcm91bmRlZC1yZWN0YW5nbGUuaHRtbAp2ZWM0IHJvdW5kUmVjdGFuZ2xlKHZlYzQgZmluYWxDb2xvdXIsIGZsb2F0IGJvcmRlcldpZHRoSW5QaXhlbHMsIGZsb2F0IGJvcmRlclJhZGl1cykgewogIGZsb2F0IGRpc3RhbmNlVG9PdXRlckVkZ2UgPSBwb3coYm9yZGVyUmFkaXVzLCAyLjApOwogIC8vIGlmIHJlc3VsdCBpcyBsYXJnZXIgdGhhbiBkaXN0YW5jZVRvT3V0ZXJFZGdlIHRoZW4gd2UgYXJlIG91dHNpZGUgb2YgdGhlIHNoYXBlCiAgZmxvYXQgZGlzdGFuY2VGcm9tQ2VudHJlID0gY2FsY3VsYXRlRWRnZU9mUmVjdGFuZ2xlKHZfdGV4Q29vcmQueHksIHZfdGV4Q29vcmQueiwgdl90ZXhDb29yZC53LCAwLjAsIGJvcmRlclJhZGl1cyk7CiAgaWYoYWJzKHZfYm9yZGVyV2lkdGgpID4gMC4wKSB7CiAgICBmaW5hbENvbG91ciAqPSAxLjAgLSBhYXN0ZXAoZGlzdGFuY2VUb091dGVyRWRnZSwgZGlzdGFuY2VGcm9tQ2VudHJlKTsKICAgIGRpc3RhbmNlRnJvbUNlbnRyZSA9IGNhbGN1bGF0ZUVkZ2VPZlJlY3RhbmdsZSh2X3RleENvb3JkLnh5LCB2X3RleENvb3JkLnosIHZfdGV4Q29vcmQudywgdl9ib3JkZXJXaWR0aCwgYm9yZGVyUmFkaXVzKTsKICAgIGZsb2F0IGJvcmRlclNpemUgPSBtYXgoMC4wLCBib3JkZXJSYWRpdXMgLSB2X2JvcmRlcldpZHRoKTsKICAgIGZsb2F0IGRpc3RhbmNlVG9Jbm5lckVkZ2UgPSBwb3coYm9yZGVyU2l6ZSwgMi4wKTsKICAgIGZpbmFsQ29sb3VyICo9IGFhc3RlcChkaXN0YW5jZVRvSW5uZXJFZGdlLCBkaXN0YW5jZUZyb21DZW50cmUpOwogIH0gZWxzZSB7CiAgICBmaW5hbENvbG91ciAqPSAxLjAgLSBhYXN0ZXAoZGlzdGFuY2VUb091dGVyRWRnZSwgZGlzdGFuY2VGcm9tQ2VudHJlKTsKICB9CiAgcmV0dXJuIGZpbmFsQ29sb3VyOwp9Cgp2ZWM0IGdldENvbG91ckZvclRleHRPckZvbnRJY29uKHZlYzQgdGV4Q29vcmQsIHZlYzQgY29sb3VyLCBmbG9hdCB1c2VXaGl0ZUJvb3N0KSB7CiAgLy8gUmVhZCB0aGUgdmFsdWUgZnJvbSB0aGUgcmVxdWlyZWQgY29sb3VyIGNvbXBvbmVudCB0aGF0IHdpbGwgZGV0ZXJtaW5lIHRoZSBzaGFwZQogIGZsb2F0IGNvbG91ckNvbXBvbmVudCA9IHJlYWRDb2xvdXJDb21wb25lbnRGcm9tVGV4dHVyZSh2X3RleHR1cmVCYW5rLnksIHRleENvb3JkKTsKICAvLyBOb3cgY29sb3VyIGl0IGFuZCBib29zdCB0aGUgY29udHJhc3Qgd2hlbiB0aGUgY29sb3VyIGlzIHdoaXRlIGlmIHJlcXVpcmVkCiAgcmV0dXJuIGdldENvbG91ckZyb21Db21wb25lbnQoY29sb3VyQ29tcG9uZW50LCBjb2xvdXIsIHVzZVdoaXRlQm9vc3QpOwp9CgovLyBpZiBzaGFwZSBpcyBsZXNzIHRoYW4gNSBwaXhlbHMgaW4gc2l6ZSBzdGFydCB0byBmYWRlIG91dCB0aGUgYm9yZGVyCmZsb2F0IGZhZGVPdXRCb3JkZXIoZmxvYXQgc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMpIHsKICByZXR1cm4gbWF4KDAuMiwgc21vb3Roc3RlcCgwLjAsIDUuMCwgc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMpKTsKfQoKdm9pZCBtYWluKCkgewogIGZsb2F0IHNoYXBlV2lkdGggPSBhYnModl9zaGFwZVNpemUueCk7CiAgZmxvYXQgc2hhcGVIZWlnaHQgPSB2X3NoYXBlU2l6ZS55OwogIC8vIHVzZWQgZm9yIG1pbmltdW0gYm9yZGVyIHNpemVzOwogIGZsb2F0IHNtYWxsZXN0U2hhcGVEaW1lbnNpb24gPSBtaW4oc2hhcGVXaWR0aCwgc2hhcGVIZWlnaHQpOwogIC8vIHRoZSBzbWFsbGVzdCBzaXplIGluIHBpeGVscyBvbiBzY3JlZW4gKHNjcmVlbiBzcGFjZSkuICBXZSByZW1vdmUgMC41IHBpeGVscyB0byBnaXZlIHRoZSBhbnRpIGFsaWFzaW5nCiAgLy8gcm9vbSB0byBzbW9vdGggb3V0IChvdGhlcndpc2UgY2lyY2xlcyBjYW4gc3RhcnQgdG8gbG9vayBzcXVhcmVpc2gpICMyNzcxCiAgZmxvYXQgc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMgPSAoKHNtYWxsZXN0U2hhcGVEaW1lbnNpb24gLyAyLjApICogdV96b29tKSAtIDAuNTsKICBmbG9hdCBib3JkZXJXaWR0aCA9IGFicyh2X2JvcmRlcldpZHRoKTsKICAvLyBUaGUgZmluYWwgY29sb3VyIHRvIGRyYXcgdG8gdGhlIHNjcmVlbgogIHZlYzQgZmluYWxDb2xvdXI7CiAgLy8gd2hldGhlciB0aGlzIHByaW1pdGl2ZSBzaG91bGQgb25seSBhcHBlYXIgaW4gdGhlIHNoYWRvdyBjYW52YXMgb3Igbm90IGFwcGVhciBhdCBhbGwKICBpbnQgc2hhZG93VHlwZSA9IHJvdW5kVG9JbnQodV9zaGFkb3dUeXBlKTsKICBib29sIGlzQ2lyY2xlID0gcm91bmRUb0ludCh2X3NoYXBlU2l6ZS54KSA+IDA7CiAgYm9vbCBoYXNDaXJjbGVEYXNoZWRCb3JkZXIgPSByb3VuZFRvSW50KHZfYm9yZGVyV2lkdGgpIDwgMDsKICBib29sIG9ubHlEcmF3T25TaGFkb3cgPSBzaGFkb3dUeXBlID09IDE7CiAgLy8gb25seSBkcmF3IHNoYWRvdyBjb2xvdXJzIGZvciBoaXQgdGVzdGluZwogIGJvb2wgc2hhZG93Q2FudmFzID0gcm91bmRUb0ludCh1X2hpdFRlc3QpID09IDE7CiAgdmVjMiB0ZXh0dXJlQ29vcmRzID0gdl90ZXhDb29yZC56dzsKICAvLyBlYWNoIGRvbnV0IHNlZ21lbnQgaXMgYSB3aG9sZSBjaXJjbGUgdGhhdHMgc2xpY2VkIGJldHdlZW4gdGhlIHN0YXJ0IGFuZCBlbmQgYW5nbGVzCiAgZmxvYXQgZG9udXRTdGFydEFuZ2xlID0gdl9kb251dFNlZ21lbnQueDsKICBmbG9hdCBkb251dEVuZEFuZ2xlID0gdl9kb251dFNlZ21lbnQueTsKICBmbG9hdCBib3JkZXJSYWRpdXMgPSB2X2RvbnV0U2VnbWVudC54OwogIGZsb2F0IGJvcmRlcldpZHRoSW5QaXhlbHM7CiAgLy8gLTIgZmxhdCBzaGFkZWQgd2l0aCBhbnRpIGFsaWFzaW5nCiAgLy8gLTEgZmxhdCBzaGFkZWQKICAvLyAwLi4yIC0+IHRleHQKICAvLyAzIC0+IGZvbnRJY29ucwogIC8vIDQuLi43IC0+IGltYWdlcwogIGludCB0ZXh0dXJlQmFuayA9IHJvdW5kVG9JbnQodl90ZXh0dXJlQmFuay54KTsKICBib29sIGhhc1JlY3RhbmdsZUJvcmRlciA9IHZfYm9yZGVyV2lkdGggPiAwLjAgJiYgcm91bmRUb0ludCh2X3NoYXBlU2l6ZS54KSA8IDA7CiAgYm9vbCBoYXNEYXNoZWRCb3JkZXIgPSB0ZXh0dXJlQmFuayA9PSAtMzsKICBib29sIGhhc0NpcmNsZVNlZ21lbnRzID0gZG9udXRTdGFydEFuZ2xlICE9IDAuMCB8fCBkb251dEVuZEFuZ2xlICE9IDAuMDsKICBmbG9hdCBzZWdtZW50QW5nbGU7CiAgaWYoaGFzQ2lyY2xlU2VnbWVudHMgfHwgaGFzQ2lyY2xlRGFzaGVkQm9yZGVyKSB7CiAgICBpZihkb251dFN0YXJ0QW5nbGUgPiBQSSkgewogICAgICBkb251dFN0YXJ0QW5nbGUgLT0gMi4wICogUEk7CiAgICB9CiAgICBpZihkb251dEVuZEFuZ2xlID4gUEkpIHsKICAgICAgZG9udXRFbmRBbmdsZSAtPSAyLjAgKiBQSTsKICAgIH0gIAogICAgZmxvYXQgeCA9IHRleHR1cmVDb29yZHMueCAtIDAuNTsKICAgIGZsb2F0IHkgPSB0ZXh0dXJlQ29vcmRzLnkgLSAwLjU7CiAgICBzZWdtZW50QW5nbGUgPSBhdGFuKHkseCk7CiAgfQogIGlmKHNoYWRvd0NhbnZhcykgewogICAgLy8gRXhjbHVkZSBmcm9tIHNoYWRvdwogICAgaWYoc2hhZG93VHlwZSA9PSAtMSl7CiAgICAgICAgZGlzY2FyZDsKICAgIH0gZWxzZSB7CiAgICAgIGZpbmFsQ29sb3VyID0gdl9oaXRUZXN0Q29sb3VyIC8gMjU1LjA7CiAgICAgIGlmKGlzQ2lyY2xlKSB7CiAgICAgICAgZmxvYXQgZGlzdEluU2NyZWVuUGl4ZWxzID0gZGlzdGFuY2VGcm9tQ2lyY2xlQ2VudHJlKHNoYXBlV2lkdGgpOwogICAgICAgIGZpbmFsQ29sb3VyICo9IDEuMCAtIHN0ZXAoc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMsIGRpc3RJblNjcmVlblBpeGVscyk7CiAgICAgICAgaWYoYm9yZGVyV2lkdGggPiAwLjApIHsKICAgICAgICAgIGZsb2F0IGJvcmRlclJhZGl1c0luU2NyZWVuUGl4ZWxzID0gYm9yZGVyV2lkdGggKiB1X3pvb207CiAgICAgICAgICBmaW5hbENvbG91ciAqPSBzdGVwKHNoYXBlU2l6ZUluU2NyZWVuUGl4ZWxzIC0gYm9yZGVyUmFkaXVzSW5TY3JlZW5QaXhlbHMsIGRpc3RJblNjcmVlblBpeGVscyk7CiAgICAgICAgfQogICAgICAgIGlmKGhhc0NpcmNsZVNlZ21lbnRzKSB7CiAgICAgICAgICAvLyBmb3IgZG9udXQgc2VnbWVudHMgdGhhdCBjcm9zcyBiZXR3ZWVuIFBJIGFuZCAtUEkgCiAgICAgICAgICBpZihkb251dFN0YXJ0QW5nbGUgPj0gZG9udXRFbmRBbmdsZSkgewogICAgICAgICAgIGZpbmFsQ29sb3VyICo9IHN0ZXAoZG9udXRTdGFydEFuZ2xlLCBzZWdtZW50QW5nbGUpICsgKDEuMCAtIHN0ZXAoZG9udXRFbmRBbmdsZSwgc2VnbWVudEFuZ2xlKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgIGZpbmFsQ29sb3VyICo9IHN0ZXAoZG9udXRTdGFydEFuZ2xlLCBzZWdtZW50QW5nbGUpOwogICAgICAgICAgIGZpbmFsQ29sb3VyICo9IDEuMCAtIHN0ZXAoZG9udXRFbmRBbmdsZSwgc2VnbWVudEFuZ2xlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gaWYodl9kb251dFNlZ21lbnQueCA+IDAuMCkgewogICAgICAgIGJvcmRlcldpZHRoSW5QaXhlbHMgPSBnZXRCb3JkZXJXaWR0aFpvb20oYm9yZGVyV2lkdGgpOwogICAgICAgIGZsb2F0IHNxdWFyZU9mQm9yZGVyUmFkaXVzID0gcG93KGJvcmRlclJhZGl1cywgMi4wKTsKICAgICAgICBmbG9hdCByZXN1bHQgPSBjYWxjdWxhdGVFZGdlT2ZSZWN0YW5nbGUodl90ZXhDb29yZC54eSwgdl90ZXhDb29yZC56LCB2X3RleENvb3JkLncsIDAuMCwgYm9yZGVyUmFkaXVzKTsKICAgICAgICBmaW5hbENvbG91ciAqPSAxLjAgLSBzdGVwKHNxdWFyZU9mQm9yZGVyUmFkaXVzLCByZXN1bHQpOwogICAgICB9IGVsc2UgaWYoaGFzUmVjdGFuZ2xlQm9yZGVyKSB7CiAgICAgICAgZmluYWxDb2xvdXIgKj0gcmVjdGFuZ2xlQm9yZGVyKGJvcmRlcldpZHRoKTsKICAgICAgfQogICAgfQogIH0gZWxzZSBpZiAob25seURyYXdPblNoYWRvdyl7CiAgICBkaXNjYXJkOwogIH0gZWxzZSB7CiAgICAgIGZpbmFsQ29sb3VyID0gdl9jb2xvdXIgLyAyNTUuMDsKICAgICAgLy8gdHJhbnNwYXJlbmN5IHRvIGFwcGx5IHdoZW4gdXNpbmcgcGVySXRlbUFscGhhOwogICAgICBmbG9hdCBhbHBoYSA9IGZpbmFsQ29sb3VyLmE7CiAgICAgIC8vIGxvYWQgdGhlIGNvcnJlY3QgdGV4dHVyZSBhbmQgcmVhZCBpdAogICAgICBpZiAodGV4dHVyZUJhbmsgPj0gMCkgewogICAgICAgICAgdmVjNCB0ZXh0dXJlVmFsdWU7CiAgICAgICAgICAvLyBzZXQgbWlwbWFwIGxldmVsIGJpYXMgdG8gc2hhcnBlbiB0ZXh0dXJlcwogICAgICAgICAgZmxvYXQgYmlhcyA9IC0yLjAvMy4wOwogICAgICAgICAgZmxvYXQgdGV4dEJpYXMgPSAtMC44OwogICAgICAgICAgLy8gR2V0IHRoZSBjb2xvdXIgZnJvbSB0aGUgY3VycmVudCB0ZXh0dXJlCiAgICAgICAgICAvLyBJdHMgbm90IHBvc3NpYmxlIGFjY2VzcyBhcnJheXMgb3RoZXIgdGhhbiB2aWEgc3RhdGljIHZhcmlhYmxlcyBzbyB0aGlzIGNhbid0IGJlIG1ha2UKICAgICAgICAgIC8vIHNob3J0ZXIKICAgICAgICAgIC8vdGV4dCAwCiAgICAgICAgICBpZih0ZXh0dXJlQmFuayA9PSAwKSAgewogICAgICAgICAgICB0ZXh0dXJlVmFsdWUgPSB0ZXh0dXJlMkQodV9pbWFnZVswXSwgdl90ZXhDb29yZC54eSwgdGV4dEJpYXMpOwogICAgICAgICAgICBmaW5hbENvbG91ciA9IGdldENvbG91ckZvclRleHRPckZvbnRJY29uKHRleHR1cmVWYWx1ZSwgZmluYWxDb2xvdXIsIDEuMCk7CiAgICAgICAgICAvL3RleHQgMQogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDEpIHsKICAgICAgICAgICAgdGV4dHVyZVZhbHVlID0gdGV4dHVyZTJEKHVfaW1hZ2VbMV0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgICAgZmluYWxDb2xvdXIgPSBnZXRDb2xvdXJGb3JUZXh0T3JGb250SWNvbih0ZXh0dXJlVmFsdWUsIGZpbmFsQ29sb3VyLCAxLjApOwogICAgICAgICAgLy8gdGV4dCAyCiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gMikgewogICAgICAgICAgICB0ZXh0dXJlVmFsdWUgPSB0ZXh0dXJlMkQodV9pbWFnZVsyXSwgdl90ZXhDb29yZC54eSwgdGV4dEJpYXMpOwogICAgICAgICAgICBmaW5hbENvbG91ciA9IGdldENvbG91ckZvclRleHRPckZvbnRJY29uKHRleHR1cmVWYWx1ZSwgZmluYWxDb2xvdXIsIDEuMCk7CiAgICAgICAgICAvLyBmb250SWNvbnMgMyAKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSAzKSB7CiAgICAgICAgICAgIHRleHR1cmVWYWx1ZSA9IHRleHR1cmUyRCh1X2ltYWdlWzNdLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgICAgZmluYWxDb2xvdXIgPSBnZXRDb2xvdXJGb3JUZXh0T3JGb250SWNvbih0ZXh0dXJlVmFsdWUsIGZpbmFsQ29sb3VyLCAwLjApOwogICAgICAgICAgLy8gaW1hZ2UgNAogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDQpIHsKICAgICAgICAgICAgZmluYWxDb2xvdXIgPSB0ZXh0dXJlMkQodV9pbWFnZVs0XSwgdl90ZXhDb29yZC54eSwgYmlhcykgKiBhbHBoYTsKICAgICAgICAgIC8vIGltYWdlIDUgICAKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSA1KSB7CiAgICAgICAgICAgIGZpbmFsQ29sb3VyID0gdGV4dHVyZTJEKHVfaW1hZ2VbNV0sIHZfdGV4Q29vcmQueHksIGJpYXMpICogYWxwaGE7CiAgICAgICAgICAvLyBpbWFnZSA2CiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gNikgewogICAgICAgICAgICBmaW5hbENvbG91ciA9IHRleHR1cmUyRCh1X2ltYWdlWzZdLCB2X3RleENvb3JkLnh5LCBiaWFzKSAqIGFscGhhOwogICAgICAgICAgLy8gaW1hZ2UgNyAgIAogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDcpIHsKICAgICAgICAgICAgZmluYWxDb2xvdXIgPSB0ZXh0dXJlMkQodV9pbWFnZVs3XSwgdl90ZXhDb29yZC54eSwgYmlhcykgKiBhbHBoYTsKICAgICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBmbGF0IHNoYWRlZCByZWN0IG9yIHRyaWFuZ2xlLCBqdXN0IGFwcGx5IHRoZSBjb2xvdXIKICAgICAgICBmbG9hdCBhbHBoYSA9IGZpbmFsQ29sb3VyLmE7CiAgICAgICAgZmluYWxDb2xvdXIgPSB2ZWM0KGZpbmFsQ29sb3VyLnJnYiAgKiBhbHBoYSwgYWxwaGEpOwogICAgICB9CiAgICAgIGlmKGlzQ2lyY2xlKSB7CiAgICAgICAgIGZsb2F0IGRpc3RJblNjcmVlblBpeGVscyA9IGRpc3RhbmNlRnJvbUNpcmNsZUNlbnRyZShzaGFwZVdpZHRoKTsKICAgICAgICAgZmluYWxDb2xvdXIgKj0gMS4wIC0gYWFzdGVwKHNoYXBlU2l6ZUluU2NyZWVuUGl4ZWxzLCBkaXN0SW5TY3JlZW5QaXhlbHMpOwogICAgICAgICBpZihib3JkZXJXaWR0aCA+IDAuMCkgewogICAgICAgICAgIGZsb2F0IGJvcmRlclJhZGl1c0luU2NyZWVuUGl4ZWxzID0gbWF4KDEuMCwgYm9yZGVyV2lkdGggKiB1X3pvb20pOwogICAgICAgICAgIGZpbmFsQ29sb3VyICo9IGFhc3RlcChzaGFwZVNpemVJblNjcmVlblBpeGVscyAtIGJvcmRlclJhZGl1c0luU2NyZWVuUGl4ZWxzLCBkaXN0SW5TY3JlZW5QaXhlbHMpOwogICAgICAgICAgIGZpbmFsQ29sb3VyICo9IGZhZGVPdXRCb3JkZXIoc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMpOwogICAgICAgICB9CgogICAgICAgICAvLyBVc2VkIHRvIGRlY2lkZSBob3cgbXVjaCBhbnRpIGFsaWFzaW5nIHRvIGFwcGx5CiAgICAgICAgIGZsb2F0IHNtb290aG5lc3MgPSB2X3BpeGVsKjEuNTsKICAgICAgICAgZmxvYXQgc2FGcm9tID0gZG9udXRTdGFydEFuZ2xlIC0gc21vb3RobmVzczsKICAgICAgICAgZmxvYXQgc2FUbyA9IGRvbnV0U3RhcnRBbmdsZSArIHNtb290aG5lc3M7CiAgICAgICAgIGZsb2F0IGVhRnJvbSA9IGRvbnV0RW5kQW5nbGUgLSBzbW9vdGhuZXNzOwogICAgICAgICBmbG9hdCBlYVRvID0gZG9udXRFbmRBbmdsZSArIHNtb290aG5lc3M7CiAgICAgICAgIGlmKGhhc0NpcmNsZVNlZ21lbnRzKSB7CiAgICAgICAgICAgLy8gZm9yIGRvbnV0IHNlZ21lbnRzIHRoYXQgY3Jvc3MgYmV0d2VlbiBQSSBhbmQgLVBJIAogICAgICAgICAgIGlmKGRvbnV0U3RhcnRBbmdsZSA+PSBkb251dEVuZEFuZ2xlKSB7CiAgICAgICAgICAgICBmaW5hbENvbG91ciAqPSBzbW9vdGhzdGVwKHNhRnJvbSwgc2FUbywgc2VnbWVudEFuZ2xlKSArICgxLjAgLSBzbW9vdGhzdGVwKGVhRnJvbSwgZWFUbywgc2VnbWVudEFuZ2xlKSk7CiAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIGZpbmFsQ29sb3VyICo9IHNtb290aHN0ZXAoc2FGcm9tLCBzYVRvLCBzZWdtZW50QW5nbGUpOwogICAgICAgICAgICAgZmluYWxDb2xvdXIgKj0gMS4wIC0gc21vb3Roc3RlcChlYUZyb20sIGVhVG8sIHNlZ21lbnRBbmdsZSk7CiAgICAgICAgICAgfQogICAgICAgICB9IGVsc2UgaWYoaGFzQ2lyY2xlRGFzaGVkQm9yZGVyKSB7CiAgICAgICAgICBmbG9hdCBkYXNoTGVuZ3RoID0gYm9yZGVyV2lkdGggKiAyLjA7CiAgICAgICAgICBmbG9hdCBnYXBXaWR0aCA9IGRhc2hMZW5ndGgvMi4wOwogICAgICAgICAgZmxvYXQgY2lyY3VtZmVyZW5jZSA9IDIuMCAqIChQSSAqIChzaGFwZVdpZHRoIC8yLjApKTsKICAgICAgICAgIGZsb2F0IGFuZ2xlQXJvdW5kQ2lyY2xlID0gc2VnbWVudEFuZ2xlIC8gKDIuMCpQSSk7CiAgICAgICAgICBmbG9hdCBkYXNoZXMgPSBmbG9vcigoY2lyY3VtZmVyZW5jZSArIGdhcFdpZHRoKSAvIChkYXNoTGVuZ3RoICsgZ2FwV2lkdGgpIC0gMS4wICk7CiAgICAgICAgICBmbG9hdCBkYXNoID0gc2luKCgoYW5nbGVBcm91bmRDaXJjbGUgKiBkYXNoZXMpKSAqICgyLjAgKiBQSSkpOwogICAgICAgICAgLy8gc21vb3RoIGFuZCBjdXQgb3V0IGEgZ2FwIHdoZW4gdGhlIHNpbmUgd2F2ZSBpZiBwYXN0IHRoZSBkYXNoVGhyZXNob2xkCiAgICAgICAgICBmaW5hbENvbG91ciAqPSBhYXN0ZXAoLTAuNSwgIGRhc2gpOwogICAgICAgICB9CiAgICAgIC8vIGRyYXcgYSBzcXVhcmUgYm9yZGVyLCBmaWxsIGEgc3F1YXJlIGFuZCBjdXQgb3V0IHRoZSBjZW50cmUKICAgICAgfSBlbHNlIGlmKHZfZG9udXRTZWdtZW50LnggPiAwLjApIHsKICAgICAgICBib3JkZXJXaWR0aEluUGl4ZWxzID0gZ2V0Qm9yZGVyV2lkdGhab29tKGJvcmRlcldpZHRoKTsKICAgICAgICBmaW5hbENvbG91ciA9IHJvdW5kUmVjdGFuZ2xlKGZpbmFsQ29sb3VyLCBib3JkZXJXaWR0aEluUGl4ZWxzLCBib3JkZXJSYWRpdXMpOwogICAgICB9IGVsc2UgaWYoaGFzUmVjdGFuZ2xlQm9yZGVyKSB7CiAgICAgICAgYm9yZGVyV2lkdGhJblBpeGVscyA9IGdldEJvcmRlcldpZHRoWm9vbShib3JkZXJXaWR0aCk7CiAgICAgICAgZmluYWxDb2xvdXIgKj0gcmVjdGFuZ2xlQm9yZGVyKGJvcmRlcldpZHRoSW5QaXhlbHMpOwogICAgICAgIGZpbmFsQ29sb3VyICo9IGZhZGVPdXRCb3JkZXIoc2hhcGVTaXplSW5TY3JlZW5QaXhlbHMpOwogICAgICAgIGlmKGhhc0Rhc2hlZEJvcmRlcikgewogICAgICAgICAgZmxvYXQgZGFzaExlbmd0aCA9IGJvcmRlcldpZHRoSW5QaXhlbHMgKiAyLjA7CiAgICAgICAgICBmbG9hdCBnYXBXaWR0aCA9IGJvcmRlcldpZHRoSW5QaXhlbHM7CiAgICAgICAgICBmbG9hdCBkYXNoZXMgPSBmbG9vcigodl90ZXhDb29yZC56ICsgZ2FwV2lkdGgpIC8gKGRhc2hMZW5ndGggKyBnYXBXaWR0aCkpICsgMC41OwogICAgICAgICAgZmxvYXQgZGFzaCA9IHNpbigoKCh2X3RleENvb3JkLnggLyB2X3RleENvb3JkLnopICogZGFzaGVzKSkgKiAoMi4wICogUEkpKTsKICAgICAgICAgIC8vIHNtb290aCBhbmQgY3V0IG91dCBhIGdhcCB3aGVuIHRoZSBzaW5lIHdhdmUgaWYgcGFzdCB0aGUgZGFzaFRocmVzaG9sZAogICAgICAgICAgZmluYWxDb2xvdXIgKj0gc3RlcCgtMC40OSwgIGRhc2gpOwogICAgICAgICAgZGFzaGVzID0gZmxvb3IoKHZfdGV4Q29vcmQudyArIGdhcFdpZHRoKSAvIChkYXNoTGVuZ3RoICsgZ2FwV2lkdGgpKSArIDAuNTsKICAgICAgICAgIGRhc2ggPSBzaW4oKCgodl90ZXhDb29yZC55LyB2X3RleENvb3JkLncpICogZGFzaGVzKSkgKiAoMi4wICogUEkpKTsKICAgICAgICAgIC8vIHNtb290aCBhbmQgY3V0IG91dCBhIGdhcCB3aGVuIHRoZSBzaW5lIHdhdmUgaWYgcGFzdCB0aGUgZGFzaFRocmVzaG9sZAogICAgICAgICAgZmluYWxDb2xvdXIgKj0gYWFzdGVwKC0wLjQ5LCAgZGFzaCk7ICAKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gdW5jb21tZW50IHRvIGRlYnVnIHNoYXBlCiAgICAgLy8gZmluYWxDb2xvdXIgPSB2ZWM0KDEuMCwwLjAsMC4wLDAuNSk7CiAgIH0KICBnbF9GcmFnQ29sb3IgPSBmaW5hbENvbG91cjsKfQ==",Ju="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjNCBhX3RleENvb3JkOwphdHRyaWJ1dGUgdmVjNCBhX2hpdFRlc3RDb2xvdXI7CmF0dHJpYnV0ZSB2ZWMyIGFfdGV4dHVyZUJhbms7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9jaXJjbGVSYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3dpZHRoOwphdHRyaWJ1dGUgZmxvYXQgYV9zdGFydEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV9lbmRBbmdsZTsKCnVuaWZvcm0gdmVjMyB1X3Jlc29sdXRpb247CnVuaWZvcm0gbWF0NCB1X3RyYW5zZm9ybTsKdW5pZm9ybSBmbG9hdCB1X3pvb207CnVuaWZvcm0gbG93cCBmbG9hdCB1X2hpdFRlc3Q7Cgp2YXJ5aW5nIGZsb2F0IHZfYm9yZGVyV2lkdGg7CnZhcnlpbmcgdmVjMiB2X3NoYXBlU2l6ZTsKdmFyeWluZyB2ZWM0IHZfdGV4Q29vcmQ7CnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUJhbms7CnZhcnlpbmcgZmxvYXQgdl9waXhlbDsKdmFyeWluZyB2ZWMyIHZfZG9udXRTZWdtZW50OwoKLy8gZW5zdXJlcyB0aGF0IG51bWJlcnMgYXJlIGV4YWN0bHkgaW50ZWdlcnMgCmludCByb3VuZFRvSW50KGZsb2F0IGEpIHsKICByZXR1cm4gaW50KGZsb29yKGEgKyAwLjUpKTsKfQoKLy8gZW5zdXJlcyB0aGF0IG51bWJlcnMgYXJlIGV4YWN0bHkgaW50ZWdlcnMgCnZlYzIgcm91bmQodmVjMiBhKSB7CiByZXR1cm4gZmxvb3IoYSArIDAuNSk7Cn0KCnZlYzIgdG9DbGlwU3BhY2UodmVjMiBwb3NpdGlvbnMpIHsKICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogIHZlYzIgemVyb1RvT25lID0gcG9zaXRpb25zIC8gdV9yZXNvbHV0aW9uLnh5OwogIC8vIGNvbnZlcnQgZnJvbSAwLT4xIHRvIDAtPjIKICB2ZWMyIHplcm9Ub1R3byA9IHplcm9Ub09uZSAqIDIuMDsKICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICByZXR1cm4gemVyb1RvVHdvIC0gMS4wOwp9Cgp2ZWMyIHRvQ2FydGVzaWFuKHZlYzIgcG9zaXRpb25zKSB7CiAgLy8gY29udmVydCBmcm9tIC0xLT4rMSAoY2xpcHNwYWNlKSB0byAwLT4yCiAgcG9zaXRpb25zICs9IDEuMDsKICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAwLT4xCiAgcG9zaXRpb25zIC89IDIuMDsKICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSAwLjAgdG8gMS4wIHRvIHBpeGVscwogIHJldHVybiBwb3NpdGlvbnMgKiB1X3Jlc29sdXRpb24ueHk7Cn0KCi8vIHB1c2ggb3V0IGVhY2ggdmVydGV4IHRvIG1ha2UgdGhlIHNoYXBlIGxhcmdlcgp2ZWMyIGV4cGFuZFZlcnRleEZyb21DZW50cmUoaW50IHZlcnRleEluZGV4LCBmbG9hdCBzaXplKSB7CiAgLy8gVGhlIGRpcmVjdGlvbiB0byBwdXNoIG91dAogIHZlYzIgdW5pdFZlY3RvcjsKICAvLyBmb3IgZWFjaCBwb2ludCBpbiB0aGUgcXVhZCBnZXQgdGhlIGNlbnRyZSBwb2ludAogIGlmICh2ZXJ0ZXhJbmRleCA9PSAwKSB7CiAgICB1bml0VmVjdG9yID0gbm9ybWFsaXplKHZlYzIoLTEuMCwgLTEuMCkpOwogIH0gZWxzZSBpZih2ZXJ0ZXhJbmRleCA9PSAxKSB7CiAgICB1bml0VmVjdG9yID0gbm9ybWFsaXplKHZlYzIoMS4wLCAtMS4wKSk7CiAgfSBlbHNlIGlmKHZlcnRleEluZGV4ID09IDIpIHsKICAgIHVuaXRWZWN0b3IgPSBub3JtYWxpemUodmVjMigtMS4wLCAxLjApKTsKICB9IGVsc2UgaWYodmVydGV4SW5kZXggPT0gMykgewogICAgdW5pdFZlY3RvciA9IG5vcm1hbGl6ZSh2ZWMyKDEuMCwgMS4wKSk7CiAgfQogIHJldHVybiB1bml0VmVjdG9yICogbGVuZ3RoKHZlYzIoc2l6ZSkpOwp9Cgp2b2lkIG1haW4oKSB7CiAgIGJvb2wgaXNIaXRUZXN0aW5nID0gcm91bmRUb0ludCh1X2hpdFRlc3QpID09IDE7CiAgIGJvb2wgaXNDaXJjbGUgPSBhX2NpcmNsZVJhZGl1cyA+IDAuMDsKICAgaW50IHRleHR1cmVCYW5rID0gcm91bmRUb0ludChhX3RleHR1cmVCYW5rLngpOwogICBmbG9hdCBib3JkZXJXaWR0aCA9IDAuMDsKICAgYm9vbCBpc0JvcmRlciA9IGZhbHNlOwogICB2ZWMyIHZlcnRleFBvc2l0aW9uID0gYV9wb3NpdGlvbi54eTsKICAgZmxvYXQgaGFsZldpZHRoOwogICBmbG9hdCBoYWxmSGVpZ2h0OwogICB2ZWMyIHVuaXRWZWN0b3I7CiAgIGludCB2ZXJ0ZXhJbmRleCA9IHJvdW5kVG9JbnQoYV90ZXh0dXJlQmFuay55KTsKICAgaWYoaXNDaXJjbGUpIHsKICAgICBoYWxmV2lkdGggPSBhYnMoYV9jaXJjbGVSYWRpdXMpOwogICAgIGhhbGZIZWlnaHQgPSBoYWxmV2lkdGg7CiAgIH0gZWxzZSB7CiAgICAgaGFsZldpZHRoID0gYV90ZXhDb29yZC56IC8gMi4wOwogICAgIGhhbGZIZWlnaHQgPSBhX3RleENvb3JkLncgLyAyLjA7CiAgIH0KICAgZmxvYXQgdmlld0V4dHJhID0gMC4wOwogICAvLyBpZiBpdHMgYW4gaW1hZ2UsIG1ha2UgaXQgbGFyZ2VyIGJ5IHRoZSBhbW91bnQgb2YgcGl4ZWxzIHNwZWNpZmllZCBpbiB2aWV3RXh0cmEgKGFfd2lkdGgpCiAgIGlmICh0ZXh0dXJlQmFuayA+IDMpIHsKICAgICB2aWV3RXh0cmEgPSBhX3dpZHRoOwogICAgIHZlcnRleFBvc2l0aW9uICs9IGV4cGFuZFZlcnRleEZyb21DZW50cmUodmVydGV4SW5kZXgsIHZpZXdFeHRyYSAvIHVfem9vbSk7CiAgIH0gZWxzZSB7CiAgICAgYm9yZGVyV2lkdGggPSBhYnMoYV93aWR0aCk7CiAgICAgaXNCb3JkZXIgPSByb3VuZFRvSW50KGJvcmRlcldpZHRoKSA+IDA7CiAgIH0KICAgCiAgIGZsb2F0IGJvcmRlcldpZHRoT3V0U2l6ZSA9IGNlaWwoYm9yZGVyV2lkdGggLyAyLjApOwogICBpZihpc0JvcmRlcikgewogICAgIC8vIFdoZW4gaGl0IHRlc3RpbmcsIG1ha2UgdGhlIGJvcmRlcnMgdGhpY2tlciBzbyB0aGF0IHRoZXkgYXJlIGVhc3kgdG8gaGl0CiAgICAgaWYoaXNIaXRUZXN0aW5nKSB7CiAgICAgICAgZmxvYXQgYm9yZGVyWm9vbSA9ICAoNy4wIC8gdV96b29tKSAqIHNpZ24oYV93aWR0aCk7CiAgICAgICAvLyBhZGQgNyBzY3JlZW4gcGl4ZWxzIHRvIHRoZSBsaW5lIHRoaWNrbmVzcwogICAgICAgYm9yZGVyV2lkdGggKz0gYm9yZGVyWm9vbTsKICAgICAgIC8vIG1ha2UgdGhlIGJvcmRlciBsYXJnZXIgdG8gYWNjb21vZGF0ZSBuZXcgc2l6ZQogICAgICAgYm9yZGVyV2lkdGhPdXRTaXplICs9IGNlaWwoYm9yZGVyWm9vbSAvIDIuMCk7CiAgICAgfQogICAgIHZlcnRleFBvc2l0aW9uICs9IGV4cGFuZFZlcnRleEZyb21DZW50cmUodmVydGV4SW5kZXgsIGJvcmRlcldpZHRoT3V0U2l6ZSk7CiAgIH0KCiAgIGdsX1Bvc2l0aW9uID0gdV90cmFuc2Zvcm0gKiB2ZWM0KHRvQ2xpcFNwYWNlKHZlcnRleFBvc2l0aW9uKSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsKICAgCiAgIGlmIChpc0JvcmRlciAmJiAhaXNDaXJjbGUpIHsKICAgICAvLyBHZXQgZmluYWwgcG9zaXRpb24gaW4gc2NyZWVuc3BhY2UKICAgICB2ZWMyIHZpZXdQb3NpdGlvbiA9IGdsX1Bvc2l0aW9uLnh5OwogICAgIC8vIGNvbnZlcnQgdG8gcGl4ZWxzCiAgICAgdmlld1Bvc2l0aW9uID0gdG9DYXJ0ZXNpYW4odmlld1Bvc2l0aW9uKTsKICAgICB2aWV3UG9zaXRpb24gPSByb3VuZCh2aWV3UG9zaXRpb24pOwogICAgIGdsX1Bvc2l0aW9uLnh5ID0gdG9DbGlwU3BhY2Uodmlld1Bvc2l0aW9uKTsKICAgfQogICAKICAgLy8gcGFzcyB0aGUgdGV4Q29vcmQgdG8gdGhlIGZyYWdtZW50IHNoYWRlcgogICAvLyBUaGUgR1BVIHdpbGwgaW50ZXJwb2xhdGUgdGhpcyB2YWx1ZSBiZXR3ZWVuIHBvaW50cy4KICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7CiAgIHZfY29sb3VyID0gYV9jb2xvdXI7CiAgIHZfaGl0VGVzdENvbG91ciA9IGFfaGl0VGVzdENvbG91cjsKICAgdl90ZXh0dXJlQmFuayA9IGFfdGV4dHVyZUJhbms7CiAgIGZsb2F0IGJvcmRlckV4cGFuc2lvbiA9IGJvcmRlcldpZHRoT3V0U2l6ZSAqIHNpZ24oYV9jaXJjbGVSYWRpdXMpOwogICBpZihpc0NpcmNsZSkgewogICAgIC8vICM3MDQyIEhhZCB0byBzcGxpdCB1cCB0aGlzIGNhbGN1bGF0aW9uIGJlY2F1c2UgdmVjMihhKSArIGIgc2VlbXMgbm90IHRvIHdvcmsgb24KICAgICAvLyBQaXhlbCBDIHRhYmxldAogICAgIGZsb2F0IHNoYXBlRGlhbWV0ZXIgPSAoYV9jaXJjbGVSYWRpdXMgKyBib3JkZXJFeHBhbnNpb24pICogMi4wOwogICAgIHZfc2hhcGVTaXplID0gdmVjMihzaGFwZURpYW1ldGVyKTsKICAgfSBlbHNlIHsKICAgICB2X3NoYXBlU2l6ZSA9IHZlYzIoLWFfdGV4Q29vcmQueiArIGJvcmRlckV4cGFuc2lvbiwgYV90ZXhDb29yZC53IC0gYm9yZGVyRXhwYW5zaW9uKTsKICAgfQogICB2X2JvcmRlcldpZHRoID0gYm9yZGVyV2lkdGggKiBzaWduKGFfd2lkdGgpOwogICAvLyB0aGUgc2l6ZSBvZiBhIHBpeGVsIGluIHNjcmVlbnNwYWNlIGNsaXAgY29vcmRpbmF0ZXMKICAgdl9waXhlbCA9ICgxLjAgLyAoYV9jaXJjbGVSYWRpdXMgKiAyLjApKSAvIHVfem9vbTsKICAgdl9kb251dFNlZ21lbnQgPSB2ZWMyKGFfc3RhcnRBbmdsZSwgYV9lbmRBbmdsZSk7Cn0=",ju="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2U7CnVuaWZvcm0gZmxvYXQgdV9nbG9iYWxBbHBoYTsKdW5pZm9ybSB2ZWM0IHVfYmFja2dyb3VuZENvbG91cjsKCi8vIHRoZSB0ZXhDb29yZHMgcGFzc2VkIGluIGZyb20gdGhlIHZlcnRleCBzaGFkZXIuCnZhcnlpbmcgdmVjMiB2X3RleENvb3JkOwoKdm9pZCBtYWluKCkgewogIGdsX0ZyYWdDb2xvciA9ICh0ZXh0dXJlMkQodV9pbWFnZSwgdl90ZXhDb29yZCkgKyB1X2JhY2tncm91bmRDb2xvdXIpICogdV9nbG9iYWxBbHBoYTsKfQo=",Qu="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjMiBhX3RleENvb3JkOwoKdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgIGdsX1Bvc2l0aW9uID0gdmVjNChhX3Bvc2l0aW9uLCAwLjAsMS4wKTsKICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7Cn0K",qu={}
;qu["line-arc-vertex"]=Ou;qu["line-fragment"]=_u;qu["line-vertex"]=Ku;qu["triangle-fragment"]=Pu;qu["triangle-vertex"]=Ju;qu["renderToTexture-fragment"]=ju;qu["renderToTexture-vertex"]=Qu;function $u(e,t){for(var n=["webgl","experimental-webgl"],r=null,i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(e){}if(r)break}return r}function es(e,t,n){var r=is(e,[t,n]);r.vertexShader=t;r.fragmentShader=n;return r}function ts(e,t){e.useProgram(t);e.bindBuffer(e.ARRAY_BUFFER,null);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)}function ns(){var e={},t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=1;e.zoom=function(e){n=e;t[0]*=e;t[4]*=e;t[8]*=1;t[1]*=e;t[5]*=e;t[9]*=1;t[2]*=e;t[6]*=e;t[10]*=1;t[3]*=e;t[7]*=e;t[11]*=1};e.getZoomLevel=function(){return n};e.pan=function(e,n){t[12]+=t[0]*e+t[4]*n;t[13]+=t[1]*e+t[5]*n;t[14]+=t[2]*e+t[6]*n;t[15]+=t[3]*e+t[7]*n};e.get=function(){return t};return e}function rs(e,t,n){var r=e.createShader(n),i=atob(qu[t]);e.shaderSource(r,i);e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(r);e.deleteShader(r);throw new Error("Error in shader: "+a)}return r}var is=function(e,t){for(var n=e.createProgram(),r=0;r<t.length;++r)e.attachShader(n,t[r]);e.linkProgram(n);if(!e.getProgramParameter(n,e.LINK_STATUS)){var i=e.getProgramInfoLog(n);e.deleteProgram(n);throw new Error("Error in program linking:"+i)}return n};function as(e){var t,n=e,r=10*Float32Array.BYTES_PER_ELEMENT,i={};if(!n.lineShader){var a=rs(n,"line-vertex",n.VERTEX_SHADER),o=rs(n,"line-fragment",n.FRAGMENT_SHADER);t=es(n,a,o);n.lineShader={vertexShader:a,fragmentShader:o,program:t}}t=n.lineShader.program;n.getExtension("OES_standard_derivatives");n.getExtension("OES_element_index_uint");var l={position1:n.getAttribLocation(t,"a_position1"),position2:n.getAttribLocation(t,"a_position2"),position3:n.getAttribLocation(t,"a_position3"),colour:n.getAttribLocation(t,"a_colour"),colour2:n.getAttribLocation(t,"a_colour2"),vertexInfo:n.getAttribLocation(t,"a_vertexInfo"),shadowColour:n.getAttribLocation(t,"a_hitTestColour"),index:n.getAttribLocation(t,"a_index")},u={hitTest:n.getUniformLocation(t,"u_hitTest"),zoom:n.getUniformLocation(t,"u_zoom"),transform:n.getUniformLocation(t,"u_transform"),resolution:n.getUniformLocation(t,"u_resolution"),shadowType:n.getUniformLocation(t,"u_shadowType"),viewIndependent:n.getUniformLocation(t,"u_viewIndependent"),gradientStartFraction:n.getUniformLocation(t,"u_gradientStartFraction")};i.finish=function(){ts(n,t)};i.drawItems=function(e,r,i,a,o,l,u,v){n.useProgram(t);h();s(i,a,o,l,u,0|e.shadowType,e.useView,v);c(r);d(e,r);f(r);g(r);h()};function s(e,t,r,i,a,o,l,s){n.uniform3f(u.resolution,t,r,i);n.uniformMatrix4fv(u.transform,!1,e.get());n.uniform1f(u.hitTest,0|a);n.uniform1f(u.zoom,e.getZoomLevel());n.uniform1f(u.shadowType,o);n.uniform1f(u.viewIndependent,0|!l);var c=0;a||(c=(1-s.linkStyle.transition)/2);n.uniform1f(u.gradientStartFraction,c)}function c(e){e.elementBuffer||(e.elementBuffer=n.createBuffer());e.indexBuffer||(e.indexBuffer=n.createBuffer())}function f(e){n.bindBuffer(n.ARRAY_BUFFER,e.elementBuffer);n.enableVertexAttribArray(l.position1);n.enableVertexAttribArray(l.position2);n.enableVertexAttribArray(l.position3);n.enableVertexAttribArray(l.vertexInfo);n.enableVertexAttribArray(l.colour);n.enableVertexAttribArray(l.colour2);n.enableVertexAttribArray(l.shadowColour);n.enableVertexAttribArray(l.index);n.vertexAttribPointer(l.position1,2,n.FLOAT,!1,r,0);n.vertexAttribPointer(l.position2,2,n.FLOAT,!1,r,8);n.vertexAttribPointer(l.position3,2,n.FLOAT,!1,r,16);n.vertexAttribPointer(l.vertexInfo,4,n.UNSIGNED_BYTE,!1,r,24);n.vertexAttribPointer(l.colour,4,n.UNSIGNED_BYTE,!1,r,28);n.vertexAttribPointer(l.colour2,4,n.UNSIGNED_BYTE,!1,r,32);n.vertexAttribPointer(l.shadowColour,3,n.UNSIGNED_BYTE,!1,r,36);n.vertexAttribPointer(l.index,1,n.UNSIGNED_BYTE,!1,r,39)}function d(e,t){if(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.positions||e.rebuildOptions.colours||e.rebuildOptions.textures||e.rebuildOptions.shadow){n.bindBuffer(n.ARRAY_BUFFER,t.elementBuffer);n.bufferData(n.ARRAY_BUFFER,t.elementData,n.DYNAMIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,null);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.elementIndex,n.DYNAMIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}}function g(e){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.indexBuffer);n.drawElements(n.TRIANGLES,6*e.numOfLines+3*e.numOfArrowheads,n.UNSIGNED_INT,0)}function h(){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null);n.bindBuffer(n.ARRAY_BUFFER,null)}return i}var os=6*Float32Array.BYTES_PER_ELEMENT,ls=3*Float32Array.BYTES_PER_ELEMENT,us=4*Uint8Array.BYTES_PER_ELEMENT,ss=8*Uint8Array.BYTES_PER_ELEMENT;function cs(e){var t,n={},r=e;if(!r.arcShader){var i=rs(r,"line-arc-vertex",r.VERTEX_SHADER),a=rs(r,"line-fragment",r.FRAGMENT_SHADER);t=es(r,i,a);r.arcShader={vertexShader:i,fragmentShader:a,program:t}}t=r.arcShader.program;var o={position:r.getAttribLocation(t,"a_position"),radius:r.getAttribLocation(t,"a_radius"),startAngle:r.getAttribLocation(t,"a_startAngle"),endAngle:r.getAttribLocation(t,"a_endAngle"),width:r.getAttribLocation(t,"a_width"),colour:r.getAttribLocation(t,"a_colour"),colour2:r.getAttribLocation(t,"a_colour2"),core:r.getAttribLocation(t,"a_core"),type:r.getAttribLocation(t,"a_lineType"),shadowColour:r.getAttribLocation(t,"a_hitTestColour")},l={hitTest:r.getUniformLocation(t,"u_hitTest"),zoom:r.getUniformLocation(t,"u_zoom"),transform:r.getUniformLocation(t,"u_transform"),resolution:r.getUniformLocation(t,"u_resolution"),shadowType:r.getUniformLocation(t,"u_shadowType"),gradientStartFraction:r.getUniformLocation(t,"u_gradientStartFraction")};n.finish=function(){ts(r,t)};n.drawItems=function(e,n,i,a,o,l,v){r.useProgram(t);u(n,i,a,o,l,0|e.shadowType,v);s(e);c(e);f(e);g(e);d(e);r.drawArrays(r.TRIANGLES,0,e.arcBuffers.totalnumOfVertices);h()};function u(e,t,n,i,a,o,u){r.uniform3f(l.resolution,t,n,i);r.uniformMatrix4fv(l.transform,!1,e.get());r.uniform1f(l.hitTest,0|a);r.uniform1f(l.zoom,e.getZoomLevel());r.uniform1f(l.shadowType,o);var s=0;a||(s=(1-u.linkStyle.transition)/2);r.uniform1f(l.gradientStartFraction,s)}function s(e){e.arcBuffers.positionBuffer||(e.arcBuffers.positionBuffer=r.createBuffer());e.arcBuffers.colourBuffer||(e.arcBuffers.colourBuffer=r.createBuffer());e.arcBuffers.shadowBuffer||(e.arcBuffers.shadowBuffer=r.createBuffer());e.arcBuffers.coreBuffer||(e.arcBuffers.coreBuffer=r.createBuffer())}function c(e){r.bindBuffer(r.ARRAY_BUFFER,e.arcBuffers.colourBuffer);(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&r.bufferData(r.ARRAY_BUFFER,e.arcBuffers.colourData,r.STATIC_DRAW);r.enableVertexAttribArray(o.colour);r.enableVertexAttribArray(o.colour2);r.vertexAttribPointer(o.colour,4,r.UNSIGNED_BYTE,!1,ss,0);r.vertexAttribPointer(o.colour2,4,r.UNSIGNED_BYTE,!1,ss,4)}function f(e){r.bindBuffer(r.ARRAY_BUFFER,e.arcBuffers.shadowBuffer);(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&r.bufferData(r.ARRAY_BUFFER,e.arcBuffers.shadowData,r.STATIC_DRAW);r.enableVertexAttribArray(o.shadowColour);r.enableVertexAttribArray(o.type);r.vertexAttribPointer(o.shadowColour,3,r.UNSIGNED_BYTE,!1,us,0);r.vertexAttribPointer(o.type,1,r.UNSIGNED_BYTE,!1,us,3)}function d(e){r.bindBuffer(r.ARRAY_BUFFER,e.arcBuffers.coreBuffer);(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&r.bufferData(r.ARRAY_BUFFER,e.arcBuffers.coreData,r.STATIC_DRAW);r.enableVertexAttribArray(o.core);r.vertexAttribPointer(o.core,3,r.FLOAT,!1,ls,0)}function g(e){r.bindBuffer(r.ARRAY_BUFFER,e.arcBuffers.positionBuffer);(e.rebuildOptions.positions||e.alwaysUpdate||e.rebuildOptions.all)&&r.bufferData(r.ARRAY_BUFFER,e.arcBuffers.positionData,r.STATIC_DRAW);r.enableVertexAttribArray(o.position);r.enableVertexAttribArray(o.radius);r.enableVertexAttribArray(o.startAngle);r.enableVertexAttribArray(o.endAngle);r.enableVertexAttribArray(o.width);r.vertexAttribPointer(o.position,2,r.FLOAT,!1,os,0);r.vertexAttribPointer(o.radius,1,r.FLOAT,!1,os,8);r.vertexAttribPointer(o.startAngle,1,r.FLOAT,!1,os,12);r.vertexAttribPointer(o.endAngle,1,r.FLOAT,!1,os,16);r.vertexAttribPointer(o.width,1,r.FLOAT,!1,os,20)}function h(){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null);r.bindBuffer(r.ARRAY_BUFFER,null)}return n}function fs(e){var t,n={},r=e,i=3*Float32Array.BYTES_PER_ELEMENT,a=9*Float32Array.BYTES_PER_ELEMENT,o=4*Uint8Array.BYTES_PER_ELEMENT,l=4*Uint8Array.BYTES_PER_ELEMENT;if(!r.triangleShader){var u=rs(r,"triangle-vertex",r.VERTEX_SHADER),s=rs(r,"triangle-fragment",r.FRAGMENT_SHADER);t=es(r,u,s);r.triangleShader={vertexShader:u,fragmentShader:s,program:t}}t=r.triangleShader.program;var c={transform:r.getUniformLocation(t,"u_transform"),textures:r.getUniformLocation(t,"u_image[0]"),resolution:r.getUniformLocation(t,"u_resolution"),hitTest:r.getUniformLocation(t,"u_hitTest"),shadowType:r.getUniformLocation(t,"u_shadowType"),zoom:r.getUniformLocation(t,"u_zoom"),position:r.getAttribLocation(t,"a_position"),startAngle:r.getAttribLocation(t,"a_startAngle"),endAngle:r.getAttribLocation(t,"a_endAngle"),circleRadius:r.getAttribLocation(t,"a_circleRadius"),width:r.getAttribLocation(t,"a_width"),colour:r.getAttribLocation(t,"a_colour"),textCoord:r.getAttribLocation(t,"a_texCoord"),shadowColour:r.getAttribLocation(t,"a_hitTestColour"),textureBank:r.getAttribLocation(t,"a_textureBank")};n.drawItems=function(e,n,i,a,o,l,u,s,c){r.useProgram(t);b(n,l,u,s,c,0|e.shadowType);p(e);d(e);g(e);h(e);v(e);f(i,a,o);r.drawArrays(r.TRIANGLES,0,3*e.triangleBuffers.numOfTriangles)};n.finish=function(){ts(r,t)};function f(e,t,n){var r,i;for(r=0,i=e.atlases.length;r<i;r++)m(e.atlases[r],r);t&&m(t,3);for(r=0,i=n.length;r<i;r++)m(n[r],r+4)}function d(e){r.bindBuffer(r.ARRAY_BUFFER,e.triangleBuffers.shadowBuffer);(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&r.bufferData(r.ARRAY_BUFFER,e.triangleBuffers.shadowData,r.STATIC_DRAW);r.enableVertexAttribArray(c.shadowColour);r.vertexAttribPointer(c.shadowColour,4,r.UNSIGNED_BYTE,!1,l,0)}function g(e){r.bindBuffer(r.ARRAY_BUFFER,e.triangleBuffers.textureBuffer);(e.rebuildOptions.textures||e.alwaysUpdate||e.rebuildOptions.all)&&r.bufferData(r.ARRAY_BUFFER,e.triangleBuffers.textureData,r.STATIC_DRAW);r.enableVertexAttribArray(c.textCoord);r.enableVertexAttribArray(c.textureBank);r.enableVertexAttribArray(c.circleRadius);r.enableVertexAttribArray(c.startAngle);r.enableVertexAttribArray(c.endAngle);r.vertexAttribPointer(c.textCoord,4,r.FLOAT,!1,a,0);r.vertexAttribPointer(c.textureBank,2,r.FLOAT,!1,a,16);r.vertexAttribPointer(c.circleRadius,1,r.FLOAT,!1,a,24);r.vertexAttribPointer(c.startAngle,1,r.FLOAT,!1,a,28);r.vertexAttribPointer(c.endAngle,1,r.FLOAT,!1,a,32)}function h(e){r.bindBuffer(r.ARRAY_BUFFER,e.triangleBuffers.colourBuffer);(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&r.bufferData(r.ARRAY_BUFFER,e.triangleBuffers.colourData,r.STATIC_DRAW);r.enableVertexAttribArray(c.colour);r.vertexAttribPointer(c.colour,4,r.UNSIGNED_BYTE,!1,o,0)}function v(e){r.bindBuffer(r.ARRAY_BUFFER,e.triangleBuffers.positionBuffer);(e.rebuildOptions.positions||e.rebuildOptions.all||e.alwaysUpdate)&&r.bufferData(r.ARRAY_BUFFER,e.triangleBuffers.positionData,r.STATIC_DRAW);r.enableVertexAttribArray(c.position);r.enableVertexAttribArray(c.width);r.vertexAttribPointer(c.position,2,r.FLOAT,!1,i,0);r.vertexAttribPointer(c.width,1,r.FLOAT,!1,i,8)}function m(e,t){r.activeTexture(r["TEXTURE"+t]);if(e.texture)r.bindTexture(r.TEXTURE_2D,e.texture);else{e.texture=r.createTexture();var n=e.alphaChannel?r.RGBA:r.RGB;r.bindTexture(r.TEXTURE_2D,e.texture);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);r.texImage2D(r.TEXTURE_2D,0,n,n,r.UNSIGNED_BYTE,e.img);r.generateMipmap(r.TEXTURE_2D);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);e.img=null}}function p(e){e.triangleBuffers.positionBuffer||(e.triangleBuffers.positionBuffer=r.createBuffer());e.triangleBuffers.textureBuffer||(e.triangleBuffers.textureBuffer=r.createBuffer());e.triangleBuffers.colourBuffer||(e.triangleBuffers.colourBuffer=r.createBuffer());e.triangleBuffers.shadowBuffer||(e.triangleBuffers.shadowBuffer=r.createBuffer())}function b(e,t,n,i,a,o){r.uniform3f(c.resolution,t,n,i);r.uniform1f(c.hitTest,0|a);r.uniform1iv(c.textures,[0,1,2,3,4,5,6,7]);r.uniformMatrix4fv(c.transform,!1,e.get());r.uniform1f(c.shadowType,o);r.uniform1f(c.zoom,e.getZoomLevel())}return n}function ds(e){var t,n={},r=e;if(!r.rttShader){var i=rs(r,"renderToTexture-vertex",r.VERTEX_SHADER),a=rs(r,"renderToTexture-fragment",r.FRAGMENT_SHADER);t=es(r,i,a);r.rttShader={vertexShader:i,fragmentShader:a,program:t}}t=r.rttShader.program;var o=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]),l=r.createBuffer(),u={position:r.getAttribLocation(t,"a_position"),textCoord:r.getAttribLocation(t,"a_texCoord")},s={globalAlpha:r.getUniformLocation(t,"u_globalAlpha"),backgroundColour:r.getUniformLocation(t,"u_backgroundColour"),textures:r.getUniformLocation(t,"u_image")};n.finish=function(){ts(r,t)};n.drawItems=function(e,n,i,a){r.useProgram(t);d(e,i);c(a||o);f(n,0);r.drawArrays(r.TRIANGLES,0,6)};function c(e){r.bindBuffer(r.ARRAY_BUFFER,l);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.enableVertexAttribArray(u.position);r.enableVertexAttribArray(u.textCoord);r.vertexAttribPointer(u.position,2,r.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0);r.vertexAttribPointer(u.textCoord,2,r.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,8)}function f(e,t){r.activeTexture(r["TEXTURE"+t]);r.bindTexture(r.TEXTURE_2D,e)}function d(e,t){r.uniform1f(s.globalAlpha,e);r.uniform4fv(s.backgroundColour,new Float32Array(t||[0,0,0,0]))}return n}function gs(e){var t,n,r,i,a,o={},l=e.canvas,u=e.framebuffers,s=y(),c=as(s),f=cs(s),d=fs(s),g=ds(s),h=null;o.finish=function(){o.clearFramebuffers();f.finish();c.finish();d.finish();e.imageAtlases.forEach(function(e){k(e)});k(e.textAtlas);k(e.fontIconAtlas);e.layersToDraw=[];e.allLayers={};s.flush();s.finish();s=null;c=null;f=null;d=null;g=null};o.clearView=function(e){e&&(s=y());C();s.clear(s.COLOR_BUFFER_BIT)};o.clearFramebuffers=function(){E(e.framebuffers).forEach(function(e){s.deleteFramebuffer(e.framebuffer);s.deleteRenderbuffer(e.renderbuffer);s.deleteTexture(e.texture)});e.framebuffers={};u=e.framebuffers};o.clearTextureAtlas=function(e){e&&(Array.isArray(e)?e.forEach(k):k(e))};o.render=function(t,u,c,f,d,g){n=l.clientWidth;r=l.clientHeight;var h=l.width/n;i=s.drawingBufferWidth;a=s.drawingBufferHeight;var m=e.layersToDraw,p=G(t);e.view=t;if(g.showShadowCanvas)return o.drawShadowCanvas(0,0,!0);for(var y=!1,I=0,C=m.length;I<C;I++){var Z=m[I];if(g.overview&&g.overview.shown&&Z.blatOverview&&u)v(u,c,f,d,g);else{if(V(Z)){Z.drawFramebuffer&&(y=!0);b(Z.drawFramebuffer);w(Z,p,n,r,h,c,f,d,g.showShadowCanvas,g);W(Z)}if(Z.drawBackgroundColour||Z.useFramebuffer&&y){y=!1;M();x(Z.useFramebuffer,Z.fbAlpha,Z.drawBackgroundColour);b(Z.useFramebuffer);s.clear(s.COLOR_BUFFER_BIT)}}}S()};o.drawShadowCanvas=function(o,u,c){n=l.clientWidth;r=l.clientHeight;var f=l.width/n;i=s.drawingBufferWidth;a=s.drawingBufferHeight;if(e.layersToDraw.length>0){var d=G(e.view),g=i/l.clientWidth,h=o*g,v=a-u*g;c?M():b("shadow");for(var m=0,p=e.layersToDraw.length;m<p;m++){w(e.layersToDraw[m],d,n,r,f,e.textAtlas,e.fontIconAtlas,e.imageAtlases,!0)}!c&&h>=0&&v>=0&&h<i&&v<a&&s.readPixels(h,v,1,1,s.RGBA,s.UNSIGNED_BYTE,t)}return t};o.getPixels=function(e,t,n,r,i,a){M();s.clearColor(1,1,1,1);o.clearView();o.render(e,t,n,r,i,a);var l=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,l);return l};function v(t,i,a,o,u){n=l.clientWidth;var c=l.width/n,f=t.width(),d=t.height(),g=G(t);b("overview",f*c,d*c);s.clear(s.COLOR_BUFFER_BIT);for(var h=e.layersToDraw,v=0,m=h.length;v<m;v++){var p=h[v];p.overview&&w(p,g,f,d,c,i,a,o,u.showShadowCanvas,u)}b(null);var y=I(f,d,n,r,u);x("overview",1,[1,1,1,1],y);x("overview",1,null,y)}function m(){var e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST);return e}function p(e){e?s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer):M()}function b(e,t,n){var r=u[e]||null,i=s.RGBA,a=t||s.drawingBufferWidth,o=n||s.drawingBufferHeight;s.viewport(0,0,a,o);if(e&&!r){r={framebuffer:s.createFramebuffer(),renderbuffer:s.createRenderbuffer(),texture:m()};u[e]=r;"shadow"===e&&(i=s.RGB);s.texImage2D(s.TEXTURE_2D,0,i,a,o,0,i,s.UNSIGNED_BYTE,null);s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer);s.bindRenderbuffer(s.RENDERBUFFER,r.renderbuffer);s.clearColor(0,0,0,0);s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,a,o);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r.texture,0);s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,r.renderbuffer);var l=s.checkFramebufferStatus(s.FRAMEBUFFER);if(s.FRAMEBUFFER_COMPLETE!==l)throw new Error(l.toString())}p(r)}function y(){s=$u(l,{antialias:!1,preferLowPowerToHighPerformance:!1,depth:!1,stencil:!1});n=l.width;r=l.height;i=s.drawingBufferWidth;a=s.drawingBufferHeight;s.getExtension("OES_standard_derivatives");s.getExtension("OES_element_index_uint");s.viewport(0,0,i,a);s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA);s.enable(s.BLEND);s.clearColor(0,0,0,0);e.framebuffers={};u=e.framebuffers;t=new Uint8Array(4);return s}function I(e,t,n,r,i){var a,o=1-e/n*2,l=1-t/r*2;switch(i.overview.p){case"ne":a=new Float32Array([o,l,0,0,1,l,1,0,o,1,0,1,o,1,0,1,1,l,1,0,1,1,1,1]);break;case"nw":a=new Float32Array([-1,l,0,0,-o,l,1,0,-1,1,0,1,-1,1,0,1,-o,l,1,0,-o,1,1,1]);break;case"sw":a=new Float32Array([-1,-1,0,0,-o,-1,1,0,-1,-l,0,1,-1,-l,0,1,-o,-1,1,0,-o,-l,1,1]);break;case"se":default:a=new Float32Array([o,-1,0,0,1,-1,1,0,o,-l,0,1,o,-l,0,1,1,-1,1,0,1,-l,1,1])}return a}function x(e,t,n,r){var i;u[e]&&(i=u[e].texture);g.drawItems(t,i,n,r)}function C(){s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight)}function G(e){return e?{panX:e.offsetXtoWebglPanX(),panY:e.offsetYtoWebglPanY(),zoom:e.settings().zoom}:{panX:0,panY:0,zoom:1}}function w(e,t,n,r,i,a,o,l,u,s){Z(e.useView,t.panX,t.panY,t.zoom);A(c,e,e.lineBuffers,h,n,r,i,u,s);B(f,e,h,n,r,i,u,s);R(d,e,h,a,o,l,n,r,i,u)}function Z(e,t,n,r){h=ns();if(e){h.pan(t,n);h.zoom(r)}else{h.pan(0,0);h.zoom(1)}}function A(e,t,n,r,i,a,o,l,u){n.numOfLines>0&&e.drawItems(t,n,r,i,a,o,l,u)}function B(e,t,n,r,i,a,o,l){t.arcBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o,l)}function R(e,t,n,r,i,a,o,l,u,s){t.triangleBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o,l,u,s)}function M(){s.bindFramebuffer(s.FRAMEBUFFER,null)}function W(e){e.rebuildOptions.colours=!1;e.rebuildOptions.positions=!1;e.rebuildOptions.textures=!1;e.rebuildOptions.shadow=!1;e.rebuildOptions.all=!1}function V(e){return e.lineBuffers.numOfLines||e.arcBuffers.numOfTriangles||e.triangleBuffers.numOfTriangles||e.drawBackgroundColour}function S(){for(var e=0;e<8;e++){s.activeTexture(s["TEXTURE"+e]);s.bindTexture(s.TEXTURE_2D,null)}}function k(e){if(e&&e.texture){s.deleteTexture(e.texture);e.texture=null;e.ctx=null;e.img=null}}return o}function hs(e,t){for(var n="abcdefghijklmnopqrstuvwzyzABCDEFGHIJKLMNOPQRSTUVWXWZ$£1234567890()",r=new Map,i=function(){return Object.keys(u).filter(function(e){return!r.get(e)})},a=function(){return Object.keys(u).filter(function(e){return r.get(e)})},o={},l=function(e){o=e},u={},s=0,c=n.length;s<c;s++)u[n[s]]=!0;var f=function(e,t){for(var n=!1,i=!1,a=0,o=e.length;a<o;a++){var l=e[a];r.get(l)?n=!0:i=!0;u[l]||(u[l]=!0)}n&&(t.imageAtlas=!0);i&&(t.textAtlas=!0)};return{getNonEmojiGlyphs:i,getEmojiGlyphs:a,setEmojiGlyphImages:l,getGlyphsFromText:function(n,i,a,l,u,s,c){var d,g=t.getCombinedCharacters(n);s&&(g=e.analyseText(g,n).result);var h,v,m,p=!1,b={},y=[],I=c.getGlyphInfoForFont(i||a),x=0;if(l)for(h=0,v=g.length;h<v;h++){d=g[h].text||g[h];r.has(d)||r.set(d,ce(d));if(r.get(d))m=o[d];else{m=I[d+"B"]}if(m)y[x++]=m;else{b[d]=!0;p=!0}}else for(h=0,v=g.length;h<v;h++){d=g[h].text||g[h];r.has(d)||r.set(d,ce(d));if(m=r.get(d)?o[d]:I[d])y[x++]=m;else{b[d]=!0;p=!0}}p&&f(Object.keys(b),u);return y}}}function vs(){var e={},t=new Map;e.getCombinedCharacters=function(e){var n=t.get(e);if(!n){n=de(fe(e));t.set(e,n)}return n};return e}function ms(e){var t={},n=vs(),r={bidi:Ct,canvas:e,layersToDraw:[],textAtlas:null,fontIconAtlas:null,imageAtlases:[],allLayers:{},framebuffers:{},alpha:{},characterCache:n},i=hs(Ct,n),a=Du(r,i),o=gs(r);t.setAlpha=function(e,t){r.alpha.ghost=e;r.alpha.background=t};t.clearView=function(e){o.clearView(e)};t.shutdownAndReset=function(){o.finish();n=vs();r={bidi:Ct,canvas:e,layersToDraw:[],textAtlas:null,fontIconAtlas:null,imageAtlases:[],allLayers:{},framebuffers:{},alpha:{},characterCache:n};i=hs(Ct,n);a=Du(r,i);o=gs(r)};t.clearFramebuffers=function(){o.clearFramebuffers()};t.updateTextures=function(e){a.updateImageTextures(e,o)};t.build=function(e,t,n,i){var l,u=n.all||n.positions;if(n.all){l=[];r.layersToDraw.length=0}else l=r.layersToDraw;var s={},c=null;function f(e,t){if(n.all){if(t.bg&&s&&!e.bg){s.useFramebuffer=c;c=null}s={id:e.path,blatOverview:e.blatOverview,shadowType:e.shadowType,overview:e.overview,useView:e.useView,alwaysUpdate:e.alwaysUpdate,bg:e.bg,fbAlpha:i.backgroundAlpha,primitives:[],numOfPrimitives:0};if(e.bg){t.bg&&(c="bg");s.drawFramebuffer=c}l.push(s)}else(s=r.allLayers[e.path]).numOfPrimitives=0}function d(e){s.primitives[s.numOfPrimitives++]=e}e.forEach(d,f,!u);if(c){s.useFramebuffer=c;c=null}a.generate(l,t,n,i,o)};t.draw=function(e,t,n){o.render(e,t,r.textAtlas,r.fontIconAtlas,r.imageAtlases,n)};t.getPixels=function(e,t,n){return o.getPixels(e,t,r.textAtlas,r.fontIconAtlas,r.imageAtlases,n)};t.drawShadowCanvas=function(e,t){return o.drawShadowCanvas(e,t)};return t}var ps=8888;function bs(e,i,a,o,l,u,s){var f=document.getElementById(i),d=r(f);function g(e,t,n){var r,i=document.createElement("canvas");if(n&&d){i.dir="rtl";document.body.appendChild(i);i.style.display="none"}r=s?document.createElement("canvas").getContext("2d"):i.getContext("2d");i.context2d=r;i.height=t;i.width=e;s||m(i);return i}function h(e,t){var r=n(),i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,a=r/i;if(r!==i){var o=e.width,l=e.height;e.width=Math.round(o*a);e.height=Math.round(l*a);e.style.width=o+"px";e.style.height=l+"px";s||t.scale(a,a)}}function v(){if(!gn){for(var e="Hello",t=g(100,100).context2d,n=!1,r=function(n){vn(t,n);return t.measureText(e).width},i=r(1),a=2;!n&&a<30;){(n=i!==r(a))&&dn(a-1);a++}hn(!0)}}function m(e){var t=e.getContext("2d");function n(e){t.setLineDash=function(n){t[e]=n}}t.setLineDash||(void 0!==t.webkitLineDash?n("webkitLineDash"):void 0!==t.mozDash&&n("mozDash"))}function p(){return document.createElement("img")}var b=g(a,o,!0);b.style.display="block";var y={},I=b.context2d;f.style.display="block";f.parentNode.replaceChild(b,f);b.setAttribute("id",i);if(s&&Il()&&"chart"===e){b.renderer=ms(b);y.renderer=b.renderer;b.webgl=!0}b.canvas=!0;var x=b;if(b.webgl){I.webgl=!0;I.webglCanvas=b}else I.webgl=!1;h(b,I);v();var C=x.getAttribute("style")||"";C+="-ms-touch-action: none; touch-action: none; outline: none;";x.setAttribute("style",C);x.setAttribute("tabindex",""+ps++);var G="chart"===e?hl(i):Ol(i);t(G,function(e,t){-1===t.indexOf("private")&&(y[t]=e)});G.privateInit(I,a,o,g,function(e){document.getElementById(i).style.cursor=e},p,l,u);y.internalSetSize=function(e,t){G.privateMapSetSize&&G.privateMapSetSize(e,t);x.width=e;x.height=t;h(x,I);G.privateSetSize(I,e,t,!0)};var w=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){c(e,1e3/60)};function Z(){G.update();w(Z)}w(Z);return y}var ys={},Is=0,xs={},Cs=!1;try{var Gs=Object.defineProperty({},"passive",{get:function(){Cs=!0}});window.addEventListener("test",Gs,Gs);window.removeEventListener("test",Gs,Gs)}catch(e){Cs=!1}var ws="";"undefined"!=typeof document&&Ws();var Zs={};function As(e,t,n,r){var i=r||!1;Cs?e.addEventListener(t,n,{capture:i,passive:!1}):e.addEventListener(t,n,i)}function Bs(e,t){for(var n=0;n<e.length;n++)As(document,e[n],t)}function Rs(e,t){for(var n=[],r=0;r<e[t].length;r++){var i=ne(e[t][r]);n.push({id:e[t][r].identifier,x:i.x,y:i.y})}return n}function Ms(e){e.stopPropagation&&e.stopPropagation();e.preventDefault?e.preventDefault():e.returnValue=!1;e.preventCapture&&e.preventCapture();e.preventBubble&&e.preventBubble()}function Ws(){As(document,"contextmenu",function(e){if(e.target.id in Zs){Ms(e);return!1}});As(document,"dragover",function(e){if(e.target.id in Zs){var t=ne(e);Zs[e.target.id].dragover(t.x,t.y)}});function e(e,t){As(document,e,function(n){if(n.target.id in Zs){Zs[n.target.id][e](Rs(n,"targetTouches"),Rs(n,"changedTouches"));t&&n.preventDefault()}})}function n(e){As(document,e,function(e){e.target.id in Zs&&e.preventDefault()})}function r(e){As(document,e,function(t){if(t.target.id in Zs){Zs[t.target.id][e](t.scale,t.rotation);t.preventDefault()}})}if("ontouchstart"in document.documentElement)if(window.PointerEvent){n("touchstart");n("touchmove");n("touchend");n("touchcancel")}else{e("touchstart",!0);e("touchmove");e("touchend");e("touchcancel");r("gesturestart");r("gesturechange");r("gestureend")}function i(e,t){var n=e.pointerId||0,r=ne(e);switch(t){case"ADD":ys[n]||(ys[n]={id:n,x:r.x,y:r.y});break;case"DEL":if(ys[n]){delete ys[n];Is--}break;case"MOVE":ys[n]&&(ys[n]={id:n,x:r.x,y:r.y})}return E(ys)}function a(e,t){var n=e.pointerId||0,r=ne(e),i=[];switch(t){case"ADD":case"MOVE":i=[{id:n,x:r.x,y:r.y}];break;case"DEL":i=[ys[n]]}return i}function o(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function l(e){xs[e]=new MSGesture;xs[e].target=document.getElementById(e)}function u(){s=1;c=0}var s=1,c=0;function f(e,t){return function(n){if(n.target.id in Zs&&o(n)){var r=a(n,t);Zs[n.target.id][e](i(n,t),r);n.preventDefault()}}}function d(e){function n(n){if(o(n)){var r="DEL";t(Zs,function(t){var o=a(n,r);t[e](i(n,r),o);var l=n.target.id;l&&Zs[l]&&n.preventDefault()})}}return n}if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){As(document,"pointerdown",function(e){if(e.target.id in Zs&&o(e)){if("undefined"!=typeof MSGesture){xs[e.target.id]||l(e.target.id);xs[e.target.id].addPointer(e.pointerId)}Is++;var t=a(e,"ADD");Zs[e.target.id].touchstart(i(e,"ADD"),t)}});As(document,["pointermove"],f("touchmove","MOVE"));As(document,["pointerup"],d("touchend"));As(document,["pointercancel"],d("touchcancel"));As(document,"MSHoldVisual",function(e){e.preventDefault()});As(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id;if(t in Zs&&Is>1){Zs[t].gesturestart();e.preventDefault()}});As(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=Is>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;if(t in Zs&&n){s*=e.scale;c+=e.rotation*(180/Math.PI);Zs[t].gesturechange(s,c);e.preventDefault()}});As(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;if(t in Zs){Zs[t].gestureend(s,c);u();e.preventDefault()}})}As(window,"dblclick",function(e){if(e.target.id in Zs){if(!((navigator.msMaxTouchPoints||navigator.maxTouchPoints)&&("touch"===e.pointerType||"pen"===e.pointerType))){var t=ne(e);Zs[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey);e.preventDefault()}}});As(window,"mousedown",function(e){if(e.target.id in Zs&&0===Is){var t=ne(e);Zs[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}});As(window,"mouseup",function(e){if(e.target.id in Zs){var t=ne(e);Zs[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}if(h){v(e.target.id,h.target.id,"mouseup",h);h=null}});As(window,"mouseout",function(e){e.target.id in Zs&&(h=e)});var g=null,h=null;function v(e,t,n,r){if(e!==t){if(null!==t&&Zs[t]&&document.getElementById(t)){var i=re(r,t);Zs[t][n](i.x,i.y,r.ctrlKey,r.shiftKey)}"mouseleave"===n&&(g=e)}}As(window,"mousemove",function(e){if(e.target.id in Zs){v(e.target.id,g,"mouseleave",e);var t=ne(e);Zs[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}else v(null,g,"mouseleave",e)});function m(e){var t=e.wheelDelta||-e.detail;if(0!==t){var n=Zs[e.target.id];if(n){var r=ne(e);n.mousewheel(t,r.x,r.y);Ms(e)}}}Bs(["wheel","mousewheel","DOMMouseScroll"],m);As(document,"MozMousePixelScroll",function(e){Zs[e.target.id]&&Ms(e)});As(document,"keyup",function(e){e.target.id in Zs&&Zs[e.target.id].keyup(e.keyCode)});As(document,"keydown",function(e){var t=!1;e.target.id in Zs&&(t=t||Zs[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey));t&&e.preventDefault&&e.preventDefault()})}function Vs(e){e in Zs&&delete Zs[e]}var Ss="auto";function ks(e){e&&(Ss=e);return Ss}function Xs(){var e,t,n,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0];r=arguments[1];var i=document.getElementById(e);if(!i){Es(e,r);return}t=i.clientWidth;n=i.clientHeight;break;default:e=arguments[0];t=Number(arguments[1]);n=Number(arguments[2]);r=arguments[3]}Us("chart",e,t,n,r)}function Es(e,t){x(t,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function Fs(e){return+e.replace(/px$/,"")}function Ys(e,t,n,r){var i=document.getElementById(t);if(i){Us(e,t,i.clientWidth||Fs(i.style.width),i.clientHeight||Fs(i.style.height),n?a:r)}else Es(t,r);function a(e,t){e?x(r,e):t.options(n,function(){r&&r(null,t)})}}var Hs,Ls={chart:0,timebar:0};function zs(e,t){function n(e){
return M(e)||"chart"===e||"timebar"===e}var r=Z(e),i=r.every(function(e){return n(e.type)});r.length<1?x(t,Error("No definition passed to KeyLines.create")):i?a(r,0,[]):x(t,Error("The type of component passed to KeyLines.create is not valid"));function a(e,n,r){function i(e,t){var n=e.id?e.id:Ns(t);e.setAttribute("id",n);return n}function o(e){if(Ts(e.element)&&e.id)throw new Error("Cannot pass a DOM element and an id to create, please pass only one.");if(e.element&&!Ts(e.element))throw new Error("You must pass a DOM element to the components element property.");var t={type:e.type?e.type:"chart",id:e.id||e,options:e.options};if(Ts(e)){t.type="chart";t.id=i(e,t.type)}else Ts(e.element)&&(t.id=i(e.element,t.type));return t}var l;try{l=o(e[n])}catch(e){x(t,e);return}Ys(l.type,l.id,l.options,function(i,o){if(i)x(t,i);else{r.push(o);var l=n+1;if(l>=e.length){var u=1===r.length?r[0]:r;t&&t(null,u)}else a(e,l,r)}})}}function Ts(e){return!(!e&&null!==e&&"object"!=typeof e)&&("object"==typeof HTMLElement&&e instanceof HTMLElement||1===e.nodeType)}function Ns(e){Ls[e]++;var t="KeyLines-"+e+"-"+Ls[e];return Zs[t]||document.getElementById(t)?Ns(e):t}function Us(e,t,n,r,i){Vs(t);var a=n||100,o=r||100;if("canvas"!==Ss&&"chart"===e&&Il())try{Ps(e,t,a,o,!0,i)}catch(n){bl();Ps(e,t,a,o,!1,i)}else if(_s())Ps(e,t,a,o,!1,i);else{i("Could not create HTML5 canvas.")}}function Ds(e){Hs=e}function Os(e){e&&(ws=e);return ws}Ds("assets/");function _s(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}var Ks,Ps=function(e,t,n,r,i,a){try{Zs[t]=bs(e,t,n,r,Hs,ws,i)}catch(e){if(a){a(e);return}}Zs[t].webgl=i;Zs[t].canvas=!0;Zs[t].id=function(){return t};a&&a(null,Zs[t])};function Js(e,t,n){if(!h(t)||!h(n))throw new Error("KeyLines.setSize: Invalid width or height value passed. Both parameters should be numbers.");var r=Math.round(t),i=Math.round(n);if(!(r<=0||i<=0)){var a=Ts(e)?e:document.getElementById(e);if(!a)throw new Error("You must pass a valid id or DOM element.");var o=a.id;a.style.height=i+"px";a.style.width=r+"px";if(Zs[o]){Zs[o].internalSetSize(r,i);Zs[o].webgl&&Zs[o].renderer.clearFramebuffers()}}}function js(e){if(e){e.assets&&Ds(e.assets);e.images&&Os(e.images)}return{assets:Hs,images:ws}}function Qs(){return qs(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function qs(e){for(var t=B,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}"undefined"!=typeof document&&Bs(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],rc);function $s(e){var t=B;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:!!t(document.msFullscreenElement)&&document.msFullscreenElement===e}function ec(){var e=B;return!!e(document.webkitCurrentFullScreenElement)||(!!e(document.mozFullScreenElement)||!!e(document.msFullscreenEnabled)&&document.msFullscreenEnabled)}function tc(e,t){for(var n,r=0;!n&&r<t.length;r++)if(e[t[r]]){n=!0;e[t[r]]()}}function nc(e){tc(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function rc(){Ks&&Ks(Qs())}function ic(e,t){Ks=t;Qs()&&$s(e)?tc(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):nc(e)}function ac(){if(_s()){var e=document.createElement("canvas").getContext("2d");return!!e.setLineDash||!!e.mozDash||!!e.webkitLineDash}return!1}var oc=("undefined"!=typeof window?window:global).Promise,lc=oc,uc="",sc=!1,cc=["create"],fc=["arrange","createLink","filter","foreground","range","animateProperties","expand","hide","layout","load","merge","options","pan","ping","setItem","setProperties","show","toDataURL","viewOptions","zoom"],dc=["combo","getGraphEngine","graph","map"],gc=["arrange","betweenness","close","closeness","combine","hide","transfer","open","options","show","uncombine"];function hc(e,t,n){n&&(uc=n);if(null==lc&&!oc&&!e)throw Error("[promisify] There's no valid Promise constructor available. It is not possible to promisify.");if(!yc(e))throw Error("[promisify] Promise constructor not valid. Please use a valid Promise implementation.");oc=e||lc;if(!sc){vc(t,cc,dc);E(t.components||{}).forEach(function(e){vc(e,fc,dc)})}sc=!0}function vc(e,t,n){t.forEach(function(t){e[t]&&(e[t+uc]=mc(e[t],t,"create"===t))});n&&n.forEach(function(t){e[t]&&(e[t+uc]=bc(e[t],gc))});return e}function mc(e,t,n){return function(){for(var r=Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];var a=Math.max(0,e.length-1);return pc(t,r)?e.apply(null,r):new oc(function(t,i){if(r.length===e.length&&m(r[a])){r.pop();d("A callback has been passed, but the function will return a Promise instead")}function o(e,n){if(e)return i(e);var r=Array.isArray(n),a=(r?n:[n]).map(function(e){return vc(e,fc,dc)});return t(r?a:a[0])}r[a]=n?o:t;e.apply(null,r)})}}function pc(e,t){return!(!/options$/i.test(e)||!M(t[0]))||"range"===e&&!t.length}function bc(e,t){return function(){var n=Array.prototype.slice.call(arguments),r=e.apply(null,n),i={},a=Y(t);Object.keys(r).forEach(function(e){e in a?i[e+uc]=mc(r[e],e):i[e]=r[e]});return i}}function yc(e){var t=e||oc,n=void 0!==t&&"resolve"in t&&"reject"in t;try{new t(function(e){n=n&&"function"==typeof e})}catch(e){throw new Error("You must pass a valid promise constructor")}return n}var Ic=function(){return lr.a||lr.b},xc={charts:Zs,createChart:Xs,imageBasePath:Os,setCanvasPaths:Ds,promisify:function(e,t,n){return hc(e,this,t,n)},components:Zs,coords:ne,create:zs,dashedLineSupport:ac,fullScreenCapable:ec,getFontIcon:Fn,mode:ks,paths:js,setSize:Js,toggleFullScreen:ic,webGLSupport:Il,Rendering:{mainChannel:Ic}};xc.getGraphEngine=Jo;"undefined"!=typeof window&&(window.KeyLines=xc);"undefined"!=typeof global&&(global.KeyLines=xc);return xc});
